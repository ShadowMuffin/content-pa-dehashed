category: Data Enrichment & Threat Intelligence
commonfields:
  id: PhishTank
  version: -1
configuration:
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: '1'
  display: Database refresh interval (hours)
  name: fetchIntervalHours
  required: false
  type: 0
defaultEnabled: false
description: PhishTank is a free community site where anyone can submit, verify, track
  and share phishing data
display: PhishTank
image: data:image/png;base64,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
name: PhishTank
script:
  commands:
  - arguments:
    - default: true
      description: URL to check
      name: url
      required: true
    description: Check URL Reputation
    name: url
    outputs:
    - contextPath: URL.Data
      description: Bad URLs found
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason for the vendor to make the decision
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
  - arguments: []
    description: Reload PhishTank database
    name: phishtank-reload
  - arguments: []
    description: Show PhishTank database status
    name: phishtank-status
  runonce: false
  script: "var listSource = 'http://data.phishtank.com/data/online-valid.csv';\nvar\
    \ listUpdateIntervalHours = 1;\n\nvar isNumber = function(obj) {\n    return (obj\
    \ == parseFloat(obj) && obj > 0);\n}\n\nif (isNumber(params.fetchIntervalHours))\
    \ {\n    listUpdateIntervalHours = params.fetchIntervalHours;\n}\n\nvar getList\
    \ = function() {\n    var res = http(listSource, {Method: 'GET'}, params.insecure,\
    \ params.proxy);\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n \
    \       throw 'Request Failed.\\nStatus code: ' + res.StatusCode + '.\\nBody:\
    \ ' + JSON.stringify(res) + '.';\n    }\n    console.log('LOADING');\n    var\
    \ list = res.Body.split(\"\\n\");\n\n    var obj={};\n    for (var i=0;i<list.length;i++)\
    \ {\n        var line = list[i].split(\",\");\n\n        var url = removeLastSlash(line[1]);\n\
    \        if (url) {\n            obj[url] = {\n                phish_id: line[0],\n\
    \                submission_time: line[3],\n                verified: line[4],\n\
    \                verification_time: line[5],\n                online: line[6],\n\
    \                target: line[7]\n            };\n        }\n    }\n\n    return\
    \ obj;\n};\n\nvar reload = function() {\n    var list = getList();\n    var data={'list':list,'timestamp':new\
    \ Date().getTime()};\n    setIntegrationContext(data);\n    return data;\n};\n\
    \nvar isReloadNeeded = function(data) {\n    if (!data || !data.timestamp || !data.list)\
    \ {\n        return true;\n    }\n    now = new Date().getTime();\n    if (data.timestamp\
    \ < now-(3600*1000*listUpdateIntervalHours)) {\n        return true;\n    }\n\
    \    return false;\n}\n\nvar removeLastSlash=function(pUrl) {\n    var url=pUrl;\n\
    \    if (url) {\n        if (url[url.length - 1] == '/') {\n            url =\
    \ url.substr(0,url.length - 1);\n        }\n    }\n    return url;\n}\nvar doURL\
    \ = function(pUrl) {\n    var data = getIntegrationContext();\n    if (isReloadNeeded(data))\
    \ {\n        data = reload();\n    }\n    var url = removeLastSlash(pUrl);\n \
    \   var ec = {};\n    var md = \"### PhishTank Database - URL Query\\n\";\n\n\
    \    if (data.list[url]) {\n\n        var dbotScore = (data.list[url].verified\
    \ === 'yes') ? 3 : 2;\n        addMalicious(ec, outputPaths.url, {\n         \
    \   Data: args.url,\n            Malicious: {Vendor: 'PhishTank', Description:\
    \ 'Match found in PhishTank database'}\n        });\n        ec.DBotScore = {Indicator:\
    \ args.url, Type: 'url', Vendor: 'PhishTank', Score: dbotScore};\n\n        md\
    \ += \"#### Found matches for URL \" + args.url + \"\\n\";\n        md += objToMd(data.list[url]);\n\
    \        var phishTankURL = 'http://www.phishtank.com/phish_detail.php?phish_id='\
    \ + data.list[url].phish_id;\n        md += 'Additional details at ['+phishTankURL+']('+phishTankURL+')\\\
    n';\n    } else {\n        md += \"#### No matches for URL \" + args.url + \"\\\
    n\";\n        ec.URL = {\n            Data: args.url\n        };\n        ec.DBotScore\
    \ = {Indicator: args.url, Type: 'url', Vendor: 'PhishTank', Score: 0};\n    }\n\
    \    var res = {'url':args.url, 'match': true};\n    return {Type: entryTypes.note,\
    \ Contents: res, ContentsFormat: formats.json, HumanReadable: md, EntryContext:\
    \ ec};\n};\n\nswitch (command) {\n    case 'test-module':\n        if (!isNumber(params.fetchIntervalHours))\
    \ {\n            throw 'PhishTank error: Please provide a numeric value (and bigger\
    \ than 0) for Database refresh interval (hours)';\n        }\n        var list=getList();\n\
    \        if (Object.keys(list).length === 0) {\n            throw 'Error - could\
    \ not fetch PhishTank database';\n        }\n        return 'ok';\n    case 'url':\n\
    \        return doURL(args.url);\n    case 'phishtank-reload':\n        data=reload();\n\
    \        var md = \"PhishTank Database reloaded\\n\";\n        md += \"Total **\"\
    \ + Object.keys(data.list).length + \"** URLs loaded.\\n\";\n        return({Type:\
    \ entryTypes.note, Contents: {}, ContentsFormat: formats.json, HumanReadable:\
    \ md});\n    case 'phishtank-status':\n        data=getIntegrationContext();\n\
    \        var md = \"PhishTank Database Status\\n\";\n        if (!data || !data.list)\
    \ {\n            md += \"Database not loaded.\\n\"\n        } else {\n       \
    \     md += \"Total **\" + Object.keys(data.list).length + \"** URLs loaded.\\\
    n\";\n            md += \"Last load time **\" + new Date(data.timestamp).toString()\
    \ + \"**\\n\";\n        }\n        return({Type: entryTypes.note, Contents: {},\
    \ ContentsFormat: formats.json, HumanReadable: md});\n    default:\n        throw\
    \ 'PhishTank error: unknown command';\n}\n"
  type: javascript
tests:
- PhishTank Testing
toversion: 4.1.9
