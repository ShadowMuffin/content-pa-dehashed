args:
- default: true
  description: Admin user to use for compliance search
  name: username
  required: true
- description: Password for the specified user
  name: password
  required: true
  secret: true
- description: Query to use for finding mails
  name: query
  required: true
- description: in seconds. Default is 5 mins. Max is 2 hours.
  name: timeout
comment: Assign a 'Mailbox Import Export' management role to a user. This script runs
  through the agent on a Windows machine, pulls and executes a  PowerShell script
  - which talks to the Exchange server.
commonfields:
  id: D2O365ComplianceSearch
  version: -1
dependson: {}
name: D2O365ComplianceSearch
script: "//+ o365/office365compliancesearch.ps1\n//Params: Username, Password and\
  \ Query in exchange syntax\nif ((env.ARCH !== \"amd64\") && (env.OS !== \"windows\"\
  )) {\n    throw(\"Script can run only in 64bit Windows Agents\");\n}\nvar command\
  \ = [];\ncommand.push(\"powershell.exe\");\ncommand.push(\"-NonInteractive\");\n\
  command.push(\"-NoLogo\");\ncommand.push(\"'\" + which(\"office365compliancesearch.ps1\"\
  ) + \"'\");\nif (typeof (args.password) !== \"undefined\") {\n    command.push(\"\
  -password\");\n    command.push(\"'\" + args.password + \"'\");\n}\nif (typeof (args.username)\
  \ !== \"undefined\") {\n    command.push(\"-username\");\n    command.push(args.username);\n\
  }\nif (typeof (args.query) !== \"undefined\") {\n    command.push(\"-query\");\n\
  \    command.push(args.query);\n}\n//pack(command.join(\" \"));\ntimeout = 60 *\
  \ 5;\nif (typeof (args.timeout) !== \"undefined\") {\n    //pack('timeout: ' + timeout\
  \ + '\\n');\n    timeout = args.timeout;\n}\nvar results = execute(command.join(\"\
  \ \"), timeout);//, 'table');\nif(results.Error !== \"exit status 0\" || results.Stderr.length\
  \ > 0) {\n    throw \"script failed with an error. \\n\" + results.Error +\n   \
  \ \"\\nstderr: \" + results.Stderr + \"\\nstdout: \" +results.Stdout;\n}\npack(results.Stdout);\n"
scripttarget: 1
system: true
tags:
- email
- office365
timeout: "7.2\xB5s"
toversion: 4.1.9
type: javascript
