args:
- description: Registry path to be checked
  name: input
  required: true
comment: Check the given registry path against a small blacklist (score 3), whitelist
  (score 1), and suspicious list (score 2). If the key matches neither, returns an
  answer of 0.
commonfields:
  id: RegPathReputationBasicLists
  version: -1
enabled: true
name: RegPathReputationBasicLists
runas: DBotWeakRole
runonce: false
script: "WHITELIST = [ r'HKEY_LOCAL_MACHINE\\Software\\wow6432node\\Microsoft\\Windows\\\
  CurrentVersion\\Run\\vmware-tray.exe' ]\nBLACKLIST = [ r'HKEY_CURRENT_USER\\Software\\\
  Locky',\nr'HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\\
  Locky' ]\nSUSPICIOUS = [ r\"HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\\
  UrlSearchHooks\",\nr\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\\
  Run\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Htmlfile\\Shell\\Open\\Command\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Htmlfile\\Shell\\Open\\Command\\(Default)\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Protocols\\Filter\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Classes\\Protocols\\Handler\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\\
  Active Setup\\Installed Components\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\\
  Windows NT\\CurrentVersion\\Windows\\Appinit_Dlls\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\\
  Microsoft\\Windows NT\\CurrentVersion\\Winlogon\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\\
  Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\VmApplet\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Authentication\\Credential Provider\
  \ Filters\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\\
  Authentication\\Credential Providers\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\\
  Windows\\CurrentVersion\\Authentication\\PLAP Providers\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellServiceObjects\",\n\
  r\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\",\nr\"\
  HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Active Setup\\Installed Components\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\\
  Windows\\Appinit_Dlls\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\\
  Windows\\CurrentVersion\\Explorer\\ShellServiceObjects\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\Lsa\\Authentication Packages\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\Lsa\\Notification Packages\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\Security Packages\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\Print\\Monitors\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\SafeBoot\",\nr\"HKEY_LOCAL_MACHINE\\SYSTEM\\\
  CurrentControlSet\\Control\\SafeBoot\\AlternateShell\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\",\nr\"HKEY_LOCAL_MACHINE\\\
  SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SecurityProviders\",\nr\"\
  HKEY_LOCAL_MACHINE\\Software\\Classes\\AllFileSystemObjects\\ShellEx\\ContextMenuHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\AllFileSystemObjects\\ShellEx\\PropertySheetHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\
  Instance\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\\
  Instance\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Background\\ShellEx\\\
  ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\ShellEx\\\
  ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Shellex\\\
  CopyHookHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Shellex\\\
  DragDropHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Shellex\\\
  PropertySheetHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Drive\\ShellEx\\\
  ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Folder\\ShellEx\\\
  ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Folder\\ShellEx\\\
  DragDropHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Folder\\ShellEx\\\
  PropertySheetHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Classes\\Folder\\Shellex\\\
  ColumnHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\\
  Drivers32\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\\
  Windows\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\\
  Windows\\IconServiceLib\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\\
  CurrentVersion\\Explorer\\Browser Helper Objects\",\nr\"HKEY_LOCAL_MACHINE\\Software\\\
  Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers\",\nr\"\
  HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\",\nr\"\
  HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\AllFileSystemObjects\\ShellEx\\\
  ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\\
  AllFileSystemObjects\\ShellEx\\PropertySheetHandlers\",\nr\"HKEY_LOCAL_MACHINE\\\
  Software\\Wow6432Node\\Classes\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\
  Instance\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\CLSID\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\\
  Instance\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Directory\\\
  Background\\ShellEx\\ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\\
  Classes\\Directory\\ShellEx\\ContextMenuHandlers\",\nr\"HKEY_LOCAL_MACHINE\\Software\\\
  Wow6432Node\\Classes\\Directory\\Shellex\\CopyHookHandlers\",\nr\"HKEY_LOCAL_MACHINE\\\
  Software\\Wow6432Node\\Classes\\Directory\\Shellex\\DragDropHandlers\",\nr\"HKEY_LOCAL_MACHINE\\\
  Software\\Wow6432Node\\Classes\\Directory\\Shellex\\PropertySheetHandlers\",\nr\"\
  HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Drive\\ShellEx\\ContextMenuHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Folder\\ShellEx\\ContextMenuHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Folder\\ShellEx\\DragDropHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Folder\\ShellEx\\PropertySheetHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Classes\\Folder\\Shellex\\ColumnHandlers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\\
  Drivers32\",\nr\"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\\
  CurrentVersion\\Explorer\\Browser Helper Objects\",\nr\"HKEY_LOCAL_MACHINE\\Software\\\
  Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Control\\ServiceControlManagerExtension\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Control\\Session Manager\\BootExecute\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Control\\Session Manager\\KnownDlls\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\\StartupPrograms\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Services\\WinSock2\\Parameters\\NameSpace_Catalog5\\\
  Catalog_Entries\",\nr\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\\
  WinSock2\\Parameters\\NameSpace_Catalog5\\Catalog_Entries64\",\nr\"HKEY_LOCAL_MACHINE\\\
  System\\CurrentControlSet\\Services\\WinSock2\\Parameters\\Protocol_Catalog9\\Catalog_Entries\"\
  ,\nr\"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\WinSock2\\Parameters\\\
  Protocol_Catalog9\\Catalog_Entries64\",\nr\"HKEY_LOCAL_MACHINE\\software\\microsoft\\\
  windows\\currentversion\\policies\\explorer\\run\",\nr\"HKEY_CURRENT_USER\\Software\\\
  Microsoft\\Windows\\CurrentVersion\\RunServices\",\nr\"HKEY_LOCAL_MACHINE\\Software\\\
  Microsoft\\Windows\\CurrentVersion\\RunServices\",\nr\"HKEY_LOCAL_MACHINE\\software\\\
  microsoft\\wbem\\ess\\//./root/cimv2\\win32clockprovider\",\nr\"HKEY_LOCAL_MACHINE\\\
  Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\",\nr\"HKEY_CURRENT_USER\\\
  Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\",\nr\"HKEY_CURRENT_USER\\\
  SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\",\nr\"HKEY_LOCAL_MACHINE\\\
  SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ShellServiceObjectDelayLoad\",\nr\"\
  HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\",\n\
  r\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\",\nr\"\
  HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\",\nr\"\
  HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\\
  Run\",\nr\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows NT\\CurrentVersion\\\
  Windows\\load\",\nr\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\\
  Explorer\\SharedTaskScheduler\" ]\n\n# registry keys are case insensative: https://docs.microsoft.com/en-us/windows/desktop/sysinfo/structure-of-the-registry\n\
  reg_path = NormalizeRegistryPath(demisto.args()['input'].upper())\n\ndef check_reg_in_list(path,\
  \ list_to_check):\n    for key in list_to_check:\n        if path.startswith(key.upper()):\n\
  \          return True\n    return False\n\nif check_reg_in_list(reg_path, WHITELIST):\n\
  \    score = 1\nelif check_reg_in_list(reg_path, BLACKLIST):\n    score = 3\nelif\
  \ check_reg_in_list(reg_path, SUSPICIOUS):\n    score = 2\nelse:\n    score = 0\n\
  \noutputs = {\n    'Path': reg_path,\n    'Score': score\n}\n\ndemisto.results({\n\
  \    'Type': entryTypes['note'],\n    'ContentsFormat': formats['json'],\n    'Contents':\
  \ score,\n    'ReadableContentsFormat': formats['text'],\n    'HumanReadable': \"\
  The Registry Path reputation for: {} is: {}\".format(reg_path, score),\n    'EntryContext':\
  \ {\n        'RegistryKey(val.Path == obj.Path)': outputs\n    }\n})"
scripttarget: 0
subtype: python2
tags:
- registry
- reputation
tests:
- RegPathReputationBasicLists_test
toversion: 4.1.9
type: python
