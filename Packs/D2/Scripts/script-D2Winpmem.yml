comment: Use the D2 agent to carry the winpmem binary to a system and return the memory
  dump file to the war room. This usually takes a while, depending on amount of RAM
  in the target system.
commonfields:
  id: D2Winpmem
  version: -1
dependson: {}
name: D2Winpmem
script: "//+winpmem/winpmem_2.0.1.exe\ntry {\n  if (env.OS !== 'windows') {\n    throw\
  \ ('script can only run on Windows');\n  }\n  var arch = wmi_query('select OSArchitecture\
  \ from win32_operatingsystem')[0].OSArchitecture;\n  var exename = 'winpmem_2.0.1.exe';\n\
  \  var dumpFile = env.TEMP + '\\\\mem.dump';\n  var output = execute(exename + '\
  \ -v -o ' + dumpFile, 600); // 10 minutes timeout\n  pack(output.Stdout);\n  if\
  \ (output.Success) {\n    pack_file(dumpFile);\n    del(dumpFile);\n  } else {\n\
  \    throw output.Error;\n  }\n} catch (ex) {\n  pack('Winpmem failed: ' + ex);\n\
  }"
scripttarget: 1
system: true
tags:
- agent
- memory
- forensics
timeout: 0s
toversion: 4.1.9
type: javascript
