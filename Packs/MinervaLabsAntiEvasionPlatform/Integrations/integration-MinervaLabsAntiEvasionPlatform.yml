category: Endpoint
commonfields:
  id: Minerva Labs Anti-Evasion Platform
  version: -1
configuration:
- defaultvalue: ''
  display: Minerva Management Console URL
  name: url
  required: true
  type: 0
- defaultvalue: ''
  display: Username
  name: credentials
  required: true
  type: 9
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Minerva eliminates the endpoint security gap while empowering companies
  to embrace technology fearlessly.
detaileddescription: 'Minerva Labs integration with Demisto.

  The integration queries the Minerva server for new events, endpoint status, groups
  and able to create active response such as adding vaccinations and exclusions.'
display: Minerva Labs Anti-Evasion Platform
image: data:image/png;base64,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
name: Minerva Labs Anti-Evasion Platform
script:
  commands:
  - arguments:
    - description: data
      name: data
      required: true
    - auto: PREDEFINED
      description: The exclusion type.
      name: type
      predefined:
      - hash
      - path
      required: true
    - defaultValue: All Groups
      description: A list of group IDs to which this exclusion applies.
      isArray: true
      name: appliedGroupsIds
    - description: A description of the exclusion.
      name: description
      required: true
    description: Add exclusions to Minerva Console.
    execution: true
    name: minerva-add-exclusion
    outputs:
    - contextPath: Minerva.Exclusion.Id
      description: Exclusion ID.
      type: string
    - contextPath: Minerva.Exclusion.Type
      description: Exclusion type.
      type: string
    - contextPath: Minerva.Exclusion.Data
      description: Exclusion data.
      type: string
    - contextPath: Minerva.Exclusion.Description
      description: A description of the exclusion.
      type: string
    - contextPath: Minerva.Exclusion.lastModifiedBy
      description: The user that last modified this exclusion.
      type: string
    - contextPath: Minerva.Exclusion.lastModifiedOn
      description: The date this exclusion was last modified.
      type: date
    - contextPath: Minerva.Exclusion.appliedGroupsIds
      description: Group IDs to which this exclusion applies.
      type: string
  - arguments:
    - description: Name of the mutex.
      name: name
      required: true
    - description: A description of the vaccination.
      name: description
    - auto: PREDEFINED
      defaultValue: 'False'
      description: isMonitorOnly
      name: isMonitorOnly
      predefined:
      - 'True'
      - 'False'
    description: Vaccinate with Minerva.
    execution: true
    name: minerva-add-vaccine
    outputs:
    - contextPath: Minerva.Vaccine.Name
      description: Name of the mutex vaccination.
      type: string
    - contextPath: Minerva.Vaccine.Description
      description: A description of the mutex vaccination.
      type: string
    - contextPath: Minerva.Vaccine.isMonitorOnly
      description: Whether this mutex vaccination is only monitored.
      type: boolean
    - contextPath: Minerva.Vaccine.lastModifiedBy
      description: The user that last modified this mutex vaccination.
      type: string
    - contextPath: Minerva.Vaccine.lastModifiedOn
      description: The date this mutex vaccination was last modified.
      type: date
    - contextPath: Minerva.Vaccine.Id
      description: Mutex vaccination ID.
      type: string
    - contextPath: Minerva.Vaccine.Type
      description: 'Vaccine type, for example: Mutex.'
      type: string
  - arguments:
    - auto: PREDEFINED
      description: Parameter to search for.
      name: param
      predefined:
      - fileHash
      - processCommandLine
      - processName
      - username
      - endpoint
      required: true
    - auto: PREDEFINED
      description: A condition to apply to the search.
      name: condition
      predefined:
      - equalTo
      - notEqualTo
      - contain
      - notContain
      - startWith
      - endWith
      required: true
    - description: value
      name: value
      required: true
    description: Search processes with Minerva.
    name: minerva-search-process
    outputs:
    - contextPath: Minerva.Process.Endpoint
      description: The name of the endpoint on which the process was run.
      type: string
    - contextPath: Minerva.Process.SHA256
      description: The SHA256 hash of the process.
      type: string
    - contextPath: Minerva.Process.CommandLine
      description: The process command line.
      type: string
    - contextPath: Minerva.Process.Username
      description: The user name with which the process was executed.
      type: string
    - contextPath: Minerva.Process.Createtime
      description: The time the process was created.
      type: date
    - contextPath: Minerva.Process.Pid
      description: The process ID.
      type: number
    - contextPath: Minerva.Process.Name
      description: The process name.
      type: string
  - arguments:
    - auto: PREDEFINED
      description: Parameter to search for.
      name: param
      predefined:
      - group
      - endpoint
      - loggedOnUsers
      - armorVersion
      - receivedIpAddress
      - reportedIpAddress
      - operatingSystem
      required: true
    - auto: PREDEFINED
      description: A condition to apply to the search.
      name: condition
      predefined:
      - equalTo
      - notEqualTo
      - contain
      - notContain
      - startWith
      - endWith
      required: true
    - description: value
      name: value
      required: true
    description: Search Minerva for an endpoint.
    name: minerva-search-endpoint
    outputs:
    - contextPath: Minerva.Endpoint.Group
      description: The group to which the endpoint belongs.
      type: string
    - contextPath: Minerva.Endpoint.Name
      description: The endpoint name.
      type: string
    - contextPath: Minerva.Endpoint.Users
      description: The list of logged-on users.
      type: string
    - contextPath: Minerva.Endpoint.IP
      description: The reported IP address.
      type: string
    - contextPath: Minerva.Endpoint.OS
      description: The endpoint operating system.
      type: string
  - arguments: []
    description: Fetches all the groups defined in Minerva Management Console.
    name: minerva-get-groups
    outputs:
    - contextPath: Minerva.Group.Id
      description: The ID of the group.
      type: string
    - contextPath: Minerva.Group.Name
      description: The name of the group.
      type: string
    - contextPath: Minerva.Group.Policy
      description: The policy applied to the group.
      type: string
    - contextPath: Minerva.Group.PolicyVersion
      description: The policy version applied to the group.
      type: string
    - contextPath: Minerva.Group.EndpointSettings
      description: The settings applied to the group.
      type: string
    - contextPath: Minerva.Group.Endpoints
      description: The number of endpoints in the group.
      type: number
    - contextPath: Minerva.Group.Comment
      description: The comment the group creator added.
      type: string
    - contextPath: Minerva.Group.CreationTime
      description: The time the group was created.
      type: date
  - arguments: []
    description: Retrieves the mutex vaccines.
    name: minerva-get-vaccines
    outputs:
    - contextPath: Minerva.Vaccine.Name
      description: Mutex vaccination name.
      type: string
    - contextPath: Minerva.Vaccine.Description
      description: Mutex vaccination description.
      type: string
    - contextPath: Minerva.Vaccine.isMonitorOnly
      description: Whether this mutex vaccination is only monitored without simulation.
      type: boolean
    - contextPath: Minerva.Vaccine.lastModifiedBy
      description: The user that last modified this mutex vaccination.
      type: string
    - contextPath: Minerva.Vaccine.lastModifiedOn
      description: The date this mutex vaccination was last modified.
      type: date
    - contextPath: Minerva.Vaccine.Id
      description: Mutex vaccination ID.
      type: string
  - arguments:
    - description: The vaccine the specified vaccines.
      name: vaccine_id
      required: true
    description: Deletes a vaccine by the vaccine ID.
    name: minerva-delete-vaccine
  - arguments: []
    description: Retrieves all exclusions.
    name: minerva-get-exclusions
    outputs:
    - contextPath: Minerva.Exclusion.Id
      description: Exclusion ID.
      type: string
    - contextPath: Minerva.Exclusion.Type
      description: Exclusion type.
      type: string
    - contextPath: Minerva.Exclusion.Data
      description: Exclusion data.
      type: string
    - contextPath: Minerva.Exclusion.Description
      description: 'Exclusion description. '
      type: string
    - contextPath: Minerva.Exclusion.lastModifiedBy
      description: The user that last modified this exclusion.
      type: string
    - contextPath: Minerva.Exclusion.lastModifiedOn
      description: The date this exclusion was last modified.
      type: date
    - contextPath: Minerva.Exclusion.appliedGroupsIds
      description: Group IDs to which this exclusion applies.
      type: string
  - arguments:
    - description: Exclusion ID.
      isArray: true
      name: id
      required: true
    - auto: PREDEFINED
      description: Exclusion type.
      name: type
      predefined:
      - hash
      - path
      - script
      - certificate
      required: true
    description: Deletes an exclusion by the exculsion ID.
    name: minerva-delete-exclusion
  - arguments: []
    description: Moves all the events from Archive state to New event state.
    name: minerva-unarchive-events
  isfetch: true
  runonce: false
  script: "''' IMPORTS '''\nimport json\n\nimport requests\n\n# disable insecure warnings\n\
    requests.packages.urllib3.disable_warnings()\n\n\n''' GLOBALS '''\nUSERNAME =\
    \ demisto.params().get('credentials').get('identifier')\nPASSWORD = demisto.params().get('credentials').get('password')\n\
    BASE_URL = demisto.params().get('url')\nVERIFY_SSL = not demisto.params().get('insecure',\
    \ False)\n\n\n''' HELPERS '''\ndef get_session():\n    session = requests.Session()\n\
    \    session.verify = VERIFY_SSL\n    return session\n\n\ndef create_entry_context(context_id,\
    \ data):\n    ec = {}\n    if context_id.endswith('processes'):\n        context\
    \ = []\n        for process in data:\n            process_context = {\n      \
    \          'Endpoint': process['endpoint'],\n                'SHA256': process['fileHash'],\n\
    \                'CommandLine': process['processCommandLine'],\n             \
    \   'Username': process['username'],\n                'CreateTime': process['startTime'],\n\
    \                'Pid': process['processId'],\n                'Name': process['processName']\n\
    \            }\n            context.append(process_context)\n        ec['Minerva.Process(val.Id\
    \ === obj.Id)'] = context\n    elif context_id.endswith('endpoints'):\n      \
    \  context = []\n        for endpoint in data:\n            endpoint_context =\
    \ {\n                'Group': endpoint['group'],\n                'Name': endpoint['endpoint'],\n\
    \                'Users': endpoint['loggedOnUsers'],\n                'IP': endpoint['reportedIpAddress'],\n\
    \                'OS': endpoint['operatingSystem']\n            }\n          \
    \  context.append(endpoint_context)\n        ec['Minerva.Endpoint(val.Id === obj.Id)']\
    \ = context\n    elif context_id.endswith('groups'):\n        context = []\n \
    \       for group in data:\n            group_context = {\n                'Name':\
    \ group['name'],\n                'Id': group['id'],\n                'Policy':\
    \ group['policy'],\n                'PolicyVersion': group['policyVersion'],\n\
    \                'SimulationStatus': group['endpointSettings'],\n            \
    \    'Endpoints': group['endpoints'],\n                'CreationTime': group['creationTime']\n\
    \            }\n            context.append(group_context)\n        ec['Minerva.Group(val.Id\
    \ === obj.Id)'] = context\n    elif context_id.endswith('vaccination'):\n    \
    \    context = []\n        if isinstance(data, list):\n            for vaccine\
    \ in data:\n                vaccine_context = {\n                    'Id': vaccine['id'],\n\
    \                    'Name': vaccine['name'],\n                    'Type': vaccine['type'],\n\
    \                    'Description': vaccine['description'],\n                \
    \    \"IsMonitorOnly\": vaccine['isMonitorOnly'],\n                    'Last modified\
    \ by': vaccine['lastModifiedBy'],\n                    'Last modified on': vaccine['lastModifiedOn']\n\
    \                }\n                context.append(vaccine_context)\n        \
    \    ec['Minerva.Vaccine(val.Id === obj.Id)'] = context\n        else:\n     \
    \       context = {\n                'Id': data['id'],\n                'Name':\
    \ data['name'],\n                'Type': data['type'],\n                'Description':\
    \ data['description'],\n                \"IsMonitorOnly\": data['isMonitorOnly'],\n\
    \                'Last modified by': data['lastModifiedBy'],\n               \
    \ 'Last modified on': data['lastModifiedOn']\n                }\n            ec['Minerva.Vaccine(val.Id\
    \ === obj.Id)'] = context\n    elif context_id.endswith('exclusions'):\n     \
    \   context = []\n        if isinstance(data, list):\n            for exclusion\
    \ in data:\n                exclusion_context = {\n                    'Id': exclusion['id'],\n\
    \                    'Type': exclusion['type'],\n                    'Exclusion\
    \ data': exclusion['data'],\n                    'Description': exclusion['description'],\n\
    \                    'Last modified by': exclusion['lastModifiedBy'],\n      \
    \              'Last modified on': exclusion['lastModifiedOn'],\n            \
    \        'Applied groups': exclusion['appliedGroupsIds']\n                }\n\
    \                context.append(exclusion_context)\n            ec['Minerva.Exclusion(val.Id\
    \ === obj.Id)'] = context\n        else:\n            context = {\n          \
    \      'Id': data['id'],\n                'Type': data['type'],\n            \
    \    'Exclusion data': data['data'],\n                'Description': data['description'],\n\
    \                'Last modified by': data['lastModifiedBy'],\n               \
    \ 'Last modified on': data['lastModifiedOn'],\n                'Applied groups':\
    \ data['appliedGroupsIds']\n            }\n            ec['Minerva.Exclusion(val.Id\
    \ === obj.Id)'] = context\n    else:\n        LOG('Failed to create entry context\
    \ for {}'.format(context_id))\n\n    return ec\n\n\n''' FUNCTIONS '''\ndef get_from_url(url):\n\
    \    url_text = url.split('/')[-1]\n    response = session.get(url)\n    if response.status_code\
    \ is not 200:\n        return_error('Error while fetching {}. More information:\
    \ {}, {}'.format(url_text, response.status_code, response.reason))\n\n    if not\
    \ response.json():\n        return {\n            'Type': entryTypes['note'],\n\
    \            'ContentsFormat': formats['markdown'],\n            'Contents': 'No\
    \ contents retrieved for {}'.format(url_text)\n        }\n\n    return {\n   \
    \     'Type': entryTypes['note'],\n        'ContentsFormat': formats['markdown'],\n\
    \        'Contents': response.json(),\n        'HumanReadable': tableToMarkdown(pascalToSpace(url_text),\
    \ response.json(), headerTransform=pascalToSpace, removeNull=True),\n        'EntryContext':\
    \ create_entry_context(url_text, response.json())\n    }\n\n\n@logger\ndef login():\n\
    \    return session.post(BASE_URL + '/api/login',\n                        json={'username':\
    \ USERNAME,\n                              'password': PASSWORD})\n\n\n@logger\n\
    def logout():\n    session.post(BASE_URL + '/api/login/logout')\n\n\ndef fetch_incidents():\n\
    \    try:\n        r_events = session.post(BASE_URL + '/api/events',\n       \
    \                         json={\"archive\": False})\n        if r_events.status_code\
    \ is not 200:\n            raise Exception('Error in API call. More information:\
    \ {}, {}'.format(r_exclusion.status_code, r_exclusion.reason))\n\n        incidents\
    \ = []\n        for event in r_events.json():\n            incident = {\n    \
    \            'name': 'Minerva Labs Event - {}'.format(event['type']),\n      \
    \          'rawJSON': json.dumps(event)\n            }\n            incidents.append(incident)\n\
    \            session.put(BASE_URL + '/api/events/archive',\n                 \
    \       json={'events': event['id']})\n        demisto.incidents(incidents)\n\
    \    except Exception, e:\n        return_error('Error while fetching incidents.\
    \ More information: {}'.format(e.message))\n\n\n@logger\ndef get_groups():\n \
    \   get_groups_url = BASE_URL + '/api/groups'\n    response = session.get(get_groups_url,\
    \ params={'_limit': '1000'})\n    if response.status_code is not 200 or not response.json():\n\
    \        return_error('Error while fetching groups. More information: {}, {}'.format(response.status_code,\
    \ response.reason))\n\n    results = {\n        'Type': entryTypes['note'],\n\
    \        'ContentsFormat': formats['markdown'],\n        'Contents': response.json(),\n\
    \        'HumanReadable': tableToMarkdown('Available groups', t=response.json(),\
    \ headerTransform=pascalToSpace, removeNull=True),\n        'EntryContext': create_entry_context(get_groups_url,\
    \ response.json())\n    }\n    demisto.results(results)\n\n\n@logger\ndef add_exclusion(exclusion_type,\
    \ exclusion_data, exclusion_description, groups_id):\n    groups_ids_list = [group_id.strip()\
    \ for group_id in groups_id.split(',')]\n    json_params = {\n        'type':\
    \ exclusion_type,\n        'description': exclusion_description,\n        'data':\
    \ exclusion_data,\n        'appliedGroupsIds': groups_ids_list\n    }\n    exclusions_url=\
    \ BASE_URL + '/api/exclusions'\n    response = session.post(exclusions_url, json=json_params)\n\
    \    if response.status_code == 409 and response.reason == 'Conflict':\n     \
    \   demisto.results('Exclusion already exists')\n        return\n    if response.status_code\
    \ is not 200:\n        return_error('Error while adding exclusion. More information:\
    \ {}, {}'.format(response.status_code, response.reason))\n\n    results = {\n\
    \        'Type': entryTypes['note'],\n        'ContentsFormat': formats['markdown'],\n\
    \        'Contents': response.json(),\n        'HumanReadable': tableToMarkdown('Exclusion\
    \ \\'{}\\' was added'.format(exclusion_description), response.json(), headerTransform=pascalToSpace,\
    \ removeNull=True),\n        'EntryContext': create_entry_context(exclusions_url,\
    \ response.json())\n    }\n\n    demisto.results(results)\n\n\n@logger\ndef get_exclusions():\n\
    \    results = get_from_url(BASE_URL + '/api/exclusions')\n    demisto.results(results)\n\
    \n\n@logger\ndef delete_exclusion(exclusion_id, exclusion_type):\n    json_params\
    \ = {\n        'id': exclusion_id,\n        'type': exclusion_type\n    }\n  \
    \  response = session.post(BASE_URL + '/api/exclusions/delete', json=[json_params])\n\
    \    if response.status_code is not 200:\n        return_error('Error while deleting\
    \ exclusions. More information: {}, {}'.format(response.status_code, response.reason))\n\
    \    demisto.results('Exclusion {} was deleted'.format(exclusion_id))\n\n\n@logger\n\
    def add_vaccine(vaccine_name, vaccine_desc, monitor_only):\n    json_params =\
    \ {'name': vaccine_name,\n                   'description': vaccine_desc,\n  \
    \                 'isMonitorOnly': monitor_only,\n                   'type': 'mutex'}\n\
    \    vaccination_url = BASE_URL + '/api/vaccination'\n    response = session.post(vaccination_url,\
    \ json=json_params)\n    if response.status_code == 409 and response.reason ==\
    \ 'Conflict':\n        demisto.results('Vaccination already exists')\n       \
    \ return\n    if response.status_code is not 200:\n        return_error('Error\
    \ while adding a vaccine. More information: {}, {}'.format(response.status_code,\
    \ response.reason))\n\n    results = {\n        'Type': entryTypes['note'],\n\
    \        'ContentsFormat': formats['markdown'],\n        'Contents': response.json(),\n\
    \        'HumanReadable': tableToMarkdown('Vaccination \\'{}\\' was added'.format(vaccine_desc),\
    \ response.json(), headerTransform=pascalToSpace, removeNull=True)\n    }\n\n\
    \    if response.json():\n        results['EntryContext'] = create_entry_context(vaccination_url,\
    \ response.json())\n\n    demisto.results(results)\n\n\n@logger\ndef get_vaccines():\n\
    \    results = get_from_url(BASE_URL + '/api/vaccination')\n    demisto.results(results)\n\
    \n\n@logger\ndef delete_vaccines(vaccine_id):\n    response = session.delete(BASE_URL\
    \ + '/api/vaccination', params={'ids': [vaccine_id]})\n    if response.status_code\
    \ == 404:\n        demisto.results('Vaccination with id {} was not found'.format(vaccine_id))\n\
    \        return\n    if response.status_code is not 200:\n        return_error('Error\
    \ while deleting vaccination id: {}. More information: {}, {}'.format(vaccine_id,\
    \ response.status_code, response.reason))\n    demisto.results('Vaccine \\'{}\\\
    ' was deleted'.format(vaccine_id))\n\n\n@logger\ndef search(search_url, search_param,\
    \ search_condition, search_value):\n    json_params = {'filters': [{'param': search_param,\n\
    \                                'condition': search_condition,\n            \
    \                    'value': search_value}]}\n    response = session.post(search_url,\n\
    \                            json=json_params)\n    if response.status_code is\
    \ not 200:\n        return_error('Error while perfroming search for {}. More information:\
    \ {}, {}'.format(search_url.rsplit('/')[1], response.status_code, response.reason))\n\
    \n    results = {\n        'Type': entryTypes['note'],\n        'ContentsFormat':\
    \ formats['markdown'],\n        'Contents': response.json(),\n        'HumanReadable':\
    \ tableToMarkdown('Search results for \\'{}\\''.format(search_url.split('/')[-1]),\
    \ response.json(), headerTransform=pascalToSpace, removeNull=True),\n        'EntryContext':\
    \ create_entry_context(search_url, response.json())\n    }\n\n    demisto.results(results)\n\
    \n\n@logger\ndef unarchive_events():\n    response = session.put(BASE_URL + '/api/events/archive',\
    \ json={'shouldArchive': False})\n    if response.status_code is not 200:\n  \
    \      return_error('Error while un-archiving events. More information: {}, {}'.format(response.status_code,\
    \ response.reason))\n    demisto.results('Events were un-archived')\n\n\n''' EXECUTION\
    \ '''\nsession = get_session()\ntry:\n    handle_proxy()\n\n    args = demisto.args()\n\
    \n    def add_exclusion_command():\n        exclusion_type = args.get('type')\n\
    \        exclusion_data = args.get('data')\n        exclusion_description = args.get('description')\n\
    \        groups_id = args.get('appliedGroupsIds')\n        add_exclusion(exclusion_type,\
    \ exclusion_data, exclusion_description, groups_id)\n\n    def delete_exclusion_command():\n\
    \        exclusion_id = args.get('id')\n        exclusion_type = args.get('type')\n\
    \        delete_exclusion(exclusion_id, exclusion_type)\n\n    def add_vaccine_command():\n\
    \        vaccine_name = args.get('name')\n        vaccine_desc = args.get('description')\n\
    \        monitor_only = args.get('isMonitorOnly')\n        add_vaccine(vaccine_name,\
    \ vaccine_desc, monitor_only)\n\n    def delete_vaccines_command():\n        vaccine_id\
    \ = args.get('vaccine_id')\n        delete_vaccines(vaccine_id)\n\n    def search_process_command():\n\
    \        processes_search_url = BASE_URL + '/api/processes'\n        search_param\
    \ = args.get('param')\n        search_condition = args.get('condition')\n    \
    \    search_value = args.get('value')\n        search(processes_search_url, search_param,\
    \ search_condition, search_value)\n\n    def search_endpoint_command():\n    \
    \    endpoint_search_url = BASE_URL + '/api/endpoints'\n        search_param =\
    \ args.get('param')\n        search_condition = args.get('condition')\n      \
    \  search_value = args.get('value')\n        search(endpoint_search_url, search_param,\
    \ search_condition, search_value)\n\n    def get_groups_command():\n        get_groups()\n\
    \n\n    LOG('Command is {}'.format(demisto.command()))\n    if USERNAME and PASSWORD:\n\
    \        minerva_login = login()\n    else:\n        return_error('Failed to log\
    \ in, no credentials were given')\n    if demisto.command() == 'fetch-incidents':\n\
    \        fetch_incidents()\n    elif demisto.command() == 'test-module':\n   \
    \     if minerva_login.status_code == 200:\n            demisto.results('ok')\n\
    \        else:\n            return_error('Failed to log in. More information:\
    \ {}, {}', minerva_login.status_code, minerva_login.reason)\n    elif demisto.command()\
    \ == 'minerva-add-exclusion':\n        add_exclusion_command()\n    elif demisto.command()\
    \ == 'minerva-get-exclusions':\n        get_exclusions()\n    elif demisto.command()\
    \ == 'minerva-delete-exclusion':\n        delete_exclusion_command()\n    elif\
    \ demisto.command() == 'minerva-add-vaccine':\n        add_vaccine_command()\n\
    \    elif demisto.command() == 'minerva-get-vaccines':\n        get_vaccines()\n\
    \    elif demisto.command() == 'minerva-delete-vaccine':\n        delete_vaccines_command()\n\
    \    elif demisto.command() == 'minerva-search-process':\n        search_process_command()\n\
    \    elif demisto.command() == 'minerva-search-endpoint':\n        search_endpoint_command()\n\
    \    elif demisto.command() == 'minerva-get-groups':\n        get_groups_command()\n\
    \    elif demisto.command() == 'minerva-unarchive-events':\n        unarchive_events()\n\
    except Exception, e:\n    LOG('Cannot perform the command: {}. Error: {}'.format(demisto.command(),\
    \ e.message))\n    LOG.print_log()\n    return_error(e.message)\nfinally:\n  \
    \  logout()\n"
  subtype: python2
  type: python
tests:
- Minerva Test playbook
toversion: 4.1.9
