category: Network Security
commonfields:
  id: Cisco CloudLock
  version: -1
configuration:
- defaultvalue: https://api.cloudlock.com
  display: Server URL (e.g. https://192.168.0.1)
  name: server
  required: true
  type: 0
- defaultvalue: v2
  display: Version
  name: version
  required: true
  type: 0
- defaultvalue: ''
  display: API token
  name: token
  required: true
  type: 4
- defaultvalue: 'false'
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: 'false'
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Query Cisco CloudLock
display: Cisco CloudLock
hidden: false
image: data:image/png;base64,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
name: Cisco CloudLock
script:
  commands:
  - arguments:
    - description: To indicate the item number to start the result set from
      name: offset
    - description: To determine the quantity of results to return in the response
      name: limit
    - description: "Use the \u201Corder\u201D parameter to indicate the order for\
        \ your request list result. For multiple sort orders use a comma-delimted\
        \ list of sort parameters. Default direction is ascending, and a leading \u201C\
        -\u201D character denotes descending"
      name: order
    - description: 'The application supplying the underlying data (i.e. Google Drive,
        Google Sites). platform value should be in the format: <vendor>_<origin_type>'
      name: platform
    - description: comma delimited list of owner email addresses
      name: users
    - description: exposure level of the document
      name: exposure
    - auto: PREDEFINED
      description: The applications trust rating
      name: asset_type
      predefined:
      - google_document
      - google_spreadsheet
      - google_presentation
      - google_form
      - google_drawing
      - google_site
      - google_non_native_file
      - pdf
      - folder
    - description: The mime type of the object/document (if any)
      name: mime_type
    - description: Filters assets updated before the specified timestamp
      name: updated_before
    - description: Filters assets updated after the specified timestamp
      name: updated_after
    description: This endpoint will return data about the users in the cloud lock
      system
    name: cloudlock-get-users
    outputs:
    - contextPath: CloudLock.Users.ID
      description: CloudLock user ID
    - contextPath: CloudLock.Users.Name
      description: CloudLock user name
    - contextPath: CloudLock.Users.Suspended
      description: CloudLock user suspended
    - contextPath: CloudLock.Users.OU
      description: CloudLock user OU
    - contextPath: CloudLock.Users.Incidents.Total
      description: CloudLock user total incidents
    - contextPath: CloudLock.Users.Incidents.Active
      description: CloudLock user active incidents
    - contextPath: CloudLock.Users.Entities.Total
      description: CloudLock user total entities
    - contextPath: CloudLock.Users.Entities.Exposed
      description: CloudLock user exposed entities
  - arguments:
    - default: true
      description: 'User email '
      name: email
      required: true
    description: This endpoint returns all of the applications installed by a user
      (based on the users email address)
    name: cloudlock-get-user-apps
    outputs:
    - contextPath: CloudLock.Users,Applications.Category
      description: CloudLock user application category
    - contextPath: CloudLock.Users,Applications.AccessRisk
      description: CloudLock user application access risk
    - contextPath: CloudLock.Users,Applications.RiskLevel
      description: CloudLock user application risk level
    - contextPath: CloudLock.Users,Applications.ID
      description: CloudLock user application id
    - contextPath: CloudLock.Users,Applications.Name
      description: CloudLock user application name
    - contextPath: CloudLock.Users,Applications.Vendor
      description: CloudLock user application vendor
  - arguments:
    - description: Filter based on the event type i.e. login, user_settings, other
      name: event_type
    - description: Filter based on the event id or a group of ids (needs url encoding)
      name: ids
    - description: Filter based on the creation date
      name: created_after
    - defaultValue: User-Email
      description: Filter results by this key
      name: filter_key
    - description: Filter results by this value of the key
      name: filter_value
    description: Returns UBA (User Behavioral Analysis) activities
    name: cloudlock-get-activities
    outputs:
    - contextPath: CloudLock.Activities.ID
      description: Activity ID
    - contextPath: CloudLock.Activities.IP
      description: Activity IP
    - contextPath: CloudLock.Activities.Type
      description: Activity type
    - contextPath: CloudLock.Activities.Created
      description: Activity creation time
    - contextPath: CloudLock.Activities.Successful
      description: Activity successful
    - contextPath: CloudLock.Activities.Location.Latitude
      description: Activity latitude
    - contextPath: CloudLock.Activities.Location.Longitude
      description: Activity longitudr
    - contextPath: CloudLock.Activities.Location.Country.Code
      description: Activity country code
    - contextPath: CloudLock.Activities.Location.Country.Name
      description: Activity country name
    - contextPath: CloudLock.Activities.Location.Region.Code
      description: Activity region code
    - contextPath: CloudLock.Activities.Location.Region.Name
      description: Activity region name
    - contextPath: CloudLock.Activities.Location.City
      description: Activity city
    - contextPath: CloudLock.Activities.Category
      description: Activity category
    - contextPath: CloudLock.Activities.OriginID
      description: Activity OriginID
    - contextPath: CloudLock.Activities.User.Email
      description: Activity user email
    - contextPath: CloudLock.Activities.User.VendorID
      description: Activity user vendor id
    - contextPath: CloudLock.Activities.Vendor.Name
      description: Activity vendor name
    - contextPath: CloudLock.Activities.Vendor.Service
      description: Activity vendor service
    - contextPath: CloudLock.Activities.User.FullName
      description: Activity user full name
  script: "var base = params.server.replace(/[\\/]+$/, '') + '/api/' + params.version\
    \ + '/';\n\nvar commands = {\n    'cloudlock-get-users': {\n        url: 'users',\n\
    \        method: 'GET',\n        extended: true,\n        title: 'CloudLock get\
    \ users response',\n        contextPath: 'CloudLock.Users(val.ID==obj.ID)',\n\
    \        translator: [\n            {to: 'ID', from: 'id'},\n            {to:\
    \ 'Name', from: 'name'},\n            {to: 'Suspended', from: 'suspended'},\n\
    \            {to: 'Email', from: 'email'},\n            {to: 'OU', from: 'ou'},\n\
    \            {to: 'Incidents-Total', from: 'total_incidents'},\n            {to:\
    \ 'Incidents-Active', from: 'total_active_incidents'},\n            {to: 'Entities-Total',\
    \ from: 'total_entities'},\n            {to: 'Entities-Exposed', from: 'total_exposed_entities'},\n\
    \        ]\n    },\n    'test-module': {\n        url: 'users',\n        method:\
    \ 'GET',\n        defaultArgs: {\n            limit: 1\n        }\n    },\n  \
    \  'cloudlock-get-user-apps': {\n        url: 'users/%email%/apps',\n        method:\
    \ 'GET',\n        extended: true,\n        title: 'CloudLock get user apps response',\n\
    \        contextPath: 'CloudLock.Users(val.Email==obj.Email)',\n        translator:\
    \ [\n            {to: 'Applications-Category', from: 'app.category'},\n      \
    \      {to: 'Applications-AccessRisk', from: 'app.access_risk'},\n           \
    \ {to: 'Applications-RiskLevel', from: 'app.risk_level'},\n            {to: 'Applications-ID',\
    \ from: 'app.risk_level'},\n            {to: 'Applications-Name', from: 'app.name'},\n\
    \            {to: 'Applications-Vendor', from: 'app.id'},\n        ]\n    },\n\
    \    'cloudlock-get-activities': {\n        url: 'activities',\n        method:\
    \ 'GET',\n        extended: true,\n        innerPath: 'items',\n        title:\
    \ 'CloudLock get activities response',\n        contextPath: 'CloudLock.Activities(val.ID==obj.ID)',\n\
    \        translator: [\n                {to: 'ID', from: 'event_id'},\n      \
    \          {to: 'IP', from: 'client_ip'},\n                {to: 'Type', from:\
    \ 'event_type'},\n                {to: 'Created', from: 'created_at'},\n     \
    \           {to: 'Successful', from: 'operation_successful'},\n              \
    \  {to: 'Location-Latitude', from: 'client_location.lat'},\n                {to:\
    \ 'Location-Longitude', from: 'client_location.lng'},\n                {to: 'Location-Country-Code',\
    \ from: 'client_location.country.code'},\n                {to: 'Location-Country-Name',\
    \ from: 'client_location.country.name'},\n                {to: 'Location-Region-Code',\
    \ from: 'client_location.region.code'},\n                {to: 'Location-Region-Name',\
    \ from: 'client_location.region.name'},\n                {to: 'Location-City',\
    \ from: 'client_location.city'},\n                {to: 'Category', from: 'event_category'},\n\
    \                {to: 'OriginID', from: 'origin_id'},\n                {to: 'User-Email',\
    \ from: 'actor.user_email'},\n                {to: 'User-FullName', from: 'actor.full_name'},\n\
    \                {to: 'User-VendorID', from: 'actor.vendor_id'},\n           \
    \     {to: 'Vendor-Name', from: 'vendor.name'},\n                {to: 'Vendor-Service',\
    \ from: 'vendor.service'},\n            ],\n        filter: function(filter_key,\
    \ filter_value){\n            return function(obj) {\n                return !filter_key\
    \ || !filter_value || dq(obj, filter_key) === filter_value;\n            };\n\
    \        }\n    },\n};\n\nfunction mapObjFunction(mapFields, filter) {\n    var\
    \ transformSingleObj= function(obj) {\n        var res = {};\n        mapFields.forEach(function(f)\
    \ {\n           res[f.to] = dq(obj, f.from);\n        });\n        if (filter\
    \ && !filter(res)) {\n            return undefined;\n        }\n        return\
    \ res;\n    };\n    return function(obj) {\n        if (obj instanceof Array)\
    \ {\n            var res = [];\n            for (var j=0; j < obj.length; j++)\
    \ {\n                var current = transformSingleObj(obj[j]);\n             \
    \   if (current) {\n                    res.push(current);\n                }\n\
    \            }\n            return res;\n        }\n        return transformSingleObj(obj);\n\
    \    };\n}\n\nfunction createContext(data) {\n    var createContextSingle = function(obj)\
    \ {\n        var res = {};\n        var keys = Object.keys(obj);\n        keys.forEach(function(k)\
    \ {\n            var values = k.split('-');\n            var current = res;\n\
    \            for (var j = 0; j<values.length - 1; j++) {\n                if (!current[values[j]])\
    \ {\n                    current[values[j]] = {};\n                }\n       \
    \         current = current[values[j]];\n            }\n            current[values[j]]\
    \ = obj[k];\n        });\n        return res;\n    };\n    if (data instanceof\
    \ Array) {\n        var res = [];\n        for (var j=0; j < data.length; j++)\
    \ {\n            res.push(createContextSingle(data[j]));\n        }\n        return\
    \ res;\n    }\n    return createContextSingle(data);\n}\n\nfunction sendRequest(commandData)\
    \ {\n    var res = http(\n        base + replaceInTemplatesAndRemove(commandData.url,\
    \ args) + (commandData.method === 'GET' ? encodeToURLQuery(args || commandData.defaultArgs)\
    \ : ''),\n        {\n            Method: commandData.method,\n            Headers:\
    \ {\n                'Authorization': ['Bearer ' + params.token],\n          \
    \      'Content-Type': ['application/json'],\n            },\n            Body:\
    \ commandData.method !== 'GET' ? JSON.stringify(args || commandData.defaultArgs)\
    \ : undefined\n        },\n        params.insecure,\n        params.proxy\n  \
    \  );\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw\
    \ 'Failed to ' + commandData.url + ' , request status code: ' + res.StatusCode\
    \ + ' and Body: ' + res.Body + '.';\n    }\n    return JSON.parse(res.Body);\n\
    }\n\nvar commandData = commands[command];\nvar email = args.email && command ===\
    \ 'cloudlock-get-user-apps' ? args.email : undefined;\nvar filterKey = args['filter_key'];\n\
    var filterValue = args['filter_value'];\ndelete args['filter_key'];\ndelete args['filter_value'];\n\
    \n\nvar result = sendRequest(commandData);\nif (command === 'test-module') {\n\
    \    return 'ok';\n}\nvar entry = {\n    Type: entryTypes.note,\n    Contents:\
    \ result,\n    ContentsFormat: formats.json,\n};\nif (commandData.extended) {\n\
    \    var filterFunc = commandData.filter ? commandData.filter(filterKey, filterValue)\
    \ : null;\n    var translated = mapObjFunction(commandData.translator, filterFunc)\
    \ (\n      commandData.innerPath ? dq(result, commandData.innerPath) : result\n\
    \    );\n    entry.ReadableContentsFormat = formats.markdown;\n    entry.HumanReadable\
    \ = tableToMarkdown(commandData.title,translated);\n    entry.EntryContext = {};\n\
    \    var context = createContext(translated);\n    context.Email = email;\n  \
    \  entry.EntryContext[commandData.contextPath] = context;\n}\nreturn entry;"
  type: javascript
tests:
- No tests
toversion: 4.1.9
versionedfields: {}
