category: Network Security
commonfields:
  id: Forcepoint
  version: -1
configuration:
- defaultvalue: ''
  display: Server URL (e.g. https://192.168.0.1)
  name: url
  required: true
  type: 0
- defaultvalue: ''
  display: Credentials
  name: credentials
  required: true
  type: 9
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
description: Advanced threat protection with added local management controls.
display: Forcepoint
image: data:image/png;base64,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
name: Forcepoint
script:
  commands:
  - arguments:
    - description: The category name. Must be unique, alphanumeric name.
      name: categoryName
      required: true
    - description: The category description.  It may contain alphanumeric characters,
        periods, and commas.
      name: categoryDescription
    - defaultValue: '0'
      description: "The category parent. 0 is the top-level category, and can be specified\
        \ as the parent. \t Subcategories can be added to categories that have a parent\
        \ of 0, but not to categories with a different parent."
      name: parent
    description: Create custom category.
    name: fp-add-category
    outputs:
    - contextPath: Forcepoint.AddCategory.CategoryName
      description: The category name.
  - arguments:
    - auto: PREDEFINED
      defaultValue: 'false'
      description: Select 'true' to retrieve a list of all the categories. Else, only
        API-managed categories will be listed.
      name: allCategories
      predefined:
      - 'true'
      - 'false'
    description: Retrieve a list of all the categories, or only API-managed categories.
    name: fp-list-categories
    outputs:
    - contextPath: ListCategories.CategoryName
      description: Category name
    - contextPath: ListCategories.CategoryID
      description: Category ID
    - contextPath: ListCategories.CategoryDescription
      description: Category description
    - contextPath: ListCategories.CategoryOwner
      description: Category owner
  - arguments:
    - description: The category name.  Leave blank if category ID is provided.
      name: categoryName
    - description: The category ID.  Leave blank if category name is provided.
      name: categoryId
    description: Get a list of URLs and IP addresses in an API-managed category.
    name: fp-get-category-detailes
    outputs:
    - contextPath: Forcepoint.CategoryDetails.CategoryName
      description: Category name
    - contextPath: Forcepoint.CategoryDetails.CategoryID
      description: Category ID
    - contextPath: Forcepoint.CategoryDetails.URLs
      description: Category URLs
    - contextPath: Forcepoint.CategoryDetails.IPs
      description: Category IPs
  - arguments:
    - description: 'Comma separated list of URL addresses to add. '
      name: urls
    - description: 'Comma separated list of IP address to add. '
      name: ips
    - description: The category ID. Leave blank if category name is provided.
      name: categoryID
    - description: The category name. Leave Blank if category ID is provided.
      name: categoryName
    description: Add URLs and IP addresses to an API-managed category. Refer to category
      either by it's ID or by it's name.
    name: fp-add-address-to-category
    outputs:
    - contextPath: Forcepoint.AddAddressToCategory.CategoryName
      description: The category name.
    - contextPath: Forcepoint.AddAddressToCategory.CategoryID
      description: The category ID.
    - contextPath: Forcepoint.AddAddressToCategory.Totals.AddedURLs
      description: Total URLs added to category.
    - contextPath: Forcepoint.AddAddressToCategory.Totals.AddedIPs
      description: Total IP addresses added to category.
  - arguments:
    - description: Comma separated list of category IDs.
      name: categoryIDs
    - description: Comma separated list of category names.
      name: categoryNames
    description: Delete API-managed categories. Refer to categories you wish to delete
      either by ID list or by name list. It is possible to pass both lists, when each
      list refers to different categories.
    name: fp-delete-categories
    outputs:
    - contextPath: Forcepoint.DeletedCategories.CategoryName
      description: Category name
    - contextPath: Forcepoint.DeletedCategories.CategoryID
      description: Category ID
    - contextPath: Forcepoint.DeletedCategories.URLs
      description: Category URLs
    - contextPath: Forcepoint.DeletedCategories.IPs
      description: Category IPs
  - arguments:
    - description: The category ID.  Leave blank if category name is provided.
      name: categoryID
    - description: Comma separated list of URL address to remove.
      name: urls
    - description: Comma separated list of IP address to remove.
      name: ips
    - description: The category name.  Leave blank if category ID is provided.
      name: categoryName
    description: ' Remove URLs, IP addresses, and ranges from a specific API-managed
      category.  Refer to category either by it''s ID or by it''s name.'
    name: fp-delete-address-from-category
    outputs:
    - contextPath: Forcepoint.DeleteAddressesFromCategory.CategoryName
      description: The category Name.
    - contextPath: Forcepoint.DeleteAddressesFromCategory.CategoryID
      description: The category ID.
    - contextPath: Forcepoint.DeleteAddressesFromCategory.Totals.DeletedURLs
      description: Total URLs deleted from category.
    - contextPath: Forcepoint.DeleteAddressesFromCategory.Totals.DeletedIPs
      description: Total IP addresses deleted from category.
  script: "var SERVER_URL = params.url;\nif (SERVER_URL.slice(-1) === '/') {\n   \
    \ SERVER_URL = SERVER_URL.slice(0,-1);\n}\nSERVER_URL += ':15873/api/web/v1/';\n\
    \nvar USER_NAME = params.credentials.identifier;\n\nvar PASSWORD = params.credentials.password;\n\
    \nfunction sendRequest(url, method, body, transactionID) {\n    var req = {\n\
    \            Method: method,\n            Headers: {\n                'Content-Type':\
    \ ['application/json'],\n                'Accept': ['application/json']\n    \
    \        },\n            Username: USER_NAME,\n            Password: PASSWORD\n\
    \        };\n    var reqBody = {};\n    if (body) {\n        reqBody = body;\n\
    \    }\n    if (transactionID) {\n          reqBody['Transaction ID'] = transactionID;\n\
    \    }\n    req.Body = JSON.stringify(reqBody);\n    var res = http(url, req,\
    \ params.insecure, params.proxy);\n    return res;\n}\n\nfunction transactionFlowRequest(url,\
    \ method, body) {\n    var transactionid = startTransaction();\n    var res =\
    \ {};\n    try {\n        res = sendRequest(url, method, body, transactionid);\n\
    \    } catch (e) {\n        throw e;\n    } finally {\n        //if request failes\
    \ - commit the transaction anyway, to allow the creation a of new transaction\
    \ for the next command.\n        commitTransaction(transactionid);\n    }\n  \
    \  var tries = 0;\n    var status = {};\n    //check the systen status, wait until\
    \ transaction build status id 'Done'.\n    //The database is only updated after\
    \ the build is done.\n    //Will prevent the need to add 'wait' between playbook\
    \ tasks\n    do {\n        wait(1);\n        status = getTransactionStatus();\n\
    \        tries++;\n    } while (status['Build Status'] !== 'Done' && tries < 10);\n\
    \    if (tries > 10) {\n        throw 'Possible transaction failure - transaction\
    \ status: ' + status.Status.toString();\n    }\n    return res;\n}\nfunction startTransaction()\
    \ {\n    var url = SERVER_URL + 'categories/start';\n    var tries = 0;\n    var\
    \ res = {};\n    // Start a new transacrion - 3 tries for recurring 409 error.\n\
    \    //Error 409 - another transaction is in progress (Only one Policy API Server\
    \ in a global TRITON AP-WEB deployment can start a transaction at a time).\n \
    \   do {\n        wait(1);\n        res = sendRequest(url, 'POST');\n        tries++;\n\
    \    } while(res.StatusCode === 409 && tries < 10);\n    if (res.StatusCode !==\
    \ 200) {\n        if (res.StatusCode === 409) {\n            throw 'Another transaction\
    \ is in process. Please wait for a few seconds before sending another request.';\n\
    \        }\n        throw 'error - request failed. error number ' + res.StatusCode;\n\
    \    }\n    var resBody = JSON.parse(res.Body);\n    var tid = resBody['Transaction\
    \ ID'];\n    return tid;\n}\n\nfunction commitTransaction(transactionID) {\n \
    \   var url = SERVER_URL + 'categories/commit?transactionid=' + transactionID;\n\
    \    var res = sendRequest(url, 'POST');\n    if (res.StatusCode !== 200) {\n\
    \        throw 'error - transaction commit failed. error  ' + res.Status;\n  \
    \  }\n}\n\nfunction getTransactionStatus() {\n    var url = SERVER_URL + 'categories/status';\n\
    \    var res = sendRequest(url, 'GET');\n    if (res.StatusCode !== 200) {\n \
    \       throw 'Error- failed to get transaction status. possible transaction failure';\n\
    \    }\n    try {\n        var resBody = JSON.parse(res.Body);\n        return\
    \ resBody;\n    } catch (err) {\n        throw \"error - unexpected response.\
    \ Couldn't parse response body\";\n    }\n}\n\nfunction parseResponse(response)\
    \ {\n    var body = JSON.parse(response.Body);\n    if (response.StatusCode ===\
    \ 200) {\n        return body;\n    } else {\n        throwErrDetails(body, response.StatusCode);\n\
    \    }\n}\n\nfunction throwErrDetails(errResponse, StatusCode) {\n    var erMessage\
    \ = '';\n    var errArray = errResponse.Error ? errResponse.Error : [];\n    for\
    \ (var i = 0; i < errArray.length; i++) {\n        erMessage = erMessage + errArray[i]\
    \ + '\\n';\n    }\n    throw 'Request failed with status ' + StatusCode + '. '\
    \ + erMessage;\n}\n\nfunction addCategory(){\n    var res = addCategoryRequest(\n\
    \        args.categoryName,\n        args.categoryDescription,\n        parseInt(args.parent));\n\
    \    var title = 'Forcepoint Add Category';\n    var content = res.Categories;\n\
    \    var data = [\n        {\n            to: 'CategoryName',\n            from:\
    \ 'Category Name'\n        }];\n    var context = mapObjFunction(data) (content);\n\
    \    var entry = {\n          Type: entryTypes.note,\n          Contents: content,\n\
    \          ContentsFormat: formats.json,\n          ReadableContentsFormat: formats.markdown,\n\
    \          HumanReadable: tableToMarkdown(title, context),\n          EntryContext:\
    \ {}\n      };\n      entry.EntryContext['Forcepoint.AddCategory(val.CategoryName==obj.CategoryName)']\
    \ = context;\n      return entry;\n}\n\nfunction addCategoryRequest(categoryName,\
    \ categoryDescription, parent) {\n    var url = SERVER_URL + 'categories';\n \
    \   var body = {\n        Categories: [\n            {\n                'Category\
    \ Name': categoryName,\n                'Category Description': categoryDescription,\n\
    \                'Parent': parent\n            }\n        ]\n    };\n    var res\
    \ = transactionFlowRequest(url, 'POST', body);\n    return parseResponse(res);\n\
    }\n\nfunction listCategories(){\n    var listAll = (args.allCategories === 'true');\n\
    \    var res = listCategoriesRequest(listAll);\n    var title = 'Forcepoint List\
    \ Categories';\n    var categories = parseCategoryList(res.Categories);\n    var\
    \ data = [\n                {to: 'CategoryName', from: 'Category Name'},\n   \
    \             {to: 'CategoryID', from: 'Category ID'},\n                {to: 'CategoryDescription',\
    \ from: 'Category Description'},\n                {to: 'CategoryOwner', from:\
    \ 'Category Owner'},\n                {to: 'CategoryParent', from: 'CategoryParent'}\n\
    \            ];\n    var context = mapObjFunction(data)(categories);\n    var\
    \ entry = {\n          Type: entryTypes.note,\n          Contents: res,\n    \
    \      ContentsFormat: formats.json,\n          ReadableContentsFormat: formats.markdown,\n\
    \          HumanReadable: tableToMarkdown(title, context),\n          EntryContext:\
    \ {}\n      };\n      entry.EntryContext['Forcepoint.ListCategories(val.CategoryID==obj.CategoryID)']\
    \ = createContext(context);\n      return entry;\n}\n\nfunction parseCategoryList(categories){\n\
    \    var categoryArr = [];\n    categories.forEach(function(cat) {\n        var\
    \ children = cat.Children;\n        cat.CategoryParent = '';\n        categoryArr.push(cat);\n\
    \        if (children) {\n            for (var i = 0; i < children.length; i++)\
    \ {\n                var child = children[i];\n                child.CategoryParent\
    \ = cat['Category Name'];\n                categoryArr.push(child);\n        \
    \    }\n        }\n    });\n    return categoryArr;\n}\n\nfunction listCategoriesRequest(listAll)\
    \ {\n    var url = listAll ? SERVER_URL + 'categories/all' : SERVER_URL + 'categories';\n\
    \    var res =  sendRequest(url, 'GET');\n    return parseResponse(res);\n}\n\n\
    function categoryDetails(){\n    if (!args.categoryName && !args.categoryId) {\n\
    \        throw \"Please provide either the category name or it\\' ID.\"\n    }\n\
    \    var res = args.categoryId ? categoryDetailsByIDRequest(args.categoryId) :\
    \ categoryDetailsByNameRequest(args.categoryName);\n    var title = 'Forcepoint\
    \ Category Details';\n    var data = [\n            {to: 'CategoryName', from:\
    \ 'Category Name'},\n            {to: 'CategoryID', from: 'Category ID'},\n  \
    \          {to: 'URLs', from: 'URLs'},\n            {to: 'IPs', from: 'IPs'}\n\
    \        ];\n    var context = mapObjFunction(data) (res);\n    var entry = {\n\
    \          Type: entryTypes.note,\n          Contents: res,\n          ContentsFormat:\
    \ formats.json,\n          ReadableContentsFormat: formats.markdown,\n       \
    \   HumanReadable: tableToMarkdown(title, context),\n          EntryContext: {}\n\
    \      };\n      entry.EntryContext['Forcepoint.CategoryDetails(val.CategoryID==obj.CategoryID)']\
    \ = createContext(context);\n      return entry;\n\n}\n\nfunction categoryDetailsByNameRequest(name)\
    \ {\n    url = SERVER_URL + 'categories/urls?catname=' + name;\n    var res =\
    \  sendRequest(url, 'GET');\n    return parseResponse(res);\n}\n\nfunction categoryDetailsByIDRequest(id)\
    \ {\n    url = SERVER_URL + 'categories/urls?catid=' + id;\n    var res =  sendRequest(url,\
    \ 'GET');\n    return parseResponse(res);\n}\n\nfunction addAddress() {\n    if\
    \ (!args.ips && !args.urls) {\n        throw 'Please pass an ip list, url list,\
    \ or both.'\n    }\n    if (!args.categoryID && !args.categoryName) {\n      \
    \  throw \"Please provide either the category name or it's ID.\";\n    }\n   \
    \ var urls = args.urls ? args.urls.split(',') : undefined;\n    var ips = args.ips\
    \ ? args.ips.split(',') : undefined;\n    var res = args.categoryID ? editAddressRequest(urls,\
    \ ips, parseInt(args.categoryID)) : editAddressRequest(urls, ips, undefined, args.categoryName);\n\
    \    var title = 'Forcepoint Category Details';\n    var data = [\n          \
    \      {to: 'CategoryID', from: 'Category ID'},\n                {to: 'Totals.AddedURLs',\
    \ from: 'Totals.Added URLs'},\n                {to: 'Totals.AddedIPs', from: 'Totals.Added\
    \ IPs'}\n            ];\n    var context = mapObjFunction(data) (res);\n    var\
    \ entry = {\n            Type: entryTypes.note,\n            Contents: res,\n\
    \            ContentsFormat: formats.json,\n            ReadableContentsFormat:\
    \ formats.markdown,\n            HumanReadable: tableToMarkdown(title, context),\n\
    \            EntryContext: {}\n        };\n    entry.EntryContext['Forcepoint.AddAddressToCategory(val.CategoryID==obj.CategoryID)']\
    \ = createContext(context);\n    return entry;\n}\n\nfunction editAddressRequest(urls,\
    \ ips, id, name, del){\n    var url = SERVER_URL + 'categories/urls';\n    var\
    \ body = {};\n    if (id) {\n        body['Category ID'] = id;\n    }\n    else\
    \ if(name){\n        body['Category Name'] = name;\n    }\n    if (urls) {\n \
    \       body.URLs = urls;\n    }\n    if (ips) {\n        body.IPs = ips;\n  \
    \  }\n    var method = del ? 'DELETE' : 'POST';\n    var res =  transactionFlowRequest(url,\
    \ method, body);\n    return parseResponse(res);\n}\n\nfunction deleteAddress()\
    \ {\n    if (!args.ips && !args.urls) {\n        throw 'Please pass an ip list,\
    \ url list, or both.'\n    }\n    if (!args.categoryID && !args.categoryName)\
    \ {\n        throw \"Please provide either the category name or it's ID.\";\n\
    \    }\n    var urls = args.urls ? args.urls.split(',') : undefined;\n    var\
    \ ips = args.ips ? args.ips.split(',') : undefined;\n    var res = args.categoryID\
    \ ? editAddressRequest(urls, ips, parseInt(args.categoryID), undefined, true)\
    \ : editAddressRequest(urls, ips, undefined, args.categoryName, true);\n    var\
    \ title = 'Forcepoint Delete Address From Category';\n    var data = [\n     \
    \               {to: 'CategoryID', from: 'Category ID'},\n                   \
    \ {to: 'Totals.DeletedURLs', from: 'Totals.Deleted URLs'},\n                 \
    \   {to: 'Totals.DeletedIPs', from: 'Totals.Deleted IPs'}\n                ];\n\
    \    var context = mapObjFunction(data)(res);\n    var entry = {\n          Type:\
    \ entryTypes.note,\n          Contents: res,\n          ContentsFormat: formats.json,\n\
    \          ReadableContentsFormat: formats.markdown,\n          HumanReadable:\
    \ tableToMarkdown(title, context),\n          EntryContext: {}\n      };\n   \
    \   entry.EntryContext['Forcepoint.DeleteAddressesFromCategory'] = createContext(context);\n\
    \      return entry;\n}\n\nfunction deleteCategory() {\n    if (!args.categoryIDs\
    \ && !args.categoryNames) {\n        throw 'Please provied IDs or/and Names of\
    \ the categories you wish to delete.';\n    }\n    //save the categories details\
    \ before deleting them\n    var deleted = [];\n    if (args.categoryIDs) {\n \
    \       var ids = [];\n        if (Array.isArray(args.categoryIDs)) {\n      \
    \      ids = args.categoryIDs;\n        } else if (typeof args.categoryIDs ===\
    \ 'string') {\n            ids = args.categoryIDs.split(',');\n            ids.forEach(function(element,\
    \ index, arr) {\n                arr[index] = parseInt(element);\n           \
    \ });\n        } else if (!isNaN(args.categoryIDs)) {\n            ids.push(args.categoryIDs);\n\
    \        }\n        ids.forEach(function(element) {\n            //Get details\
    \ for each category. If the request fails, it means wrong category id/name was\
    \ provided.\n            //category DELETE request with wrong id/name will not\
    \ cause an error. No need to end the procedure. Valid ids/names will still be\
    \ deleted.\n              try {\n                var catDetails = categoryDetailsByIDRequest(element);\n\
    \                deleted.push(catDetails);\n            } catch(e) {}\n      \
    \  });\n        deleteCategoryRequest(ids);\n    }\n    if(args.categoryNames)\
    \ {\n        var names = [];\n        if (Array.isArray(args.categoryNames)){\n\
    \            names = args.categoryNames;\n        } else  {\n            names\
    \ = args.categoryNames.split(',');\n        }\n        //Get details for each\
    \ category. If the request fails, it means wrong category id/name was provided.\n\
    \        //category DELETE request with wrong id/name will not cause an error.\
    \ No need to end the procedure. Valid ids/names will still be deleted.\n     \
    \   try {\n            names.forEach(function(element) {\n                var\
    \ catDetails = categoryDetailsByNameRequest(element);\n                deleted.push(catDetails);\n\
    \            });\n        } catch(e) {};\n        deleteCategoryRequest(undefined,\
    \ names);\n    }\n    var data = [\n        {to: 'CategoryName', from: 'Category\
    \ Name'},\n        {to: 'CategoryID', from: 'Category ID'},\n        {to: 'URLs',\
    \ from: 'URLs'},\n        {to: 'IPs', from: 'IPs'}\n        ];\n    var context\
    \ = mapObjFunction(data) (deleted);\n    var entry = {\n      Type: entryTypes.note,\n\
    \      ReadableContentsFormat: formats.text,\n      HumanReadable: \"Categories\
    \ were deleted successfully\",\n      Contents: deleted,\n      ContentsFormat:\
    \ formats.json,\n      EntryContext: {}\n      };\n      entry.EntryContext['Forcepoint.DeletedCategories']\
    \ = createContext(context);\n      return entry;\n}\n\nfunction deleteCategoryRequest(ids,\
    \ names) {\n    var url = SERVER_URL + 'categories';\n    var body = {};\n   \
    \ if (ids) {\n        body['Category IDs'] = ids;\n    }\n    else if (names)\
    \ {\n        body['Category Names'] = names;\n    }\n    var res = transactionFlowRequest(url,\
    \ 'DELETE', body);\n    if (res.StatusCode !== 200) {\n        var errResponse\
    \ = JSON.stringify(res.Body);\n        throwErrDetails(errResponse, res.StatusCode);\n\
    \    }\n}\n\nfunction test() {\n    var tid = startTransaction();\n    commitTransaction(tid);\n\
    \    return 'ok';\n}\n\n\nswitch(command) {\n    case 'test-module':\n       \
    \ return test();\n    case 'fp-add-category':\n        return addCategory();\n\
    \    case 'fp-list-categories':\n        return listCategories();\n    case 'fp-get-category-detailes':\n\
    \        return categoryDetails();\n    case 'fp-add-address-to-category':\n \
    \       return addAddress();\n    case 'fp-delete-address-from-category':\n  \
    \      return deleteAddress();\n    case 'fp-delete-categories':\n        return\
    \ deleteCategory();\n}\n"
  type: javascript
toversion: 4.1.9
