id: Microsoft Defender Advanced Threat Protection - Test
inputs: []
name: Microsoft Defender Advanced Threat Protection - Test
outputs: []
starttaskid: '0'
tasks:
  '0':
    id: '0'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '27'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 0be28659-de93-4681-88d7-a02c56b2563f
      iscommand: false
      name: ''
      version: -1
    taskid: 0be28659-de93-4681-88d7-a02c56b2563f
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 50\n  }\n}"
  '15':
    id: '15'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '2'
    note: false
    quietmode: 0
    scriptarguments:
      health_status:
        simple: Active
      hostname: {}
      ip: {}
      os_platform: {}
      retry-count:
        simple: '3'
      risk_score: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves a collection of machines that have communicated with
        WDATP cloud on the last 30 days
      id: 63021ac7-822b-4eac-8f1c-a59c8608d275
      iscommand: true
      name: Get machines by health status
      script: '|||microsoft-atp-get-machines'
      type: regular
      version: -1
    taskid: 63021ac7-822b-4eac-8f1c-a59c8608d275
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 720\n  }\n}"
  '18':
    id: '18'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '43'
    note: false
    quietmode: 0
    scriptarguments:
      category:
        simple: None
      description:
        simple: Created for test
      event_time:
        complex:
          accessor: Hunt.Result
          root: MicrosoftATP
          transformers:
          - args:
              field:
                value:
                  simple: Timestamp
            operator: getField
      machine_id:
        complex:
          accessor: Hunt.Result.DeviceId
          root: MicrosoftATP
          transformers:
          - args:
              index:
                value:
                  simple: '0'
            operator: atIndex
      recommended_action:
        simple: test alert
      report_id:
        complex:
          accessor: Hunt.Result
          root: MicrosoftATP
          transformers:
          - args:
              field:
                value:
                  simple: ReportId
            operator: getField
      retry-count:
        simple: '3'
      severity:
        simple: Medium
      title:
        simple: test alert
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 958a04a7-2b20-4c9c-8590-c0bfd4846144
      iscommand: true
      name: Create alert with time as name
      script: '|||microsoft-atp-create-alert'
      type: regular
      version: -1
    taskid: 958a04a7-2b20-4c9c-8590-c0bfd4846144
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1595\n  }\n}"
  '19':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Alert.ID
                root: MicrosoftATP
          operator: isExists
      label: 'yes'
    id: '19'
    ignoreworker: false
    nexttasks:
      'yes':
      - '8'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 6ea2b20e-c393-4102-8123-b60a60d75ef1
      iscommand: false
      name: Assert alert created
      type: condition
      version: -1
    taskid: 6ea2b20e-c393-4102-8123-b60a60d75ef1
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1945\n  }\n}"
  '2':
    id: '2'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    scriptarguments:
      category: {}
      retry-count:
        simple: '3'
      severity:
        simple: Informational
      status: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 636c70f1-73c5-4010-848c-281d0583018d
      iscommand: true
      name: Get ATP list alerts
      script: '|||microsoft-atp-list-alerts'
      type: regular
      version: -1
    taskid: 636c70f1-73c5-4010-848c-281d0583018d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 895\n  }\n}"
  '20':
    id: '20'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '21'
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: DeviceLogonEvents | take 1 | project DeviceId, ReportId, tostring(Timestamp)
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 3db567cc-031a-454f-87a8-742f727ccc3d
      iscommand: true
      name: Advance query
      script: '|||microsoft-atp-advanced-hunting'
      type: regular
      version: -1
    taskid: 3db567cc-031a-454f-87a8-742f727ccc3d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1245\n  }\n}"
  '21':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Hunt.Result.ReportId
                root: MicrosoftATP
          operator: isExists
      label: 'yes'
    id: '21'
    ignoreworker: false
    nexttasks:
      'yes':
      - '18'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: b17efed5-e85c-4e7e-835b-8c512bbdaca8
      iscommand: false
      name: Assert query results
      type: condition
      version: -1
    taskid: b17efed5-e85c-4e7e-835b-8c512bbdaca8
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1420\n  }\n}"
  '24':
    id: '24'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '5'
    note: false
    quietmode: 0
    scriptarguments:
      file:
        simple: 36c5d12033b2eaf251bae61c00690ffb17fddc87
      file_hash:
        simple: 36c5d12033b2eaf251bae61c00690ffb17fddc87
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Get a collection of machines related to a given file hash.
      id: 9ac1eb64-777a-46a9-89f6-32d65fdb7a71
      iscommand: true
      name: Get machine related to file
      script: '|||microsoft-atp-get-file-related-machines'
      type: regular
      version: -1
    taskid: 9ac1eb64-777a-46a9-89f6-32d65fdb7a71
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 370\n  }\n}"
  '25':
    id: '25'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '26'
      - '28'
    note: false
    quietmode: 0
    scriptarguments:
      id:
        simple: da637178102407855446_82583843
      limit:
        simple: '10'
      offset: {}
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves the files associated to a specific alert.
      id: 10f21a33-1229-4c29-87fe-74d508edf7b4
      iscommand: true
      name: Get alert related files
      script: '|||microsoft-atp-get-alert-related-files'
      type: regular
      version: -1
    taskid: 10f21a33-1229-4c29-87fe-74d508edf7b4
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 265,\n    \"y\": 1245\n  }\n}"
  '26':
    id: '26'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '36'
    note: false
    quietmode: 0
    scriptarguments:
      file_hash:
        simple: ${MicrosoftATP.AlertFile.Files.Sha1}
      retry-count:
        simple: '3'
      sha1:
        complex:
          accessor: AlertFile.Files.Sha1
          root: MicrosoftATP
          transformers:
          - args:
              index:
                value:
                  simple: '0'
            operator: atIndex
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves a collection of alerts related to a given file hash.
      id: 84c3df06-8700-47bf-873e-0359f5f02213
      iscommand: true
      name: Get file related alerts
      script: '|||microsoft-atp-get-file-alerts'
      type: regular
      version: -1
    taskid: 84c3df06-8700-47bf-873e-0359f5f02213
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 50,\n    \"y\": 1420\n  }\n}"
  '27':
    id: '27'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '25'
      - '24'
      - '29'
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: 'yes'
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Delete field from context
      id: f5267851-77ef-41e4-810a-6ff181b94093
      iscommand: false
      name: Delete context
      scriptName: DeleteContext
      type: regular
      version: -1
    taskid: f5267851-77ef-41e4-810a-6ff181b94093
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 195\n  }\n}"
  '28':
    id: '28'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '42'
    note: false
    quietmode: 0
    scriptarguments:
      file_hash:
        simple: ${MicrosoftATP.AlertFile.Files.Sha1}
      retry-count:
        simple: '3'
      sha1:
        complex:
          accessor: AlertFile.Files.Sha1
          root: MicrosoftATP
          transformers:
          - args:
              index:
                value:
                  simple: '0'
            operator: atIndex
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves the statistics for the given file.
      id: bf308d86-fe25-4602-8f75-53ac58a58cdc
      iscommand: true
      name: Get file statistics
      script: '|||microsoft-atp-get-file-statistics'
      type: regular
      version: -1
    taskid: bf308d86-fe25-4602-8f75-53ac58a58cdc
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 480,\n    \"y\": 1420\n  }\n}"
  '29':
    id: '29'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '38'
    note: false
    quietmode: 0
    scriptarguments:
      id:
        simple: fb3405b2-ccfb-4884-912b-e2b242879c4d
      machine_id: {}
      requestor: {}
      retry-count:
        simple: '3'
      status: {}
      type: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Return the machine's actions. If you set an action id it will return
        the info on the specific action
      id: 72754b8e-3c47-4cd1-8dc6-0fa219e77847
      iscommand: true
      name: Get machine action data
      script: '|||microsoft-atp-list-machine-actions-details'
      type: regular
      version: -1
    taskid: 72754b8e-3c47-4cd1-8dc6-0fa219e77847
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1340,\n    \"y\": 1595\n  }\n}"
  '3':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Alert.ID
                root: MicrosoftATP
                transformers:
                - args:
                    index:
                      value:
                        simple: '0'
                  operator: atIndex
          operator: isExists
      label: 'yes'
    id: '3'
    ignoreworker: false
    nexttasks:
      'yes':
      - '20'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: bebff2d1-1fef-4680-8ff0-fc663e01915a
      iscommand: false
      name: Assert an alert was fetched
      type: condition
      version: -1
    taskid: bebff2d1-1fef-4680-8ff0-fc663e01915a
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1070\n  }\n}"
  '34':
    id: '34'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '35'
    note: false
    quietmode: 0
    scriptarguments:
      domain:
        simple: google.com
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves the statistics on the given domain.
      id: 7c4a4ccc-1837-42c2-82cb-1f73bb034707
      iscommand: true
      name: Get domain statistics
      script: '|||microsoft-atp-get-domain-statistics'
      type: regular
      version: -1
    taskid: 7c4a4ccc-1837-42c2-82cb-1f73bb034707
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 480,\n    \"y\": 1770\n  }\n}"
  '35':
    id: '35'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '8'
    note: false
    quietmode: 0
    scriptarguments:
      ip:
        simple: 8.8.8.8
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves the statistics for the given IP.
      id: 8f473d4a-d885-43c5-8732-1ebeeb5b408b
      iscommand: true
      name: Get ip statistics
      script: '|||microsoft-atp-get-ip-statistics'
      type: regular
      version: -1
    taskid: 8f473d4a-d885-43c5-8732-1ebeeb5b408b
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 480,\n    \"y\": 1945\n  }\n}"
  '36':
    id: '36'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '37'
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: '3'
      username:
        simple: demisto
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves a collection of alerts related to a given user ID.
      id: 420e5d42-25af-45a7-8b1b-d2e796ab57f1
      iscommand: true
      name: Get user alerts
      script: '|||microsoft-atp-get-user-alerts'
      type: regular
      version: -1
    taskid: 420e5d42-25af-45a7-8b1b-d2e796ab57f1
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 50,\n    \"y\": 1605\n  }\n}"
  '37':
    id: '37'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '8'
    note: false
    quietmode: 0
    scriptarguments:
      retry-count:
        simple: '3'
      username:
        simple: demisto
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves a collection of machines related to a given user ID.
      id: 8c1dac17-9773-442b-85c1-d089016e989d
      iscommand: true
      name: Get user machines
      script: '|||microsoft-atp-get-user-machines'
      type: regular
      version: -1
    taskid: 8c1dac17-9773-442b-85c1-d089016e989d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 50,\n    \"y\": 1770\n  }\n}"
  '38':
    id: '38'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '39'
    note: false
    quietmode: 0
    scriptarguments:
      action:
        simple: Add
      machine_id:
        simple: ${MicrosoftATP.MachineAction.MachineID}
      retry-count:
        simple: '3'
      tag:
        simple: testing
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Adds or remove tag to a specific Machine.
      id: 389188a0-3df4-42a6-8489-5201f6668185
      iscommand: true
      name: Add machine tag
      script: '|||microsoft-atp-add-remove-machine-tag'
      type: regular
      version: -1
    taskid: 389188a0-3df4-42a6-8489-5201f6668185
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1340,\n    \"y\": 1770\n  }\n}"
  '39':
    id: '39'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '8'
    note: false
    quietmode: 0
    scriptarguments:
      action:
        simple: Remove
      machine_id:
        simple: f70f9fe6b29cd9511652434919c6530618f06606
      retry-count:
        simple: '3'
      tag:
        simple: testing
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Adds or remove tag to a specific Machine.
      id: 0e3eeb99-5e05-4653-8f44-ac4c7d5f3a53
      iscommand: true
      name: Remove machine tag
      script: '|||microsoft-atp-add-remove-machine-tag'
      type: regular
      version: -1
    taskid: 0e3eeb99-5e05-4653-8f44-ac4c7d5f3a53
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1340,\n    \"y\": 1945\n  }\n}"
  '42':
    id: '42'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '34'
    note: false
    quietmode: 0
    scriptarguments:
      file:
        simple: ${MicrosoftATP.FileStatistics.Sha1}
      file_hash:
        simple: ${MicrosoftATP.FileStatistics.Sha1}
      retry-count:
        simple: '3'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Get a collection of machines related to a given file hash.
      id: 15a1a789-bbf3-4afe-8c3b-2810b0719c17
      iscommand: true
      name: Get file related machines
      script: '|||microsoft-atp-get-file-related-machines'
      type: regular
      version: -1
    taskid: 15a1a789-bbf3-4afe-8c3b-2810b0719c17
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 480,\n    \"y\": 1595\n  }\n}"
  '43':
    id: '43'
    ignoreworker: false
    nexttasks:
      '#none#':
      - '19'
    note: false
    quietmode: 0
    scriptarguments:
      alert_id:
        complex:
          accessor: Alert.ID
          root: MicrosoftATP
          transformers:
          - args:
              index:
                value:
                  simple: '0'
            operator: atIndex
      assigned_to: {}
      classification:
        simple: Unknown
      comment:
        simple: testing
      determination: {}
      retry-count:
        simple: '3'
      status: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Update the properties of an alert entity
      id: 53b0c492-94a4-4473-8b7a-4ce4c2725801
      iscommand: true
      name: update alert
      script: '|||microsoft-atp-update-alert'
      type: regular
      version: -1
    taskid: 53b0c492-94a4-4473-8b7a-4ce4c2725801
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 1770\n  }\n}"
  '5':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: FileMachine.Machines.ID
                root: MicrosoftATP
          operator: isEqualString
          right:
            value:
              simple: f70f9fe6b29cd9511652434919c6530618f06606
      label: 'yes'
    id: '5'
    ignoreworker: false
    nexttasks:
      'yes':
      - '15'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 5c89e826-199d-4cae-89a7-1c92671bcdc8
      iscommand: false
      name: Assert right machine was fetched
      type: condition
      version: -1
    taskid: 5c89e826-199d-4cae-89a7-1c92671bcdc8
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 910,\n    \"y\": 545\n  }\n}"
  '8':
    id: '8'
    ignoreworker: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: e8ca7e69-25db-480c-8fc0-ad4147e71518
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: e8ca7e69-25db-480c-8fc0-ad4147e71518
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 695,\n    \"y\": 2120\n  }\n}"
toversion: 4.1.9
version: -1
view: "{\n  \"linkLabelsPosition\": {},\n  \"paper\": {\n    \"dimensions\": {\n \
  \     \"height\": 2135,\n      \"width\": 1670,\n      \"x\": 50,\n      \"y\":\
  \ 50\n    }\n  }\n}"
