category: Network Security
commonfields:
  id: Vectra
  version: -1
configuration:
- defaultvalue: ''
  display: Server URL (e.g. https://192.168.0.1)
  name: server
  required: true
  type: 0
- defaultvalue: ''
  display: Credentials
  name: credentials
  required: true
  type: 9
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
description: Automated attacker behavior analytics
display: Vectra
image: data:image/png;base64,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
name: Vectra
script:
  commands:
  - arguments:
    - description: Filter by detection ID
      name: detection_id
    - description: Filters objects listed
      name: fields
    - description: Page number. Possible values are a positive integer or last
      name: page
    - description: Page size. Possible values are a positive integer or all
      name: page_size
    - description: "Orders records by last timestamp, threat score and certainty score.\
        \ The default out sorts threat and certainty score in ascending order. Scores\
        \ can sorted in descending order by prepending the query with \u201Cminus\u201D\
        \ symbol"
      name: ordering
    - description: '>= the id provided'
      name: min_id
    - description: <= the id provided
      name: max_id
    - description: 'filter by state: active, inactive, ignored, ignored for all'
      name: state
    - description: filter by the detection type (verbose name)
      name: type_vname
    - description: filter by the detection category
      name: category
    - description: filter by source (ip address)
      name: src_ip
    - description: filter by threat score
      name: t_score
    - description: filter by threat score >= the score provided
      name: t_score_gte
    - description: filter by certainty score
      name: c_score
    - description: filter by certainty score >= the score provided
      name: c_score_gte
    - description: filter by last timestamp
      name: last_timestamp
    - description: filter by id of the host object a detection is attributed to
      name: host_id
    - description: filter by a tag or a comma-separated list of tags
      name: tags
    - description: filter by destination in the detection detail set
      name: destination
    - description: filter by the protocol in the detection detail set
      name: proto
    - description: filter by the destination port in the detection detail set
      name: dst_port
    - description: filter by the inbound_ip in the relayed comm set
      name: inbound_ip
    - description: filter by the inbound_proto in the relayed comm set
      name: inbound_proto
    - description: filter by the inbound_port in the relayed comm set
      name: inbound_port
    - description: filter by the inbound_dns in the relayed comm set
      name: inbound_dns
    - description: filter by the outbound_ip in the relayed comm set
      name: outbound_ip
    - description: filter by the outbound_proto in the relayed comm set
      name: outbound_proto
    - description: filter by the outbound_port in the relayed comm set
      name: outbound_port
    - description: filter by the outbound_dns in the relayed_comm_set
      name: outbound_dns
    - description: filter by the dns_ip in the dns_set
      name: dns_ip
    - description: filter by the dns_request in the dns_set
      name: dns_request
    - description: filter by the resp_code in the dns_set
      name: resp_code
    - description: filter by the resp in the dns_set
      name: resp
    deprecated: true
    description: Detection objects contain all the information related to security
      events detected on the network
    name: vec-detections
    outputs:
    - contextPath: Vectra.Detections.DetectionId
      description: The learned hostname
    - contextPath: Vectra.Detections.TypeVName
      description: Vectra detection id
    - contextPath: Vectra.Detections.Category
      description: The detection category
    - contextPath: Vectra.Detections.SrcIP
      description: The detection source IP
    - contextPath: Vectra.Detections.State
      description: The detection state
    - contextPath: Vectra.Detections.TScore
      description: The detection tscore
    - contextPath: Vectra.Detections.CScore
      description: The detection cscore
    - contextPath: Vectra.Detections.TargetsKeyAsset
      description: Is detection targets key asset
    - contextPath: Vectra.Detections.Tags
      description: The detection tags
    - contextPath: Vectra.Detections.FirstTimestamp
      description: The detection first time stamp
    - contextPath: Vectra.Detections.LastTimestamp
      description: The detection last time stamp
    - contextPath: Vectra.Detections.HostID
      description: The detection host id
  - arguments:
    - description: Filter by detection ID
      name: detection_id
    - description: Filters objects listed
      name: fields
    - description: Page number. Possible values are a positive integer or last
      name: page
    - description: Page size. Possible values are a positive integer or all
      name: page_size
    - description: "Orders records by last timestamp, threat score and certainty score.\
        \ The default out sorts threat and certainty score in ascending order. Scores\
        \ can sorted in descending order by prepending the query with \u201Cminus\u201D\
        \ symbol"
      name: ordering
    - description: '>= the id provided'
      name: min_id
    - description: <= the id provided
      name: max_id
    - description: 'filter by state: active, inactive, ignored, ignored for all'
      name: state
    - description: filter by the detection type (verbose name)
      name: type_vname
    - description: filter by the detection category
      name: category
    - description: filter by source (ip address)
      name: src_ip
    - description: filter by threat score
      name: t_score
    - description: filter by threat score >= the score provided
      name: t_score_gte
    - description: filter by certainty score
      name: c_score
    - description: filter by certainty score >= the score provided
      name: c_score_gte
    - description: filter by last timestamp
      name: last_timestamp
    - description: filter by id of the host object a detection is attributed to
      name: host_id
    - description: filter by a tag or a comma-separated list of tags
      name: tags
    - description: filter by destination in the detection detail set
      name: destination
    - description: filter by the protocol in the detection detail set
      name: proto
    - description: filter by the destination port in the detection detail set
      name: dst_port
    - description: filter by the inbound_ip in the relayed comm set
      name: inbound_ip
    - description: filter by the inbound_proto in the relayed comm set
      name: inbound_proto
    - description: filter by the inbound_port in the relayed comm set
      name: inbound_port
    - description: filter by the inbound_dns in the relayed comm set
      name: inbound_dns
    - description: filter by the outbound_ip in the relayed comm set
      name: outbound_ip
    - description: filter by the outbound_proto in the relayed comm set
      name: outbound_proto
    - description: filter by the outbound_port in the relayed comm set
      name: outbound_port
    - description: filter by the outbound_dns in the relayed_comm_set
      name: outbound_dns
    - description: filter by the dns_ip in the dns_set
      name: dns_ip
    - description: filter by the dns_request in the dns_set
      name: dns_request
    - description: filter by the resp_code in the dns_set
      name: resp_code
    - description: filter by the resp in the dns_set
      name: resp
    description: Detection objects contain all the information related to security
      events detected on the network
    name: vectra-detections
    outputs:
    - contextPath: Vectra.Detections.DetectionId
      description: The learned hostname
    - contextPath: Vectra.Detections.TypeVName
      description: Vectra detection id
    - contextPath: Vectra.Detections.Category
      description: The detection category
    - contextPath: Vectra.Detections.SrcIP
      description: The detection source IP
    - contextPath: Vectra.Detections.State
      description: The detection state
    - contextPath: Vectra.Detections.TScore
      description: The detection tscore
    - contextPath: Vectra.Detections.CScore
      description: The detection cscore
    - contextPath: Vectra.Detections.TargetsKeyAsset
      description: Is detection targets key asset
    - contextPath: Vectra.Detections.Tags
      description: The detection tags
    - contextPath: Vectra.Detections.FirstTimestamp
      description: The detection first time stamp
    - contextPath: Vectra.Detections.LastTimestamp
      description: The detection last time stamp
    - contextPath: Vectra.Detections.HostID
      description: The detection host id
  - arguments:
    - description: Filter by host ID
      name: host_id
    - description: Filters objects listed
      name: fields
    - description: Page number. Possible values are a positive integer or last
      name: page
    - description: Page size. Possible values are a positive integer or all
      name: page_size
    - description: "Orders records by last timestamp, threat score and certainty score.\
        \ The default out sorts threat and certainty score in ascending order. Scores\
        \ can sorted in descending order by prepending the query with \u201Cminus\u201D\
        \ symbol"
      name: ordering
    - description: filter by name
      name: name
    - description: 'filter by state: active, inactive, suspended, ignored, ignored4all'
      name: state
    - description: filter by last_source (ip address)
      name: last_source
    - description: filter by threat score
      name: t_score
    - description: filter by threat score >= the score provided
      name: t_score_gte
    - description: filter by certainty score
      name: c_score
    - description: filter by certainty score >= the score provided
      name: c_score_gte
    - description: filter by last_detection_timestamp
      name: last_detection_timestamp
    - description: filter by a tag or a comma-separated list of tags (returns hosts
        that contain any of the tags specified), e.g.tags=baz | tags=foo,bar"
      name: tags
    - description: 'filter by key asset: True, False'
      name: key_assest
    - description: filter by mac address
      name: mac_address
    deprecated: true
    description: Host information includes data that correlates the host data to detected
      security events
    name: vec-hosts
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Detection.ID
      description: List of Detections for Host
    - contextPath: Endpoint.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.CScore
      description: The current certainty score correlated to this host
  - arguments:
    - description: Filter by host ID
      name: host_id
    - description: Filters objects listed
      name: fields
    - description: Page number. Possible values are a positive integer or last
      name: page
    - description: Page size. Possible values are a positive integer or all
      name: page_size
    - description: "Orders records by last timestamp, threat score and certainty score.\
        \ The default out sorts threat and certainty score in ascending order. Scores\
        \ can sorted in descending order by prepending the query with \u201Cminus\u201D\
        \ symbol"
      name: ordering
    - description: filter by name
      name: name
    - description: 'filter by state: active, inactive, suspended, ignored, ignored4all'
      name: state
    - description: filter by last_source (ip address)
      name: last_source
    - description: filter by threat score
      name: t_score
    - description: filter by threat score >= the score provided
      name: t_score_gte
    - description: filter by certainty score
      name: c_score
    - description: filter by certainty score >= the score provided
      name: c_score_gte
    - description: filter by last_detection_timestamp
      name: last_detection_timestamp
    - description: filter by a tag or a comma-separated list of tags (returns hosts
        that contain any of the tags specified), e.g.tags=baz | tags=foo,bar"
      name: tags
    - description: 'filter by key asset: True, False'
      name: key_assest
    - description: filter by mac address
      name: mac_address
    description: Host information includes data that correlates the host data to detected
      security events
    name: vectra-hosts
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Detection.ID
      description: List of Detections for Host
    - contextPath: Endpoint.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.CScore
      description: The current certainty score correlated to this host
  - arguments: []
    deprecated: true
    description: The settings information includes S-series sensor and X-series configurations
      input by the administrator
    name: vec-settings
  - arguments: []
    description: he settings information includes S-series sensor and X-series configurations
      input by the administrator
    name: vectra-settings
  - arguments:
    - description: the path to query
      name: path
    deprecated: true
    description: The health configuration can be used to retrieve system health statistics
      such as subnet counts, traffic bandwidth, headend and sensor information
    name: vec-health
  - arguments:
    - description: the path to query
      name: path
    description: The health configuration can be used to retrieve system health statistics
      such as subnet counts, traffic bandwidth, headend and sensor information
    name: vectra-health
  - arguments: []
    deprecated: true
    description: The rules branch can be used to retrieve a listing of configured
      Triage rules
    name: vec-triage
    outputs:
    - contextPath: Vectra.Rule.ID
      description: The record id
    - contextPath: Vectra.Rule.SmartCategory
      description: Custom Triage label used to recategorize specified detections
    - contextPath: Vectra.Rule.Description
      description: Name of Triage filter
    - contextPath: Vectra.Rule.Type
      description: Original detection type
    - contextPath: Vectra.Rule.Category
      description: Original detection category
    - contextPath: Vectra.Rule.Created
      description: The timestamp when this Triage filter was created
    - contextPath: Vectra.Rule.LastUpdate
      description: The timestamp when this Triage filter was triggered
    - contextPath: Vectra.Rule.Host.ID
      description: Host(s) that this Triage filter applies to
    - contextPath: Vectra.Rule.IP
      description: Host IP
    - contextPath: Vectra.Rule.Priority
      description: Used in ordering execution of Triage filters
    - contextPath: Vectra.Rule.Remote.IP
      description: Destination IP where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Protocol
      description: Destination protocol where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Port
      description: Destination port where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.DNS
      description: Destination FQDN where this Triage filter will apply to
    - contextPath: Vectra.Rule.Remote.Kerberos.Account
      description: Kerberos Account
    - contextPath: Vectra.Rule.Remote.Kerberos.Service
      description: Kerberos Service
  - arguments: []
    description: The rules branch can be used to retrieve a listing of configured
      Triage rules
    name: vectra-triage
    outputs:
    - contextPath: Vectra.Rule.ID
      description: The record id
    - contextPath: Vectra.Rule.SmartCategory
      description: Custom Triage label used to recategorize specified detections
    - contextPath: Vectra.Rule.Description
      description: Name of Triage filter
    - contextPath: Vectra.Rule.Type
      description: Original detection type
    - contextPath: Vectra.Rule.Category
      description: Original detection category
    - contextPath: Vectra.Rule.Created
      description: The timestamp when this Triage filter was created
    - contextPath: Vectra.Rule.LastUpdate
      description: The timestamp when this Triage filter was triggered
    - contextPath: Vectra.Rule.Host.ID
      description: Host(s) that this Triage filter applies to
    - contextPath: Vectra.Rule.IP
      description: Host IP
    - contextPath: Vectra.Rule.Priority
      description: Used in ordering execution of Triage filters
    - contextPath: Vectra.Rule.Remote.IP
      description: Destination IP where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Protocol
      description: Destination protocol where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Port
      description: Destination port where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.DNS
      description: Destination FQDN where this Triage filter will apply to
    - contextPath: Vectra.Rule.Remote.Kerberos.Account
      description: Kerberos Account
    - contextPath: Vectra.Rule.Remote.Kerberos.Service
      description: Kerberos Service
  - arguments: []
    deprecated: true
    description: The sensors branch can retrieve a listing of sensors that collect
      and feed data to the X-series
    name: vec-sensors
    outputs:
    - contextPath: Vectra.Sensor.ID
      description: Object ID
    - contextPath: Vectra.Sensor.Alias
      description: User configured alias assigned tothe sensor
    - contextPath: Vectra.Sensor.Location
      description: User configured location assigned to the sensor
    - contextPath: Vectra.Sensor.SerialNumber
      description: Serial number of the sensor
    - contextPath: Vectra.Sensor.LUID
      description: Local Unique Identifier assigned to the sensor
    - contextPath: Vectra.Sensor.Status
      description: Pairing status of the sensor
    - contextPath: Vectra.Sensor.CurrentVersion
      description: OS version currently running on the sensor
    - contextPath: Vectra.Sensor.OriginalVersion
      description: OS version originally installed on the sensor
    - contextPath: Vectra.Sensor.IP
      description: IP address of the sensor
    - contextPath: Vectra.Sensor.URI
      description: The URI of the brain the sensor is paired
    - contextPath: Vectra.Sensor.LastSeen
      description: Timestamp of the last connection by the sensor to the brain
  - arguments: []
    description: The sensors branch can retrieve a listing of sensors that collect
      and feed data to the X-series
    name: vectra-sensors
    outputs:
    - contextPath: Vectra.Sensor.ID
      description: Object ID
    - contextPath: Vectra.Sensor.Alias
      description: User configured alias assigned tothe sensor
    - contextPath: Vectra.Sensor.Location
      description: User configured location assigned to the sensor
    - contextPath: Vectra.Sensor.SerialNumber
      description: Serial number of the sensor
    - contextPath: Vectra.Sensor.LUID
      description: Local Unique Identifier assigned to the sensor
    - contextPath: Vectra.Sensor.Status
      description: Pairing status of the sensor
    - contextPath: Vectra.Sensor.CurrentVersion
      description: OS version currently running on the sensor
    - contextPath: Vectra.Sensor.OriginalVersion
      description: OS version originally installed on the sensor
    - contextPath: Vectra.Sensor.IP
      description: IP address of the sensor
    - contextPath: Vectra.Sensor.URI
      description: The URI of the brain the sensor is paired
    - contextPath: VectraSensor.LastSeen
      description: Timestamp of the last connection by the sensor to the brain
  - arguments:
    - default: true
      description: The id of the required host
      name: host_id
      required: true
    deprecated: true
    description: Get host by id
    name: vec-get-host-by-id
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.Vectra.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Vectra.DetectionID
      description: List of Detections for Host
    - contextPath: Endpoint.Vectra.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.Vectra.CScore
      description: The current certainty score correlated to this host
  - arguments:
    - description: The id of the required detection
      name: detection_id
    deprecated: true
    description: Get detections by host id
    name: vec-get-detetctions-by-id
  isfetch: true
  script: "var username = params.credentials.identifier;\nvar password = params.credentials.password;\n\
    var server = params.server.replace(/[\\/]+$/, '');\nvar insecure = params.insecure;\n\
    var sendRequest = function(method, url, queryName) {\n    var res = http(\n  \
    \          url,\n            {\n                Method: method,\n            \
    \    Username: username,\n                Password: password,\n              \
    \  Headers: {'content-type': ['application/json']},\n            },\n        \
    \    insecure\n        );\n    if (res.StatusCode < 200 || res.StatusCode >= 300)\
    \ {\n        throw 'Failed to ' + queryName + ', request status code: ' + res.StatusCode\
    \ + ' and Body: ' + res.Body + '.';\n    }\n    return res;\n};\n\nvar urlDict\
    \ = {\n    'vectra-detections': '/api/detections/',\n    'vectra-hosts':'/api/hosts/',\n\
    \    'vectra-settings':'/api/settings/',\n    'vectra-triage':'/api/rules/',\n\
    \    'vectra-sensors':'/api/sensors/',\n    'vectra-health':'/api/health/',\n\
    \    'vec-get-detetctions-by-id':'/api/detections/', //deprecated\n    'vec-detections':\
    \ '/api/detections/',   //deprecated\n    'vec-hosts':'/api/hosts',          \
    \     //deprecated\n    'vec-settings':'/api/settings',         //deprecated\n\
    \    'vec-triage':'/api/rules',              //deprecated\n    'vec-sensors':'/api/sensors',\
    \           //deprecated\n    'vec-health':'/api/health/',            //deprecated\n\
    \    'vec-get-host-by-id':'/api/hosts/',     //deprecate\n};\n\nvar createIncidentFromDetection\
    \ = function(incident) {\n    var keys = Object.keys(incident);\n    var labels\
    \ = [];\n    for (var i = 0; i<keys.length; i++) {\n        labels.push({'type':\
    \ keys[i], 'value': typeof(incident[keys[i]]) === 'object' ? JSON.stringify(incident[keys[i]])\
    \ : incident[keys[i]].toString()});\n    }\n    return {\n        \"name\": incident.id\
    \ + ' ' + incident.type_vname,\n        \"labels\": labels,\n        \"rawJSON\"\
    : JSON.stringify(incident)\n    };\n};\n\nvar fetchIncidents = function(){\n \
    \   var lastRun = getLastRun();\n    var id = lastRun && lastRun.id ? lastRun.id\
    \ : 0;\n    var result = sendRequest('GET', server + urlDict['vectra-detections']\
    \ + encodeToURLQuery({min_id: id, 'page':'last'}), 'vectra-detections');\n   \
    \ var res = JSON.parse(result.Body).results;\n    var incidents = [];\n    for\
    \ (var i = 0; i < res.length; i++) {\n        var detection = res[i];\n      \
    \  id = Math.max(id, detection.id);\n        incidents.push(createIncidentFromDetection(res[i]));\n\
    \    }\n    if (incidents.length > 0) {\n      setLastRun({'id': id !== 0 ? id\
    \ + 1 : 0});\n    }\n    return JSON.stringify(incidents);\n};\n\nvar isEmpty\
    \ = function(object) {\n    if(Array.isArray(object)){\n        return object.length\
    \ === 0;\n    }\n    for(var i in object) {\n        if(object[i]){\n        \
    \    return false;\n        }\n    }\n    return true;\n};\n\nvar splitToID =\
    \ function(str){\n    var temp = str.split('/');\n    return temp[temp.length\
    \ -1];\n};\n\nvar removeFromArray = function(keys, array){\n    for(var i=0; i<keys.length;\
    \ i++){\n        array.splice(array.indexOf(keys[i]), 1);\n    }\n    return array;\n\
    };\n\nvar vectraDetections = function(result){\n    var res = JSON.parse(result.Body);\n\
    \n    var md;\n    if(args.detection_id){\n        res = [res];\n    }\n    else{\n\
    \        res = res.results;\n    }\n    var keys = Object.keys(res[0]);\n    keys.splice(keys.indexOf('url'),\
    \ 1);\n\n    var temp;\n    for(var i=0; i<res.length; i++){\n        if(res[i].host){\n\
    \            res[i].host = splitToID(res[i].host);\n        }\n    }\n\n    var\
    \ relayed_comm_set = null;\n    var summary = null;\n\n    if(res.length === 1){\n\
    \        if (res[0].summary)\n        {\n            summary = res[0].summary;\n\
    \        }\n        if (res[0].relayed_comm_set)\n        {\n            relayed_comm_set\
    \ = res[0].relayed_comm_set;\n        }\n    }\n\n    md = tblToMd('Detection\
    \ table', res, ['id','type_vname','category','src_ip','t_score','c_score','first_timestamp','tags',\
    \ 'targets_key_asset']);\n\n    if (relayed_comm_set){\n        if (!(relayed_comm_set\
    \ instanceof Array)){\n            relayed_comm_set = [relayed_comm_set];\n  \
    \      }\n        if (relayed_comm_set.length > 0 && relayed_comm_set[0]) {\n\
    \            var relayed_keys = Object.keys(relayed_comm_set[0]);\n          \
    \  relayed_keys.splice(relayed_keys.indexOf('url'), 1);\n\n            md += '\\\
    n';\n            md += tblToMd('Relayed Comm Set',relayed_comm_set,relayed_keys);\n\
    \        }\n    }\n    if (summary){\n        if (!(summary instanceof Array)){\n\
    \            summary = [summary];\n        }\n        if (summary.length > 0 &&\
    \ summary[0]) {\n            var summary_keys = Object.keys(summary[0]);\n\n \
    \           md += '\\n';\n            md += tblToMd('Summary',summary,summary_keys);\n\
    \        }\n    }\n\n    var context = [];\n    for(i=0; i<res.length; i++){\n\
    \        var val = res[i];\n        res[i] = {\n                    DetectionId:\
    \ val.id,\n                    TypeVName: val.type_vname,\n                  \
    \  Category: val.category,\n                    SrcIP: val.src_ip,\n         \
    \           State: val.state,\n                    TScore: val.t_score,\n    \
    \                CScore: val.c_score,\n                    TargetsKeyAsset: val.targets_key_asset,\n\
    \                    FirstTimestamp: val.first_timestamp,\n                  \
    \  LastTimestamp: val.last_timestamp,\n                    Tags: val.tags,\n \
    \                   HostID: splitToID(val.host)\n                };\n        context.push(res[i]);\n\
    \    }\n\n    return {\n        Type: entryTypes.note,\n        Contents: result.Body,\n\
    \        ContentsFormat: formats.json,\n        HumanReadable: md,\n        EntryContext:\
    \ {'Vectra.Detections(val.DetectionId==obj.DetectionId)': context }\n    };\n\
    };\n\nvar vectraHosts = function(result){\n    var res;\n\n    if(args.host_id){\n\
    \        res = [JSON.parse(result.Body)];\n    }\n    else{\n        res = JSON.parse(result.Body).results;\n\
    \    }\n\n    var temp;\n    for(var i=0; i<res.length; i++){\n        res[i].detection_ids\
    \ = res[i].detection_set;\n        if(res[i].detection_ids){\n            for(j=0;\
    \ j<res[i].detection_ids.length; j++){\n                res[i].detection_ids[j]\
    \ = splitToID(res[i].detection_ids[j]);\n            }\n        }\n    }\n\n \
    \   var md = tblToMd(\n            'Hosts table',\n            res,\n        \
    \    ['id','name','state','t_score','c_score','last_source','last_detection_timestamp','detection_ids','tags','key_asset','new_host_pointer','sensor_luid','targets_key_asset']\n\
    \    );\n\n    var val;\n    for(i=0; i<res.length; i++){\n        val = res[i];\n\
    \        res[i] = {\n                    Hostname: val.name,\n               \
    \     Vectra: {\n                        ID: val.id,\n                       \
    \ LastDetection: val.last_detection_timestamp,\n                        DetectionID:\
    \ val.detection_ids,\n                        TScore: val.t_score,\n         \
    \               CScore: val.c_score,\n                        KeyAsset: val.key_asset,\n\
    \                        TargetsKeyAsset: val.targets_key_asset,\n           \
    \         },\n                    State: val.state,\n                    IP: val.last_source,\n\
    \                };\n    }\n    var context = {Endpoint : res};\n\n    return\
    \ {\n        Type: entryTypes.note,\n        Contents: result.Body,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext: context\n \
    \   };\n};\n\nvar vectraSettings = function(result){\n    var res = JSON.parse(result.Body);\n\
    \    var keys = removeFromArray(['url'],Object.keys(res.results[0]));\n    var\
    \ md = tblToMd('Setting table', res.results, keys);\n\n    return {\n        Type:\
    \ entryTypes.note,\n        Contents: result.Body,\n        ContentsFormat: formats.json,\n\
    \        HumanReadable: md\n    };\n};\n\nvar vectraTriage = function(result){\n\
    \    var res = (JSON.parse(result.Body)).results;\n    var temp;\n\n    for(var\
    \ i=0; i<res.length; i++){\n        if(res[i].host){\n            for(var j=0;\
    \ j<res[i].host.length; j++){\n                res[i].host[j] = splitToID(res[i].host[j]);\n\
    \            }\n        }\n    }\n\n    var keys = removeFromArray(['url'], Object.keys(res[0]));\n\
    \    var md = tblToMd('Rules table', res, keys);\n    var context = {};\n    var\
    \ val;\n\n    for(i=0; i<res.length; i++){\n        val = res[i];\n        res[i]\
    \ = {          ID:             val.name,\n                            SmartCategory:\
    \  val.smart_category,\n                            Description:    (val.description?\
    \ val.description:undefined),\n                            Type:           val.type_vname,\n\
    \                            Category:       val.category,\n                 \
    \           Created :       val.created_timestamp,\n                         \
    \   LastUpdate:     val.last_timestamp,\n                            Host:   \
    \        (val.host.length === 0 ? undefined :  val.host),\n                  \
    \          IP:             (val.ip? val.ip : undefined),\n                   \
    \         Priority:       (val.priority? val.priority : undefined),\n        \
    \                    Remote:         [{  IP: (val.remote1_ip? val.remote1_ip :\
    \ undefined),\n                                                Protocol: (val.remote1_proto?\
    \ val.remote1_proto : undefined),\n                                          \
    \      Port:(val.remote1_port? val.remote1_port : undefined),\n              \
    \                                  DNS: (val.remote1_dns? val.remote1_dns : undefined),\n\
    \                                                Kerberos: {Account: (val.remote1_kerb_account?\
    \ val.remote1_kerb_account : undefined),\n                                   \
    \                         Service:(val.remote1_kerb_service? val.remote1_kerb_service\
    \ : undefined)\n                                                }},\n        \
    \                                     {  IP: (val.remote2_ip? val.remote2_ip :\
    \ undefined),\n                                                Protocol: (val.remote2_proto?\
    \ val.remote2_proto : undefined),\n                                          \
    \      Port: (val.remote2_port? val.remote2_port : undefined),\n             \
    \                                   DNS:(val.remote2_dns? val.remote2_dns : undefined)\n\
    \                                             }]\n                           \
    \ };\n\n    }\n    var notEmpty = function(obj){\n        return !isEmpty(obj);\n\
    \    }\n\n    for(i=0; i<res.length; i++){\n        temp = res[i].Remote;\n  \
    \      if(isEmpty(temp[0].Kerberos)){\n            delete temp[0].Kerberos;\n\
    \        }\n        temp = temp.filter(notEmpty);\n        if(isEmpty(temp)){\n\
    \            temp = undefined;\n        }\n        res[i].Remote = temp;\n   \
    \ }\n    context.Vectra = {Rule: res};\n\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: result.Body,\n        ContentsFormat: formats.json,\n     \
    \   HumanReadable: md,\n        EntryContext : context\n    };\n\n};\n\nvar vectraSensors\
    \ = function(result){\n    var res = JSON.parse(result.Body);\n    var keys =\
    \ removeFromArray(['url','health_stats'], Object.keys(res.results[0]));\n    var\
    \ md = tblToMd('Sensors table', res.results, keys);\n    var val;\n    for(i=0;\
    \ i<res.results.length; i++){\n        val = res.results[i];\n        res.results[i]\
    \ = {\n                            ID : val.id,\n                            Alias\
    \ : val.alias,\n                            Location : (val.location? val.location:undefined),\n\
    \                            SerialNumber : val.serial_number,\n             \
    \               LUID : val.luid,\n                            Status : val.status,\n\
    \                            CurrentVersion : val.current_version,\n         \
    \                   OriginalVersion : val.original_version,\n                \
    \            IP : val.ip_address,\n                            URI : val.headend_uri,\n\
    \                            LastSeen : val.last_seen\n                      \
    \  };\n    }\n\n    var context = {Vectra: { Sensor: res.results } };\n\n    return\
    \ {\n        Type: entryTypes.note,\n        Contents: result.Body,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext : context\n\
    \    };\n};\n\nvar funcDict = {\n    'vectra-detections':  vectraDetections,\n\
    \    'vectra-hosts':       vectraHosts,\n    'vectra-settings':    vectraSettings,\n\
    \    'vectra-triage':      vectraTriage,\n    'vectra-sensors':     vectraSensors,\n\
    \    'vec-detections':     vectraDetections, //deprecated\n    'vec-hosts':  \
    \        vectraHosts,      //deprecated\n    'vec-settings':       vectraSettings,\
    \   //deprecated\n    'vec-triage':         vectraTriage,     //deprecated\n \
    \   'vec-sensors':        vectraSensors,    //deprecated\n    'vec-get-host-by-id':\
    \ vectraHosts,      //deprecated\n    'vec-get-detetctions-by-id': vectraDetections\
    \  //deprecated\n};\n\nvar result;\n\nswitch (command) {\n    case 'fetch-incidents':\n\
    \        return fetchIncidents();\n    case 'test-module':\n        if (sendRequest('GET',\
    \ server + urlDict['vec-detections'], 'Test')) {\n            return 'ok';\n \
    \       }\n        return 'not cool';\n    case 'vectra-health':\n    case 'vec-health':\
    \ //deprecated\n        return sendRequest('GET', server + urlDict[command] +\
    \ '/' + args.path, urlDict[command]);\n    case 'vec-get-detetctions-by-id': \
    \  //deprecated\n    case 'vec-detections':              //deprecated\n    case\
    \ 'vectra-detections':\n        result = sendRequest('GET', server + urlDict[command]\
    \ + (args.detection_id? args.detection_id : encodeToURLQuery(args)), urlDict[command]);\n\
    \        break;\n    case 'vec-get-host-by-id':  //deprecated\n    case 'vec-hosts':\
    \           //deprecatd\n    case 'vectra-hosts':\n        result = sendRequest('GET',\
    \ server + urlDict[command] + (args.host_id? args.host_id : encodeToURLQuery(args)),\
    \ urlDict[command]);\n        break;\n    default:\n        result = sendRequest('GET',\
    \ server + urlDict[command] + encodeToURLQuery(args), urlDict[command]);\n}\n\n\
    return funcDict[command](result);"
  type: javascript
tests:
- No test
toversion: 4.1.9
