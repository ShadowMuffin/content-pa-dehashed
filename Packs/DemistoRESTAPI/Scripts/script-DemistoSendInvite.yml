args:
- default: true
  description: Email of user being invited
  name: email
  required: true
- description: Roles of invited user
  name: roles
  required: true
comment: Send invitation to join Demisto
commonfields:
  id: DemistoSendInvite
  version: -1
dependson:
  must:
  - demisto-api-post
  - demisto-api-get
enabled: true
name: DemistoSendInvite
script: "var res = executeCommand('demisto-api-get', {uri: '/roles'});\nif (isError(res[0]))\
  \ {\n    throw res[0].Contents;\n}\n\nvar roles = res[0].Contents.response;\nvar\
  \ roleIDs = [];\nvar roleNames = args.roles.split(',');\n\nroleNames.forEach(function(roleName)\
  \ {\n    var roleID = dq({roles:roles},'roles(val.name==\"'+roleName+'\").id');\n\
  \    if (!roleID) {\n        throw 'Cannot find role ' + roleName;\n    }\n    roleIDs.push(roleID[0]);\n\
  });\n\nbody = {\n    email: args.email,\n    roles: roleIDs\n};\n\nres = executeCommand('demisto-api-post',\
  \ {uri: '/invite', body: body});\nif (isError(res[0])) {\n    throw res[0].Contents;\n\
  }\n\nvar response = res[0].Contents.response;\nvar md = tableToMarkdown('Demisto\
  \ invite user', response);\nvar ec = {email: response.email, link: response.url};\n\
  \nreturn {\n    ContentsFormat: formats.json,\n    Type: entryTypes.note,\n    Contents:\
  \ response,\n    HumanReadable: md\n};"
scripttarget: 0
tags:
- DemistoAPI
toversion: 4.1.9
type: javascript
