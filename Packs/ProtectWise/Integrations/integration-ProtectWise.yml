category: Network Security
commonfields:
  id: ProtectWise
  version: -1
configuration:
- defaultvalue: https://api.protectwise.com/api/v1/
  display: Url
  name: url
  required: true
  type: 0
- defaultvalue: ''
  display: Email
  name: email
  required: false
  type: 0
- defaultvalue: ''
  display: Password
  name: password
  required: false
  type: 4
- display: API Token
  name: token
  required: false
  type: 4
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Only fetch events with this text in the name
  name: messageFilter
  required: false
  type: 0
- defaultvalue: ''
  display: Filter by threat category
  name: threatCategory
  required: false
  type: 0
- defaultvalue: ''
  display: Filter by killchain stage
  name: killChainStage
  required: false
  type: 0
- defaultvalue: ''
  display: Filter by  threat level (LOW, MEDIUM, or HIGH)
  name: threatLevel
  required: false
  type: 0
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- defaultvalue: '50'
  display: Maximum events to fetch per fetch
  name: maxFetch
  required: false
  type: 0
description: Cloud based Security Network DVR
detaileddescription: 'To configure this integration you can either use Email and Password,
  or the API token.

  To obtain the API token navigate to the `Settings` page in the Visualizer UI, and
  under `Your Settings`

  select `GENERATE TOKEN`.'
display: ProtectWise
fromversion: 3.5.0
image: data:image/png;base64,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
name: ProtectWise
script:
  commands:
  - arguments:
    - default: true
      description: The ID of the individual sensor. If empty, will query all available
        sensors.
      name: sensorId
    deprecated: true
    description: Returns the specified, or all available sensors.
    name: sensors
  - arguments:
    - default: true
      description: The ID of the individual sensor. If empty, will query all available
        sensors.
      name: sensorId
    description: Returns all available sensors.
    name: protectwise-show-sensors
    outputs:
    - contextPath: Protectwise.Sensor.id
      description: The ID of the sensor.
    - contextPath: Protectwise.Sensor.friendly_name
      description: The name of the sensor.
    - contextPath: Protectwise.Sensor.ip_address
      description: The IP address of the sensor.
    - contextPath: Protectwise.Sensor.last_seen
      description: The time when the sensor was last seen.
    - contextPath: Protectwise.Sensor.customer_id
      description: The customer ID of the sensor.
    - contextPath: Protectwise.Sensor.enabled
      description: Whether the sensor is enabled.
  - arguments:
    - description: The timestamp of the start time of the event. For example, 1401451200000,
        or 2015-03-25T12:00:00.
      name: start
      required: true
    - description: The timestamp of the end of the event. For example, 1401451500000,
        or 2015-03-25T12:00:00.
      name: end
      required: true
    - description: 'Filter by one or more event types. Can be: "MaliciousFlow", "KillChainEscalation",
        or "MaliciousConversation".'
      name: eventType
    - description: 'Filter by killchain stage. Can be: "Methodology", "Recon", "Delivery",
        "Exploit", "Beacon", "CnC", "Fortification", or Data_Theft".'
      name: killChainStage
    - description: 'Filter by the threat level. Can be: "NONE", "LOW", "MEDIUM", or
        "HIGH".'
      name: threatLevel
    - description: 'Filter by the threat category. Can be: "ExploitsAndAttacks", "DenialOfService",
        "Malware", "Scanning", "Botnets", "Phishing", "Suspicious", "MaliciousHost",
        "APT", "Misc", or "Unknown".'
      name: threatCategory
    - description: 'Filter by the observation stage. Can be: "Realtime" or "Retrospective".'
      name: observationStage
    - description: Filter by events that are affected by a specific IP address.
      name: ip
    - description: The minimum number of results to return per page.
      name: minLimit
    - description: The maximum number of results to return per page.
      name: maxLimit
    - description: Whether to sort results by descending timestamp. If "true", results
        are returned in descending timestamp order. If "false", results are returned
        in ascending timestamp order. Default is "true".
      name: reverseOrder
    - description: An identifier to fetch the next page in the result set.
      name: nextPage
    deprecated: true
    description: Searches for events. Events are resources that describe a threat
      and contain a collection of observations.
    name: search
  - arguments:
    - description: Timestamp of the start time of the event. For example, 1401451200000,
        or 2015-03-25T12:00:00.
      name: start
      required: true
    - description: Timestamp of the end of the event. For example, 1401451500000,
        or 2015-03-25T12:00:00.
      name: end
      required: true
    - description: 'Filters by one or more event types. Can be: "MaliciousFlow:, "KillChainEscalation",
        or "MaliciousConversation".'
      name: eventType
    - description: 'Filters by the killchain stage. Can be: "Methodology", "Recon",
        "Delivery", "Exploit", "Beacon", "CnC", "Fortification", or "Data_Theft".'
      name: killChainStage
    - description: 'Filters by Low, Medium, or High threats. Can be: "NONE", "LOW",
        "MEDIUM", or "HIGH".'
      name: threatLevel
    - description: 'Filters by threat category. Can be: "ExploitsAndAttacks", "DenialOfService",
        "Malware", "Scanning", "Botnets", "Phishing", "Suspicious", "MaliciousHost",
        "APT", "Misc", or "Unknown".'
      name: threatCategory
    - description: Filters by Realtime or Retrospective.
      name: observationStage
    - description: Filters by events that are affected by a specific IP address.
      name: ip
    - description: Minimum number of results to return per page.
      name: minLimit
    - description: Maximum number of results to return per page.
      name: maxLimit
    - description: Return results sorted by descending timestamp (default = true).
      name: reverseOrder
    - description: An identifier which fetches the next page in the result set.
      name: nextPage
    description: Searches for events. Events are resources that describe a threat
      and contains a collection of observations. Deprecated - use the protectwise-search-events
      command.
    name: protectwise-search-events
    outputs:
    - contextPath: Protectwise.Event.message
      description: Name of the event.
    - contextPath: Protectwise.Event.id
      description: Protectwise event ID.
    - contextPath: Protectwise.Event.type
      description: The type of the event.
    - contextPath: Protectwise.Event.sensorId
      description: The sensor ID of the event.
    - contextPath: Protectwise.Event.threatScore
      description: The threat score (0-100).
    - contextPath: Protectwise.Event.killChainStage
      description: The Kill Chain Stage of the event.
    - contextPath: Protectwise.Event.confidence
      description: The confidence level (0-100)
    - contextPath: Protectwise.Event.startedAt
      description: The time that Event started.
    - contextPath: Protectwise.Event.observedAt
      description: The time the event was observed.
    - contextPath: Protectwise.Event.endedAt
      description: The time the event ended.
    - contextPath: Protectwise.Event.observationCount
      description: The number of observations related to this event.
    - contextPath: Protectwise.Event.netflowCount
      description: The number of netflows related to this event.
    - contextPath: Protectwise.Event.observedStage
      description: The observed stage (Realtime or Retrospective).
  - arguments:
    - default: true
      description: The ID of the event to return.
      name: id
      required: true
    deprecated: true
    description: Returns information about a single event and its associated observations.
    name: pw-event-get
  - arguments:
    - default: true
      description: The ID of the event.
      name: id
      required: true
    description: Searches for a single event in ProtectWise. Deprecated - use the
      protectwise-event-info command.
    name: protectwise-event-info
    outputs:
    - contextPath: Protectwise.Event.message
      description: Name of the event.
    - contextPath: Protectwise.Event.id
      description: The ID of the event.
    - contextPath: Protectwise.Event.type
      description: The type of the event.
    - contextPath: Protectwise.Event.sensorId
      description: The sensor ID of the event.
    - contextPath: Protectwise.Event.threatScore
      description: The Threat score. From 0-100.
    - contextPath: Protectwise.Event.killChainStage
      description: Kill Chain Stage of the event.
    - contextPath: Protectwise.Event.confidence
      description: The Confidence level. From 0-100.
    - contextPath: Protectwise.Event.startedAt
      description: The time the event started.
    - contextPath: Protectwise.Event.observedAt
      description: The time the event was observed.
    - contextPath: Protectwise.Event.endedAt
      description: The time the event ended.
    - contextPath: Protectwise.Event.observationCount
      description: The number of observations related to this event.
    - contextPath: Protectwise.Event.netflowCount
      description: The number of netflows related to this event.
    - contextPath: Protectwise.Event.observedStage
      description: The observed stage (Realtime or Retrospective).
    - contextPath: Protectwise.Event.Netflows.key
      description: The Netflow key.
    - contextPath: Protectwise.Event.Netflows.srcIp
      description: The Netflow Source IP.
    - contextPath: Protectwise.Event.Netflows.dstIp
      description: The Netflow Dst IP.
    - contextPath: Protectwise.Event.Netflows.srcPort
      description: The Netflow source port.
    - contextPath: Protectwise.Event.Netflows.dstPort
      description: The Netflow DST Port.
    - contextPath: Protectwise.Event.Netflows.layer4Proto
      description: The Netflow Layer 4 Protocol.
    - contextPath: Protectwise.Event.Observations.id
      description: The observation ID.
    - contextPath: Protectwise.Event.Observations.killChainStage
      description: The Observation Killchain Stage.
    - contextPath: Protectwise.Event.Observations.source
      description: The Observation Source.
    - contextPath: Protectwise.Event.Observations.sensorId
      description: The Observation's Sensor ID.
    - contextPath: Protectwise.Event.Observations.threatScore
      description: The Observation threat score.
    - contextPath: Protectwise.Event.Observations.severity
      description: The Observation Severity.
    - contextPath: Protectwise.Event.Observations.confidence
      description: The observation confidence level (0-100).
    - contextPath: Protectwise.Event.Observations.occurredAt
      description: The time the observation occurred.
    - contextPath: Protectwise.Event.Observations.observedAt
      description: The time the observation observed.
    - contextPath: Protectwise.Event.Observations.endedAt
      description: The time the observation ended.
    - contextPath: Protectwise.Event.Observations.netflowId
      description: The ID of the related Netflow for this observation.
    - contextPath: Protectwise.Event.Observations.observedStage
      description: The observed stage of the observation.
  - arguments:
    - description: The sensor ID or a comma-separated list of sensor IDs.
      name: sensorId
      required: true
    - description: The timestamp of the start time of the event. For example, 1401451200000,
        or 2015-03-25T12:00:00
      name: start
      required: true
    - description: The timestamp of the end of the event. For example, 1401451500000,
        or 2015-03-25T12:00:00
      name: end
      required: true
    - description: 'Filter by observation type. Can be: "ids", "http", "iprep", "urlrep",
        "protocol" or "file".'
      name: type
    - description: Search for observations in every kill chain stage (true false)
      name: hasKillChain
    - description: Filter by kill chain stage (Methodology  Recon  Delivery  Exploit  Beacon  CnC  Fortification  Data_Theft)
      name: killChainStage
    - description: Filter observations by IP address in the src/dst fields
      name: ip
    - description: Filter by Low, Medium, or High threats (NONE  LOW  MEDIUM  HIGH)
      name: threatLevel
    - description: Filter by threat category (ExploitsAndAttacks  DenialOfService  Malware  Scanning  Botnets  Phishing  Suspicious  MaliciousHost  APT  Misc  Unknown)
      name: threatCategory
    - description: 'Filter by threat signature (find observations of the same type
        of threat) -  Example: 69020504'
      name: signatureId
    - description: Try to return at least this many results per page
      name: minLimit
    - description: Do not return more than this many results
      name: maxLimit
    - description: Return results sorted by descending timestamp (default = true)
      name: reverseOrder
    - description: An identifier to fetch the next page in the result set
      name: nextPage
    deprecated: true
    description: Searches for observations in ProtectWise.
    name: observation-search
  - arguments:
    - description: The ID of the individual sensor or a comma-separated list of Sensor
        IDs.
      name: sensorId
      required: true
    - description: Timestamp of the start time of the event. For example, 1401451200000,
        or 2015-03-25T12:00:00.
      name: start
      required: true
    - description: Timestamp of the end of the event. For example, 1401451500000,
        or 2015-03-25T12:00:00
      name: end
      required: true
    - description: 'Filter by observation type. Can be: "ids", "http", "iprep", "urlrep",
        "protocol", or "file".'
      name: type
    - description: 'Searches for observations in every kill chain stage. Can be: "true"
        or "false".'
      name: hasKillChain
    - description: 'Filter by killchain stage. Can be: "Methodology", "Recon", "Delivery",
        "Exploit", "Beacon", "CnC", "Fortification", or "Data_Theft".'
      name: killChainStage
    - description: Filter observations by IP address in the src/dst fields.
      name: ip
    - description: 'Filter by Low, Medium, or High threats. Can be: "NONE", "LOW",
        "MEDIUM", or "HIGH".'
      name: threatLevel
    - description: 'Filter by threat category. Can be: "ExploitsAndAttacks", "DenialOfService",
        "Malware", "Scanning", "Botnets", "Phishing", "Suspicious", "MaliciousHost",
        "APT", "Misc", or "Unknown".'
      name: threatCategory
    - description: Filter by threat signature. Finds observations of the same type
        of threat). For example, 69020504.
      name: signatureId
    - description: Minimum number of results per page.
      name: minLimit
    - description: Maximum number of results per page.
      name: maxLimit
    - description: Returns results sorted by descending timestamp. Default is true.
      name: reverseOrder
    - description: An identifier to fetch the next page in the result set.
      name: nextPage
    description: Searches for observations in ProtectWise. Deprecated - use the protectwise-search-observations
      command.
    name: protectwise-search-observations
    outputs:
    - contextPath: Protectwise.Observation.id
      description: The ID of the observation.
    - contextPath: Protectwise.Observation.killChainStage
      description: The Killchain Stage of the observation.
    - contextPath: Protectwise.Observation.source
      description: The source of the observation.
    - contextPath: Protectwise.Observation.sensorId
      description: The ID of the protectwise sensor that generated the observation.
    - contextPath: Protectwise.Observation.threatScore
      description: The threat score of the observation.
    - contextPath: Protectwise.Observation.severity
      description: The severity of the observation.
    - contextPath: Protectwise.Observation.confidence
      description: The confidence level of the observation.
    - contextPath: Protectwise.Observation.occurredAt
      description: The time the observation occurred.
    - contextPath: Protectwise.Observation.observedAt
      description: The time the observation was observed.
    - contextPath: Protectwise.Observation.endedAt
      description: The time the observation ended.
    - contextPath: Protectwise.Observation.netflowId
      description: The ID of the Netflow attached to this observation.
    - contextPath: Protectwise.Observation.observedStage
      description: The attack stage reflected by the observation.
  - arguments:
    - description: The ID of the observation.
      name: id
      required: true
    - description: The ID of an individual sensor or a comma-separated list of sensor
        IDs.
      name: sensorId
      required: true
    deprecated: true
    description: Searches for a single observation in ProtectWise.
    name: pw-observation-get
  - arguments:
    - description: The ID of the observation.
      name: id
      required: true
    - description: The Sensor ID or a comma-separated list of Sensor IDs.
      name: sensorId
      required: true
    description: Lookup a single observation for ProtectWise. Deprecated - use the
      protectwise-event-pcap-download command.
    name: protectwise-observation-info
    outputs:
    - contextPath: Protectwise.Observation.id
      description: The ID of the observation.
    - contextPath: Protectwise.Observation.killChainStage
      description: The Killchain Stage of the observation.
    - contextPath: Protectwise.Observation.source
      description: Observation Source
    - contextPath: Protectwise.Observation.sensorId
      description: ID of the Protectwise sensor that generated the observation.
    - contextPath: Protectwise.Observation.threatScore
      description: The threat Score of the observation.
    - contextPath: Protectwise.Observation.severity
      description: The severity of the observation.
    - contextPath: Protectwise.Observation.confidence
      description: The confidence level of the observation.
    - contextPath: Protectwise.Observation.occurredAt
      description: The time the observation occurred.
    - contextPath: Protectwise.Observation.observedAt
      description: The time the observation was Observed.
    - contextPath: Protectwise.Observation.endedAt
      description: The time the observation ended.
    - contextPath: Protectwise.Observation.netflowId
      description: The ID of the Netflow tied to this observation.
    - contextPath: Protectwise.Observation.observedStage
      description: The attack stage reflected by the observation.
  - arguments:
    - default: true
      description: The event ID.
      name: eventId
      required: true
    - description: The filename for download.
      name: filename
    deprecated: true
    description: The Event PCAP file to download.
    name: event-pcap-download
  - arguments:
    - default: true
      description: The ID of the event.
      name: eventId
      required: true
    - description: The filename for the download.
      name: filename
    description: Event Pcap Download. Deprecated - use the protectwise-event-pcap-info
      command.
    name: protectwise-event-pcap-download
  - arguments:
    - default: true
      description: The ID of the event.
      name: eventId
      required: true
    deprecated: true
    description: Returns details of the ProtectWise Event PCAP files.
    name: event-pcap-info
  - arguments:
    - default: true
      description: The event ID.
      name: eventId
      required: true
    description: Get ProtectWise Event Pcap info. Deprecated - use the protectwise-observation-pcap-download
      command.
    name: protectwise-event-pcap-info
    outputs:
    - contextPath: Protectwise.Event.id
      description: The ID of the Event.
    - contextPath: Protectwise.Event.PCAPSize
      description: Estimated PCAP size in bytes.
  - arguments:
    - default: true
      description: The ID of the observation.
      name: id
      required: true
    - description: The ID of the sensor.
      name: sensorId
      required: true
    - description: The filename for the download.
      name: filename
    deprecated: true
    description: Downloads the observation PCAP file.
    name: observation-pcap-download
  - arguments:
    - default: true
      description: The ID of the observation.
      name: id
      required: true
    - description: The ID of the sensor.
      name: sensorId
      required: true
    - description: The filename for the download.
      name: filename
    description: Downloads the Observation PCAP file. Deprecated - use the protectwise-observation-pcap-info
      command.
    name: protectwise-observation-pcap-download
  - arguments:
    - description: The ID of the observation.
      name: id
      required: true
    - description: The ID of the sensor.
      name: sensorId
      required: true
    deprecated: true
    description: Returns PCAP details of observations in Protectwise.
    name: observation-pcap-info
  - arguments:
    - description: The ID of the observation.
      name: id
      required: true
    - description: The ID of the Sensor.
      name: sensorId
      required: true
    description: Returns ProtectWise Observation PCAP file information.
    name: protectwise-observation-pcap-info
    outputs:
    - contextPath: Protectwise.Observation.id
      description: The ID of the observation.
    - contextPath: Protectwise.Observation.sensorId
      description: The Sensor ID of the observation.
    - contextPath: Protectwise.Observation.PCAPSize
      description: Estimated PCAP size in bytes
  - arguments: []
    deprecated: true
    description: Returns the API token, which is used in the integration configuration.
    name: get-token
  isfetch: true
  script: "var DEFAULT_EVENT_HEADERS = ['message','id','type','sensorId','threatScore','killChainStage','confidence','startedAt','observedAt','endedAt','observationCount','netflowCount','observedStage'];\n\
    var DEFAULT_NETFLOW_HEADERS = ['key', 'id.srcIp', 'id.dstIp', 'id.srcPort', 'id.dstPort',\
    \ 'id.layer4Proto'];\nvar DEFAULT_OBSERVATION_HEADERS = ['id','killChainStage','source','sensorId','threatScore','severity','confidence','occurredAt','observedAt','endedAt','netflowId','observedStage'];\n\
    var DEFAULT_SENSOR_HEADERS = ['id', 'friendly_name', 'ip_address', 'last_seen',\
    \ 'customer_id', 'enabled'];\nvar TIME_FIELDS = ['startedAt', 'occurredAt', 'endedAt',\
    \ 'observedAt'];\n\nvar serverUrl = params.url.replace(/[\\/]+$/, '') + '/';\n\
    \nvar getToken = function() {\n    var token = '';\n    if ((params.token) &&\
    \ (params.token.length > 0)) {\n        token = params.token;\n    }\n    if (token.length\
    \ === 0) {\n        if (params.email.length === 0 || params.password.length ===\
    \ 0){\n            throw 'If token configuration is empty , you must provide email+password\
    \ configuration params for auth';\n        }\n        var tokResult = http(\n\
    \            serverUrl + 'token',\n            {\n                Headers: {'Content-Type':\
    \ ['application/json']},\n                Method: 'POST',\n                Body:\
    \ JSON.stringify({'email': params.email, 'password': params.password}),\n    \
    \        },\n            params.insecure,\n            params.proxy\n        );\n\
    \        var body;\n        if (tokResult.StatusCode !== 200 && tokResult.StatusCode\
    \ !== 201) {\n            throw 'Failed to create token, request status code:\
    \ ' + tokResult.StatusCode + ', body: ' + tokResult.Body;\n        }\n       \
    \ try {\n            body = JSON.parse(tokResult.Body);\n        } catch (ex)\
    \ {\n            throw 'Error parsing token - ' + tokResult.Body + ' - ' + ex;\n\
    \        }\n\n        return body.token;\n    }\n    return token;\n};\n\n// If\
    \ value for any argument is empty remove it\nvar cleanArgs = function(args) {\n\
    \    return Object.keys(args).filter(function(k) {return args[k];}).reduce(function(clean,\
    \ k) {clean[k] = args[k]; return clean;}, {});\n};\n\nvar doReq = function(url,\
    \ token, raw, args, saveToFile) {\n    if (args) {\n        url += encodeToURLQuery(cleanArgs(args));\n\
    \    }\n    var res = http(\n        url,\n        {\n            Headers: {'X-Access-Token':\
    \ [ token ]},\n            Method: 'GET',\n            SaveToFile: saveToFile\
    \ ? true : false\n        },\n        params.insecure,\n        params.proxy\n\
    \        );\n    if (res.StatusCode !== 200) {\n        throw 'Failed to execute\
    \ ' + url + ' : ' + res.StatusCode + ', body: ' + res.Body;\n    }\n    try {\n\
    \        return (raw ? (saveToFile ? res.Path : res.Body) : JSON.parse(res.Body));\n\
    \    } catch (ex) {\n        throw 'Error parsing response - ' + res.Body + '\
    \ - ' + ex;\n    }\n};\n\nvar filterClone = function(src, filter) {\n    if (src\
    \ && Array.isArray(src) && filter && Array.isArray(filter)) {\n        var items\
    \ = [];\n        src.forEach(function(s) {\n            var item = {};\n     \
    \       filter.forEach(function( col ) {\n               item[col] =  dq(s, col);\n\
    \            });\n            items.push(item);\n        });\n        return items;\n\
    \    } else return undefined;\n};\n\nvar parseTime = function(time) {\n    if\
    \ ((typeof time === 'string' || time instanceof String) && (time.indexOf(\"-\"\
    ) >= 0 || time.indexOf(\"/\") >= 0 )){\n        var d = new Date(time);\n    \
    \    return d.getTime();\n    }\n    return time;\n};\n\nvar eventsSearch = function(start,\
    \ end, eventType, killChainStage, threatLevel, threatCategory, observationStage,\
    \ ip, expandDetails, minLimit, maxLimit, reverseOrder, nextPage, token) {\n  \
    \  return doReq(serverUrl + 'events', token, true, {start: parseTime(start), end:\
    \ parseTime(end),\n        eventType: eventType, killChainStage: killChainStage,\
    \ threatLevel: threatLevel, threatCategory: threatCategory, observationStage:\
    \ observationStage,\n        ip: ip, expandDetails: expandDetails, minLimit: minLimit,\
    \ maxLimit: maxLimit, reverseOrder: reverseOrder, nextPage: nextPage});\n};\n\n\
    var observationSearch = function(sensorId,start,end,type,killChainStage,threatLevel,threatCategory,hasKillChain,ip,expandDetails,minLimit,maxLimit,reverseOrder,nextPage,signatureId,token)\
    \ {\n    return doReq(serverUrl + 'observations', token, true, {sensorId: sensorId,\
    \ start: parseTime(start), end: parseTime(end), type: type, killChainStage: killChainStage,\n\
    \        threatLevel: threatLevel, threatCategory: threatCategory, hasKillChain:\
    \ hasKillChain, ip: ip, expandDetails: expandDetails, minLimit: minLimit, maxLimit:\
    \ maxLimit,\n        reverseOrder: reverseOrder, nextPage: nextPage, signatureId:\
    \ signatureId});\n};\n\nvar createIncidentFromEvent = function(event) {\n    var\
    \ keys = Object.keys(event);\n    var labels = [];\n    for (var i = 0; i<keys.length;\
    \ i++) {\n        val = event[keys[i]];\n        if (TIME_FIELDS.indexOf(keys[i])\
    \ > -1) {\n            val = convertTimestampToString(val);\n        }\n     \
    \   labels.push({'type': keys[i], 'value': String(val)});\n    }\n    return {\n\
    \        \"name\": event.message,\n        \"labels\": labels,\n        \"rawJSON\"\
    : JSON.stringify(event),\n        \"occurred\": convertTimestampToString(event.observedAt)\n\
    \    };\n};\n\nvar token = getToken();\nswitch (command) {\n    case 'test-module':\n\
    \        if (token && token.length > 0) {\n            return true;\n        }\n\
    \        return false;\n    case 'fetch-incidents':\n        var lastRun = getLastRun();\n\
    \        var now = (new Date()).getTime();\n        if (!lastRun || !lastRun.time)\
    \ {\n            // First time, retrieve events from the last 10 min\n       \
    \     lastRun = {time: now - 10 * 60 * 1000};\n        }\n        var data = eventsSearch(lastRun.time\
    \ , now , params.eventType, params.killChainStage, params.threatLevel,\n     \
    \       params.threatCategory, null, null, null, null, null, null, null, token);\n\
    \        try {\n            var res = JSON.parse(data).events;\n            res.reverse();\
    \  // events are fetched in descending order so reversing to process older first\n\
    \        } catch (ex) {\n            throw 'Error parsing event fetch - ' + data\
    \ + ' - ' + ex;\n        }\n        var incidents = [];\n        for (var i =\
    \ 0; i < res.length; i++) {\n            if (incidents.length >= Math.min(parseInt(params.maxFetch),\
    \ 50)) {\n                break;\n            }\n            var skip = true;\n\
    \            if (params.messageFilter && res[i].message) {\n                filters\
    \ = params.messageFilter.split(',');\n                for (var j = 0; j < filters.length;\
    \ j++) {\n                    if (filters[j] && filters[j].length > 0 && res[i].message.toLowerCase().indexOf(filters[j].toLowerCase())\
    \ > -1) {\n                        skip = false;\n                        break;\n\
    \                    }\n                }\n            } else {\n            \
    \    skip = false;\n            }\n            if(!skip) {\n                incidents.push(createIncidentFromEvent(res[i]));\n\
    \                lastRun.time = Math.max(lastRun.time, res[i].startedAt)+1;\n\
    \            }\n        }\n        setLastRun(lastRun);\n        return JSON.stringify(incidents);\n\
    \    case 'sensors':\n    case 'protectwise-show-sensors':\n        var url =\
    \ serverUrl + 'sensors';\n        if (args.sensorId && args.sensorId.length >\
    \ 0 ) {\n            url = url + '/' + args.sensorId;\n        }\n        var\
    \ headers = args.headers ? args.headers : DEFAULT_SENSOR_HEADERS;\n\n        var\
    \ res = doReq(url, token);\n        var items = [];\n\n        if (!Array.isArray(res))\
    \ {\n            res = [res];\n        }\n        items = filterClone(res, headers);\n\
    \n        return {\n            Type: entryTypes.note,\n            Contents:\
    \ res,\n            ContentsFormat: formats.json,\n            HumanReadable:\
    \ tableToMarkdown('Protectwise sensors', items, headers),\n            EntryContext:\
    \ {'Protectwise.Sensor(val.id == obj.id)': items}\n        };\n    case 'search':\n\
    \    case 'protectwise-search-events':\n        var res;\n        var raw = eventsSearch(args.start,\
    \ args.end, args.eventType, args.killChainStage, args.threatLevel,\n         \
    \   args.threatCategory, args.observationStage, args.ip, args.expandDetails, args.minLimit,\
    \ args.maxLimit, args.reverseOrder, args.nextPage, token);\n        try {\n  \
    \          res = JSON.parse(raw).events;\n        } catch (ex) {\n           \
    \ throw 'Error parsing event search - ' + raw + ' - ' + ex;\n        }\n     \
    \   var eventHeaders = args.headers ? args.headers : DEFAULT_EVENT_HEADERS;\n\
    \        var items = [];\n        if (!Array.isArray(res)) {\n            res\
    \ = [res];\n        }\n        items = filterClone(res, eventHeaders);\n     \
    \   items.forEach(function(item) {\n           TIME_FIELDS.forEach(function (timeKey)\
    \ {\n               if (item[timeKey]) {\n                   item[timeKey] = convertTimestampToString(item[timeKey]);\n\
    \               }\n           });\n        });\n\n        return {\n         \
    \   Type: entryTypes.note,\n            Contents: raw,\n            ContentsFormat:\
    \ formats.json,\n            HumanReadable: tableToMarkdown('Protectwise Event\
    \ Search', items, eventHeaders),\n            EntryContext: {'Protectwise.Event(val.id\
    \ == obj.id)': items}\n        };\n    case 'pw-event-get':\n    case 'protectwise-event-info':\n\
    \        var url = serverUrl + 'events/' + args.id;\n        var eventHeaders\
    \ = args.headers ? args.headers : DEFAULT_EVENT_HEADERS;\n        var res = doReq(url,\
    \ token);\n        var event = {};\n        eventHeaders.forEach(function( col\
    \ ) {\n           event[col] = res[col];\n        });\n\n        TIME_FIELDS.forEach(function\
    \ (timeKey) {\n           if (event[timeKey]) {\n               event[timeKey]\
    \ = convertTimestampToString(event[timeKey]);\n           }\n        });\n\n \
    \       var md = tableToMarkdown('Protectwise Event ' + res.id, [event], eventHeaders);\n\
    \n        if (res.netflows && res.netflows.length > 0) {\n            var nf =\
    \ filterClone(res.netflows, DEFAULT_NETFLOW_HEADERS);\n            for(var i =\
    \ 0; i < nf.length; i++) {\n                nf[i].srcIp = nf[i]['id.srcIp'];\n\
    \                nf[i].dstIp = nf[i]['id.dstIp'];\n                nf[i].srcPort\
    \  = nf[i]['id.srcPort'];\n                nf[i].dstPort = nf[i]['id.dstPort'];\n\
    \                nf[i].layer4Proto = nf[i]['id.layer4Proto'];\n              \
    \  }\n            event.Netflows = nf;\n            md += '\\n' + tableToMarkdown('Related\
    \ Netflows', nf, DEFAULT_NETFLOW_HEADERS);\n        }\n\n        if (res.observations\
    \ && res.observations.length > 0) {\n            var obs = filterClone(res.observations,\
    \ DEFAULT_OBSERVATION_HEADERS);\n            obs.forEach(function(item) {\n  \
    \              TIME_FIELDS.forEach(function (timeKey) {\n                   if\
    \ (item[timeKey]) {\n                       item[timeKey] = convertTimestampToString(item[timeKey]);\n\
    \                   }\n               });\n            });\n            event.Observations\
    \ = obs;\n            md += '\\n' + tableToMarkdown('Related Observations', obs,\
    \ DEFAULT_OBSERVATION_HEADERS);\n        }\n\n        return {\n            Type:\
    \ entryTypes.note,\n            Contents: res,\n            ContentsFormat: formats.json,\n\
    \            HumanReadable: md,\n            EntryContext: {'Protectwise.Event(val.id\
    \ == obj.id)': event}\n        };\n    case 'observation-search':\n    case 'protectwise-search-observations':\n\
    \        var res;\n        var raw = observationSearch(args.sensorId, args.start,\
    \ args.end, args.type, args.killChainStage, args.threatLevel,\n            args.threatCategory,\
    \ args.hasKillChain, args.ip, args.expandDetails, args.minLimit, args.maxLimit,\
    \ args.reverseOrder, args.nextPage, args.signatureId, token);\n        try {\n\
    \            res = JSON.parse(raw).observations;\n        } catch (ex) {\n   \
    \         throw 'Error parsing observation search - ' + raw + ' - ' + ex;\n  \
    \      }\n        var headers = args.headers ? args.headers : DEFAULT_OBSERVATION_HEADERS;\n\
    \        var items = [];\n        if (!Array.isArray(res)) {\n            res\
    \ = [res];\n        }\n        items = filterClone(res, headers);\n        items.forEach(function(item)\
    \ {\n            TIME_FIELDS.forEach(function (timeKey) {\n               if (item[timeKey])\
    \ {\n                   item[timeKey] = convertTimestampToString(item[timeKey]);\n\
    \               }\n           });\n        });\n\n        return {\n         \
    \   Type: entryTypes.note,\n            Contents: raw,\n            ContentsFormat:\
    \ formats.json,\n            HumanReadable: tableToMarkdown('Protectwise Observation\
    \ Search', items, headers),\n            EntryContext: {'Protectwise.Observation(val.id\
    \ == obj.id)': items}\n        };\n    case 'pw-observation-get':\n    case 'protectwise-observation-info':\n\
    \        var url = serverUrl + 'observations/' + args.id;\n        var headers\
    \ = args.headers ? args.headers : DEFAULT_OBSERVATION_HEADERS;\n        var res\
    \ = doReq(url, token, false, {'sensorId': args.sensorId});\n        var obj =\
    \ {};\n        headers.forEach(function( col ) {\n           obj[col] = res[col];\n\
    \        });\n        TIME_FIELDS.forEach(function (timeKey) {\n           if\
    \ (obj[timeKey]) {\n               obj[timeKey] = convertTimestampToString(obj[timeKey]);\n\
    \           }\n        });\n\n        var md = tableToMarkdown('Protectwise Observation\
    \ ' + res.id, [obj], headers);\n        return {\n            Type: entryTypes.note,\n\
    \            Contents: res,\n            ContentsFormat: formats.json,\n     \
    \       HumanReadable: md,\n            EntryContext: {'Protectwise.Observation(val.id\
    \ == obj.id)': obj}\n        };\n    case 'event-pcap-download':\n    case 'protectwise-event-pcap-download':\n\
    \        var filename = (args.filename && args.filename.length > 0) ? args.filename\
    \ : (args.eventId + '.pcap');\n\n        var url = serverUrl + 'pcaps/events/'\
    \ + args.eventId;\n        res = doReq(url, token, true, {filename: filename},\
    \ true);\n        return {Type: 3, FileID: res, File: filename, Contents: 'we\
    \ must have contents for an entry'};\n    case 'event-pcap-info':\n    case 'protectwise-event-pcap-info':\n\
    \        var url = serverUrl + 'pcaps/events/'+ args.eventId + '/info';\n    \
    \    var res = doReq(url, token);\n        var md = '### Protectwise PCAP for\
    \ Event ' + res.id + '\\n - Estimated size: ' + res.estimatedSize + ' bytes';\n\
    \        if (res.netflows && res.netflows.length > 0) {\n            var nf =\
    \ filterClone(res.netflows, DEFAULT_NETFLOW_HEADERS);\n                for(var\
    \ i = 0; i < nf.length; i++) {\n                    nf[i].srcIp = nf[i]['id.srcIp'];\n\
    \                    nf[i].dstIp = nf[i]['id.dstIp'];\n                    nf[i].srcPort\
    \  = nf[i]['id.srcPort'];\n                    nf[i].dstPort = nf[i]['id.dstPort'];\n\
    \                    nf[i].layer4Proto = nf[i]['id.layer4Proto'];\n          \
    \      }\n            event.Netflows = nf;\n            md += '\\n' + tableToMarkdown('Included\
    \ Netflows', res.netflows);\n        }\n\n        return {\n            Type:\
    \ entryTypes.note,\n            Contents: res,\n            ContentsFormat: formats.json,\n\
    \            HumanReadable: md,\n            EntryContext: {'Protectwise.Event(val.id\
    \ == obj.id)': {'id': res.id, 'PCAPSize': res.estimatedSize}}\n        };\n  \
    \  case 'observation-pcap-download':\n    case 'protectwise-observation-pcap-download':\n\
    \        var filename = (args.filename && args.filename.length > 0) ? args.filename\
    \ : ( args.sensorId+'-'+args.id + '.pcap');\n        var url = serverUrl + 'pcaps/observations/'\
    \ + args.sensorId + '/' + args.id;\n        res = doReq(url, token, true, {filename:\
    \ filename}, true);\n        return {Type: 3, FileID: res, File: filename, Contents:\
    \ 'we must have contents for an entry'};\n    case 'observation-pcap-info':\n\
    \    case 'protectwise-observation-pcap-info':\n        var url = serverUrl +\
    \ 'pcaps/observations/' + args.sensorId + '/' + args.id + '/info';\n        var\
    \ res = doReq(url, token);\n        var md = '### Protectwise PCAP for Observation\
    \ ' + res.id + '\\n - Estimated size: ' + res.estimatedSize + ' bytes';\n    \
    \    if (res.netflows && res.netflows.length > 0) {\n            var nf = filterClone(res.netflows,\
    \ DEFAULT_NETFLOW_HEADERS);\n                for(var i = 0; i < nf.length; i++)\
    \ {\n                    nf[i].srcIp = nf[i]['id.srcIp'];\n                  \
    \  nf[i].dstIp = nf[i]['id.dstIp'];\n                    nf[i].srcPort  = nf[i]['id.srcPort'];\n\
    \                    nf[i].dstPort = nf[i]['id.dstPort'];\n                  \
    \  nf[i].layer4Proto = nf[i]['id.layer4Proto'];\n                }\n         \
    \   event.Netflows = nf;\n            md += '\\n' + tableToMarkdown('Included\
    \ Netflows', res.netflows);\n        }\n\n        return {\n            Type:\
    \ entryTypes.note,\n            Contents: res,\n            ContentsFormat: formats.json,\n\
    \            HumanReadable: md,\n            EntryContext: {'Protectwise.Observation(val.id\
    \ == obj.id && val.sensorId == obj.sensorId)': {'id': args.id, 'sensorId': args.sensorId,\
    \ 'PCAPSize': res.estimatedSize}}\n        };\n    case 'get-token':\n       \
    \ return token;\n    default:\n        return 'The Protectwise integration has\
    \ no command \"' + command + '\"';\n}"
  type: javascript
tests:
- Protectwise-Test
toversion: 4.1.9
