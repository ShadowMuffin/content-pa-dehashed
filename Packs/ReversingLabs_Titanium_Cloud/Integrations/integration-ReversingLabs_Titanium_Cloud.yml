category: Data Enrichment & Threat Intelligence
commonfields:
  id: ReversingLabs Titanium Cloud
  version: -1
configuration:
- defaultvalue: https://ticloud-aws1-api.reversinglabs.com
  display: Base URL for malware presence
  name: base
  required: true
  type: 0
- defaultvalue: https://ticloud-cdn-api.reversinglabs.com
  display: Base URL for extended RL Data
  name: baserl
  required: false
  type: 0
- defaultvalue: ''
  display: Credentials
  name: credentials
  required: true
  type: 9
- defaultvalue: 'false'
  display: Return extended data if available
  name: extended
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: ReversingLabs Data provides malware status of the sample
display: ReversingLabs Titanium Cloud
image: data:image/png;base64,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
name: ReversingLabs Titanium Cloud
script:
  commands:
  - arguments:
    - default: true
      description: file hash
      name: file
      required: true
    - auto: PREDEFINED
      defaultValue: 'false'
      description: Return as much data as available. Overrides the default setting.
      name: extended
      predefined:
      - 'true'
      - 'false'
    description: Retrieve Malware Presence Status from ReversingLabs
    name: file
    outputs:
    - contextPath: File.MD5
      description: Bad hash found
    - contextPath: File.SHA1
      description: Bad hash SHA1
    - contextPath: File.SHA256
      description: Bad hash SHA256
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Detections
      description: For malicious files. Total detections.
    - contextPath: File.Malicious.TotalEngines
      description: For malicious files. Total engines
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
  runonce: false
  script: "import requests\nfrom requests.auth import HTTPBasicAuth\nimport re\nimport\
    \ os\n\nBASE_URL = demisto.params()['base']\nif BASE_URL[-1] == '/':\n    BASE_URL\
    \ = BASE_URL[0:-1]\nBASE_RL = demisto.params()['baserl']\nif BASE_RL[-1] == '/':\n\
    \    BASE_RL = BASE_RL[0:-1]\nAUTH = HTTPBasicAuth(demisto.params()['credentials']['identifier'],\
    \ demisto.params()['credentials']['password'])\nEXTENDED = demisto.params()['extended']\n\
    \n\nif not demisto.params()['proxy']:\n    del os.environ['HTTP_PROXY']\n    del\
    \ os.environ['HTTPS_PROXY']\n    del os.environ['http_proxy']\n    del os.environ['https_proxy']\n\
    \n\ndef return_error(data):\n    \"\"\"\n    Return error as result and exit -\
    \ filter 404 as non-errors\n    \"\"\"\n    if '404' in data:\n        demisto.results({\
    \ 'Type' : entryTypes['note'], 'ContentsFormat' : formats['text'], 'Contents'\
    \ : data})\n    else:\n        demisto.results({ 'Type' : entryTypes['error'],\
    \ 'ContentsFormat' : formats['text'], 'Contents' : data})\n    sys.exit(0)\n\n\
    \ndef validate_hash(hash_value):\n    \"\"\"\n    Validate that the given hash\
    \ is valid and return the type\n    \"\"\"\n    type_dict = {\n        32: {\n\
    \            'type':'md5',\n            'regex':r'([a-fA-F\\d]{32})'\n       \
    \ },\n        40: {\n            'type':'sha1',\n            'regex':r'([a-fA-F\\\
    d]{40})'\n        },\n        64: {\n            'type':'sha256',\n          \
    \  'regex':r'([a-fA-F\\d]{64})'\n        }\n    }\n    if len(hash_value) not\
    \ in type_dict.keys():\n        return_error('Provided hash length is not valid')\n\
    \    if not re.match(type_dict[len(hash_value)]['regex'], hash_value):\n     \
    \   return_error('Hash contains invalid characters')\n    return type_dict[len(hash_value)]['type']\n\
    \n\ndef validate_http(r):\n    \"\"\"\n    Make sure that the HTTP response is\
    \ valid and return relevant data if yes\n    \"\"\"\n    if r.status_code < 200\
    \ or r.status_code > 299:\n        return False, 'Bad HTTP response [{code}] -\
    \ {body}'.format(code=r.status_code, body=r.text)\n    try:\n        return True,\
    \ r.json()\n    except Exception as e:\n        return False, 'HTTP response is\
    \ not JSON [{error}] - {body}'.format(error=e, body=r.text)\n\n\ndef rldata(hash_type,\
    \ hash_value):\n    \"\"\"\n    Get the extended RL data\n    \"\"\"\n    endpoint\
    \ = '/api/databrowser/rldata/query/{hash_type}/{hash_value}?format=json'.format(hash_value=hash_value,\
    \ hash_type=hash_type)\n    ok, r = validate_http(requests.get(BASE_RL + endpoint,\
    \ auth=AUTH))\n    if not ok:\n        return ok, r\n\n    contents = demisto.get(r,\
    \ 'rl.sample')\n    if not contents:\n        return False, 'Unexpected JSON reply:\\\
    n' + str(r)\n\n    md5 = contents.get('md5')\n    sha1 = contents.get('sha1')\n\
    \    sha256 = contents.get('sha256')\n    sha512 = contents.get('sha512')\n  \
    \  ssdeep = contents.get('ssdeep')\n    size = contents.get('sample_size')\n \
    \   ec = {}\n    md = '## ReversingLabs extended data\\n'\n    if md5:\n     \
    \   ec['MD5'] = md5\n        md += 'MD5: **' + md5 + '**\\n'\n    if sha1:\n \
    \       ec['SHA1'] = sha1\n        md += 'SHA1: **' + sha1 + '**\\n'\n    if sha256:\n\
    \        ec['SHA256'] = sha256\n        md += 'SHA256: **' + sha256 + '**\\n'\n\
    \    if sha512:\n        ec['SHA512'] = sha512\n        md += 'SHA512: **' + sha512\
    \ + '**\\n'\n    if ssdeep:\n        ec['SSDeep'] = ssdeep\n        md += 'SSDEEP:\
    \ **' + ssdeep + '**\\n'\n    if size:\n        ec['Size'] = size\n        md\
    \ += 'Size: **' + str(size) + '**\\n'\n\n    scan_entries = demisto.get(contents,\
    \ 'xref.entries')\n    if len(scan_entries) > 0:\n        # Sort by latest date\n\
    \        scan_entries_sorted = sorted(scan_entries, key=lambda entry: entry['record_time'],\
    \ reverse=True)\n        scanners = scan_entries_sorted[0].get('scanners')\n \
    \       if scanners:\n            recent_detections = [item for item in scanners\
    \ if item['result']]\n            if recent_detections:\n                md +=\
    \ '***\\n'\n                md += '#### Recent Detections ({record_time}):\\n'.format(record_time=scan_entries_sorted[0].get('record_time'))\n\
    \                md += \"\\n\".join(['{} -- {}'.format(item['name'], item['result'])\
    \ for item in recent_detections])\n    return True, (md, ec, r)\n\n\ndef mwp(hash_type,\
    \ hash_value):\n    \"\"\"\n    Get the malware presence for the given hash\n\
    \    \"\"\"\n    endpoint = '/api/databrowser/malware_presence/query/{hash_type}/{hash_value}?extended=true&format=json'.format(hash_value=hash_value,\
    \ hash_type=hash_type)\n    ok, r = validate_http(requests.get(BASE_URL + endpoint,\
    \ auth=AUTH))\n    if not ok:\n        return ok, r\n\n    contents = demisto.get(r,\
    \ 'rl.malware_presence')\n    if not contents:\n        return False, 'Unexpected\
    \ JSON reply:\\n' + str(r)\n\n    md = '## ReversingLabs Malware Presence for\
    \ {hash_value}\\n'.format(hash_value=hash_value)\n    md += 'Malware status: **{mwp_status}**\\\
    n'.format(mwp_status=contents['status'])\n    md += 'First seen: **' + demisto.gets(contents,\
    \ 'first_seen') + '**\\n'\n    md += 'Last seen: **' + demisto.gets(contents,\
    \ 'last_seen') + '**\\n'\n    md += 'Positives / Total: **' + demisto.gets(contents,\
    \ 'scanner_match') + ' / ' + demisto.gets(contents, 'scanner_count') + '**\\n'\n\
    \    md += 'Trust factor: **' + demisto.gets(contents, 'trust_factor') + '**\\\
    n'\n    if contents['status'] == 'MALICIOUS':\n        md += 'Threat name: **'\
    \ + demisto.gets(contents, 'threat_name') + '**\\n'\n        md += 'Threat level:\
    \ **' + demisto.gets(contents, 'threat_level') + '**\\n'\n\n    score = {'UNKNOWN':0,\
    \ 'KNOWN': 1, 'SUSPICIOUS': 2, 'MALICIOUS': 3}[contents['status']]\n    prop =\
    \ contents['status'].title()\n    ec = {\n        outputPaths['file']: {\n   \
    \         hash_type.upper(): hash_value,\n            prop: {\n              \
    \  'Vendor': 'ReversingLabs',\n                'Detections': demisto.gets(contents,\
    \ 'scanner_match'),\n                'TotalEngines': demisto.gets(contents, 'scanner_count')\n\
    \            },\n            'properties_to_append': prop\n        },\n      \
    \  'DBotScore': [\n            {\n                'Indicator': hash_value,\n \
    \               'Type': 'hash',\n                'Vendor': 'ReversingLabs',\n\
    \                'Score': score\n            },\n            {\n             \
    \   'Indicator': hash_value,\n                'Type': 'file',\n              \
    \  'Vendor': 'ReversingLabs',\n                'Score': score\n            }\n\
    \n        ]\n    }\n    return True, (md, ec, r)\n\n\nif demisto.command() ==\
    \ 'test-module':\n    ok, r = validate_http(requests.get(BASE_URL + '/api/databrowser/malware_presence/query/md5/6a95d3d00267c9fd80bd42122738e726?extended=true&format=json',\
    \ auth=AUTH))\n    if ok:\n        demisto.results('ok')\n    else:\n        return_error(r)\n\
    elif demisto.command() == 'file':\n    hash_value = demisto.args()['file']\n \
    \   hash_type = validate_hash(hash_value)\n    ok, res = mwp(hash_type, hash_value)\n\
    \    if not ok:\n        return_error(res)\n    md, ec, r = res\n    if demisto.get(demisto.args(),\
    \ 'extended') != None:\n        EXTENDED = True if demisto.args()['extended'].lower()\
    \ == 'true' else False\n    if EXTENDED:\n        ok, extended_res = rldata(hash_type,\
    \ hash_value)\n        if ok:\n            md += '\\n' + extended_res[0]\n   \
    \         r['rl']['sample'] = extended_res[2]['rl']['sample']\n            # Add\
    \ all the relevant context data\n            score = ec['DBotScore'][0]['Score']\n\
    \            for k in extended_res[1]:\n                ec[outputPaths['file']][k]\
    \ = extended_res[1][k]\n                if k in ('MD5', 'SHA1', 'SHA256') and\
    \ k.lower() != hash_type:\n                    ec['DBotScore'].append({'Indicator':\
    \ extended_res[1][k], 'Type': 'hash', 'Vendor': 'ReversingLabs', 'Score': score})\n\
    \                    ec['DBotScore'].append({'Indicator': extended_res[1][k],\
    \ 'Type': 'file', 'Vendor': 'ReversingLabs', 'Score': score})\n\n\n    demisto.results({'Type':\
    \ entryTypes['note'], 'ContentsFormat': formats['json'], 'Contents': r, 'EntryContext':\
    \ ec, 'HumanReadable': md})\n"
  subtype: python2
  type: python
tests:
- ReversingLabsTCTest
toversion: 4.1.9
