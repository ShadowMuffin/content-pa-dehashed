category: Data Enrichment & Threat Intelligence
commonfields:
  id: PacketMail
  version: -1
configuration:
- defaultvalue: https://www.packetmail.net/iprep.php/
  display: URL
  name: url
  required: false
  type: 0
- defaultvalue: ''
  display: API Key
  name: apikey
  required: false
  type: 4
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: cleanmx_virus,et_c2
  display: CSV list of lists that should be considered malicious
  name: maliciousList
  required: false
  type: 0
description: Intel look up for IPS
display: PacketMail.net
hidden: false
image: data:image/png;base64,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
name: PacketMail
script:
  commands:
  - arguments:
    - description: The ip to check on
      name: ip
      required: true
    description: Get intel from PacketMail.net on IPs
    name: packetmail-ip
    outputs:
    - contextPath: IP.Address
      description: IP Address
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs, the vendor that made the decision
    - contextPath: IP.Malicious.Description
      description: For malicious IPs, the reason for the vendor to make the decision
  script: "var initialurl = params.url;\nvar malLists = params.maliciousList.split(',');\n\
    for (i = 0 ; i < malLists.length; i++) {\n    malLists[i] = malLists[i].trim();\n\
    }\n\nvar sendRequest = function(url, param) {\n\n    // handle '/' at the end\
    \ of the url\n    if (url[url.length - 1] === '/') {\n        url = url.substring(0,\
    \ url.length - 1);\n    }\n\n    var res = http(\n        url,\n        {\n  \
    \          Method: 'GET',\n            Headers: {\n                Accept: ['application/json']\n\
    \            }\n        },\n        params.insecure,\n        params.proxy\n \
    \   );\n\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw\
    \ 'Request Failed.\\nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res)\
    \ + '.';\n    }\n\n    try {\n      return JSON.parse(res.Body);\n    } catch\
    \ (err) {\n        throw 'Invalid response - expected JSON and got ' + res.Body;\n\
    \    }\n};\n\n// The command input arg holds the command sent from the user.\n\
    switch (command) {\n    // This is the call made when pressing the integration\
    \ test button.\n    case 'test-module':\n        res = sendRequest(initialurl\
    \ + '8.8.8.8' + '?apikey='+params.apikey);\n        if (res.query_result === 'Success')\
    \ {\n            return 'ok';\n        }\n        return res;\n    case 'packetmail-ip':\n\
    \        var res =  sendRequest(initialurl + args.ip + '?apikey='+params.apikey);\n\
    \        md = '';\n        maliciousLists = '';\n        var keys = Object.keys(res);\n\
    \        keys = keys.sort();\n        for (i = 0 ; i < keys.length; i++) {\n \
    \           if (md.length > 0) {\n                md += '\\n\\n';\n          \
    \  }\n            if (res[keys[i]] instanceof Object) {\n                if (malLists.indexOf(keys[i])\
    \ >= 0) {\n                    if (maliciousLists.length > 0) {\n            \
    \            maliciousLists += ',';\n                    }\n                 \
    \   maliciousLists += keys[i];\n                }\n                md += tableToMarkdown(keys[i],\
    \ res[keys[i]]);\n            }\n        }\n        ec = {};\n        if (maliciousLists.\
    \ length > 0) {\n            addMalicious(ec, outputPaths.ip,{\n             \
    \       Address: args.ip,\n                    Malicious: {Vendor: 'PacketMail',\
    \ Description: 'Found in malicious lists: ' + maliciousLists}});\n        }\n\
    \        return {Contents: res, HumanReadable: md, ContentsFormat: formats.json,\
    \ Type: entryTypes.note, EntryContext: ec};\n}\n\n"
  type: javascript
tests:
- no test
toversion: 4.1.9
