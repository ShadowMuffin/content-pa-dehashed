args:
- description: Comma-separated list of volatility commands/modules to run
  name: cmds
  required: true
- description: Path to memory dump file on the system being used
  name: memdump
  required: true
- description: System with Volatility installed to be used for the analysis
  name: system
  required: true
- description: Volatility profile to use
  name: profile
comment: Execute volatility with command and return tabular output. Incase where proper
  json output is not supported, scripts returns error. User should use raw command.
commonfields:
  id: VolRunCmds
  version: -1
dependson: {}
name: VolRunCmds
script: "var cmds = args.cmds.split(',');\nvar resultarr = [];\nfor (var i = 0; i\
  \ < cmds.length; i++) {\n    var cmdline = cmds[i];\n    if (args.profile) {\n \
  \       cmdline = cmdline + ' --profile=' + args.profile;\n    }\n    var out =\
  \ executeCommand('VolJson', {file:args.memdump, system: args.system, cmd:cmdline});\n\
  \    if (out) {\n        var mapper = function(columns) {\n            return function(val)\
  \ {\n                return val.reduce(function(prev, curr, i) {\n             \
  \       prev[columns[i]] = '' + curr;\n                    return prev;\n      \
  \          }, {});\n            };\n        };\n        for (var r = 0; r < out.length;\
  \ r++) {\n            if (out[r].Type !== entryTypes.error) {\n                var\
  \ jsonout = JSON.parse(out[r].Contents);\n                result = {};\n       \
  \         result.Contents = jsonout.rows.map(mapper(jsonout.columns));\n       \
  \         result.ContentsFormat = formats.table;\n                result.Type =\
  \ entryTypes.note;\n                resultarr.push(result);\n            }\n   \
  \         else\n            {\n                result = {};\n                var\
  \ errstring = out[r].Contents;\n                result.Contents = errstring.split('Stderr:')[1];\n\
  \                result.ContentsFormat = formats.text;\n                result.Type\
  \ = entryTypes.error;\n                resultarr.push(result);\n            }\n\
  \        }\n    }\n}\nreturn resultarr;"
scripttarget: 0
system: true
tags:
- memory
- forensics
- volatility
- server
timeout: 0s
toversion: 4.1.9
type: javascript
