category: Analytics & SIEM
commonfields:
  id: LogRhythm
  version: -1
configuration:
- defaultvalue: ''
  display: Hostname, IP address or Server URL
  name: Host
  required: true
  type: 0
- defaultvalue: ''
  display: Credentials
  name: Credentials
  required: true
  type: 9
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: Insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: useproxy
  required: false
  type: 8
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- defaultvalue: '2000'
  display: Default page size for alarm queries
  name: pageSize
  required: false
  type: 0
- defaultvalue: ''
  display: Timezone offset in minutes of the LogRhythm server machine
  name: timeZone
  required: false
  type: 0
- display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: 'false'
  display: Use Windows Authentication
  name: use_ntlm
  required: false
  type: 8
- defaultvalue: ''
  display: Domain of the Windows authentication server (used for Windows authentication)
  name: domain
  required: false
  type: 0
description: LogRhythm security intelligence
detaileddescription: SIEM, log management, network and endpoint monitoring and forensics,
  and security analytics.
display: LogRhythm
image: data:image/png;base64,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
name: LogRhythm
script:
  commands:
  - arguments:
    - default: true
      description: The unique ID of the alarm
      name: alarm-id
      required: true
    - description: The alarm comments
      name: comments
      required: true
    description: Update alarm with comments
    execution: true
    name: lr-add-alarm-comments
    outputs:
    - contextPath: LogRhythm.Alarm.Comment
      description: The alarm comment.
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
  - arguments:
    - default: true
      description: The unique ID of the alarm
      name: alarm-id
      required: true
    description: Retrieve a single alarm by the unique alarm identifier
    name: lr-get-alarm-by-id
    outputs:
    - contextPath: LogRhythm.Alarm.RBPMax
      description: Alarm maximum RBP(Risk Based Prioritization).
      type: number
    - contextPath: LogRhythm.Alarm.RuleName
      description: Alarm rule name.
      type: string
    - contextPath: LogRhythm.Alarm.EntityName
      description: entity name
      type: string
    - contextPath: LogRhythm.Alarm.Date
      description: Alarm date.
      type: date
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm status.
      type: string
    - contextPath: LogRhythm.Alarm.RBPAvg
      description: Alarm average RBP(Risk Based Prioritization).
      type: number
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
      type: number
  - arguments:
    - default: true
      description: The unique ID of the alarm
      name: alarm-id
      required: true
    - auto: PREDEFINED
      description: Include raw log
      name: include-raw-log
      predefined:
      - 'true'
      - 'false'
    description: Retrieve a list of events associated to this alarm
    name: lr-get-alarm-events-by-id
    outputs:
    - contextPath: LogRhythm.Alarm.Event.LogSourceName
      description: Event log source.
      type: string
    - contextPath: LogRhythm.Alarm.Event.Command
      description: Event command.
      type: string
    - contextPath: LogRhythm.Alarm.Event.Subject
      description: Event subject.
      type: string
    - contextPath: LogRhythm.Alarm.Event.Process
      description: Event process name.
      type: string
    - contextPath: LogRhythm.Alarm.Event.ClassificationName
      description: Event classification.
      type: string
    - contextPath: LogRhythm.Alarm.Event.ImpactedEntityName
      description: Event entity (Impacted).
      type: string
    - contextPath: LogRhythm.Alarm.Event.OriginEntityName
      description: Event entity (Origin).
      type: string
    - contextPath: LogRhythm.Alarm.Event.VendorMsgID
      description: Event vendor Message ID.
      type: string
    - contextPath: LogRhythm.Alarm.Event.NormalDate
      description: Event date.
      type: date
    - contextPath: LogRhythm.Alarm.Event.Session
      description: Event session.
    - contextPath: LogRhythm.Alarm.Event.ImpactedHostName
      description: Event hostname (Impacted).
      type: string
    - contextPath: LogRhythm.Alarm.Event.CommonEventName
      description: Event name.
      type: string
    - contextPath: LogRhythm.Alarm.Event.ImpactedZoneName
      description: Event zone (Impacted).
      type: string
    - contextPath: LogRhythm.Alarm.Event.OriginZoneName
      description: Event zone (Origin).
      type: string
    - contextPath: LogRhythm.Alarm.Event.Severity
      description: Event severity.
      type: string
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
      type: number
  - arguments:
    - default: true
      description: The unique ID of the alarm
      name: alarm-id
      required: true
    - auto: PREDEFINED
      description: Include notification history
      name: include-notifications
      predefined:
      - 'true'
      - 'false'
    - auto: PREDEFINED
      description: Include comments history
      name: include-comments
      predefined:
      - 'true'
      - 'false'
    description: Retrieve a list of alarm status and comment updates
    name: lr-get-alarm-history-by-id
    outputs:
    - contextPath: LogRhythm.Alarm.History.Comment
      description: Alarm history comment.
      type: string
    - contextPath: LogRhythm.Alarm.History.DateInserted
      description: Alarm history record date.
      type: date
    - contextPath: LogRhythm.Alarm.History.ID
      description: The unique id of the history record.
      type: number
    - contextPath: LogRhythm.Alarm.History.PersonID
      description: Alarm history person id
      type: number
    - contextPath: LogRhythm.Alarm.History.PersonName
      description: Alarm history person name
      type: string
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
      type: number
  - arguments:
    - default: true
      description: The unique ID of the alarm
      name: alarm-id
      required: true
    - auto: PREDEFINED
      description: The enumeration status of the alarm
      name: status
      predefined:
      - New
      - Opened
      - Working
      - Escalated
      - Closed
      - Closed_FalseAlarm
      - Closed_Resolved
      - Closed_Unresolved
      - Closed_Reported
      - Closed_Monitor
      required: true
    - description: The alarm comments
      name: comments
    description: Update alarm status
    name: lr-update-alarm-status
    outputs:
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm new status.
      type: string
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
      type: number
  - arguments:
    - description: 'Start date for the data query, for example: "2018-03-27". Only
        use this argument if the time_frame argument is "Custom".'
      name: start-date
    - description: 'End date for the data query. For example: end-date="2018-04-08"'
      name: end-date
    - auto: PREDEFINED
      description: Alarms for all users
      name: all-users
      predefined:
      - 'true'
      - 'false'
    - defaultValue: '1000'
      description: Number of alerts to retrieve. If empty, will be set to default
        of 1000.
      name: count
    - auto: PREDEFINED
      description: The enumeration status of the alarm
      name: status
      predefined:
      - New
      - Opened
      - Working
      - Escalated
      - Closed
      - Closed_FalseAlarm
      - Closed_Resolved
      - Closed_Unresolved
      - Closed_Reported
      - Closed_Monitor
      required: true
    - auto: PREDEFINED
      default: true
      defaultValue: Custom
      description: If time_frame is Custom, specify the start time for the time range.
      name: time_frame
      predefined:
      - LastHour
      - Today
      - Last2Days
      - LastWeek
      - LastMonth
      - Custom
    description: Retrieve alarms in the specified time period. Alerts can be filtered
      by the alarm status.
    name: lr-get-alarms
    outputs:
    - contextPath: LogRhythm.Alarm.RBPMax
      description: Alarm maximum RBP(Risk Based Prioritization).
      type: number
    - contextPath: LogRhythm.Alarm.RuleName
      description: Alarm rule name.
      type: string
    - contextPath: LogRhythm.Alarm.EntityName
      description: entity name.
      type: string
    - contextPath: LogRhythm.Alarm.Date
      description: Alarm date.
      type: date
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm status.
      type: string
    - contextPath: LogRhythm.Alarm.RBPAvg
      description: Alarm average RBP(Risk Based Prioritization).
      type: number
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
      type: number
  - arguments:
    - description: The entity ID.
      name: entity-id
      required: true
    description: Retrieves a list of hosts for a given entity, or an empty list if
      none is found.
    name: lr-get-hosts-by-entity-id
    outputs:
    - contextPath: LogRhythm.Host.DateUpdated
      description: The date when the host was last updated.
      type: date
    - contextPath: LogRhythm.Host.EntityID
      description: The entity ID.
      type: number
    - contextPath: LogRhythm.Host.HostID
      description: The unique ID of the host object.
      type: number
    - contextPath: LogRhythm.Host.HostName
      description: ' The name of the host.'
      type: string
    - contextPath: LogRhythm.Host.LongDescription
      description: ' The long description of the host.'
      type: string
    - contextPath: LogRhythm.Host.OSVersion
      description: ' The host OS version.'
      type: string
    - contextPath: LogRhythm.Host.RecordStatus
      description: The record status of the host.
      type: string
    - contextPath: LogRhythm.Host.RiskThreshold
      description: The record status of the host.
      type: string
    - contextPath: LogRhythm.Host.ShortDescription
      description: ' The short description of the host. '
      type: string
    - contextPath: LogRhythm.Host.ThreatThreshold
      description: The threat threshold of the host.
      type: string
    - contextPath: LogRhythm.Host.OSType
      description: The host OS type.
      type: string
  - arguments:
    - description: The entity ID.
      name: entity-id
      required: true
    - description: The LogRhythm hostname.
      name: host-name
      required: true
    - description: Short description for the host.
      name: short-description
    - description: Long description for the host.
      name: long-description
    - auto: PREDEFINED
      defaultValue: None
      description: The risk threshold.
      name: risk-threshold
      predefined:
      - None
      - LowLow
      - LowMedium
      - LowHigh
      - MediumLow
      - MediumMedium
      - MediumHigh
      - HighLow
      - HighMedium
      - HighHigh
    - auto: PREDEFINED
      defaultValue: Unknown
      description: The host OS type.
      name: os-type
      predefined:
      - Unknown
      - Other
      - WindowsNT4
      - Windows2000Professional
      - Windows2000Server
      - Windows2003Standard
      - Windows2003Enterprise
      - Windows95
      - WindowsXP
      - WindowsVista
      - Linux
      - Solaris
      - AIX
      - HPUX
      - Windows
    - defaultValue: None
      description: The version of the host OS.
      name: os-version
    - auto: PREDEFINED
      defaultValue: None
      description: The threat threshold.
      name: threat-threshold
      predefined:
      - None
      - LowLow
      - LowMedium
      - LowHigh
      - MediumLow
      - MediumMedium
      - MediumHigh
      - HighLow
      - HighMedium
      - HighHigh
    - description: Use an IP address to identify the host.
      name: ip-address
    - description: Use the DNS name to identify the host.
      name: dns-name
    - description: Use the Windows name to identify the host.
      name: windows-name
    description: Adds a new host to an entity.
    name: lr-add-host
    outputs:
    - contextPath: LogRhythm.Host.DateUpdated
      description: The date when the host was last updated.
      type: date
    - contextPath: LogRhythm.Host.EntityID
      description: The entity ID.
      type: number
    - contextPath: LogRhythm.Host.HostID
      description: The unique ID of the host object.
      type: number
    - contextPath: LogRhythm.Host.HostName
      description: The name of the host.
      type: string
    - contextPath: LogRhythm.Host.LongDescription
      description: The long description of the host.
      type: string
    - contextPath: LogRhythm.Host.OSVersion
      description: The host OS version.
      type: string
    - contextPath: LogRhythm.Host.RecordStatus
      description: The record status of the host.
      type: string
    - contextPath: LogRhythm.Host.RiskThreshold
      description: The record status of the host.
      type: string
    - contextPath: LogRhythm.Host.ShortDescription
      description: 'The short description of the host. '
      type: string
    - contextPath: LogRhythm.Host.ThreatThreshold
      description: The threat threshold of the host.
      type: string
    - contextPath: LogRhythm.Host.OSType
      description: The host OS type.
      type: string
  - arguments:
    - description: Filter log message by keywords.
      name: keyword
      required: true
    - description: 'Start date for the query, for example: "2018-03-27". Only use
        this argument if the time_frame argument is "Custom".'
      name: start-date
    - description: 'End date for the query, for example: end-date="2018-04-20". Only
        use this argument if the time_frame argument is "Custom".'
      name: end-date
    - auto: PREDEFINED
      defaultValue: Custom
      description: If time_frame is "Custom", specify the start time for the time
        range.
      name: time_frame
      predefined:
      - LastHour
      - Today
      - Last2Days
      - LastWeek
      - LastMonth
      - Custom
    description: Executes a query for logs that match query parameters.
    name: lr-execute-query
    outputs:
    - contextPath: LogRhythm.Log.ClassificationName
      description: 'The name of one of three major activity groups: "Operations",
        "Audit", or "Security", and a more specific sub-classification.'
      type: string
    - contextPath: LogRhythm.Log.CommonEventName
      description: A short, plain-language description of the log that determines
        its Classification.
      type: string
    - contextPath: LogRhythm.Log.Count
      description: The number of times the log entry occurred when aggregated with
        other identical log entries.
      type: number
    - contextPath: LogRhythm.Log.Direction
      description: Direction by name of activity between a log's Origin and Impacted
        Zones. Values can be "Internal", "External", "Outbound", "Local", or "Unknown".
      type: string
    - contextPath: LogRhythm.Log.EntityName
      description: The name of the entity.
      type: string
    - contextPath: LogRhythm.Log.ImpactedHostName
      description: The name of the host, such as a DNS name or NetBIOS name impacted
        by the log activity.
      type: string
    - contextPath: LogRhythm.Log.ImpactedZone
      description: The name of the Impacted Zone.
      type: string
    - contextPath: LogRhythm.Log.LogDate
      description: The creation date contained in the log. It can be in UTC or a user-selected
        time zone.
      type: date
    - contextPath: LogRhythm.Log.LogMessage
      description: The log message generated due to the activity detected by the source.
      type: string
    - contextPath: LogRhythm.Log.LogSourceHost
      description: The system or device where the log source originated.
      type: string
    - contextPath: LogRhythm.Log.LogSourceHostName
      description: The name of the log source host.
      type: string
    - contextPath: LogRhythm.Log.MPERuleName
      description: Message Processing Engine (MPE) Rule. It identifies and normalizes
        a log message and assigns it a Common Event.
      type: string
    - contextPath: LogRhythm.Log.MessageType
      description: 'The message type. Values can be: "Message", "Log", "Known Log",
        "Event", or "Alarm".'
      type: string
    - contextPath: LogRhythm.Log.OriginEntityName
      description: The resolved Entity of the origin host.
      type: string
    - contextPath: LogRhythm.Log.OriginHostName
      description: The name of the host, such as a DNS name or NetBIOS name that was
        the origin of the log activity.
      type: string
    - contextPath: LogRhythm.Log.OriginZone
      description: 'The enumeration value of the resolved Zone that was the origin
        of the activity. Values can be: "Internal", "External", or "DMZ".'
      type: string
    - contextPath: LogRhythm.Log.Session
      description: User, system, or application session.
      type: string
    - contextPath: LogRhythm.Log.Priority
      description: Calculated Risk Based Priority (RBP) of the log entry.
      type: number
    - contextPath: LogRhythm.Log.Severity
      description: Value indicating the severity of the log.
      type: string
    - contextPath: LogRhythm.Log.VendorMsgID
      description: Unique, vendor-assigned value that IDs the log message.
      type: number
    - contextPath: LogRhythm.Log.ImpactedName
      description: The name of the impacted device.
      type: string
    - contextPath: LogRhythm.Log.ObjectName
      description: 'The name for an Object. Note: Object will store the full path
        and name but ObjectName will only store the object name.'
      type: string
  isfetch: true
  runonce: false
  script: "// SOAP templates\nvar tmplAddAlarmComment = '<?xml version=\"1.0\" encoding=\"\
    UTF-8\"?>' +\n'<env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"\
    http://www.w3.org/2001/XMLSchema-instance\" xmlns:tns=\"http://www.logrhythm.com/webservices\"\
    \ xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ins0=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\"\
    >' +\n'  <env:Header>' +\n'    <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    >' +\n'      <wsse:UsernameToken xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"\
    \ wsu:Id=\"UsernameToken-1\">' +\n'        <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </env:Header>' +\n'  <env:Body>' +\n'    <tns:AddAlarmComments>' +\n'\
    \        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +\n'        <tns:comments>{{.Comments}}</tns:comments>'\
    \ +\n'    </tns:AddAlarmComments>' +\n'  </env:Body>' +\n'</env:Envelope>';\n\n\
    var tmplGetAlarmByID =\n'<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n'<SOAP-ENV:Envelope\
    \ xmlns:ns0=\"http://www.logrhythm.com/webservices\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    \ xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >' +\n' <SOAP-ENV:Header>' +\n'  <wsse:Security mustUnderstand=\"true\">' +\n\
    '   <wsse:UsernameToken>' +\n'    <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'    <wsse:Password>{{.Password}}</wsse:Password>' +\n'   </wsse:UsernameToken>'\
    \ +\n'  </wsse:Security>' +\n' </SOAP-ENV:Header>' +\n' <ns1:Body>' +\n\"  <ns0:GetAlarmByID\
    \ xmlns:ns1='http://www.logrhythm.com/webservices'>\" +\n'    <ns1:alarmID>{{.AlarmID}}</ns1:alarmID>'\
    \ +\n'  </ns0:GetAlarmByID>' +\n' </ns1:Body>' +\n'</SOAP-ENV:Envelope>';\n\n\
    var tmplGetAlarmEventsByID = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n\
    '<env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:tns=\"http://www.logrhythm.com/webservices\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:ins0=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\">' +\n\
    '  <env:Header>' +\n'    <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    >' +\n'      <wsse:UsernameToken xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"\
    \ wsu:Id=\"UsernameToken-1\">' +\n'       <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </env:Header>' +\n'  <env:Body>' +\n'    <tns:GetAlarmEventsByID>' +\n\
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +\n'        <tns:includeRawLog>{{.IncludeRawLog}}</tns:includeRawLog>'\
    \ +\n'    </tns:GetAlarmEventsByID>' +\n'  </env:Body>' +\n'</env:Envelope>';\n\
    \nvar tmplGetAlarmHistoryByID = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n\
    '<env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:tns=\"http://www.logrhythm.com/webservices\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:ins0=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\">' +\n\
    '  <env:Header>' +\n'    <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    >' +\n'      <wsse:UsernameToken xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"\
    \ wsu:Id=\"UsernameToken-1\">' +\n'        <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </env:Header>' +\n'  <env:Body>' +\n'    <tns:GetAlarmHistoryByID>' +\n\
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +\n'        <tns:includeNotifications>{{.IncludeNotifications}}</tns:includeNotifications>'\
    \ +\n'        <tns:includeComments>{{.IncludeComments}}</tns:includeComments>'\
    \ +\n'    </tns:GetAlarmHistoryByID>' +\n'  </env:Body>' +\n'</env:Envelope>';\n\
    \nvar tmplUpdateAlarmStatus = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n\
    '<env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:tns=\"http://www.logrhythm.com/webservices\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:ins0=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\">' +\n\
    '  <env:Header>' +\n'    <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    >' +\n'      <wsse:UsernameToken xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"\
    \ wsu:Id=\"UsernameToken-1\">' +\n'        <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </env:Header>' +\n'  <env:Body>' +\n'    <tns:UpdateAlarmStatus>' +\n\
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +\n'        <tns:status>{{.Status}}</tns:status>'\
    \ +\n'        {{.Comments}}' +\n'    </tns:UpdateAlarmStatus>' +\n'  </env:Body>'\
    \ +\n'</env:Envelope>';\n\nvar tmplGetFirstPageAlarmsByAlarmStatus =\n'<?xml version=\"\
    1.0\" encoding=\"UTF-8\"?>' +\n'<SOAP-ENV:Envelope xmlns:ns0=\"http://www.logrhythm.com/webservices\"\
    \ xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    \ xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >' +\n' <SOAP-ENV:Header>' +\n'  <wsse:Security mustUnderstand=\"true\">' +\n\
    '   <wsse:UsernameToken>' +\n'    <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'    <wsse:Password>{{.Password}}</wsse:Password>' +\n'   </wsse:UsernameToken>'\
    \ +\n'  </wsse:Security>' +\n' </SOAP-ENV:Header>' +\n' <ns1:Body>' +\n\"    <ns1:GetFirstPageAlarmsByAlarmStatus\
    \ xmlns:ns1='http://www.logrhythm.com/webservices'>\" +\n'      <ns1:startDate>{{.StartDate}}</ns1:startDate>'\
    \ +\n'      <ns1:endDate>{{.EndDate}}</ns1:endDate>' +\n'      <ns1:status>{{.Status}}</ns1:status>'\
    \ +\n'      <ns1:allUsers>{{.AllUsers}}</ns1:allUsers>' +\n'      <ns1:maximumResultsPerPage>{{.MaxResultsPerPage}}</ns1:maximumResultsPerPage>'\
    \ +\n'    </ns1:GetFirstPageAlarmsByAlarmStatus>' +\n' </ns1:Body>' +\n'</SOAP-ENV:Envelope>'\n\
    \nvar tmplGetNextPageAlarms = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n\
    '<env:Envelope xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:tns=\"http://www.logrhythm.com/webservices\" xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:ins0=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\">' +\n\
    '  <env:Header>' +\n'    <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    >' +\n'      <wsse:UsernameToken xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"\
    \ wsu:Id=\"UsernameToken-1\">' +\n'        <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </env:Header>' +\n'  <env:Body>' +\n'    <tns:GetNextPageAlarms>' +\n\
    '      <tns:nextPageID>{{.NextPageID}}</tns:nextPageID>' +\n'    </tns:GetNextPageAlarms>'\
    \ +\n'  </env:Body>' +\n'</env:Envelope>';\n\nvar tmplGetHostByEntity = '<?xml\
    \ version=\"1.0\" encoding=\"UTF-8\"?>' +\n'  <SOAP-ENV:Envelope xmlns:ns0=\"\
    http://www.logrhythm.com/webservices\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    \ xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >' +\n'  <SOAP-ENV:Header>' +\n'    <wsse:Security mustUnderstand=\"true\">' +\n\
    '      <wsse:UsernameToken>' +\n'        <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'        <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText\"\
    >{{.Password}}</wsse:Password>' +\n'      </wsse:UsernameToken>' +\n'    </wsse:Security>'\
    \ +\n'  </SOAP-ENV:Header>' +\n'  <ns1:Body>' +\n'    <ns0:GetHostsByEntity xmlns:ns1=\"\
    http://www.logrhythm.com/webservices\">' +\n'      <ns1:entityID>{{.EntityId}}</ns1:entityID>'\
    \ +\n'    </ns0:GetHostsByEntity>' +\n'  </ns1:Body>' +\n'</SOAP-ENV:Envelope>';\n\
    \nvar tmplAddHost1 = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n'<SOAP-ENV:Envelope\
    \ xmlns:ns0=\"http://www.logrhythm.com/webservices\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    \ xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >' +\n' <SOAP-ENV:Header>' +\n'  <wsse:Security mustUnderstand=\"true\">' +\n\
    '   <wsse:UsernameToken>' +\n'    <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'    <wsse:Password>{{.Password}}</wsse:Password>' +\n'   </wsse:UsernameToken>'\
    \ +\n'  </wsse:Security>' +\n' </SOAP-ENV:Header>' +\n' <ns1:Body>' +\n'  <ns0:AddHost\
    \ xmlns:ns1=\"http://www.logrhythm.com/webservices\">' +\n'    <ns0:hostToAdd>'\
    \ +\n'        <ns0:EntityID>{{.EntityId}}</ns0:EntityID>' +\n'        <ns0:HostName>{{.Hostname}}</ns0:HostName>'\
    \ +\n'        <ns0:Identifiers>';\n\n\nvar tmplAddHostIdentifier = '         \
    \  <ns0:HostIdentifierDataModel>' +\n'               <ns0:IdentifierType>{{.Type}}</ns0:IdentifierType>'\
    \ +\n'               <ns0:IdentifierValue>{{.Value}}</ns0:IdentifierValue>' +\n\
    '               <ns0:Add>true</ns0:Add>' +\n'           </ns0:HostIdentifierDataModel>'\n\
    \n\nvar tmplAddHost2 = '        </ns0:Identifiers>' +\n'        <ns0:ShortDescription>{{.ShortDesc}}</ns0:ShortDescription>'\
    \ +\n'        <ns0:LongDescription>{{.LongDesc}}</ns0:LongDescription>' +\n' \
    \       <ns0:DateUpdated>{{.DateUpdated}}</ns0:DateUpdated>' +\n'        <ns0:RiskThreshold>{{.RiskThreshold}}</ns0:RiskThreshold>'\
    \ +\n'        <ns0:OSType>{{.OsType}}</ns0:OSType>' +\n'        <ns0:OSVersion>{{.OsVersion}}</ns0:OSVersion>'\
    \ +\n'        <ns0:ThreatThreshold>{{.ThreatThreshold}}</ns0:ThreatThreshold>'\
    \ +\n'    </ns0:hostToAdd>' +\n'  </ns0:AddHost>' +\n' </ns1:Body>' +\n'</SOAP-ENV:Envelope>'\n\
    \nvar tmpExecuteQuery = ' <SOAP-ENV:Envelope xmlns:ns0=\"http://www.logrhythm.com/webservices\"\
    \ xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\
    \ xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \    >' +\n' <SOAP-ENV:Header>' +\n'        <wsse:Security mustUnderstand=\"true\"\
    >' +\n'            <wsse:UsernameToken>' +\n'                <wsse:Username>{{.Username}}</wsse:Username>'\
    \ +\n'                <wsse:Password>{{.Password}}</wsse:Password>' +\n'     \
    \       </wsse:UsernameToken>' +\n'        </wsse:Security>' +\n'    </SOAP-ENV:Header>'\
    \ +\n' <ns1:Body>' +\n'   <ExecuteQuery xmlns=\"http://www.logrhythm.com/webservices\"\
    >' +\n'     <Query xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\">' +\n\
    '       <includeRawLogs>false</includeRawLogs>' +\n'       <logSourceIDs xmlns:d5p1=\"\
    http://schemas.microsoft.com/2003/10/Serialization/Arrays\" i:nil=\"true\" />'\
    \ +\n'       <logSourceListIDs xmlns:d5p1=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\"\
    \ i:nil=\"true\" />' +\n'       <MaxItems>100</MaxItems>' +\n'       <PrimaryFilter>'\
    \ +\n'         <LogQueryFilterDataModel>' +\n'           <FilterType>NormalMsgDateRange</FilterType>'\
    \ +\n'           <FilterMode>FilterIn</FilterMode>' +\n'           <FilterOperator>And</FilterOperator>'\
    \ +\n'           <FilterValues i:type=\"LogQueryFilterValueDateRangeDataModel\"\
    >' +\n'             <ValueType>DateRange</ValueType>' +\n'             <Value>'\
    \ +\n'               <LogQueryDateRangeValue>' +\n'                 <StartRangeValue>{{.StartDate}}</StartRangeValue>'\
    \ +\n'                 <EndRangeValue>{{.EndDate}}</EndRangeValue>' +\n'     \
    \          </LogQueryDateRangeValue>' +\n'             </Value>' +\n'        \
    \   </FilterValues>' +\n'           <IncludeNullValues>false</IncludeNullValues>'\
    \ +\n'         </LogQueryFilterDataModel>' +\n'         <LogQueryFilterDataModel>'\
    \ +\n'           <FilterType>Message</FilterType>' +\n'           <FilterMode>FilterIn</FilterMode>'\
    \ +\n'           <FilterOperator>And</FilterOperator>' +\n'           <FilterValues\
    \ i:type=\"LogQueryFilterValueStringDataModel\">' +\n'             <ValueType>String</ValueType>'\
    \ +\n'             <Value xmlns:d8p1=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\"\
    >' +\n'               <d8p1:string>{{.Keyword}}</d8p1:string>' +\n'          \
    \   </Value>' +\n'           </FilterValues>' +\n'           <IncludeNullValues>false</IncludeNullValues>'\
    \ +\n'         </LogQueryFilterDataModel>' +\n'       </PrimaryFilter>' +\n' \
    \      <QueryEventManager>true</QueryEventManager>' +\n'       <QueryLogManagers>false</QueryLogManagers>'\
    \ +\n'       <CacheID i:nil=\"true\" />' +\n'       <PageNumber>0</PageNumber>'\
    \ +\n'       <TotalPages>0</TotalPages>' +\n'       <PageSize>100</PageSize>'\
    \ +\n'       <LogManagers xmlns:d5p1=\"http://schemas.microsoft.com/2003/10/Serialization/Arrays\"\
    >' +\n'         <d5p1:int>1</d5p1:int>' +\n'       </LogManagers>' +\n'      \
    \ <GetPagingStructure>false</GetPagingStructure>' +\n'     </Query>' +\n'   </ExecuteQuery>'\
    \ +\n' </ns1:Body>' +\n'</SOAP-ENV:Envelope>'\n\n// global variables and helper\
    \ functions\n\nvar soapActionURIGetNextPageAlarms               = 'http://www.logrhythm.com/webservices/AlarmService/GetNextPageAlarms';\n\
    var soapActionURIGetFirstPageAlarmsByAlarmStatus = 'http://www.logrhythm.com/webservices/AlarmService/GetFirstPageAlarmsByAlarmStatus';\n\
    var logRhythmAlarmAPI = params.use_ntlm ? 'AlarmServiceWindowsAuth.svc' : 'AlarmServiceBasicAuth.svc';\n\
    var logRhythmHostAPI = params.use_ntlm ? 'HostServiceWindowsAuth.svc' : 'HostServiceBasicAuth.svc';\n\
    var logRhythmQueryAPI = params.use_ntlm ? 'LogQueryServiceWindowsAuth.svc' : 'LogQueryServiceBasicAuth.svc';\n\
    var defaultAlarmsPageSize = 2000;\nvar defaultCount = 1000;\nvar alarmsFieldsToRemove\
    \ = [\"EntityID\",\"LastUpdatedID\",\"LastUpdatedName\",\"DateInserted\",\"DateUpdated\"\
    ,\"EventDateFirst\",\"EventDateLast\",\"EventCount\",\"RuleID\"];\nvar hostsFieldsToRemove\
    \ = [\"Key\",\"Identifiers\"];\n\nvar myTimezone = new Date().getTimezoneOffset();\n\
    var tz = params.timeZone ? parseInt(params.timeZone) : myTimezone;\n\nvar fixUrl\
    \ = function(base) {\n    res = base;\n    if (base && base[base.length - 1] !=\
    \ '/') {\n        res = res + '/';\n    }\n    return res + 'LogRhythm.API/Services/';\n\
    };\n\nvar getRequestUrl = function(api) {\n    var url;\n    // includes server\
    \ URL that starts with http or https\n    if (params.Host.startsWith('http'))\
    \ {\n        url = fixUrl(params.Host) + api;\n    }\n    else {\n        url\
    \ = 'https://' + fixUrl(params.Host) + api;\n    }\n    return url;\n};\n\n\n\
    var getRaw = function(url) {\n    username = params.Credentials.identifier.split('\\\
    \\')[1]\n    password = params.Credentials.password\n    domain = params.domain\n\
    \    if (params.use_ntlm) {\n        res = http(\n            url,\n         \
    \   {\n                AuthProtocol:['NTLM'],\n                Username: username,\n\
    \                Password: password,\n                Domain: domain,\n      \
    \          Method: 'GET'\n            },\n            params.Insecure,\n     \
    \       params.useproxy\n        );\n    } else {\n        res = http(\n     \
    \       url,\n            {\n                Method: 'GET',\n            },\n\
    \            params.Insecure,\n            params.useproxy\n        );\n    }\n\
    \    return res;\n};\n\nvar fixTemplate = function(template, data) {\n    var\
    \ keys = Object.keys(data);\n    for (var i = 0 ; i < keys.length; i++) {\n  \
    \      var key = keys[i];\n        template = template.replace('{{.'+key+'}}',data[key]);\n\
    \    }\n    return template;\n};\n\nvar sendRequest = function(envelope, soapAction,\
    \ apiUrl) {\n    username = params.Credentials.identifier.split('\\\\')[1]\n \
    \   password = params.Credentials.password\n    domain = params.domain\n    url\
    \ = getRequestUrl(apiUrl)\n    if (params.use_ntlm) {\n        res = http(\n \
    \           url,\n            {\n                Method: 'POST',\n           \
    \     AuthProtocol:['NTLM'],\n                Username: username,\n          \
    \      Password: password,\n                Domain: domain,\n                Body:\
    \ envelope,\n                Headers: {\n                    'Content-Type': ['text/xml'],\n\
    \                    Soapaction: [soapAction]\n                }\n           \
    \ },\n            params.Insecure,\n            params.useproxy\n        );\n\
    \    } else {\n        res = http(\n            url,\n            {\n        \
    \        Method: 'POST',\n                Body: envelope,\n                Headers:\
    \ {\n                    'Content-Type': ['text/xml; charset=utf-8'],\n      \
    \              Soapaction: [soapAction]\n                }\n            },\n \
    \           params.Insecure,\n            params.useproxy\n        );\n    }\n\
    \n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw 'Request\
    \ to LogRhythm ' + url + ' failed, request status code: ' + res.StatusCode + '\
    \ and Body: ' + res.Body + '.';\n    }\n    return res.Body;\n};\n\nvar parseResponse\
    \ = function(body) {\n    return JSON.parse(x2j(body));\n};\n\nvar doBatch = function(envelope,\
    \ action, count, pageSize) {\n    var alarmPath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.Alarms.AlarmSummaryDataModel';\n\
    \    var hasMorePath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.HasMoreResults';\n\
    \    var nextPagePath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.NextPageID';\n\
    \    var alarms = [];\n    var res = parseResponse(sendRequest(envelope, action,\
    \ logRhythmAlarmAPI));\n    while (true) {\n        var alarmObj = dq(res,alarmPath);\n\
    \        if (!alarmObj) {\n            break;\n        }\n        if (alarmObj.length)\
    \ {\n            alarms = alarms.concat(alarmObj);\n        } else {\n       \
    \     alarms.push(alarmObj);\n        }\n        var hasMore = dq(res,hasMorePath);\n\
    \        var nextPage  = dq(res,nextPagePath);\n        if (!hasMore || count\
    \ <= pageSize || count <= alarms.length || !nextPage) {\n            break;\n\
    \        }\n\n        var obj = {\n            Username: params.Credentials.identifier,\n\
    \            Password: params.Credentials.password,\n            NextPageID: nextPage\n\
    \        };\n        var nextEnvelope = fixTemplate(tmplGetNextPageAlarms, obj);\n\
    \        res = parseResponse(sendRequest(nextEnvelope, soapActionURIGetNextPageAlarms,\
    \ logRhythmAlarmAPI));\n        alarmPath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.Alarms.AlarmSummaryDataModel';\n\
    \        hasMorePath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.HasMoreResults';\n\
    \        nextPagePath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.NextPageID';\n\
    \    }\n\n    alarms.forEach(function(element) {\n        alarmsFieldsToRemove.forEach(function(field){\n\
    \            delete element[field];\n        });\n    });\n\n    return alarms.length\
    \ > count ? alarms.slice(0,count) : alarms;\n};\n\nfunction fixDictionaryKeys(dict){\n\
    \    //remove the word 'Alarm' from dictionary keys (e.g AlarmID to ID)\n    Object.keys(dict).forEach(function(key)\
    \ {\n        if(key.indexOf(\"Alarm\") !== -1){\n            var newkey = key.replace('Alarm',\
    \ '');\n            dict[newkey] = dict[key];\n            delete dict[key];\n\
    \        }\n    });\n}\n\nfunction getAlarmsData(allUsers, count, pageSize, startDate,\
    \ endDate, status, dataObj) {\n    dataObj.StartDate = startDate;\n    dataObj.EndDate\
    \ = endDate;\n    dataObj.Status = status;\n    dataObj.AllUsers = allUsers;\n\
    \    dataObj.MaxResultsPerPage = pageSize;\n    var envelope = fixTemplate(tmplGetFirstPageAlarmsByAlarmStatus,\
    \ dataObj);\n    return doBatch(envelope, soapActionURIGetFirstPageAlarmsByAlarmStatus,\
    \ count, pageSize);\n}\n\nvar prepareDetailsString = function(al) {\n    return\
    \ JSON.stringify(\n        {\n            AlarmRuleID: al.AlarmRuleID,\n     \
    \       AlarmStatus: al.AlarmStatus,\n            EntityID: al.EntityID,\n   \
    \         LastUpdatedID: al.LastUpdatedID,\n            EventCount: al.EventCount,\n\
    \            EventDateFirst: al.EventDateFirst,\n            EventDateLast: al.EventDateLast,\n\
    \            RBPAvg: al.RBPAvg,\n            RBPMax: al.RBPMax,\n            DateInserted:\
    \ al.DateInserted,\n            DateUpdated: al.DateUpdated,\n            AlarmRuleName:\
    \ al.AlarmRuleName,\n            EntityName: al.EntityName,\n            LastUpdatedName:\
    \ al.LastUpdatedName\n        }\n    );\n};\n\nvar getOccurredTime = function(al)\
    \ {\n    var occurred = new Date();\n    if (al.AlarmDate) {\n        var hour\
    \ = tz / 60;\n        var minute = tz % 60;\n        var tzPrefix = tz < 0 ? '-'\
    \ : '+';\n        var hourstr = hour +'';\n        if (hourstr.length < 2) {\n\
    \            hourstr = '0' + hourstr;\n        }\n        var minutestr = minute\
    \ +'';\n        if (minutestr.length < 2) {\n            minutestr = '0' + minutestr;\n\
    \        }\n        occurred = new Date(Date.parse(al.AlarmDate + tzPrefix + hourstr\
    \ + minutestr));\n    }\n    return occurred;\n};\n\nvar alarmsToIncident = function(alarmList,\
    \ lastRun) {\n    var incs = [];\n    var orgLastId = lastRun.lastId;\n    for\
    \ (var i = 0; i < alarmList.length; i++) {\n        logDebug(\"Got alarm from\
    \ LR\",JSON.stringify(alarmList[i]));\n        inc = {\n            name: 'LogRhythm\
    \ alarm ' + alarmList[i].AlarmID,\n            occurred: getOccurredTime(alarmList[i]),\n\
    \            created: new Date(),\n            details: prepareDetailsString(alarmList[i]),\n\
    \            rawJSON: JSON.stringify(alarmList[i])\n        };\n        // Check\
    \ that it is in the time range and in the id range\n        var alarmIdInt = parseInt(alarmList[i].AlarmID);\n\
    \        if (alarmIdInt && alarmIdInt <= orgLastId) {\n            continue;\n\
    \        }\n        if (alarmIdInt > lastRun.lastId) {\n            lastRun.lastId\
    \ = alarmIdInt;\n        }\n        if (inc.occurred.getTime() > lastRun.lastTime)\
    \ {\n            lastRun.lastTime = inc.occurred.getTime();\n        }\n     \
    \   incs.push(inc);\n    }\n    setLastRun(lastRun);\n    logDebug(\"LogRythm:\
    \ lastRun is\",JSON.stringify(lastRun));\n    logDebug(\"LogRythm: returning incs\"\
    ,JSON.stringify(incs));\n    return JSON.stringify(incs);\n};\n\nfunction getTimeFrame(timeFrame,\
    \ startArg, endArg){\n    var start = new Date();\n    var end = new Date();\n\
    \n    switch(timeFrame){\n    case 'Today':\n        start = new Date(end.getFullYear(),\
    \ end.getMonth(), end.getDate(), 0, 0, 0, 0);\n        break;\n    case 'LastHour':\n\
    \        start.setHours(new Date().getHours() - 1);\n        break;\n    case\
    \ 'Last2Days':\n        start.setDate(start.getDate()-2);\n        break;\n  \
    \  case 'LastWeek':\n        start.setDate(start.getDate()-7);\n        break;\n\
    \    case 'LastMonth':\n        start.setDate(start.getDate()-30);\n        break;\n\
    \    case 'Custom':\n        if(!startArg){\n            throw 'start-date argument\
    \ is missing';\n        }\n\n        if(!endArg){\n            throw 'end-date\
    \ argument is missing';\n        }\n\n        start = new Date(startArg);\n  \
    \      end = new Date(endArg);\n    }\n\n\n    return {\n        start: start.toISOString(),\n\
    \        end: end.toISOString()\n    };\n}\n\nvar getDateAsString = function(d)\
    \ {\n    return d.toISOString();\n}\n\nfunction processAlarmEventsMd(mdRaw){\n\
    \    // flattening the AlarmEvents structure\n    var processedMd = {};\n    mdRaw\
    \ = mdRaw['LogDataModel'];\n    Object.keys(mdRaw).forEach(function(key) {\n \
    \       if (mdRaw[key] === undefined || mdRaw[key] === \"\" || mdRaw[key] ===\
    \ \"NaN\") {\n            return;\n        }\n        else if (typeof (mdRaw[key])\
    \ === 'object'){\n            var inputString = \"\";\n            Object.keys(mdRaw[key]).forEach(function(innerKey)\
    \ {\n                inputString += innerKey + \":\" + mdRaw[key][innerKey] +\
    \ \"\\n\";\n            });\n            processedMd[key] = inputString;\n   \
    \     } else {\n            processedMd[key] = mdRaw[key];\n        }\n    });\n\
    \    return processedMd;\n}\n\n// commands functions\n\nfunction addAlarmComments(args){\n\
    \    // corresponds to lr-add-alarm-comments command. Adds a comment to an alarm\n\
    \n    var dataObj = {\n        Username: params.Credentials.identifier,\n    \
    \    Password: params.Credentials.password,\n        AlarmID: args['alarm-id'],\n\
    \        Comments: args['comments']\n    };\n\n\n    var soapActionURIAddAlarmComments\
    \ = 'http://www.logrhythm.com/webservices/AlarmService/AddAlarmComments';\n  \
    \  var envelope = fixTemplate(tmplAddAlarmComment, dataObj);\n    var jsResponse\
    \ = parseResponse(sendRequest(envelope, soapActionURIAddAlarmComments, logRhythmAlarmAPI));\n\
    \    var mdRaw = dq(jsResponse, 'Envelope.Body.AddAlarmCommentsResponse.AddAlarmCommentsResult');\n\
    \n    fixDictionaryKeys(mdRaw);\n\n\n    var md = 'LogRhythm added alarm comment\
    \ ' + args['comments'] + ' for ID: ' + args['alarm-id'];\n\n\n    var ec= {};\n\
    \    ec[\"LogRhythm.Alarm(val.ID && val.ID == \" + args['alarm-id'] + \")\"] =\
    \ {'ID' : args['alarm-id']};\n    ec[\"LogRhythm.Alarm(val.ID && val.ID == \"\
    \ + args['alarm-id'] + \").Comment\"] = [args['comments']];\n\n    return {\n\
    \        Type: entryTypes.note,\n        Contents: jsResponse,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext: ec\n    };\n\
    }\n\nfunction getAlarmById(args){\n    // corresponds to lr-get-alarm-by-id command.\
    \ Get the data by a specific alarm id\n\n    var dataObj = {\n        Username:\
    \ params.Credentials.identifier,\n        Password: params.Credentials.password,\n\
    \        AlarmID: args['alarm-id']\n    };\n\n    var soapActionURIGetAlarmByID\
    \ = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmByID';\n    var\
    \ envelope = fixTemplate(tmplGetAlarmByID, dataObj);\n    var jsResponse =  parseResponse(sendRequest(envelope,\
    \ soapActionURIGetAlarmByID, logRhythmAlarmAPI));\n    var mdRaw = dq(jsResponse,\
    \ 'Envelope.Body.GetAlarmByIDResponse.GetAlarmByIDResult');\n    if (mdRaw['-i'])\
    \ {\n        delete mdRaw['-i'];\n    }\n\n    fixDictionaryKeys(mdRaw);\n\n \
    \   alarmsFieldsToRemove.forEach(function(field){\n        delete mdRaw[field];\n\
    \    });\n\n    var md = tableToMarkdown('LogRhythm alarm for ID: ' + args['alarm-id'],\
    \  mdRaw);\n\n    var ec = {};\n    ec[\"LogRhythm.Alarm(val.ID && val.ID == \"\
    \ + mdRaw['ID'] + \")\"] = mdRaw;\n\n\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: jsResponse,\n        ContentsFormat: formats.json,\n      \
    \  HumanReadable: md,\n        EntryContext: ec\n    };\n}\n\nfunction getAlarmEventsById(args){\n\
    \    // corresponds to lr-get-alarm-events-by-id command. Get the alarm's events\
    \ by a specific alarm id\n\n\n    var fieldsToRemove = [\"Bytes\",\"ClassificationID\"\
    ,\"ClassificationTypeName\",\"CommonEventID\",\"DirectionName\",\"EntityID\",\"\
    ImpactedZone\",\n    \"ImpactedEntityID\",\"ImpactedHostID\",\"ImpactedLocation\"\
    ,\"ImpactedLocationID\",\"ImpactedNATPort\",\"ImpactedNetwork\",\"ImpactedNetworkID\"\
    ,\n    \"ImpactedPort\",\"LogDate\",\"LogSourceHost\",\"LogSourceHostID\",\"LogSourceID\"\
    ,\"LogSourceType\",\"LogSourceTypeName\",\"Login\",\"MPERuleID\",\n    \"MPERuleName\"\
    ,\"MessageID\",\"NormalDateMax\",\"OriginEntityID\",\"OriginHostID\",\"OriginLocation\"\
    ,\"OriginLocationID\",\"LogSourceHostName\",\n    \"OriginNATPort\",\"OriginName\"\
    ,\"OriginNetwork\",\"OriginNetworkID\",\"OriginPort\",\"Priority\",\"ProcessID\"\
    ,\"ProtocolID\",\"Direction\",\n    \"SequenceNumber\",\"ServiceID\",\"ServiceName\"\
    ,\"Count\",\"DateInserted\",\"OriginZone\",\"MessageType\",\"EntityName\",\"ImpactedHostID\"\
    ];\n\n    var dataObj = {\n        Username: params.Credentials.identifier,\n\
    \        Password: params.Credentials.password,\n        AlarmID: args['alarm-id'],\n\
    \        IncludeRawLog: args['include-raw-log'] === 'true'\n    };\n\n    var\
    \ soapActionURIGetAlarmsEventsByID = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmEventsByID';\n\
    \    var envelope = fixTemplate(tmplGetAlarmEventsByID, dataObj);\n    var jsResponse\
    \ = parseResponse(sendRequest(envelope, soapActionURIGetAlarmsEventsByID, logRhythmAlarmAPI));\n\
    \    var mdRaw = dq(jsResponse, 'Envelope.Body.GetAlarmEventsByIDResponse.GetAlarmEventsByIDResult.Events')\n\
    \    if (mdRaw['-i']) {\n        delete mdRaw['-i'];\n    }\n\n    if(!mdRaw['LogDataModel']){\n\
    \        return {\n            Type: entryTypes.note,\n            Contents: \"\
    No events found for this alarm\",\n            ContentsFormat: formats.text\n\
    \        };\n    }\n\n    var processedMd = processAlarmEventsMd(mdRaw);\n\n\n\
    \    fieldsToRemove.forEach(function(field){\n        delete processedMd[field];\n\
    \    });\n\n\n    var md = tableToMarkdown('LogRhythm alarm events for ID: ' +\
    \ args['alarm-id'],  processedMd);\n\n\n    var historyRow = {};\n    historyRow['ID']\
    \ = args['alarm-id'];\n    historyRow['Event'] = processedMd;\n\n    var ec =\
    \ {};\n    ec['LogRhythm.Alarm(val.ID && val.ID == ' + args['alarm-id'] + ')']\
    \ = historyRow;\n\n\n    return {\n        Type: entryTypes.note,\n        Contents:\
    \ jsResponse,\n        ContentsFormat: formats.json,\n        HumanReadable: md,\n\
    \        EntryContext: ec\n    };\n}\n\nfunction getAlarmHistoryById(args){\n\
    \    // corresponds to lr-get-alarm-history-by-id command. Get the alarm's history\
    \ by a specific alarm id\n\n    var dataObj = {\n        Username: params.Credentials.identifier,\n\
    \        Password: params.Credentials.password,\n        AlarmID: args['alarm-id'],\n\
    \        IncludeComments: args['include-comments'] === 'true',\n        IncludeNotifications:\
    \ args['include-notifications'] === 'true'\n    };\n\n    //Verify that at least\
    \ one of the 2 are marked as true, else throw an error\n    if (!dataObj.IncludeNotifications\
    \ && !dataObj.IncludeComments) {\n        throw 'At least one of \"include-comments\"\
    , \"include-notifications\" should be true';\n    }\n\n    var soapActionURIGetAlarmsHistoryByID\
    \ = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmHistoryByID';\n\
    \    var envelope = fixTemplate(tmplGetAlarmHistoryByID, dataObj);\n    var jsResponse\
    \ =  parseResponse(sendRequest(envelope, soapActionURIGetAlarmsHistoryByID, logRhythmAlarmAPI));\n\
    \    var md = \"\", mdRaw;\n    if (dataObj.IncludeNotifications) {\n        mdRaw\
    \ = dq(jsResponse, 'Envelope.Body.GetAlarmHistoryByIDResponse.GetAlarmHistoryByIDResult.Notifications.AlarmNotificationDataModel')\n\
    \        md = tableToMarkdown('LogRhythm alarm notifications history for ID: '\
    \ + args['alarm-id'],  mdRaw);\n    }\n    if (dataObj.IncludeComments) {\n  \
    \      if (md.length > 0) {\n            md += '\\n\\n';\n        }\n        mdRaw\
    \ = dq(jsResponse, 'Envelope.Body.GetAlarmHistoryByIDResponse.GetAlarmHistoryByIDResult.Comments.AlarmCommentDataModel')\n\
    \        md += tableToMarkdown('LogRhythm alarm comments history for ID: ' + args['alarm-id'],\
    \  mdRaw);\n    }\n\n    var historyRow = {};\n    historyRow['ID'] = args['alarm-id'];\n\
    \    historyRow['History'] = mdRaw;\n\n    var ec = {};\n    ec['LogRhythm.Alarm(val.ID\
    \ && val.ID == ' + args['alarm-id'] + ')'] = historyRow;\n\n    return {\n   \
    \     Type: entryTypes.note,\n        Contents: jsResponse,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext: ec\n    };\n\
    }\n\nfunction updateAlarmStatus(args){\n    // corresponds to lr-update-alarm-status\
    \ command. Updates an alarm's current status\n\n    var dataObj = {\n        Username:\
    \ params.Credentials.identifier,\n        Password: params.Credentials.password,\n\
    \        AlarmID: args['alarm-id'],\n        Status: args['status'],\n       \
    \ Comments: (args.comments ? ('<tns:comments>' + args.comments + '</tns:comments>')\
    \ : '')\n    };\n\n    var soapActionURIUpdateAlarmStatus = 'http://www.logrhythm.com/webservices/AlarmService/UpdateAlarmStatus';\n\
    \    var envelope = fixTemplate(tmplUpdateAlarmStatus, dataObj);\n    var jsResponse\
    \ = parseResponse(sendRequest(envelope, soapActionURIUpdateAlarmStatus, logRhythmAlarmAPI));\n\
    \    var mdRaw = dq(jsResponse, 'Envelope.Body.UpdateAlarmStatusResponse.UpdateAlarmStatusResult')\n\
    \n    fixDictionaryKeys(mdRaw);\n\n    var md = 'LogRhythm alarm status updated\
    \ for alarm: *' + args['alarm-id']+'* status: *' + args.status +'*';\n\n    var\
    \ status = {\n        'Status' : args['status'],\n        'ID' : args['alarm-id']\n\
    \    };\n\n    var ec= {};\n    ec[\"LogRhythm.Alarm(val.ID && val.ID == \" +\
    \ args['alarm-id'] + \")\"] = status;\n\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: jsResponse,\n        ContentsFormat: formats.json,\n      \
    \  HumanReadable: md,\n        EntryContext : ec\n    };\n}\n\nfunction getAlarms(dataArgs){\n\
    \    /* corresponds to lr-get-alarms command. Retrieves data about alarms in a\
    \ particular time range.\n       time format follows iso 8601, for example: startDate=\"\
    2017-03-27\" */\n\n    var dataObj = {\n        Username: params.Credentials.identifier,\n\
    \        Password: params.Credentials.password,\n    };\n\n    var allUsers =\
    \ dataArgs['all-users'] === 'true';\n    var count = dataArgs.count ? parseInt(dataArgs.count)\
    \ : defaultCount;\n    count = count || defaultCount;\n\n    var pageSize = params.pageSize\
    \ ? parseInt(params.pageSize) : defaultAlarmsPageSize;\n    pageSize = pageSize\
    \ || defaultAlarmsPageSize;\n    if (count < pageSize) {\n        pageSize = count;\n\
    \    }\n\n    var timeFrame = getTimeFrame(dataArgs['time_frame'], dataArgs['start-date'],\
    \ dataArgs['end-date']);\n    var alarms = getAlarmsData(allUsers, count, pageSize,\
    \ timeFrame.start, timeFrame.end, dataArgs.status, dataObj);\n\n    var ec = {};\n\
    \n    alarms.forEach(function(alarm) {\n        fixDictionaryKeys(alarm);\n  \
    \      ec['LogRhythm.Alarm(val.ID && val.ID == ' + alarm['ID'] + ')'] = alarm;\n\
    \    });\n\n    if (alarms.length) {\n        var md = tableToMarkdown('',  alarms);\n\
    \        return {\n            Type: entryTypes.note,\n            Contents: alarms,\n\
    \            ContentsFormat: formats.json,\n            HumanReadable: md,\n \
    \           EntryContext: ec\n        };\n    } else {\n        return {\n   \
    \         Type: entryTypes.note,\n            Contents: \"No results\",\n    \
    \        ContentsFormat: formats.text\n        };\n    }\n}\n\nfunction getHostsByEntityId(dataArgs){\n\
    \    var dataObj = {\n        Username: params.Credentials.identifier,\n     \
    \   Password: params.Credentials.password,\n        EntityId: dataArgs['entity-id']\n\
    \    };\n\n    var soapActionURIUgethostbyentity = 'http://www.logrhythm.com/webservices/HostService/GetHostsByEntity';\n\
    \    var envelope = fixTemplate(tmplGetHostByEntity, dataObj);\n    var jsResponse\
    \ = parseResponse(sendRequest(envelope, soapActionURIUgethostbyentity, logRhythmHostAPI));\n\
    \n    var mdRaw = dq(jsResponse, 'Envelope.Body.GetHostsByEntityResponse.GetHostsByEntityResult.HostDataModel')\n\
    \n    if (mdRaw['-i']) {\n        delete mdRaw['-i'];\n    }\n\n    fixDictionaryKeys(mdRaw);\n\
    \n    mdRaw.forEach(function(row){\n        hostsFieldsToRemove.forEach(function(field){\n\
    \            delete row[field];\n        });\n    });\n\n    var md = tableToMarkdown('LogRhythm\
    \ hosts for entity ID: ' + args['entity-id'],  mdRaw);\n\n    var ec = {};\n \
    \   ec[\"LogRhythm.Host(val.ID && val.ID == \" + mdRaw['ID'] + \")\"] = mdRaw;\n\
    \n    return {\n        Type: entryTypes.note,\n        Contents: jsResponse,\n\
    \        ContentsFormat: formats.json,\n        HumanReadable: md,\n        EntryContext:\
    \ ec\n    };\n\n}\n\nfunction addHost(dataArgs){\n    var dataObj = {\n      \
    \  Username: params.Credentials.identifier,\n        Password: params.Credentials.password,\n\
    \        Hostname: dataArgs['host-name'],\n        EntityId: dataArgs['entity-id'],\n\
    \        ShortDesc: dataArgs['short-description'],\n        LongDesc: dataArgs['long-description'],\n\
    \        DateUpdated: new Date().toISOString(),\n        RiskThreshold: dataArgs['risk-threshold'],\n\
    \        OsType: dataArgs['os-type'],\n        OsVersion: dataArgs['os-version'],\n\
    \        ThreatThreshold: dataArgs['threat-threshold']\n    };\n\n    var soapActionURIUaddHost\
    \ = 'http://www.logrhythm.com/webservices/HostService/AddHost';\n\n    var envelope\
    \ = fixTemplate(tmplAddHost1, dataObj);\n\n    if(dataArgs['ip-address']){\n \
    \       envelope += fixTemplate(tmplAddHostIdentifier, {Type: 'IPAddress', Value:\
    \ dataArgs['ip-address']});\n    }\n    if(dataArgs['dns-name']){\n        envelope\
    \ += fixTemplate(tmplAddHostIdentifier, {Type: 'DNSName', Value: dataArgs['dns-name']});\n\
    \    }\n    if(dataArgs['windows-name']){\n        envelope += fixTemplate(tmplAddHostIdentifier,\
    \ {Type: 'WindowsName', Value: dataArgs['windows-name']});\n    }\n\n    envelope\
    \ += fixTemplate(tmplAddHost2, dataObj);\n\n    var jsResponse = parseResponse(sendRequest(envelope,\
    \ soapActionURIUaddHost, logRhythmHostAPI));\n\n    var mdRaw = dq(jsResponse,\
    \ 'Envelope.Body.AddHostResponse.AddHostResult')\n\n    if (mdRaw['Succeeded']\
    \ == 'true'){\n        var host = {};\n        host[\"ShortDescription\"] = dataObj['ShortDesc'];\n\
    \        host[\"LongDescription\"] = dataObj['LongDesc'];\n        host[\"HostID\"\
    ] = mdRaw['DataID'];\n        host[\"RecordStatus\"] = 'NewRecord';\n        host[\"\
    DateUpdated\"] = dataObj['DateUpdated'];\n        host[\"ThreatThreshold\"] =\
    \ dataObj['ThreatThreshold'];\n        host[\"HostName\"] = dataObj['Hostname'];\n\
    \        host[\"OSVersion\"] = dataObj['OsVersion'];\n        host[\"RiskThreshold\"\
    ] = dataObj['RiskThreshold'];\n        host[\"EntityID\"] = dataObj['EntityId'];\n\
    \        host[\"OSType\"] = dataObj['OsType'];\n\n        var ec = {};\n     \
    \   ec[\"LogRhythm.Host\"] = host;\n\n        return {\n            Type: entryTypes.note,\n\
    \            Contents: jsResponse,\n            ContentsFormat: formats.json,\n\
    \            HumanReadable: 'Host ' + dataArgs['host-name'] + ' added succesfuly',\n\
    \            EntryContext: ec\n        };\n\n    }\n    else{\n        throw mdRaw['Errors']['ErrorInfo']['ErrorMessage'];\n\
    \    }\n}\n\nfunction executeQuery(dataArgs){\n\n    var queryFieldsToRemove =\
    \ [\"Amount\",\"Bytes\",\"BytesIn\",\"BytesOut\",\"ClassificationID\",\"ClassificationTypeName\"\
    ,\"CommonEventID\",\"DirectionName\",\"Domain\",\"Duration\",\"EntityID\",\n \
    \  \"ImpactedEntityName\",\"ImpactedHostID\",\"ImpactedIP\",\"ImpactedInterface\"\
    ,\"ImpactedLocation\",\"ImpactedLocationID\",\"ImpactedMAC\",\"ImpactedNATIP\"\
    ,\"ImpactedNATPort\",\"ImpactedEntityID\",\n   \"ImpactedNetwork\",\"ImpactedNetworkID\"\
    ,\"ImpactedPort\",\"ImpactedZoneName\",\"ItemsPacketsIn\",\"ItemsPacketsOut\"\
    ,\"LogSourceHostID\",\"LogSourceID\",\"LogSourceType\",\"MPERuleID\",\n   \"MessageID\"\
    ,\"OriginEntityID\",\"OriginHostID\",\"OriginIP\",\"OriginInterface\",\"OriginLocation\"\
    ,\"OriginLocationID\",\"OriginLogin\",\"OriginMAC\",\"OriginNATIP\",\"OriginNATPort\"\
    ,\n   \"OriginNetwork\",\"OriginNetworkID\",\"OriginPort\",\"OriginZoneName\"\
    ,\"Process\",\"ProcessID\",\"ProtocolID\",\"ProtocolName\",\"Quantity\",\"Rate\"\
    ,\"Recipient\",\"Sender\",\"SequenceNumber\",\n   \"ServiceID\",\"ServiceName\"\
    ,\"Size\",\"URL\",\"Version\",\"Account\",\"Command\",\"Group\",\"DateInserted\"\
    ,\"Login\",\"NormalDate\",\"NormalDateMax\",\"Object\",\"OriginName\",\"Subject\"\
    ];\n\n    var timeFrame = getTimeFrame(dataArgs['time_frame'], dataArgs['start-date'],\
    \ dataArgs['end-date']);\n    var dataObj = {\n        Username: params.Credentials.identifier,\n\
    \        Password: params.Credentials.password,\n        Keyword: dataArgs['keyword'],\n\
    \        StartDate: timeFrame.start,\n        EndDate: timeFrame.end\n    };\n\
    \n    var soapActionURIUexecuteQuery = 'http://www.logrhythm.com/webservices/LogQueryService/ExecuteQuery';\n\
    \    var envelope = fixTemplate(tmpExecuteQuery, dataObj);\n\n    var jsResponse\
    \ = parseResponse(sendRequest(envelope, soapActionURIUexecuteQuery, logRhythmQueryAPI));\n\
    \    var mdRaw = dq(jsResponse, 'Envelope.Body.ExecuteQueryResponse.ExecuteQueryResult.LogDataModel');\n\
    \n    if(mdRaw === undefined || mdRaw === null){\n         return {\n        \
    \        Type: entryTypes.note,\n                Contents: \"No results\",\n \
    \               ContentsFormat: formats.text\n            };\n    }\n\n    if(Array.isArray(mdRaw)){\n\
    \        mdRaw.forEach(function(row){\n            queryFieldsToRemove.forEach(function(field){\n\
    \                delete row[field];\n            });\n        });\n    }\n   \
    \ else{\n        queryFieldsToRemove.forEach(function(field){\n              \
    \  delete mdRaw[field];\n            });\n    }\n\n    var md = tableToMarkdown('LogRhythm\
    \ query results:',  mdRaw);\n\n    var ec = {};\n    ec[\"LogRhythm.Log\"] = mdRaw;\n\
    \n    return {\n        Type: entryTypes.note,\n        Contents: jsResponse,\n\
    \        ContentsFormat: formats.json,\n        HumanReadable: md,\n        EntryContext:\
    \ ec\n    };\n}\n\nfunction fetchIncidents(){\n\n    var dataObj = {\n       \
    \ Username: params.Credentials.identifier,\n        Password: params.Credentials.password\n\
    \    };\n\n    var lastRun = getLastRun();\n    if (!lastRun || !lastRun.lastTime)\
    \ {\n        lastRun = {\n            lastId: 0,\n            lastTime: new Date().getTime()\
    \ - (10 * 60 * 1000)\n        }\n    }\n    var pageSize = params.pageSize ? parseInt(params.pageSize)\
    \ : defaultAlarmsPageSize;\n    pageSize = pageSize || defaultAlarmsPageSize;\n\
    \    var alarms = getAlarmsData(true, pageSize, pageSize, getDateAsString(new\
    \ Date(lastRun.lastTime)), getDateAsString(new Date()), 'New',dataObj);\n    if\
    \ (alarms.length) {\n        return alarmsToIncident(alarms, lastRun);\n    }\n\
    \    return '[]';\n}\n// The command input arg holds the command sent from the\
    \ user.\nswitch (command) {\n    // This is the call made when pressing the integration\
    \ test button.\n    case 'test-module':\n        var url = params.use_ntlm ? getRequestUrl('AlarmServiceWindowsAuth.svc?singleWsdl')\
    \ : getRequestUrl('AlarmServiceBasicAuth.svc?singleWsdl')\n        var resp =\
    \ getRaw(url);\n        var alarmsArgs = {};\n        alarmsArgs['all-users']\
    \ = \"true\";\n        alarmsArgs['start-date'] = \"2018-03-01\";\n        alarmsArgs['end-date']\
    \ = \"2018-03-30\";\n        alarmsArgs['status'] = \"New\";\n        var alarmsResponse\
    \ = getAlarms(alarmsArgs);\n        // if we get alarmsResponse.Type it means\
    \ that no error was raised in getAlarms\n        if (resp.StatusCode === 200 &&\
    \ alarmsResponse.Type) {\n            return 'ok';\n        } else if (resp.Status)\
    \ {\n            return resp.Status;\n        } else {\n            return resp;\n\
    \        }\n        break;\n    case 'lr-add-alarm-comments':\n        return\
    \ addAlarmComments(args);\n\n    case 'lr-get-alarm-by-id':\n        return getAlarmById(args);\n\
    \n    case 'lr-get-alarm-events-by-id':\n        return getAlarmEventsById(args);\n\
    \n    case 'lr-get-alarm-history-by-id':\n        return getAlarmHistoryById(args);\n\
    \n    case 'lr-update-alarm-status':\n        return updateAlarmStatus(args);\n\
    \n    case 'lr-get-alarms':\n        return getAlarms(args);\n\n    case 'lr-get-hosts-by-entity-id':\n\
    \        return getHostsByEntityId(args);\n\n    case 'lr-add-host':\n       \
    \ return addHost(args);\n\n    case 'lr-execute-query':\n        return executeQuery(args);\n\
    \n    case 'fetch-incidents':\n        return fetchIncidents();\n}"
  type: javascript
tests:
- LogRhythm-Test-Playbook
toversion: 4.1.9
