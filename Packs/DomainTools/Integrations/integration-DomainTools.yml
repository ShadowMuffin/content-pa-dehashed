category: Data Enrichment & Threat Intelligence
commonfields:
  id: DomainTools
  version: -1
configuration:
- defaultvalue: http://api.domaintools.com/
  display: DomainTools API URL
  name: server
  required: true
  type: 0
- defaultvalue: ''
  display: API Username
  name: username
  required: true
  type: 0
- defaultvalue: ''
  display: API Key
  name: key
  required: true
  type: 4
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Domain name, DNS and Internet OSINT-based cyber threat intelligence and
  cybercrime forensics products and data
display: DomainTools
fromversion: 3.0.0
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAARCAMAAAAhQZhyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAYBQTFRFenp6u7u72trasLCwRkZGxcXFv7+/hoaGqamp1tbWlpaWdXV1PDw8Xl5eZmZmrq6ulJSU0NDQi4uLn5+fg4ODCwsLtbW1jo6OExMToKCgIiIiAQEBa2trJiYmLi4ukpKSHh4eQEBAWVlZYWFhOTk5NjY2Kioq/////v7+/f39/Pz8+fn5+/v7f39/9PT0+vr63NzcfHx8eHh4jY2N9vb2gYGB5+fnw8PD8/PziYmJ8vLyd3d38fHx+Pj47e3t6enpwsLC4eHh3t7era2tq6urgICAdnZ2vLy8m5ubhYWF2dnZt7e3fn5+7u7utra2xsbGpqameXl59fX1fX194ODgkJCQwcHB5eXlz8/P6+vr1NTUhISEycnJsrKy9/f37+/v0tLSpKSk4+PjmZmZ8PDw6Ojox8fH6urq5OTkzs7O4uLis7Ozvb29uLi4nJyc5ubm3d3dysrK2NjY1dXVjIyMrKyswMDAqqqqmpqaiIiIp6enTU1N39/fo6Ojzc3N////mmwwVQAAAIB0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wA4BUtnAAADRklEQVR42ryVZ0MiMRCGF1BB0LOBolFOvdPJ7gpIly5KB8Heey/Xe5+/fpOw+BPIh+Ql2cwzmZkEBRF9nwDVHyvY0aYgavnkU+xXMLLQafBaM7QRHDkZdObCWkfBeKiMLQHCwY7jqnNkBTLvy8koQsKP3Ka0wJla3vKJS6l9q4xnhFjZBeqH9uXsyls5rMXI39IZqd5thNzn6mLvIVmAg+5mBuQX4YfdbWGILxpH0vebUY7gSyl7g456gdJ78bKh8lBUrlrYi363JyXqbmLKOstMpCLsAfGOdYl1Ps0EDU0uQM6mafesFyH2fUzJ23SEUW+PSakJsjloiYV2/IhqMNXiHj3Fjj4ibFeVrz3DdS9tNe1dN/Dmp3TM8po+feEhz2b6yd8mW0PcYW4NXrN+sf55qn9LjMsTBJ5nrwAnQzIQV6I/LBAprVQRN4tZ8vJinS6Nd0mCF4dpQiXrmnK8e2wrHiDun6NNh5CTJJ7MUbfJopgQSERPmU7seBUZ6LP/Fr+73iwxvQ2errnXDfCinToY6xX6nx3wdkQoX9D/DE4kSxluFBdvflNWAfes3RE/rjp62mCVVTEq7eNsAHFrWGcsVRKhzrA09NnaYFc2y+69X1pgii8vyHzl4oC1UaEWlPAzGNe+Fpx7RlWHLbbkH1TNt3eI5QFuhBpzzIc6OxcpdZUQ6wo2BnFVgK3M42ETvA1ewVXXnP0ZDOMloUe/U8lZRaLfB1QC+9rlzA+3uHGdogOBwGOrCJPHYjjx+PWqy0oq5HpU05PTlPnABgJgfoYKhN1eXm67qL53JfgDwiR79wzGjOMD5+ZigoJ2VNP4dWCIlPdOVVXAm48a3Nfb4FQwEki+TanqmX2jIbaamNvl/isUp5piXSJM3oAwLU68PiPUSB9gbKp1YtTmWye+kpfovmKtxLNCnZYjP70PNKnGj+LxShgT5cqY87L9ZC6vF8cvisH4sLLhdOREek/Dp6oRGT2bkNYW5IuqUs7TsvJ5mGo1TZFNC/81ucqNy8o3N1sVhHDqk3OwQM0vEqH71PbLBecN8013bGSrHurp/nHdwScTfAjZ5eMvwRyYlzr5VreC8iZfeOzsv5PRht798ncQ/F+AAQCqnR8RUnHvswAAAABJRU5ErkJggg==
name: DomainTools
script:
  commands:
  - arguments:
    - description: Domain name to check reputation
      name: domain
      required: true
    - description: Should we return full response with detected URLs
      name: long
    - description: The number of samples from each type (resolutions, detections,
        etc.) to display for long format
      name: sampleSize
    - description: If number of positive detected domains is bigger than the threshold
        we will consider it malicious
      name: threshold
    - description: Wait time between tries if we reach the API rate limit in seconds
      name: wait
    - description: Number of retries for API rate limit
      name: retries
    description: Retrieve domain information.
    name: domain
    outputs:
    - contextPath: Domain.Name
      description: The tested domain
    - contextPath: Domain.RiskScore
      description: The reputation returned from DomainTools
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
  - arguments:
    - default: true
      description: (mandatory and default) Query strings. Each term in the query string
        must be at least three characters long. Use spaces to separate multiple terms
      name: query
      required: true
    - defaultValue: '1'
      description: 'Sets the page of results to retrieve from the server. Each page
        is limited to 100 results. Default: 1'
      name: pageNumber
    - defaultValue: '25'
      description: 'Limit the maximum domain character count. Default: 25'
      name: maxLength
    - defaultValue: '1'
      description: 'Limit the minimum domain character count. Default: 1'
      name: minLength
    - description: '(true or false) Return results with hyphens in the domain name.
        Default: true'
      name: hesHyphen
    - description: Terms to exclude from matching
      name: exclude
    - auto: PREDEFINED
      defaultValue: 'false'
      description: '(true or false) Return only domains currently registered.Default:
        false'
      name: activeOnly
      predefined:
      - 'true'
      - 'false'
    - auto: PREDEFINED
      defaultValue: 'false'
      description: '(true or false) Return only domains previously registered but
        not currently registered. Default: false'
      name: deletedOnly
      predefined:
      - 'true'
      - 'false'
    - auto: PREDEFINED
      defaultValue: 'false'
      description: '(true or false) Return only domains that start with the query
        term. Default: false'
      name: anchorLeft
      predefined:
      - 'true'
      - 'false'
    - auto: PREDEFINED
      defaultValue: 'false'
      description: '(true or false) Return only domains that end with the query term.
        Default: false'
      name: anchorRight
      predefined:
      - 'true'
      - 'false'
    - auto: PREDEFINED
      defaultValue: 'true'
      description: '(true or false) Return results with numbers in the domain name.
        Default: true'
      name: hasNumber
      predefined:
      - 'false'
      - 'true'
    description: Search for domain based on the given parameters
    name: domainSearch
    outputs:
    - contextPath: Domain.Name
      description: Domain found by command
  - arguments:
    - default: true
      description: (default) specify IP address
      name: ip
    - description: If you provide a domain name, DomainTools will respond with the
        list of other domains that share the same IP
      name: domain
    - description: Limits the size of the domain list than can appear in a response.
        The limit is applied per-IP address, not for the entire request.
      name: limit
    description: Reverse loopkup of an IP address
    name: reverseIP
    outputs:
    - contextPath: Domain.Name
      description: Domain name
    - contextPath: Domain.DNS.Address
      description: IP address
  - arguments:
    - default: true
      description: (default and mandatory) specify the name of the primary or secondary
        name server
      name: nameServer
      required: true
    - description: Limit the size of the domain list than can appear in a response
      name: limit
    description: Reverse nameserver lookup
    name: reverseNameServer
    outputs:
    - contextPath: Domain.Name
      description: Name of domain
  - arguments:
    - default: true
      description: (mandatory and default) List of one or more terms to search for
        in the Whois record, separated with the pipe character ( | ).
      name: terms
      required: true
    - description: Domain names with Whois records that match these terms will be
        excluded from the result set. Separate multiple terms with the pipe character
        ( | ).
      name: exclude
    - auto: PREDEFINED
      defaultValue: 'false'
      description: Show only historic records
      name: onlyHistoricScope
      predefined:
      - 'true'
      - 'false'
    - defaultValue: purchase
      description: 'Only lists the size and retail price of the query if you have
        per-domain pricing access purchase : includes the complete list of domain
        names that match the query'
      name: quoteMode
    description: Reverse lookup of whois information
    name: reverseWhois
    outputs:
    - contextPath: Domain.Name
      description: Name of domain
  - arguments:
    - default: true
      description: (mandatory and default) enter domain (do not use full URL). e.g.
        !whois [query=]demisto.com
      name: query
      required: true
    - auto: PREDEFINED
      defaultValue: 'true'
      description: Should return parsed or raw response. Default is true
      name: parsed
      predefined:
      - 'true'
      - 'false'
    description: Provides registration details about a domain
    name: whois
    outputs:
    - contextPath: Domain.Name
      description: Requested domain name
    - contextPath: Domain.Whois
      description: Whois data
  - arguments:
    - default: true
      description: Specify domain e.g. mycompany.com
      name: domain
      required: true
    description: Display a history of whois for a given domain
    name: whoisHistory
    outputs:
    - contextPath: Domain.Name
      description: Name of domain
    - contextPath: Domain.WhoisHistory
      description: Domain Whois history data
  - arguments:
    - description: Specify domain e.g. mycompany.com
      name: domain
    description: Display profile for a given domain
    name: domainProfile
  script: "var toCamelCase = function(string){\n    var str = ' '+string.trim();\n\
    \    str=str.replace(/ ([a-z,A-Z])/g, function (g) { return g[1].toUpperCase();\
    \ });\n    return str;\n};\n\nvar sendRequest = function(url) {\n    var res =\
    \ http(\n        url,\n        {\n            Method: 'GET',\n            Headers:\
    \ {\n                Accept: ['application/json']\n            }\n        },\n\
    \        params.insecure,\n        params.proxy\n    );\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Request Failed.\\nStatus code:\
    \ ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res) + '.';\n    }\n\n  \
    \  try {\n        return JSON.parse(res.Body);\n    }\n    catch (err) {\n   \
    \     throw 'Failed to parse JSON';\n    }\n};\n\nvar addKeyToJson = function(cur,\
    \ toAdd){\n    if(!cur){\n        return toAdd;\n    }\n    if(!Array.isArray(cur)){\n\
    \        return [cur, toAdd];\n    }\n    cur.push(toAdd);\n    return cur;\n\
    };\n\nvar changeKeys = function(conv, obj){\n    var output = {};\n    for (var\
    \ i in obj) {\n        if (Object.prototype.toString.apply(obj[i]) === '[object\
    \ Object]') {\n            output[conv(i)] = changeKeys(conv, obj[i]);\n     \
    \   } else {\n            output[conv(i)] = obj[i];\n        }\n    }\n    return\
    \ output;\n};\n\nvar callWhoIs = function(query, parsed,url){\n    var res = sendRequest(url\
    \ + query + '/whois/parsed/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key}));\n\
    \    var error = res.response.error;\n    if(error && error.code === 206){\n \
    \       parsed = false;\n        log('error code 206');\n    }\n    var splitRes\
    \ = res.response.whois.record.split('\\n');\n    var md = '### DomainTools whois\
    \ result for '+ query + '\\n';\n    var resMap = {};\n    splitRes.forEach(function(entry){\n\
    \        splitEntry = entry.split(/:\\s(.+)/);\n        if(splitEntry[1]){\n \
    \           splitEntry[0] = toCamelCase(splitEntry[0]);\n            md += '**'+splitEntry[0]+':**\
    \ '+splitEntry[1]+'\\n';\n            resMap[splitEntry[0]] = addKeyToJson(resMap[splitEntry[0]],\
    \ splitEntry[1]);\n        }\n    });\n\n    var context;\n    if(parsed === 'false'){\n\
    \        context = {'Domain': {'Name': res.response.record_source, 'Whois': resMap}};\n\
    \    }else{\n        context = {'Domain': {'Name': res.response.record_source,\
    \ 'Whois': changeKeys(toCamelCase, res.response.parsed_whois)}};\n    }\n\n  \
    \  return {\n            Type: entryTypes.note,\n            Contents: res,\n\
    \            ContentsFormat: formats.json,\n            ReadableContentsFormat:\
    \ formats.markdown,\n            HumanReadable: md,\n            EntryContext:\
    \ context\n        };\n};\n\nvar scoreConv = function(score, threshold){\n   \
    \ if(threshold){\n        return score>=threshold ? 3 : 1;\n    }\n    if(score\
    \ === 0)\n        return 1;\n    if(score > 0 && score <=69)\n        return 2;\n\
    \    if(score >= 70)\n        return 3;\n    return -1;\n};\n\nvar callDomain\
    \ = function(url, domain, threshold){\n    var repRes = sendRequest(url + 'reputation/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key,\
    \ 'domain' : domain}));\n    var md = 'Domain '+repRes.response.domain+' found\
    \ with risk score of '+ repRes.response.risk_score +'.';\n    var context = {\n\
    \        'DBotScore' : {\n            'Indicator' : domain,\n            'Score'\
    \ : scoreConv(repRes.response.risk_score, threshold),\n            'Type': 'domain',\n\
    \            'Vendor': 'domaintools'\n        }\n    };\n    if(context.DBotScore.Score\
    \ === 3){\n        addMalicious(context, outputPaths.domain, {'Name' : domain,\
    \ 'RiskScore': repRes.response.risk_score ,'Malicious' : {'Vendor' : 'DomainTools'}});\n\
    \    }\n\n    return {\n            Type: entryTypes.note,\n            Contents:\
    \ repRes,\n            ContentsFormat: formats.json,\n            HumanReadable:\
    \ md,\n            ReadableContentsFormat: formats.markdown,\n            EntryContext:\
    \ context\n        };\n};\n\nvar callProfile= function(url, domain){\n    var\
    \ domRes = sendRequest(url + domain + '/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key}));\n\
    \    return {\n            Type: entryTypes.note,\n            Contents: domRes,\n\
    \            ContentsFormat: formats.json\n        };\n};\n\nvar argToUrlParam\
    \ = function(string){\n    var map = {\n        'exclude':'exclude_query',\n \
    \       'maxLength':'max_length',\n        'minLength':'min_length',\n       \
    \ 'hesHyphen':'has_hyphen',\n        'hasNumber':'has_number',\n        'activeOnly':'active_only',\n\
    \        'deletedOnly':'deleted_only',\n        'anchorLeft':'anchor_left',\n\
    \        'anchorRight':'anchor_right',\n        'pageNumber':'page'\n    };\n\
    \    return map[string] ? map[string] : string;\n};\n\nvar callDomainSearch =\
    \ function(url, args){\n    args = changeKeys(argToUrlParam,args);\n    args.api_username\
    \ = params.username;\n    args.api_key = params.key;\n    var res = sendRequest(url\
    \ +  'domain-search/'+encodeToURLQuery(args));\n    var results = res.response.results;\n\
    \n    var md = '';\n    var numDomains = 0;\n    var context = {'Domain' : []};\n\
    \    if(results && results.length > 0){\n        results.forEach(function(result){\n\
    \            if(result.hashad_tlds && result.hashad_tlds.length > 0){\n      \
    \          result.hashad_tlds.forEach(function(tld){\n                    md+='*\
    \ '+result.sld+'.'+tld+'\\n';\n                    numDomains++;\n           \
    \         context.Domain.push({'Name' : result.sld+'.'+tld});\n              \
    \  });\n            }\n        });\n    }\n\n    return {\n            Type: entryTypes.note,\n\
    \            Contents: res,\n            ContentsFormat: formats.json,\n     \
    \       ReadableContentsFormat: formats.markdown,\n            HumanReadable:\
    \ 'Found '+numDomains +' domains:\\n'+md,\n            EntryContext: context\n\
    \        };\n};\n\nvar callReverseIP = function(url, args){\n    var md = '';\n\
    \    var context = {'Domain' : []};\n    var res;\n    var addresses;\n    if(args.domain){\n\
    \        res = sendRequest(url + args.domain+'/reverse-ip/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key,\
    \ 'limit': args.limit? args.limit : 50}));\n\n    }\n    else if(args.ip){\n \
    \       res = sendRequest(url + args.ip+'/host-domains/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key,\
    \ 'limit': args.limit? args.limit : 50}));\n    }\n    addresses = res.response.ip_addresses;\n\
    \    if(!Array.isArray(addresses)){\n        addresses = [addresses];\n    }\n\
    \n    addresses.forEach(function(address){\n        md+= '\\nFound ' + address.domain_count\
    \ + ' domains for ' +address.ip_address + '\\n';\n        address.domain_names.forEach(function(domain){\n\
    \            md += '* ' + domain + '\\n';\n            context.Domain.push({'Name':\
    \ domain, 'DNS' : {'Address' : address.ip_address}});\n        });\n    });\n\n\
    \    return {\n        Type: entryTypes.note,\n        Contents: res,\n      \
    \  ContentsFormat: formats.json,\n        ReadableContentsFormat: formats.markdown,\n\
    \        HumanReadable: md,\n        EntryContext: context\n    };\n}\n\nvar callReverseNameServer\
    \ = function(url, server, limit){\n    var res = sendRequest(url +server + '/name-server-domains/'\
    \ + encodeToURLQuery({'api_username':params.username,'api_key':params.key, 'limit':\
    \ limit? limit : 50}));\n    var md = 'Found ' +  res.response.primary_domains.length\
    \ + ' domains\\n';\n    var context = {'Domain' : []};\n    res.response.primary_domains.forEach(function(domain){\n\
    \        md += '* ' + domain + '\\n';\n        context.Domain.push({'Name' : domain});\n\
    \    });\n\n    return {\n        Type: entryTypes.note,\n        Contents: res,\n\
    \        ContentsFormat: formats.json,\n        ReadableContentsFormat: formats.markdown,\n\
    \        HumanReadable: md,\n        EntryContext: context\n    };\n}\n\nvar callReverseWhoIs\
    \ = function(url, args){\n    args.api_username = params.username;\n    args.api_key\
    \ = params.key;\n    args.mode = args.quoteMode;\n    args.scope = 'current';\n\
    \    if(args.onlyHistoricScope === 'true'){\n        args.scope = 'historic';\n\
    \    }\n    delete args.quoteModel\n    delete args.onlyHistoricScope;\n\n   \
    \ var res = sendRequest(url + encodeToURLQuery(args));\n    var context = {'Domain'\
    \ : []};\n    var md = 'Found '+res.response.domains.length+ ' domains: \\n';\n\
    \    res.response.domains.forEach(function(domain){\n        md += '* ' + domain\
    \ + '\\n';\n        context.Domain.push({'Name' : domain});\n    });\n\n    return\
    \ {\n        Type: entryTypes.note,\n        Contents: res,\n        ContentsFormat:\
    \ formats.json,\n        ReadableContentsFormat: formats.markdown,\n        HumanReadable:\
    \ md,\n        EntryContext: context\n    };\n}\n\n/*http://api.domaintools.com/v1/domaintools.com/whois/history/*/\n\
    var callWhoisHistory = function(url, domain){\n    var res = sendRequest(url+domain+'/whois/history/'+\
    \ encodeToURLQuery({'api_username':params.username,'api_key':params.key}));\n\
    \    var splitRecord;\n    var context = {'Domain' : {'Name' : domain, 'WhoisHistory'\
    \ : []}};\n    var md = '';\n    var entryContext, record;\n    res.response.history.forEach(function(entry){\n\
    \        entryContext = {};\n        record = entry.whois.record;\n        if(record){\n\
    \            var splitRecord = record.split('\\n');\n            splitRecord.forEach(function(pair){\n\
    \                splitEntry = pair.split(/:\\s(.+)/);\n                    if(splitEntry[1]){\n\
    \                        splitEntry[0] = toCamelCase(splitEntry[0]);\n       \
    \                 md += '**'+splitEntry[0]+':** '+splitEntry[1]+'\\n';\n     \
    \                   entryContext[splitEntry[0]] = splitEntry[1];\n           \
    \         }\n            });\n        }\n        context.Domain.WhoisHistory.push(entryContext);\n\
    \    });\n\n    return {\n        Type: entryTypes.note,\n        Contents: res,\n\
    \        ContentsFormat: formats.json,\n        ReadableContentsFormat: formats.markdown,\n\
    \        HumanReadable: md,\n        EntryContext: context\n    };\n}\n\nvar url\
    \ = params.server.replace(/[\\/]+$/, '');\nswitch (command) {\n    case 'test-module':\n\
    \            var res = sendRequest(url + '/v1/demisto.com/whois/parsed/'+encodeToURLQuery({'api_username':params.username,'api_key':params.key}));\n\
    \            if(res.response.error){\n                log('Something went wrong\
    \ - error code ' + error.code);\n            }\n            return 'ok';\n   \
    \ case 'domain':\n        return callDomain(url+'/v1/', args.domain, args.threshold);\n\
    \    case 'domainSearch':\n        return callDomainSearch(url+'/v2/', args);\n\
    \    case 'reverseIP':\n        return callReverseIP(url+'/v1/', args);\n    case\
    \ 'reverseNameServer':\n        return callReverseNameServer(url+'/v1/', args.nameServer,\
    \ args.limit);\n    case 'reverseWhois':\n        return callReverseWhoIs(url\
    \ + '/v1/reverse-whois/', args);\n    case 'whois':\n        return callWhoIs(args.query,\
    \ args.parsed, url+'/v1/');\n    case 'whoisHistory':\n        return callWhoisHistory(url+'/v1/',\
    \ args.domain);\n    case 'domainProfile':\n        return callProfile(url+'/v1/',\
    \ args.domain);\n}"
  type: javascript
toversion: 4.1.9
versionedfields: {}
