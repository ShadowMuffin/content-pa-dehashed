category: Forensics & Malware Analysis
commonfields:
  id: ReversingLabs A1000
  version: -1
configuration:
- defaultvalue: https://a1000.reversinglabs.com
  display: Base URL of the A1000 box
  name: base
  required: true
  type: 0
- defaultvalue: ''
  display: Token to use for authentication
  name: token
  required: true
  type: 4
- defaultvalue: 'false'
  display: Provide extended information when available
  name: extended
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: ReversingLabs A1000 Malware Analysis Platform
detaileddescription: 'To generate a token for a given username you can use a simple
  POST request with the user credentials.

  ```

  curl -X POST --form "username=your-username" --form ''password=your-password'' https://a1000-server-name-or-ip/api-token-auth/

  ```'
display: ReversingLabs A1000
image: data:image/png;base64,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
name: ReversingLabs A1000
script:
  commands:
  - arguments:
    - default: true
      description: file hash
      name: file
      required: true
    description: Retrieve file reputation data from an A1000 appliance
    name: file
    outputs:
    - contextPath: File.MD5
      description: Bad hash found
    - contextPath: File.SHA1
      description: Bad hash SHA1
    - contextPath: File.SHA256
      description: Bad hash SHA256
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Detections
      description: For malicious files. Total detections.
    - contextPath: File.Malicious.TotalEngines
      description: For malicious files. Total engines
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
  - arguments:
    - default: true
      description: The file entry to upload
      name: entryId
      required: true
    - description: A comment to add to the file
      name: comment
    - description: List of tags for the file
      name: tags
    - auto: PREDEFINED
      defaultValue: 'true'
      description: Should we send to TICloud for analysis
      name: cloud_analyze
      predefined:
      - 'true'
      - 'false'
    description: Upload a sample to A1000 for analysis
    execution: true
    name: reversinglabs-upload
  - arguments:
    - default: true
      description: The hash to delete
      name: hash
      required: true
    description: Delete an uploaded sample
    execution: true
    name: reversinglabs-delete
  - arguments:
    - default: true
      description: The sample hash
      name: hash
      required: true
    description: List extracted files from a sample
    name: reversinglabs-extracted-files
    outputs:
    - contextPath: File.MD5
      description: Bad hash found
    - contextPath: File.SHA1
      description: Bad hash SHA1
    - contextPath: File.SHA256
      description: Bad hash SHA256
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Detections
      description: For malicious files. Total detections.
    - contextPath: File.Malicious.TotalEngines
      description: For malicious files. Total engines
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
  - arguments:
    - default: true
      description: Sample hash to download
      name: hash
      required: true
    description: Download a sample to the investigation
    name: reversinglabs-download
  - arguments:
    - default: true
      description: The hash of an already uploaded sample
      name: hash
      required: true
    description: Re-analyze sample
    execution: true
    name: reversinglabs-analyze
  - arguments:
    - default: true
      description: The sample hash we want unpacked samples for
      name: hash
      required: true
    description: Download samples obtained through the unpacking process
    name: reversinglabs-download-unpacked
  runonce: false
  script: "import requests\nfrom requests.auth import HTTPBasicAuth\nimport re\nimport\
    \ os\nimport shutil\nfrom zipfile import ZipFile\n\nBASE_URL = demisto.getParam('base')\n\
    if BASE_URL[-1] == '/':\n    BASE_URL = BASE_URL[0:-1]\nHEADERS = {'Authorization':\
    \ 'Token ' + demisto.getParam('token')}\nEXTENDED = demisto.getParam('extended')\n\
    \nif not demisto.getParam('proxy'):\n    del os.environ['HTTP_PROXY']\n    del\
    \ os.environ['HTTPS_PROXY']\n    del os.environ['http_proxy']\n    del os.environ['https_proxy']\n\
    \n\ndef return_error(data):\n    \"\"\"\n    Return error as result and exit -\
    \ filter 404 as non-errors\n    \"\"\"\n    if '404' in data or 'Reply does not\
    \ contain results' in data:\n        demisto.results({ 'Type' : entryTypes['note'],\
    \ 'ContentsFormat' : formats['text'], 'Contents' : data})\n    else:\n       \
    \ demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'],\
    \ 'Contents' : data})\n    sys.exit(0)\n\n\ndef validate_hash(hash_value):\n \
    \   \"\"\"\n    Validate that the given hash is valid and return the type\n  \
    \  \"\"\"\n    type_dict = {\n        32: {\n            'type':'md5',\n     \
    \       'regex':r'([a-fA-F\\d]{32})'\n        },\n        40: {\n            'type':'sha1',\n\
    \            'regex':r'([a-fA-F\\d]{40})'\n        },\n        64: {\n       \
    \     'type':'sha256',\n            'regex':r'([a-fA-F\\d]{64})'\n        }\n\
    \    }\n    if len(hash_value) not in type_dict.keys():\n        return_error('Provided\
    \ hash length is not valid')\n    if not re.match(type_dict[len(hash_value)]['regex'],\
    \ hash_value):\n        return_error('Hash contains invalid characters')\n   \
    \ return type_dict[len(hash_value)]['type']\n\n\ndef validate_http(r):\n    \"\
    \"\"\n    Make sure that the HTTP response is valid and return relevant data if\
    \ yes\n    \"\"\"\n    if r.status_code < 200 or r.status_code > 299:\n      \
    \  return False, 'Bad HTTP response [{code}] - {body}'.format(code=r.status_code,\
    \ body=r.text)\n    try:\n        return True, r.json()\n    except Exception\
    \ as e:\n        return False, 'HTTP response is not JSON [{error}] - {body}'.format(error=e,\
    \ body=r.text)\n\n\ndef file(hash_type, hash_value):\n    \"\"\"\n    Get the\
    \ summary data from A1000 with most of the fields except TICORE\n    \"\"\"\n\
    \    ok, r = validate_http(requests.post(BASE_URL + '/api/samples/list/', headers=HEADERS,\
    \ data={'hash_values': hash_value,\n        'fields': 'sha1,sha256,sha512,md5,category,file_type,file_subtype,identification_name,identification_version,file_size,'\
    \ +\n        'extracted_file_count,local_first_seen,local_last_seen,classification_origin,classification_reason,threat_status,trust_factor,'\
    \ +\n        'threat_level,threat_name,summary,ticloud,aliases'}))\n    if not\
    \ ok:\n        return_error(r)\n\n    results = r.get('results')\n    if not results:\n\
    \        return_error('Reply does not contain results')\n\n    res = results[0]\n\
    \    status = res['threat_status']\n    score = {'unknown': 0, 'known': 1, 'suspicious':\
    \ 2, 'malicious': 3}[status]\n    prop = status.title()\n    file_data = {\n \
    \       prop: {\n            'Vendor': 'ReversingLabs A1000',\n            'Status':\
    \ status\n        },\n        'properties_to_append': prop\n    }\n    md = '##\
    \ ReversingLabs A1000 reputation for: {}\\n'.format(hash_value)\n    ec = {'DBotScore':\
    \ []}\n\n    md5 = res.get('md5')\n    sha1 = res.get('sha1')\n    sha256 = res.get('sha256')\n\
    \    sha512 = res.get('sha512')\n    file_type = res.get('file_type')\n    file_info\
    \ = res.get('file_subtype')\n    file_size = res.get('file_size')\n    if md5:\n\
    \        file_data['MD5'] = md5\n        md += 'MD5: **' + md5 + '**\\n'\n   \
    \     ec['DBotScore'].append({'Indicator': md5, 'Type': 'hash', 'Vendor': 'ReversingLabs\
    \ A1000', 'Score': score})\n    if sha1:\n        file_data['SHA1'] = sha1\n \
    \       md += 'SHA1: **' + sha1 + '**\\n'\n        ec['DBotScore'].append({'Indicator':\
    \ sha1, 'Type': 'hash', 'Vendor': 'ReversingLabs A1000', 'Score': score})\n  \
    \  if sha256:\n        file_data['SHA256'] = sha256\n        md += 'SHA256: **'\
    \ + sha256 + '**\\n'\n        ec['DBotScore'].append({'Indicator': sha256, 'Type':\
    \ 'hash', 'Vendor': 'ReversingLabs A1000', 'Score': score})\n    if sha512:\n\
    \        file_data['SHA512'] = sha512\n        md += 'SHA512: **' + sha512 + '**\\\
    n'\n    if file_type:\n        file_data['Type'] = file_type\n    if file_info:\n\
    \        file_data['Info'] = file_info\n    if file_size:\n        file_data['Size']\
    \ = file_size\n\n    ec[outputPaths['file']] = file_data\n\n    md += 'ID: **{}**\\\
    n'.format(demisto.get(res, 'summary.id'))\n    md += 'Malware status: **{}**\\\
    n'.format(status)\n    md += 'Local first seen: **{}**\\n'.format(res.get('local_first_seen'))\n\
    \    md += 'Local last seen: **{}**\\n'.format(res.get('local_last_seen'))\n \
    \   md += 'First seen: **{}**\\n'.format(demisto.gets(res, 'ticloud.first_seen'))\n\
    \    md += 'Last seen: **{}**\\n'.format(demisto.gets(res, 'ticloud.last_seen'))\n\
    \    md += 'Trust factor: **{}**\\n'.format(res.get('trust_factor'))\n    if status\
    \ == 'malicious':\n        md += 'Threat name: **{}**\\n'.format(res.get('threat_name'))\n\
    \        md += 'Threat level: **{}**\\n'.format(res.get('threat_level'))\n   \
    \ md += 'Category: **{}**\\n'.format(res.get('category'))\n    md += 'Classification\
    \ origin: **{}**\\n'.format(res.get('classification_origin'))\n    md += 'Classification\
    \ reason: **{}**\\n'.format(res.get('classification_reason'))\n    md += 'Aliases:\
    \ **{}**\\n'.format(','.join(res.get('aliases')))\n    md += 'Extracted file count:\
    \ **{}**\\n'.format(res.get('extracted_file_count'))\n    md += 'File type: **{}/{}**\\\
    n'.format(file_type, file_info)\n    md += 'File size: **{}**\\n'.format(file_size)\n\
    \    md += 'Identification name: **{}**\\n'.format(res.get('identification_name'))\n\
    \    md += 'Identification version: **{}**\\n'.format(res.get('identification_version'))\n\
    \    indicators = demisto.get(res, 'summary.indicators')\n    if indicators:\n\
    \        md += tableToMarkdown('Indicators', indicators)\n\n    demisto.results({'Type':\
    \ entryTypes['note'], 'ContentsFormat': formats['json'], 'Contents': r, 'EntryContext':\
    \ ec, 'HumanReadable': md})\n\n\ndef extracted_files():\n    \"\"\"\n    Get the\
    \ list of extracted files for a given sample\n    \"\"\"\n    parent = demisto.getArg('hash')\n\
    \    endpoint = '/api/samples/{}/extracted-files/'.format(parent)\n    ok, r =\
    \ validate_http(requests.get(BASE_URL + endpoint, headers=HEADERS))\n    if not\
    \ ok:\n        return_error(r)\n\n    results = r.get('results')\n    if not results:\n\
    \        return_error('Reply does not contain results')\n\n    ec = {'DBotScore':\
    \ []}\n    file_list = []\n    file_context_list = []\n    for res in results:\n\
    \        sha1 = demisto.get(res, 'sample.sha1')\n        status = demisto.get(res,\
    \ 'sample.threat_status')\n        score = {'unknown': 0, 'known': 1, 'suspicious':\
    \ 2, 'malicious': 3}[status]\n        prop = status.title()\n        file_data\
    \ = {\n            'SHA1': sha1,\n            'Name': res.get('filename'),\n \
    \           'Info': demisto.get(res, 'sample.type_display'),\n            'Size':\
    \ demisto.get(res, 'sample.file_size'),\n            'Path': res.get('path'),\n\
    \            'Local First': demisto.get(res, 'sample.local_first_seen'),\n   \
    \         'Local Last': demisto.get(res, 'sample.local_last_seen'),\n        \
    \    'Malware Status': status,\n            'Trust': demisto.get(res, 'sample.trust_factor'),\n\
    \            'Threat Name': demisto.get(res, 'sample.threat_name'),\n        \
    \    'Threat Level': demisto.get(res, 'sample.threat_level')\n        }\n    \
    \    file_context = {\n            'SHA1': sha1,\n            'Type': demisto.get(res,\
    \ 'sample.file_type'),\n            'Name': res.get('filename'),\n           \
    \ 'Info': demisto.get(res, 'sample.type_display'),\n            'Size': demisto.get(res,\
    \ 'sample.file_size'),\n            prop: {\n                'Vendor': 'ReversingLabs\
    \ A1000',\n                'Status': status\n            },\n            'properties_to_append':\
    \ prop\n        }\n        file_list.append(file_data)\n        file_context_list.append(file_context)\n\
    \        ec['DBotScore'].append({'Indicator': sha1, 'Type': 'hash', 'Vendor':\
    \ 'ReversingLabs A1000', 'Score': score})\n\n    md = tableToMarkdown('ReversingLabs\
    \ A1000 extracted files for: {}\\n'.format(parent), file_data,\n        ['SHA1',\
    \ 'Name', 'Path', 'Info', 'Size', 'Local First', 'Local Last', 'Malware Status',\
    \ 'Trust', 'Threat Name', 'Threat Level'])\n    ec[outputPaths['file']] = file_context_list\n\
    \    demisto.results({'Type': entryTypes['note'], 'ContentsFormat': formats['json'],\
    \ 'Contents': r, 'EntryContext': ec, 'HumanReadable': md})\n\n\ndef upload():\n\
    \    \"\"\"\n    Upload a file to A1000 for analysis\n    \"\"\"\n    data = {}\n\
    \    if demisto.getArg('comment'):\n        data['comment'] = demisto.getArg('comment')\n\
    \    if demisto.getArg('tags'):\n        data['tags'] = demisto.getArg('tags')\n\
    \    cloud = demisto.getArg('cloud_analyze')\n    if cloud and cloud.lower() ==\
    \ 'true':\n        data['analysis'] = 'cloud'\n    try:\n        file_entry =\
    \ demisto.getFilePath(demisto.getArg('entryId'))\n        data['filename'] = file_entry['name']\n\
    \        with open(file_entry['path'], 'rb') as f:\n            ok, r = validate_http(requests.post(BASE_URL\
    \ + '/api/uploads/', data=data, files={'file': f}, headers=HEADERS))\n       \
    \     if not ok:\n                return_error(r)\n            md = '## ReversingLabs\
    \ A1000 file upload\\n'\n            md += 'Message: **{}**\\n'.format(r.get('message'))\n\
    \            md += 'ID: **{}**\\n'.format(demisto.get(r, 'detail.id'))\n     \
    \       md += 'SHA1: **{}**\\n'.format(demisto.get(r, 'detail.sha1'))\n      \
    \      md += 'Created: **{}**\\n'.format(demisto.get(r, 'detail.created'))\n \
    \           demisto.results({'Type': entryTypes['note'], 'ContentsFormat': formats['json'],\
    \ 'Contents': r, 'HumanReadable': md})\n    except:\n        return_error('Entry\
    \ ID {} is not a file'.format(demisto.getArg('entryId')))\n\n\ndef delete_sample():\n\
    \    \"\"\"\n    Delete a file from A1000\n    \"\"\"\n    ok, r = validate_http(requests.delete(BASE_URL\
    \ + '/api/samples/{}/'.format(demisto.getArg('hash')), headers=HEADERS))\n   \
    \ if not ok:\n        return_error(r)\n    res = r.get('results')\n    if not\
    \ res:\n        return_error('Deleted successfully but got wrong JSON reply')\n\
    \    md = '## ReversingLabs A1000 file delete\\n'\n    md += 'Message: **{}**\\\
    n'.format(res.get('message'))\n    md += 'MD5: **{}**\\n'.format(demisto.get(res,\
    \ 'detail.md5'))\n    md += 'SHA1: **{}**\\n'.format(demisto.get(res, 'detail.sha1'))\n\
    \    md += 'SHA256: **{}**\\n'.format(demisto.get(res, 'detail.sha256'))\n   \
    \ demisto.results({'Type': entryTypes['note'], 'ContentsFormat': formats['json'],\
    \ 'Contents': r, 'HumanReadable': md})\n\n\ndef download():\n    \"\"\"\n    Download\
    \ a sample from A1000\n    \"\"\"\n    hash_value = demisto.getArg('hash')\n \
    \   r = requests.get(BASE_URL + '/api/samples/{}/download/'.format(hash_value),\
    \ headers=HEADERS, stream=True)\n    if r.status_code < 200 or r.status_code >\
    \ 299:\n        return_error('Bad HTTP response [{code}] - {body}'.format(code=r.status_code,\
    \ body=r.text))\n    filename = hash_value + '.bin'\n    with open(filename, 'wb')\
    \ as f:\n        r.raw.decode_content = True\n        shutil.copyfileobj(r.raw,\
    \ f)\n    demisto.results(file_result_existing_file(filename))\n\n\ndef reanalyze():\n\
    \    \"\"\"\n    Re-Analyze a sample already existing on A1000\n    \"\"\"\n \
    \   ok, r = validate_http(requests.post(BASE_URL + '/api/samples/{}/analyze/'.format(demisto.getArg('hash')),\
    \ headers=HEADERS, data={'analysis': 'cloud'}))\n    if not ok:\n        return_error(r)\n\
    \    md = '## ReversingLabs A1000 file re-analyze\\n'\n    md += 'Message: **{}**\\\
    n'.format(r.get('message'))\n    md += 'MD5: **{}**\\n'.format(demisto.get(r,\
    \ 'detail.md5'))\n    md += 'SHA1: **{}**\\n'.format(demisto.get(r, 'detail.sha1'))\n\
    \    md += 'SHA256: **{}**\\n'.format(demisto.get(r, 'detail.sha256'))\n    demisto.results({'Type':\
    \ entryTypes['note'], 'ContentsFormat': formats['json'], 'Contents': r, 'HumanReadable':\
    \ md})\n\n\ndef unpacked():\n    \"\"\"\n    Download samples obtained through\
    \ the unpacking process\n    \"\"\"\n    hash_value = demisto.getArg('hash')\n\
    \    r = requests.get(BASE_URL + '/api/samples/{}/unpacked/'.format(hash_value),\
    \ headers=HEADERS, stream=True)\n    if r.status_code < 200 or r.status_code >\
    \ 299:\n        return_error('Bad HTTP response [{code}] - {body}'.format(code=r.status_code,\
    \ body=r.text))\n    filename = hash_value + '.zip'\n    with open(filename, 'wb')\
    \ as f:\n        r.raw.decode_content = True\n        shutil.copyfileobj(r.raw,\
    \ f)\n    with ZipFile(filename, 'r') as zip_ref:\n        zip_ref.extractall()\n\
    \        for extracted in zip_ref.infolist():\n            demisto.results(file_result_existing_file(extracted.filename,\
    \ extracted.filename.replace('/', '_')))\n\n\nif demisto.command() == 'test-module':\n\
    \    ok, r = validate_http(requests.get(BASE_URL + '/api/samples/21841b32c6165b27dddbd4d6eb3a672defe54271/ticloud/',\
    \ headers=HEADERS))\n    if ok:\n        demisto.results('ok')\n    else:\n  \
    \      return_error(r)\nelif demisto.command() == 'file':\n    hash_value = demisto.args()['file']\n\
    \    hash_type = validate_hash(hash_value)\n    file(hash_type, hash_value)\n\
    elif demisto.command() == 'reversinglabs-upload':\n    upload()\nelif demisto.command()\
    \ == 'reversinglabs-delete':\n    delete_sample()\nelif demisto.command() == 'reversinglabs-extracted-files':\n\
    \    extracted_files()\nelif demisto.command() == 'reversinglabs-download':\n\
    \    download()\nelif demisto.command() == 'reversinglabs-analyze':\n    reanalyze()\n\
    elif demisto.command() == 'reversinglabs-download-unpacked':\n    unpacked()\n\
    else:\n    return_error('Command [{}] not implemented'.format(demisto.command()))\n"
  subtype: python2
  type: python
toversion: 4.1.9
