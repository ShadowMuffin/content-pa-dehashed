category: Forensics & Malware Analysis
commonfields:
  id: VxStream
  version: -1
configuration:
- defaultvalue: https://www.hybrid-analysis.com
  display: Server URL (e.g. https://216.3.128.82)
  name: serverUrl
  required: true
  type: 0
- defaultvalue: ''
  display: API Key
  name: apiKey
  required: true
  type: 4
- defaultvalue: ''
  display: Secret Key (applicable only for v1)
  name: secretKey
  required: false
  type: 4
- defaultvalue: v1
  display: API Version (v1,v2)
  name: version
  required: false
  type: 0
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Fully automated malware analysis (formerly Payload Security VxStream).
display: CrowdStrike Falcon Sandbox
image: data:image/png;base64,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
name: VxStream
script:
  commands:
  - arguments:
    - default: true
      description: File hash (MD5, SHA1 or SHA256)
      name: file
      required: true
    deprecated: true
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
    name: vx-scan
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: 'Environment id of the file '
      type: number
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
  - arguments:
    - default: true
      description: File hash (MD5, SHA1 or SHA256)
      name: file
      required: true
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
    name: crowdstrike-scan
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: Environment id of the file
      type: string
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    - contextPath: File.hash
      description: The hash used to query the file
      type: string
    - contextPath: File.state
      description: The state of the file test
      type: string
  - arguments: []
    deprecated: true
    description: Get a list of all available environments
    name: vx-get-environments
    outputs:
    - contextPath: VX.Environment.ID
      description: Environment id
    - contextPath: VX.Environment.description
      description: Environment description
    - contextPath: VX.Environment.architecture
      description: Environment architecture
    - contextPath: VX.Environment.VMs_total
      description: Total virtual machines in environment
    - contextPath: VX.Environment.VMs_busy
      description: Busy virtual machines in environment
    - contextPath: VX.Environment.analysisMode
      description: Analysis mode of environment
    - contextPath: VX.Environment.groupicon
      description: Icon of environment
  - arguments: []
    description: Get a list of all available environments
    name: crowdstrike-get-environments
    outputs:
    - contextPath: CrowdStrike.Environment.ID
      description: Environment ID
      type: number
    - contextPath: CrowdStrike.Environment.description
      description: Environment description
      type: string
    - contextPath: CrowdStrike.Environment.architecture
      description: Environment architecture
      type: string
    - contextPath: CrowdStrike.Environment.VMs_total
      description: Total virtual machines in environment
      type: number
    - contextPath: CrowdStrike.Environment.VMs_busy
      description: Busy virtual machines in environment
      type: number
    - contextPath: CrowdStrike.Environment.analysisMode
      description: 'Analysis mode of environment '
      type: string
    - contextPath: CrowdStrike.Environment.groupicon
      description: Icon of environment
      type: string
  - arguments:
    - default: true
      description: War-room entry ID of sample file
      name: entryId
      required: true
    - defaultValue: '100'
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      name: environmentId
    deprecated: true
    description: Submit a file from investigation to analysis server
    name: vx-submit-sample
  - arguments:
    - default: true
      description: War-room entry ID of sample file
      name: entryId
      required: true
    - defaultValue: '100'
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      name: environmentID
      required: true
    description: Submit a file from investigation to analysis server
    name: crowdstrike-submit-sample
    outputs:
    - contextPath: File.SHA256
      description: File SHA256 hash
      type: string
    - contextPath: File.MD5
      description: File MD5 hash
      type: string
    - contextPath: File.SHA1
      description: File SHA1 hash
      type: string
    - contextPath: CrowdStrike.JobID
      description: Sample job ID
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Sample environment ID
      type: number
  - arguments:
    - default: true
      description: Falcon Sandbox query syntax (see `<server url>/faq#advanced-search-options`
        for more details). examples -  url:google, host:95.181.53.78
      name: query
      required: true
    deprecated: true
    description: Search the database using the Falcon Sandbox search syntax
    name: vx-search
    outputs:
    - contextPath: VX.Search.SHA256
      description: SHA256 of search result
    - contextPath: VX.Search.SHA1
      description: SHA1of search result
    - contextPath: VX.Search.MD5
      description: MD5 of search result
    - contextPath: VX.Search.environmentId
      description: Environment Id of search result
    - contextPath: VX.Search.start_time
      description: Start time of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result by server
    - contextPath: VX.Search.verdict
      description: Verdict of search result
    - contextPath: VX.Search.environmentDescription
      description: Environment description of search result
    - contextPath: VX.Search.submitname
      description: Submission name of search result
    - contextPath: VX.Search.vxfamily
      description: Family of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result
    - contextPath: VX.Search.type_short
      description: type of search result (url, host, etc.)
    - contextPath: VX.Search.size
      description: Size of search result
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
  - arguments:
    - default: true
      description: Falcon Sandbox query syntax, e.g. url:google,host:95.181.53.78.
        This argument integrates all other arguments to one, and cannot be given along
        with the other arguments.
      name: query
    - description: Filename e.g. invoice.exe
      name: filename
    - description: Filetype e.g. docx
      name: filetype
    - description: Filetype description e.g. PE32 executable
      name: filetype_desc
    - description: Environment Id
      name: env_id
    - description: Country (3 digit ISO) e.g. swe, usa, fra
      name: country
    - auto: PREDEFINED
      description: 'Verdict '
      name: verdict
      predefined:
      - Whitelisted
      - NoVerdict
      - NoSpecificThreat
      - Suspicious
      - Malicious
    - description: AV Multiscan range e.g. 50-70 (min 0, max 100)
      name: av_detect
    - description: AV Family Substring e.g. nemucod
      name: vx_family
    - description: Hashtag e.g. ransomware
      name: tag
    - description: Port e.g. 8080
      name: port
    - description: Host e.g. 192.168.0.1
      name: host
    - description: Domain e.g. checkip.dyndns.org
      name: domain
    - description: HTTP Request Substring e.g. google
      name: url
    - description: Similar Samples e.g. <sha256>
      name: similar_to
    - description: Sample Context e.g. <sha256>
      name: context
    - description: Import Hash
      name: imp_hash
    - description: SSDeep
      name: ssdeep
    - description: Authentication Hash
      name: authentihash
    description: Search the database using the Falcon Sandbox search syntax
    name: crowdstrike-search
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of search result
      type: string
    - contextPath: File.SHA1
      description: SHA1of search result
      type: string
    - contextPath: File.MD5
      description: MD5 of search result
      type: string
    - contextPath: File.environmentId
      description: Environment Id of search result
      type: number
    - contextPath: File.start_time
      description: Start time of search result
    - contextPath: File.threatscore
      description: Threat score of search result by server
      type: string
    - contextPath: File.verdict
      description: Verdict of search result
      type: string
    - contextPath: File.environmentDescription
      description: Environment description of search result
      type: string
    - contextPath: File.submitname
      description: Submission name of search result
      type: string
    - contextPath: File.vxfamily
      description: Family of search result
      type: string
    - contextPath: File.threatscore
      description: Threat score of search result
      type: number
    - contextPath: File.type_short
      description: type of search result (url, host, etc.)
      type: string
    - contextPath: File.size
      description: Size of search result
      type: number
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
  - arguments:
    - default: true
      description: File hash (MD5, SHA1 or SHA256)
      name: file
      required: true
    - description: environment ID to submit file to(get all via crowdstrike-get-environments)
      name: environmentId
    deprecated: true
    description: Retrieve result data upon a file. NOTE - This command returns a file
    name: vx-result
  - arguments:
    - default: true
      description: File hash (MD5, SHA1 or SHA256) - Mandatory in v1
      name: file
    - defaultValue: '100'
      description: environment ID to submit file to (get all via crowdstrike-get-environments)  -
        Mandatory in v1.
      name: environmentId
    - auto: PREDEFINED
      defaultValue: pdf
      description: File type of report to return (supported only in v2)
      name: file-type
      predefined:
      - xml
      - json
      - html
      - pdf
      - stix
      - misp
      - bin
      - pcap
    - description: Job ID of file to generate report of (supported only in v2)
      name: JobID
    description: Retrieve result data upon a file. NOTE - This command returns a file
    name: crowdstrike-result
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
  - arguments:
    - description: War-room entry ID of sample file
      name: entryId
      required: true
    - description: environment ID to submit file to(get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
      name: environmentID
    - defaultValue: '3'
      description: Delay wait time between calls (in seconds)
      name: delay
    - defaultValue: '60'
      description: Total wait time (in seconds)
      name: timeout
    deprecated: true
    description: (Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate file
      playbook instead) Detonate file through Falcon Sandbox
    name: vx-detonate-file
  - arguments:
    - description: War-room entry ID of sample file
      name: entryId
      required: true
    - description: environment ID to submit file to(get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
      name: environmentID
    - defaultValue: '3'
      description: Delay wait time between calls (in seconds)
      name: delay
    - defaultValue: '60'
      description: Total wait time (in seconds)
      name: timeout
    deprecated: true
    description: (Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate file
      playbook instead) Detonate file through Falcon Sandbox
    name: crowdstrike-detonate-file
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: Environment id of the file
      type: string
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
  - arguments:
    - description: URL to analyze
      name: url
      required: true
    - defaultValue: '100'
      description: Environment ID to submit URL to
      name: environmentID
      required: true
    description: Submit a URL for analysis (Supported only in v2)
    name: crowdstrike-submit-url
    outputs:
    - contextPath: File.SHA256
      description: File SHA256
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Environment ID in which the URL was analysed
      type: string
    - contextPath: CrowdStrike.JobID
      description: Job ID of URL analysation
      type: string
  - arguments:
    - description: File hash (SHA256) to retrieve screenshots of
      name: file
    - defaultValue: '100'
      description: environment ID to retrieve screenshots from
      name: environmentID
    - description: Job ID to retrieve screenshots of
      name: JobID
    description: ' Retrieves screenshots from a report (Supported only in v2)'
    name: crowdstrike-get-screenshots
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of search result
      type: string
    - contextPath: File.SHA1
      description: SHA1of search result
      type: string
    - contextPath: File.MD5
      description: MD5 of search result
      type: string
    - contextPath: File.environmentId
      description: Environment Id of search result
      type: number
    - contextPath: File.start_time
      description: Start time of search result
    - contextPath: File.threatscore
      description: Threat score of search result by server
      type: string
    - contextPath: File.verdict
      description: Verdict of search result
      type: string
    - contextPath: File.environmentDescription
      description: Environment description of search result
      type: string
    - contextPath: File.submitname
      description: Submission name of search result
      type: string
    - contextPath: File.vxfamily
      description: Family of search result
      type: string
    - contextPath: File.threatscore
      description: Threat score of search result
      type: number
    - contextPath: File.type_short
      description: type of search result (url, host, etc.)
      type: string
    - contextPath: File.size
      description: Size of search result
      type: number
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
  - arguments:
    - description: 'URL address to be submitted '
      name: url
      required: true
    - defaultValue: '100'
      description: Environment ID to submit URL to (get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
      name: environmentID
    - defaultValue: '3'
      description: Delay wait time between calls (in seconds)
      name: delay
    - defaultValue: '60'
      description: Total wait time (in seconds)
      name: timeout
    - auto: PREDEFINED
      defaultValue: pdf
      description: File type of report to return
      name: file-type
      predefined:
      - xml
      - json
      - html
      - pdf
      - stix
      - misp
      - bin
      - pcap
    deprecated: true
    description: (Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate URL
      playbook instead) Detonates URL address through Falcon Sandbox (supported only
      in v2)
    name: crowdstrike-detonate-url
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
  - arguments:
    - defaultValue: '100'
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      name: environmentID
    - description: URL of file to submit.
      name: url
      required: true
    description: Submit a file by URL for analysis (Supported only in v2).
    name: crowdstrike-submit-file-by-url
    outputs:
    - contextPath: File.SHA256
      description: File SHA256
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Environment ID in which the file was analysed
      type: string
    - contextPath: CrowdStrike.JobID
      description: Job ID of file analysation
      type: string
  runonce: false
  script: "var apiKey = params.apiKey;\nvar secretKey = params.secretKey;\nvar serverUrl\
    \ = params.serverUrl;\nvar insecure = params.insecure;\nvar proxy = params.proxy;\n\
    var version = params.version;\nif (version === undefined) {\n    version = 'v1';\n\
    }\nif (version === 'v1' && !secretKey) {\n    return 'No API secret key was provided.';\n\
    }\nvar HEADERS = {\n    'User-Agent': ['Falcon Sandbox']\n};\nif (version ===\
    \ 'v1') {\n    HEADERS['Authorization'] = ['Basic ' + Base64.encode(apiKey + ':'\
    \ + secretKey)];\n} else { // API Version is v2\n    HEADERS['api-key'] = [apiKey];\n\
    \    HEADERS['accept'] = ['application/json'];\n}\n\n// handle '/' at the end\
    \ of serverUrl\nif (serverUrl[serverUrl.length - 1] === '/') {\n    serverUrl\
    \ = serverUrl.substring(0, serverUrl.length - 1);\n}\n\nfunction entryError(errorCode,\
    \ text) {\n    var error = 'Falcon Sandbox returned an error (' + errorCode +\
    \ ') - ' + text;\n    return {Type: entryTypes.error, ContentsFormat: formats.text,\
    \ Contents: error};\n}\n\n// return a function that maps object keys by mapper\
    \ (or capitlize keys if key is not exists in mapper)\nfunction mapObject(mapper)\
    \ {\n    return function(obj) {\n        var res = {};\n        Object.keys(obj).forEach(function(key)\
    \ {\n            // map key or capitalize if not exists\n            var newKey\
    \ = mapper[key] || key;\n            res[newKey] = obj[key];\n        });\n  \
    \      return res;\n    };\n}\n\nfunction createTableEntry(name, rawResponse,\
    \ table, context, headers) {\n    return {\n        Type: entryTypes.note,\n \
    \       ContentsFormat: formats.json,\n        Contents: rawResponse,\n      \
    \  ReadableContentsFormat: formats.markdown,\n        HumanReadable: tableToMarkdown(name,\
    \ table, headers, undefined, headerTransform=underscoreToCamelCase),\n       \
    \ EntryContext: context\n    };\n}\n\nfunction sendRequest(method, endpoint, body)\
    \ {\n    var requestUrl = serverUrl + endpoint;\n    var res = http(\n       \
    \ requestUrl,\n        {\n            Method: method,\n            Headers: HEADERS,\n\
    \            Body: body\n        },\n        insecure,\n        proxy\n    );\n\
    \n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw 'Request\
    \ Failed.\\nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res,\
    \ null, 2) + '.';\n    }\n    var responseBody;\n    try {\n        responseBody\
    \ = JSON.parse(res.Body);\n    } catch (ex) {\n        responseBody = res.Bytes;\n\
    \    }\n    return responseBody;\n}\n\nfunction scan(hash) {\n    if (version\
    \ === 'v1'){\n        return sendRequest('GET', '/api/scan/' + hash);\n    } else\
    \ { // v2\n        HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];\n\
    \        return sendRequest('POST', '/api/v2/search/hash', 'hash='+hash);\n  \
    \  }\n\n}\nfunction scanToEntry(res, hash) {\n    if (version === 'v1' && res.response_code\
    \ !== 0) {\n        return entryError(res.response_code, res.response.error);\n\
    \    }\n    var response = (version === 'v1') ? res.response: res;\n    // Prettify\
    \ response certificates\n    if (response[0].certificates) {\n        for (var\
    \ i = 0; i < response[0].certificates.length; i++) {\n            response[0].certificates[i]\
    \ = JSON.stringify(response[0].certificates[i], null, 2);\n        }\n    }\n\
    \    // create table from response\n    var tableMapper = {\n       threatlevel:\
    \ 'threat level',\n       total_network_connections: 'total network connections',\n\
    \       targeturl: 'target url',\n       classification_tags: 'classification\
    \ tags',\n       threatscore: 'threat score',\n       total_processes: 'total\
    \ processes',\n       submitname: 'submit name',\n       environmentDescription:\
    \ 'environment description',\n       isinteresting: 'interesting',\n       environmentId:\
    \ 'environment id',\n       isurlanalysis: 'url analysis',\n       analysis_start_time:\
    \ 'analysis start time',\n       total_signatures: 'total signatures'\n    };\n\
    \n    var table = response.map(mapObject(tableMapper));\n\n    // create context\
    \ from response\n    var context = {};\n\n    var contextMapper = {\n        sha1:\
    \ 'SHA1',\n        sha256: 'SHA256',\n        md5: 'MD5',\n        job_id: 'JobID',\n\
    \        environment_id: 'environmentId',\n        threat_score: 'threatscore',\n\
    \        environment_description: 'environmentDescription',\n        submit_name:\
    \ 'submitname',\n        url_analysis: 'isurlanalysis',\n        interesting:\
    \ 'isinteresting',\n        vx_family: 'vxfamily'\n    };\n    var filePath =\
    \ \"File(val.hash===obj.hash)\";\n    fileContext = response.map(mapObject(contextMapper));\n\
    \    fileContext[0].hash = hash;\n    context[filePath] = fileContext;\n    response.forEach(function(res)\
    \ {\n       if(res.threatlevel && res.threatlevel > 1) {\n           addMalicious(context,\
    \ outputPaths.file, {\n                MD5: res.md5,\n                SHA1: res.sha1,\n\
    \                SHA256: res.sha256,\n                Malicious: {\n         \
    \           Vendor: 'Falcon Sandbox',\n                    Description: 'Score\
    \ above ' + res.threatscore\n                }\n            });\n       }\n  \
    \  });\n    context.DBotScore = {\n        Indicator: response[0].sha256,\n  \
    \      Type: 'hash',\n        Vendor: 'CrowdStrike Falcon Sandbox',\n        Score:\
    \ translateScore(response[0]['threat_level'])\n    }\n    return createTableEntry('Scan\
    \ Results:', response, table, context);\n}\n\nfunction getEnvironments() {\n \
    \   var res = sendRequest('GET', '/system/state');\n    if (res.response_code\
    \ !== 0) {\n        return entryError(res.response_code, res.response.error);\n\
    \    }\n\n    var response = res.response;\n    return response;\n\n}\n\nfunction\
    \ tableFromEnvironments(response) {\n    var environments;\n    if ('environment'\
    \ in response) { // Single-server setup\n        environments = response.environment;\n\
    \    } else { // Multi-server setup\n        environments = response.backend.global_environment;\n\
    \    }\n    var environmentsKeys = Object.keys(environments);\n    var table=[];\n\
    \    var envContext = [];\n    for (var i = 0; i < environmentsKeys.length; i++){\n\
    \        var currentEnvironment = environments[environmentsKeys[i]];\n       \
    \ envContext[i] = environments[environmentsKeys[i]];\n        table[i] = {\n \
    \           ID: currentEnvironment.ID,\n            description: currentEnvironment.description,\n\
    \            architecture: currentEnvironment.architecture,\n            'total\
    \ VMS': currentEnvironment.VMs_total,\n            'busy VMS': currentEnvironment.VMs_busy,\n\
    \            'analysis mode': currentEnvironment.analysisMode,\n            'group\
    \ icon': currentEnvironment.groupicon ? currentEnvironment.groupicon : ''\n  \
    \      };\n    }\n    // create context from environments\n    var context = {\n\
    \        'VX.Environment(val.ID && val.ID == obj.ID)': envContext,\n        'CrowdStrike.Environment(val.ID\
    \ && val.ID == obj.ID)': envContext\n    };\n\n\n    return createTableEntry('All\
    \ Environments:', response, table, context, ['ID', 'description', 'architecture',\
    \ 'total VMS', 'busy VMS', 'analysis mode', 'group icon']);\n}\n\nfunction submitFile(entryId,\
    \ environmentId) {\n    var requestUrl = version === 'v1' ? serverUrl + '/api/submit'\
    \ : serverUrl + '/api/v2/submit/file';\n    var multipart_content = null;\n  \
    \  if (version === 'v2') {\n        HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];\n\
    \        multipart_content = {environment_id: environmentId}; // For API v2\n\
    \    } else {\n        multipart_content = {environmentId: environmentId}; //\
    \ For API v1\n    }\n\n    // submit file\n    var res = httpMultipart(\n    \
    \            requestUrl, // URL\n                entryId, // Optional - FilePath\
    \ / EntryID\n                {\n                    Method: 'POST',\n        \
    \            Headers: HEADERS\n                },\n                multipart_content,\n\
    \                insecure,\n                proxy\n            );\n\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Multipart Request Failed.\\\
    nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res) + '.';\n\
    \    }\n    var body;\n\n    try {\n        body = JSON.parse(res.Body);\n   \
    \ } catch (ex) {\n        throw 'Error parsing response - ' + res.Body + ' - '\
    \ + ex;\n    }\n    if (version === 'v1' && body.response_code !== 0) {\n    \
    \    return entryError(body.response_code, body.response.error);\n    }\n    var\
    \ response = version === 'v1' ? body.response: body;\n\n    var fileResult = {};\n\
    \    if (response.sha256) {\n        fileResult.SHA256 = response.sha256;\n  \
    \  }\n    if (response.sha1) {\n        fileResult.SHA1 = response.sha1;\n   \
    \ }\n    if (response.md5) {\n        fileResult.MD5 = response.md5;\n    }\n\
    \    if (response['job_id']) {\n        fileResult.JobID = response['job_id'];\n\
    \    }\n    if (response['environment_id']) {\n        fileResult.EnvironmentID\
    \ = response['environment_id'];\n    }\n    return fileResult;\n}\n\nfunction\
    \ submitFileEntry(file) {\n    var resMessage = 'File submitted successfully';\n\
    \    var fileContext = {}\n    var csContext = {}\n    if (file.SHA256) {\n  \
    \      fileContext.SHA256 = file.SHA256;\n        resMessage += '\\nSHA256 - '\
    \ + file.SHA256;\n    }\n    if (file.SHA1) {\n        fileContext.SHA1 = file.SHA1;\n\
    \        resMessage += '\\nSHA1 - ' + file.SHA1;\n    }\n    if (file.MD5) {\n\
    \        fileContext.MD5 = file.MD5;\n        resMessage += '\\nMD5 - ' + file.MD5;\n\
    \    }\n    if (file.JobID) {\n        csContext.JobID = file.JobID;\n       \
    \ resMessage += '\\nJob ID - ' + file.JobID;\n    }\n    if (file.EnvironmentID)\
    \ {\n        csContext.EnvironmentID = file.EnvironmentID;\n        resMessage\
    \ += '\\nEnvironment ID - ' + file.EnvironmentID;\n    }\n    var context = {\n\
    \        'File(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256\
    \ == obj.SHA256)': fileContext\n    }\n\n    if (csContext) {\n        context['CrowdStrike(val.JobID\
    \ && val.JobID === obj.JobID)'] = csContext\n    }\n\n    return {\n        Type:\
    \ entryTypes.note,\n        ContentsFormat: formats.json,\n        Contents: file,\n\
    \        ReadableContentsFormat: formats.markdown,\n        HumanReadable: resMessage,\n\
    \        EntryContext: context\n    };\n}\n\nfunction searchQuery() {\n    var\
    \ res;\n    if (version === 'v1') {\n        var query = '';\n        if (args.query)\
    \ {\n            query = args.query;\n        } else {\n        // Build Crowd\
    \ Strike query syntax from arguments, i.e. key:value\n            for (var key\
    \ in args) {\n                if (key === 'verdict') {\n                    var\
    \ verdictNumber = translateVerdict(args[key]);\n                    query += key\
    \ + ':' + verdictNumber + '&';\n                    continue;\n              \
    \  }\n                if (key === 'country' && args[key].length != 3) {\n    \
    \                throw 'Country ISO code should be 3 characters long'\n      \
    \          }\n                query += key + ':' + args[key] + '&';\n        \
    \    }\n        }\n        res = sendRequest('GET', '/api/search?query=' + query);\n\
    \    } else { //API Version is v2\n        HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];\n\
    \        body = '';\n        if (args.query) {\n            args.query.split(',').forEach(function(keyValue){\n\
    \               splittedObject = keyValue.split(/:(.+)/); // Split by first ':'\
    \ only\n               key = splittedObject[0];\n               value = splittedObject[1];\n\
    \               body += key + '=' + value + '&'\n            });\n        } else\
    \ {\n        // Build Crowd Strike query syntax from arguments, i.e. key:value\n\
    \            for (var key in args) {\n                if (key === 'verdict') {\n\
    \                    var verdictNumber = translateVerdict(args[key]);\n      \
    \              body += key + '=' + verdictNumber + '&';\n                    continue;\n\
    \                }\n                if (key === 'country' && args[key].length\
    \ != 3) {\n                    throw 'Country ISO code should be 3 characters\
    \ long'\n                }\n                body += key + '=' + args[key] + '&';\n\
    \            }\n        }\n        res = sendRequest('POST', '/api/v2/search/terms',\
    \ body)\n    }\n\n    if (version === 'v1' && res.response_code !== 0) {\n   \
    \     return entryError(res.response_code, res.response.error);\n    }\n\n   \
    \ var result = version === 'v1' ? res.response.result : res.result\n\n    // create\
    \ table from search result\n    var tableMapper = {\n       environmentDescription:\
    \ 'environment description',\n       start_time: 'start time',\n       submitname:\
    \ 'submit name',\n       threatscore: 'threat score',\n       type_short: 'type\
    \ short',\n    };\n\n    var table = result.map(mapObject(tableMapper));\n\n \
    \   // create context from search result\n    var contextMapper;\n    var context;\n\
    \    if (version === 'v1') {\n        contextMapper = {\n            sha1: 'SHA1',\n\
    \            sha256: 'SHA256',\n            md5: 'MD5',\n        };\n\n      \
    \  context = {\n            'File(val.MD5 && val.MD5 == obj.MD5 || val.SHA1 &&\
    \ val.SHA1 == obj.SHA1 || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)),\n\
    \            'VX.Search(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256\
    \ == obj.SHA256)': result.map(mapObject(contextMapper)) //VX.Search context path\
    \ is for backward compatibility\n        };\n    } else { // v2\n        contextMapper\
    \ = {\n            job_id: 'JobID',\n            sha256: 'SHA256',\n         \
    \   environment_id: 'environmentId',\n            threat_score: 'threatscore',\n\
    \            environment_description: 'environmentDescription',\n            submit_name:\
    \ 'submitname',\n            analysis_start_time: 'start_time'\n        };\n\n\
    \        context = {\n            'File(val.JobID && val.JobID == obj.JobID ||\
    \ val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)),\n\
    \            'VX.Search(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256\
    \ == obj.SHA256)': result.map(mapObject(contextMapper)) //VX.Search context path\
    \ is for backward compatibility\n        };\n    }\n\n    result.forEach(function(res)\
    \ {\n       if(res.threatlevel && res.threatlevel > 1) {\n           addMalicious(context,\
    \ outputPaths.file, {\n                MD5: res.md5,\n                SHA1: res.sha1,\n\
    \                SHA256: res.sha256,\n                Malicious: {\n         \
    \           Vendor: 'Falcon Sandbox',\n                    Description: 'Score\
    \ above ' + res.threatscore\n                }\n            });\n       }\n  \
    \  });\n\n    return createTableEntry('Search results:', result, table, context);\n\
    }\n\nfunction translateVerdict(verdict) {\n    var verdictNumber;\n    switch\
    \ (verdict) {\n        case 'Whitelisted':\n            verdictNumber = 1;\n \
    \           break;\n        case 'NoVerdict':\n            verdictNumber = 2;\n\
    \            break;\n        case 'NoSpecificThreat':\n            verdictNumber\
    \ = 3;\n            break;\n        case 'Suspicious':\n            verdictNumber\
    \ = 4;\n            break;\n        case 'Malicious':\n            verdictNumber\
    \ = 4;\n            break;\n    }\n    return verdictNumber;\n}\n\nfunction csResultCmd(hash,\
    \ environmentId, fileType, jobID) {\n    var res = csResult(hash, environmentId,\
    \ fileType, jobID);\n\n    if (res.response_code !== undefined && res.response_code\
    \ !== 0) {\n        return entryError(res.response_code, res.response.error);\n\
    \    }\n\n    if (version === 'v2') {\n        var fileScan = scan(hash);\n  \
    \      return resultEntry(res, fileType, fileScan)\n    } else {\n        return\
    \ res;\n    }\n}\n\nfunction csResult(hash, environmentId, fileType, jobID) {\n\
    \    var csID;\n    if (version === 'v2') {\n        if (hash && environmentId){\n\
    \            csID = hash + ':' + environmentId;\n        } else if (jobID) {\n\
    \            csID = jobID;\n        } else {\n            return 'Job ID or SHA256\
    \ and environment ID are required.'\n        }\n    }\n    var cmdUrl = (version\
    \ === 'v1') ? '/api/result/' + hash + '?type=json&environmentId=' + args.environmentId\
    \ : '/api/v2/report/' + csID + '/file/' + fileType;\n    return sendRequest('GET',\
    \ cmdUrl);\n}\n\nfunction resultEntry(result, fileType, scan) {\n    var currentTime\
    \ = new Date();\n    var filename =  'CrowdStrike_report_' + currentTime.getTime();\n\
    \    switch (fileType) {\n        case 'pcap':\n        case 'bin':\n        case\
    \ 'xml':\n        case 'html':\n            filename += '.gz';\n            break;\n\
    \        case 'json':\n            filename += '.json';\n            result =\
    \ JSON.stringify(result);\n            break;\n        case 'misp':\n        case\
    \ 'stix':\n            filename += '.xml';\n            break;\n        case 'pdf':\n\
    \            filename += '.pdf';\n    }\n    ec = {\n        DBotScore: {\n  \
    \          Indicator: scan[0].sha256,\n            Type: 'hash',\n           \
    \ Vendor: 'CrowdStrike Falcon Sandbox',\n            Score: translateScore(scan[0]['threat_level'])\n\
    \        }\n    }\n    return {\n        Type: 9,\n        FileID: saveFile(result),\n\
    \        File: filename,\n        Contents: filename,\n        EntryContext: ec\n\
    \    };\n}\n\nfunction translateScore(score) {\n    /* Translates CS threat level\
    \ to DBot Score */\n    var scoreObject = {\n        3: 0,\n        2: 3,\n  \
    \      1: 2,\n        0: 1\n    }\n    if (score in scoreObject) {\n        return\
    \ scoreObject[score];\n    } else {\n        return 0;\n    }\n}\n\nfunction detonateFile(entryId,\
    \ delay, timeout) {\n    var environmentId;\n    if (args.environmentID) {\n \
    \       environmentId = args.environmentID;\n    } else {\n        var environments\
    \ = getEnvironments();\n        if ('environment' in environments) { // Single-server\
    \ setup\n            environments = environments.environment;\n        } else\
    \ { // Multi-server setup\n            environments = environments.backend.global_environment;\n\
    \        }\n        for (var i=0; i<environments.length; i++) {\n            if\
    \ (environments[i]['ID'] === 100) {\n                environmentId = 100;\n  \
    \              break;\n             } else if (environments[i]['architecture'].toLowerCase()\
    \ === 'windows') {\n                environmentId = environments[i]['ID'];\n \
    \               break;\n            }\n        }\n    }\n    if (!environmentId)\
    \ {\n        throw 'No environment ID was given'\n    }\n    var file = submitFile(entryId,\
    \ environmentId.toString());\n    var hash = file.SHA256;\n\n    delayTime = parseInt(delay);\n\
    \    timeOut = parseInt(timeout);\n    var waitTime = delayTime;\n\n    wait(delayTime);\n\
    \    while (waitTime<timeOut) {\n        var res = scan(hash);\n        if ((version\
    \ === 'v1' && res.response.length > 0 && res.response[0]) || (version === 'v2'\
    \ && res.length > 0)) {\n            return scanToEntry(res, hash);\n        }\
    \ else {\n            waitTime = waitTime + delayTime;\n            wait(delayTime);\n\
    \        }\n    }\n    throw ('Timeout due to no answer after ' + timeOut + '\
    \ seconds.');\n}\n\nfunction submitUrlCmd(url, environmentID) {\n    if (version\
    \ === 'v1') {\n        throw 'This command is supported only in API v2.'\n   \
    \ }\n    var response = submitUrl(url, environmentID);\n    var context = {\n\
    \        'File(val.hash && val.hash === obj.hash)': {\n            'SHA256': response['sha256'],\n\
    \            'hash': response['sha256']\n        },\n        'CrowdStrike(val.JobID\
    \ && val.JobID === obj.JobID)': {\n            'EnvironmentID': response['environment_id'],\n\
    \            'JobID': response['job_id']\n        }\n    };\n    var title = 'URL\
    \ ' + url + ' was submitted for analysis on CrowdStrike Falcon Sandbox';\n   \
    \ return createTableEntry(title, response, response, context);\n}\n\nfunction\
    \ submitUrl(url, environmentID) {\n    var cmdUrl = '/api/v2/submit/url-for-analysis';\n\
    \    var body = 'url=' + encodeURIComponent(url) + '&environment_id=' + environmentID;\n\
    \    HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];\n    return\
    \ sendRequest('POST', cmdUrl, body);\n}\n\nfunction getScreenshotsCmd(file, environmentID,\
    \ jobID) {\n    if (version === 'v1') {\n        throw 'This command is supported\
    \ only in API v2.'\n    }\n    var response = getScreenshots(file, environmentID,\
    \ jobID);\n    var images = [];\n    for (var i = 0; i < response.length; i++)\
    \ {\n        images.push({\n            Type: entryTypes.note,\n            ContentsFormat:\
    \ formats.json,\n            Contents: '',\n            ReadableContentsFormat:\
    \ formats.markdown,\n            HumanReadable: '![](data:image/png;base64,' +\
    \ response[i]['image'] + ')'\n        });\n    }\n    return images\n}\n\nfunction\
    \ getScreenshots(file, environmentID, jobID) {\n    var csID;\n    if (file &&\
    \ environmentID){\n        csID = file + ':' + environmentID;\n    } else if (jobID)\
    \ {\n        csID = jobID;\n    } else {\n        return 'Job ID or SHA256 and\
    \ environment ID are required.'\n    }\n    var cmdUrl = '/api/v2/report/' + csID\
    \ +'/screenshots';\n    return sendRequest('GET', cmdUrl);\n}\n\nfunction file(hash)\
    \ {\n    args.context = hash;\n    delete args.file;\n    return searchQuery();\n\
    }\n\nfunction detonateUrl(url, delay, timeout, fileType) {\n    if (version ===\
    \ 'v1') {\n        throw 'This command is supported only in API v2.'\n    }\n\
    \    var environmentId;\n    if (args.environmentID) {\n        environmentId\
    \ = args.environmentID;\n    } else {\n        var environments = getEnvironments();\n\
    \        if ('environment' in environments) { // Single-server setup\n       \
    \     environments = environments.environment;\n        } else { // Multi-server\
    \ setup\n            environments = environments.backend.global_environment;\n\
    \        }\n        for (var i=0; i<environments.length; i++) {\n            if\
    \ (environments[i]['ID'] === 100) {\n                environmentId = 100;\n  \
    \              break;\n             } else if (environments[i]['architecture'].toLowerCase()\
    \ === 'windows') {\n                environmentId = environments[i]['ID'];\n \
    \               break;\n\n            }\n        }\n    }\n    if (!environmentId)\
    \ {\n        throw 'No environment ID was given'\n    }\n    var jobId = submitUrl(url,\
    \ environmentId);\n    delayTime = parseInt(delay);\n    timeOut = parseInt(timeout);\n\
    \    var waitTime = delayTime;\n\n    wait(delayTime);\n    while (waitTime<timeOut)\
    \ {\n        if (response) {\n            var response = csResult(null, environmentId,\
    \ fileType, jobId);\n            return resultEntry(response, fileType);\n   \
    \     } else {\n            waitTime = waitTime + delayTime;\n            wait(delayTime);\n\
    \        }\n    }\n    throw ('Timeout due to no answer after ' + timeOut + '\
    \ seconds.');\n}\n\nfunction submitFileByUrlCommad(url, environmentID) {\n   \
    \ if (version === 'v1') {\n        throw 'This command is supported only in API\
    \ v2.'\n    }\n    var response = submitFileByUrl(url, environmentID);\n    var\
    \ context = {\n        'File(val.SHA256 && val.SHA256 === obj.SHA256)': {\n  \
    \          'SHA256': response['sha256']\n        },\n        'CrowdStrike(val.JobID\
    \ && val.JobID === obj.JobID)': {\n            'EnvironmentID': response['environment_id'],\n\
    \            'JobID': response['job_id']\n        }\n    };\n    var title = 'File\
    \ ' + url + ' was submitted for analysis on CrowdStrike Falcon Sandbox';\n   \
    \ return createTableEntry(title, response, response, context);\n}\n\nfunction\
    \ submitFileByUrl(url, environmentID) {\n    var cmdUrl = '/api/v2/submit/url-to-file';\n\
    \    var body = 'url=' + url + '&environment_id=' + environmentID;\n    HEADERS['Content-Type']\
    \ = ['application/x-www-form-urlencoded'];\n    return sendRequest('POST', cmdUrl,\
    \ body);\n}\n\nswitch (command) {\n    case 'test-module':\n        args.query\
    \ = 'url:google';\n        var entry = searchQuery();\n        if (entry && entry.Type\
    \ === entryTypes.note) {\n           return 'ok';\n        }\n        return entry\
    \ && entry.Contents;\n    case 'vx-scan': // Deprecated\n    case 'crowdstrike-scan':\n\
    \        var res = scan(args.file);\n        if (res.length > 0){\n          \
    \  return scanToEntry(res, args.file);\n        } else {\n            return {\n\
    \                Type: entryTypes.note,\n                ContentsFormat: formats.json,\n\
    \                Contents: {},\n                ReadableContentsFormat: formats.markdown,\n\
    \                HumanReadable: 'No results found.',\n                EntryContext:\
    \ {\n                    \"File(val.hash==obj.hash)\": {\n                   \
    \ \"state\": \"NO_CONTENT\",\n                    \"hash\": args.file\n      \
    \              }\n                }\n            };\n        }\n    case 'vx-get-environments':\
    \ // Deprecated\n    case 'crowdstrike-get-environments':\n        var response\
    \ = getEnvironments();\n        return tableFromEnvironments(response);\n    case\
    \ 'vx-submit-sample': // Deprecated\n    case 'crowdstrike-submit-sample':\n \
    \       var entry = submitFile(args.entryId, args.environmentID);\n        //\
    \ return entry if type is error\n        if ('Type' in entry && entry['Type']\
    \ === entryTypes.error) {\n            return entry;\n        }\n        return\
    \ submitFileEntry(entry);\n    case 'vx-search': // Deprecated\n    case 'crowdstrike-search':\n\
    \        return searchQuery();\n    case 'vx-result': // Deprecated\n    case\
    \ 'crowdstrike-result':\n        return csResultCmd(args.file, args.environmentId,\
    \ args['file-type'], args.JobID);\n    case 'vx-detonate-file': // Deprecated\n\
    \    case 'crowdstrike-detonate-file':\n        return detonateFile(args.entryId,\
    \ args.delay, args.timeout);\n    case 'crowdstrike-submit-url':\n        return\
    \ submitUrlCmd(args.url, args.environmentID);\n    case 'crowdstrike-get-screenshots':\n\
    \        return getScreenshotsCmd(args.file, args.environmentID, args.JobID);\n\
    \    case 'file':\n        return file(args.file);\n    case 'crowdstrike-detonate-url':\n\
    \        return detonateUrl(args.url, args.delay, args.timeout, args['file-type']);\n\
    \    case 'crowdstrike-submit-file-by-url':\n        return submitFileByUrlCommad(args.url,\
    \ args.environmentID);\n}\n\n"
  type: javascript
tests:
- VxStream Test
- detonate_file_-_generic_test
toversion: 4.1.9
