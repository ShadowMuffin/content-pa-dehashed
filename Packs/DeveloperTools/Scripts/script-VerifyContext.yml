args:
- default: true
  description: Context path (e.g. 'Incidents')
  name: path
  required: true
- description: Comma separated values to verify that are in context (e.g. 'one,two,three')
  name: fields
- description: 'Primitive or JSON expected value of the path context (e.g. ''SomeString'',
    ''{"a": 1, "b": ["hello", "world" ]}'
  name: expectedValue
comment: 'Deprecated, use playbook filters instead.

  Verifies path in context:

  - Verifies path existence

  - If matching object is an array: verify fields exists in each of the objects in
  the array

  - If matching object is not an array: verify fields exists in matching object

  - if ''expectedValue'' is given: ensure that the given value is equal to the context
  path'
commonfields:
  id: VerifyContext
  version: -1
deprecated: true
enabled: true
name: VerifyContext
script: "var path = args.path;\nvar fields = args.fields ? args.fields.split(\",\"\
  ) : [];\nvar expectedValue = args.expectedValue;\n\nvar verifyFields = function(obj)\
  \ {\n    fields.forEach(function (field) {\n        var value = dq(obj, field.trim());\n\
  \        if (value === undefined || value === null) {\n            throw 'Field\
  \ ' + field + ' is missing from ' + JSON.stringify(obj) + '.';\n        }\n    });\n\
  }\n\nvar contextObject = dq(invContext, path);\nif (contextObject === undefined\
  \ || contextObject === null) {\n      throw 'Path ' + path + ' is not in context.';\n\
  }\n\nvar isArray = contextObject instanceof Array;\n\nif (isArray) {\n    contextObject.forEach(verifyFields);\n\
  } else {\n    verifyFields(contextObject);\n}\n\nif (expectedValue) {\n    var value;\n\
  \    try {\n       value = JSON.parse(expectedValue);\n    } catch (e) {\n     \
  \   value = expectedValue;\n    }\n    if (JSON.stringify(value) !== JSON.stringify(contextObject))\
  \ {\n        throw ('Context path ' + path + ' is not equal to expected value. Found:\
  \ ' + JSON.stringify(contextObject) + ', expected: ' + JSON.stringify(value));\n\
  \    }\n}"
scripttarget: 0
tags:
- context
- Utility
tests:
- No test
toversion: 4.1.9
type: javascript
