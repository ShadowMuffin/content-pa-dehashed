category: Analytics & SIEM
commonfields:
  id: RSA NetWitness Security Analytics
  version: -1
configuration:
- defaultvalue: ''
  display: Server Url (192.168.56.101)
  name: url
  required: true
  type: 0
- defaultvalue: ''
  display: Username
  name: username
  required: true
  type: 0
- defaultvalue: ''
  display: Password
  name: password
  required: true
  type: 4
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: RSA Security Analytics is a distributed and modular system that enables
  highly flexible deployment architectures that scale with the needs of the organization.
  Security Analytics allows administrators to collect two types of data from the network
  infrastructure, packet data and log data.
display: RSA NetWitness Security Analytics
fromversion: 2.0.0
image: data:image/png;base64,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
name: RSA NetWitness Security Analytics
script:
  commands:
  - arguments:
    - description: 'If query provided all other parameters ignored. Query should contain
        page, limit, start, sort and filter, joined by &, For example: page=1&start=0&limit=100&sort=[{"property":"created","direction":"DESC"}]&filter=[{"property":"created","value":[851171984031,1482323984031]}]'
      name: query
    - description: The default is 1. Indicates the page number of incidents
      name: page
    - description: The default is 0. Indicates the start index of incident in page
      name: start
    - description: The default is 100. Limits the number of incidents per page
      name: limit
    - description: 'By default sorts by "created" field in "DESC" order. Example:
        "[{\"property\":\"created\",\"direction\":\"DESC\"}]"'
      name: sort
    - description: 'By default filters by "created" from 1996 to this date. Example:
        "[{\"property\":\"id\", \"value\":\"INC-21\"}]"'
      name: filter
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running nw-get-component command.
        If this argument is not filled/passed, the script will automatically get the
        first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    - description: '[optinal boolean] By default alerts and events related to incident
        not loaded. If loadAlerts is true, then command will load all alerts and their
        events from SA. Please be noticed THIS IS HAS PERFORMANCE IMPACT! For each
        alert XHR request send to SA.'
      name: loadAlerts
    deprecated: true
    description: Fetches incidents by filter
    name: nw-list-incidents
  - arguments: []
    description: Logins to the system and returns valid sessionId
    name: nw-login
  - arguments:
    - description: '[optional string] Query must contain page, start, limit'
      name: query
    deprecated: true
    description: Returns all the components in the system
    name: nw-get-components
  - arguments:
    - auto: PREDEFINED
      description: Filter of time range in which events occured
      name: timeRangeType
      predefined:
      - LAST_5_MINUTES
      - LAST_10_MINUTES
      - LAST_15_MINUTES
      - LAST_30_MINUTES
      - LAST_HOUR
      - LAST_3_HOURS
      - LAST_6_HOURS
      - LAST_12_HOURS
      - LAST_24_HOURS
      - LAST_2_DAYS
      - LAST_5_DAYS
      - EARLY_MORNING
      - MORNING
      - AFTERNOON
      - EVENING
      - TODAY
      - YESTERDAY
      - THIS_WEEK
      - LAST_WEEK
      - ALL_DATA
      - CUSTOM
      required: true
    - description: '[number] Id of the device where the events stored/occurred. In
        order to get list of available devices/components run command nw-get-components'
      name: deviceId
      required: true
    - description: '[optional]'
      name: collectionName
    - description: '[optional]'
      name: predicateIds
    - description: '[optional datetime] If timeRangeType defined as CUSTOM, set this
        argument'
      name: startDate
    - description: '[optional datetime] If timeRangeType defined as CUSTOM, set this
        argument'
      name: endDate
    - description: '[optional datetime] Last collection time'
      name: lastCollectionTime
    - description: The unique meta id for this field. If nw-get-events was called
        this will be your starting id for this distinct value
      name: mid1
    - description: The unique meta id for this field. If nw-get-events was called
        this will be your ending id for this distinct value.
      name: mid2
    - description: '[optional guid] Investigation id token'
      name: investigationToken
    - description: '[optional number] Default set to 1. The page number'
      name: page
    - description: '[optional number] Default set to 0. The starting index of event
        in page.'
      name: start
    - description: '[optional number] Default set to 25. Limits the number of events
        per page'
      name: limit
    - description: 'By default sorts by "id" field in "ASC" order. Example: "[{\"property\":\"id\",\"direction\":\"ASC\"}]"'
      name: sort
    - description: '<string> Must provide key value pairs of fieldName and their value
        separated by comma. Example: "ip.src=1.1.1.1,meta.device.type=\"crowdstrike\""'
      name: filter
    deprecated: true
    description: Returns all the events in defined time range
    name: nw-get-events
  - arguments: []
    deprecated: true
    description: Returns the available users to be assigned to incidents
    name: nw-get-available-assignees
    outputs:
    - contextPath: Netwitness.Component.Id
      description: Netwitness User ID
    - contextPath: Netwitness.Component.Name
      description: Netwitness User Name
    - contextPath: Netwitness.Component.Login
      description: Netwitness User Lofin Name
    - contextPath: Netwitness.Component.EmailAddress
      description: Netwitness User Email Address
  - arguments:
    - description: '[string] Short summary of the alert which will be attached to
        incident'
      name: alertSummary
      required: true
    - description: '[optional string] Default set to "50". '
      name: severity
    - description: '[string] The name of the incident.'
      name: name
      required: true
    - description: '[optional string] Set assignee login name if assignee has changed.
        You can execute nw-get-available-assignees to get the list of users. Example:
        demisto123'
      name: assigned
    - description: List of event ids separated by comma [,] must not include spaces
        in it. In order to get list of events you can use nw-get-events
      name: eventList
      required: true
    - description: The id of the device/component (Concentrator, Log Decoder, Packet
        Decoder, etc.) from which the events are. You can view the list of devices
        by executing the command nw-get-components
      name: deviceId
      required: true
    - auto: PREDEFINED
      description: Priority of the incident
      name: priority
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
      required: true
    - description: Summary of the incident
      name: summary
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running nw-get-component command.
        If this argument is not filled/passed, the script will automatically get the
        first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    deprecated: true
    description: Creating new incident
    execution: true
    name: nw-create-incident
  - arguments:
    - default: true
      description: '[string] Existing incident id. '
      name: incidentId
      required: true
    - description: '[array of strings] List of event ids separated by comma [,] must
        not include spaces in it. In order to get list of events you can use nw-get-events.
        Example: "23,12,3"'
      name: eventList
      required: true
    - description: '[string] Short summary of the alert which will be attached to
        incident'
      name: alertSummary
      required: true
    - description: '[number] Severity of the incident. Example: 50'
      name: severity
      required: true
    - description: '[number] The id of the device/component (Concentrator, Log Decoder,
        Packet Decoder, etc.) from which the events are. You can view the list of
        devices by executing the command nw-get-components'
      name: deviceId
      required: true
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running nw-get-component command.
        If this argument is not filled/passed, the script will automatically get the
        first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    deprecated: true
    description: This command will add new events to existing incident
    execution: true
    name: nw-add-events-to-incident
  - arguments:
    - description: 'List of incident ids which will be updated, separated by comma
        [,]. Must not contain spaces. Example: "INC-13,INC-15,INC-23"'
      name: idList
      required: true
    - description: '[optional string] Set name if incident name has been changed'
      name: name
    - description: '[optional string] Updated incident summary'
      name: summary
    - description: '[optional string] Set assignee login name if assignee has changed.
        You can execute nw-get-available-assignees to get the list of users. Example:
        demisto123'
      name: assignee
    - description: '[optional string] Add a journal entry describing your changes'
      name: comment
    - auto: PREDEFINED
      description: '[optional status] Set status if changed'
      name: status
      predefined:
      - NEW
      - ASSIGNED
      - IN_PROGRESS
      - REMEDIATION_REQUESTED
      - REMEDIATION_COMPLETED
      - CLOSED
      - CLOSED_FALSE_POSITIVE
    - auto: PREDEFINED
      description: '[optional priority] Set priority if incident priority has been
        changed'
      name: priority
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
    - description: List of categories.
      name: categories
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running nw-get-component command.
        If this argument is not filled/passed, the script will automatically get the
        first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    deprecated: true
    description: Updates incident
    execution: true
    name: nw-update-incident
  - arguments: []
    description: Simulates fetching incidents. Returns array of incidents from NetWitness.
    name: fetch-incidents
  - arguments:
    - description: The default is 1. Indicates the page number of incidents
      name: page
    - description: The default is 0. Indicates the start index of incident in page
      name: start
    - description: The default is 100. Limits the number of incidents per page
      name: limit
    - description: 'By default sorts by "alert.timestamp" field in "DESC" order. Example:
        "[{\"property\":\"alert.timestamp\",\"direction\":\"DESC\"}]"'
      name: sort
    - description: 'By default filters by "alert.timestamp" from 1996 to this date.
        Example: "[{\"property\":\"incidentId\", \"value\":\"INC-21\"}]"'
      name: filter
    deprecated: true
    description: Return all the alerts filtered by filter.
    name: nw-get-alerts
  - arguments:
    - description: Alert id
      name: alertId
      required: true
    deprecated: true
    description: Return single alert by id
    name: nw-get-alert-details
  - arguments:
    - description: '[number] Id of the device where the events stored/occurred. In
        order to get list of available devices/components run command nw-get-components'
      name: deviceId
      required: true
    - description: '[number] Id of the event'
      name: eventId
      required: true
    deprecated: true
    description: Returns two entries. One is event details json and the second is
      event/session content
    name: nw-get-event-details
  - arguments:
    - default: true
      description: '[number] ID of incident. Example: "INC-12"'
      name: incidentId
      required: true
    deprecated: true
    description: Returns incident json by id
    name: nw-get-incident-details
  - arguments:
    - default: true
      description: Id of the alert
      name: alertId
      required: true
    deprecated: true
    description: Returns the original events which this alert contains
    name: nw-get-alert-original
  - arguments:
    - description: 'If query provided all other parameters ignored. Query should contain
        page, limit, start, sort and filter, joined by &, For example: page=1&start=0&limit=100&sort=[{"property":"created","direction":"DESC"}]&filter=[{"property":"created","value":[851171984031,1482323984031]}]'
      name: query
    - description: The default is 1. Indicates the page number of incidents
      name: page
    - description: The default is 0. Indicates the start index of incident in page
      name: start
    - description: The default is 100. Limits the number of incidents per page
      name: limit
    - description: 'By default sorts by "created" field in "DESC" order. Example:
        "[{\"property\":\"created\",\"direction\":\"DESC\"}]"'
      name: sort
    - description: 'By default filters by "created" from 1996 to this date. Example:
        "[{\"property\":\"id\", \"value\":\"INC-21\"}]"'
      name: filter
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running netwitness-im-get-component
        command. If this argument is not filled/passed, the script will automatically
        get the first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    - description: '[optinal boolean] By default alerts and events related to incident
        not loaded. If loadAlerts is true, then command will load all alerts and their
        events from SA. Please be noticed THIS IS HAS PERFORMANCE IMPACT! For each
        alert XHR request send to SA.'
      name: loadAlerts
    description: Fetches incidents by filter
    name: netwitness-im-list-incidents
    outputs:
    - contextPath: Netwitness.Incident.Id
      description: Netwitness Incident ID
    - contextPath: Netwitness.Incident.Name
      description: Netwitness Incident Name
    - contextPath: Netwitness.Incident.Priority
      description: Netwitness Incident Priority
    - contextPath: Netwitness.Incident.CreatedBy
      description: User who created Netwitness Incident
    - contextPath: Netwitness.Incident.Summary
      description: Netwitness Incident Summary
    - contextPath: Netwitness.Incident.Assignee
      description: User Assigned To Incident
    - contextPath: Netwitness.Incident.Created
      description: Time of Incident Creation
    - contextPath: Netwitness.Incident.FirstAlertTime
      description: Time of Incident Creation
    - contextPath: Netwitness.Incident.LastUpdatedByUserName
      description: User who was last to update Incident
    - contextPath: Netwitness.Incident.RiskScore
      description: Netwitness Incident Risk Score
    - contextPath: Netwitness.Incident.AverageAlertRiskScore
      description: Netwitness Incident Average Risk Score
    - contextPath: Netwitness.Incident.Categories
      description: Netwitness Incident Category
    - contextPath: Netwitness.Incident.AlertCount
      description: Netwitness Incident Alerts Counts
  - arguments: []
    description: Logins to the system and returns valid sessionId
    name: netwitness-im-login
  - arguments:
    - description: '[optional string] Query must contain page, start, limit'
      name: query
    description: Returns all the components in the system
    name: netwitness-im-get-components
    outputs:
    - contextPath: Netwitness.Component.Id
      description: Netwitness Component ID
    - contextPath: Netwitness.Component.DisplayName
      description: Netwitness Component DisplayName
    - contextPath: Netwitness.Component.DeviceVersion
      description: Netwitness Component Device Version
    - contextPath: Netwitness.Component.DisplayType
      description: Netwitness Component Device Type
    - contextPath: Netwitness.Component.Host
      description: Netwitness Component Device Host
    - contextPath: Netwitness.Component.Port
      description: Netwitness Component Device Port
    - contextPath: Netwitness.Component.Validated
      description: Netwitness Component is passed validation
    - contextPath: Netwitness.Component.Licensed
      description: Netwitness Component license
    - contextPath: Netwitness.Component.Username
      description: Netwitness Component User Name
    - contextPath: Netwitness.Component.EnableSSL
      description: Netwitness Component Enable SSL
  - arguments:
    - auto: PREDEFINED
      description: Filter of time range in which events occured
      name: timeRangeType
      predefined:
      - LAST_5_MINUTES
      - LAST_10_MINUTES
      - LAST_15_MINUTES
      - LAST_30_MINUTES
      - LAST_HOUR
      - LAST_3_HOURS
      - LAST_6_HOURS
      - LAST_12_HOURS
      - LAST_24_HOURS
      - LAST_2_DAYS
      - LAST_5_DAYS
      - EARLY_MORNING
      - MORNING
      - AFTERNOON
      - EVENING
      - TODAY
      - YESTERDAY
      - THIS_WEEK
      - LAST_WEEK
      - ALL_DATA
      - CUSTOM
      required: true
    - description: '[number] Id of the device where the events stored/occurred. In
        order to get list of available devices/components run command netwitness-im-get-components'
      name: deviceId
      required: true
    - description: '[optional]'
      name: collectionName
    - description: '[optional]'
      name: predicateIds
    - description: '[optional datetime] If timeRangeType defined as CUSTOM, set this
        argument'
      name: startDate
    - description: '[optional datetime] If timeRangeType defined as CUSTOM, set this
        argument'
      name: endDate
    - description: '[optional datetime] Last collection time'
      name: lastCollectionTime
    - description: The unique meta id for this field. If nw-get-events was called
        this will be your starting id for this distinct value
      name: mid1
    - description: The unique meta id for this field. If nw-get-events was called
        this will be your ending id for this distinct value.
      name: mid2
    - description: '[optional guid] Investigation id token'
      name: investigationToken
    - description: '[optional number] Default set to 1. The page number'
      name: page
    - description: '[optional number] Default set to 0. The starting index of event
        in page.'
      name: start
    - description: '[optional number] Default set to 25. Limits the number of events
        per page'
      name: limit
    - description: 'By default sorts by "id" field in "ASC" order. Example: "[{\"property\":\"id\",\"direction\":\"ASC\"}]"'
      name: sort
    - description: '<string> Must provide key value pairs of fieldName and their value
        separated by comma. Example: "ip.src=1.1.1.1,meta.device.type=\"crowdstrike\""'
      name: filter
    description: Returns all the events in defined time range
    name: netwitness-im-get-events
  - arguments: []
    description: Returns the available users to be assigned to incidents
    name: netwitness-im-get-available-assignees
    outputs:
    - contextPath: Netwitness.Account.Id
      description: Netwitness Account ID
    - contextPath: Netwitness.Account.Name
      description: Netwitness Account Name
    - contextPath: Netwitness.Account.Login
      description: Netwitness Account Login Name
    - contextPath: Netwitness.Account.EmailAddress
      description: Netwitness Account Email Address
  - arguments:
    - description: '[string] Short summary of the alert which will be attached to
        incident'
      name: alertSummary
      required: true
    - description: '[optional string] Default set to "50". '
      name: severity
    - description: '[string] The name of the incident.'
      name: name
      required: true
    - description: '[optional string] Set assignee login name if assignee has changed.
        You can execute netwitness-im-get-available-assignees to get the list of users.
        Example: demisto123'
      name: assigned
    - description: List of event ids separated by comma [,] must not include spaces
        in it. In order to get list of events you can use netwitness-im-get-events
      name: eventList
      required: true
    - description: The id of the device/component (Concentrator, Log Decoder, Packet
        Decoder, etc.) from which the events are. You can view the list of devices
        by executing the command netwitness-im-get-components
      name: deviceId
      required: true
    - auto: PREDEFINED
      description: Priority of the incident
      name: priority
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
      required: true
    - description: Summary of the incident
      name: summary
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running netwitness-im-get-component
        command. If this argument is not filled/passed, the script will automatically
        get the first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    description: Creating new incident
    execution: true
    name: netwitness-im-create-incident
    outputs:
    - contextPath: Netwitness.Incident.Id
      description: Netwitness Incident ID
    - contextPath: Netwitness.Incident.Name
      description: Netwitness Incident Name
    - contextPath: Netwitness.Incident.Priority
      description: Netwitness Incident Priority
    - contextPath: Netwitness.Incident.CreatedBy
      description: User who created Netwitness.Incident
    - contextPath: Netwitness.Incident.AlertIDList
      description: Alerts which rised by incident
  - arguments:
    - default: true
      description: '[string] Existing incident id. '
      name: incidentId
      required: true
    - description: '[array of strings] List of event ids separated by comma [,] must
        not include spaces in it. In order to get list of events you can use netwitness-im-get-events.
        Example: "23,12,3"'
      name: eventList
      required: true
    - description: '[string] Short summary of the alert which will be attached to
        incident'
      name: alertSummary
      required: true
    - description: '[number] Severity of the incident. Example: 50'
      name: severity
      required: true
    - description: '[number] The id of the device/component (Concentrator, Log Decoder,
        Packet Decoder, etc.) from which the events are. You can view the list of
        devices by executing the command netwitness-im-get-components'
      name: deviceId
      required: true
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running netwitness-im-get-component
        command. If this argument is not filled/passed, the script will automatically
        get the first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    description: This command will add new events to existing incident
    execution: true
    name: netwitness-im-add-events-to-incident
  - arguments:
    - description: 'List of incident ids which will be updated, separated by comma
        [,]. Must not contain spaces. Example: "INC-13,INC-15,INC-23"'
      name: idList
      required: true
    - description: '[optional string] Set name if incident name has been changed'
      name: name
    - description: '[optional string] Updated incident summary'
      name: summary
    - description: '[optional string] Set assignee login name if assignee has changed.
        You can execute netwitness-im-get-available-assignees to get the list of users.
        Example: demisto123'
      name: assignee
    - description: '[optional string] Add a journal entry describing your changes'
      name: comment
    - auto: PREDEFINED
      description: '[optional status] Set status if changed'
      name: status
      predefined:
      - NEW
      - ASSIGNED
      - IN_PROGRESS
      - REMEDIATION_REQUESTED
      - REMEDIATION_COMPLETED
      - CLOSED
      - CLOSED_FALSE_POSITIVE
    - auto: PREDEFINED
      description: '[optional priority] Set priority if incident priority has been
        changed'
      name: priority
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
    - description: List of categories.
      name: categories
    - description: '[optional number] This is the id of NetWitness INCIDENT_MANAGEMENT
        device/component id. It can be received by running netwitness-im-get-component
        command. If this argument is not filled/passed, the script will automatically
        get the first device of type INCIDENT_MANAGEMENT from the SA server.'
      name: incidentManagementId
    description: Updates incident
    execution: true
    name: netwitness-im-update-incident
  - arguments:
    - description: The default is 1. Indicates the page number of incidents
      name: page
    - description: The default is 0. Indicates the start index of incident in page
      name: start
    - description: The default is 100. Limits the number of incidents per page
      name: limit
    - description: 'By default sorts by "alert.timestamp" field in "DESC" order. Example:
        "[{\"property\":\"alert.timestamp\",\"direction\":\"DESC\"}]"'
      name: sort
    - description: 'By default filters by "alert.timestamp" from 1996 to this date.
        Example: "[{\"property\":\"incidentId\", \"value\":\"INC-21\"}]"'
      name: filter
    description: Return all the alerts filtered by filter.
    name: netwitness-im-get-alerts
  - arguments:
    - description: Alert id
      name: alertId
      required: true
    description: Return single alert by id
    name: netwitness-im-get-alert-details
    outputs:
    - contextPath: Netwitness.Alert.Id
      description: Netwitness Alert ID
    - contextPath: Netwitness.Alert.Name
      description: Netwitness Alert Name
    - contextPath: Netwitness.Alert.IncidentId
      description: Id of Incident which caused to Alert
    - contextPath: Netwitness.Alert.Timestamp
      description: Time of Alert
    - contextPath: Netwitness.Alert.HostSummary
      description: Netwitness Alert Summary
    - contextPath: Netwitness.Alert.SignatureId
      description: Singnature Id of Alert
    - contextPath: Netwitness.Alert.Source
      description: Score of Alert
    - contextPath: Netwitness.Alert.Type
      description: Type of Alert
    - contextPath: Netwitness.Alert.RiskScore
      description: Risk score of Alert
    - contextPath: Netwitness.Alert.SourceCountry
      description: Netwitness Alert Source Country
    - contextPath: Netwitness.Alert.DestinationCountry
      description: Netwitness Alert Destination Country
    - contextPath: Netwitness.Alert.NumEvents
      description: Netwitness Alert Evevts Number
    - contextPath: Netwitness.Alert.SourceIp
      description: Netwitness Alert Source Ip
    - contextPath: Netwitness.Alert.DestonationIp
      description: Netwitness Alert Destonation Ip
    - contextPath: Netwitness.Alert.DestonationPort
      description: Netwitness Alert Destonation Port
  - arguments:
    - description: '[number] Id of the device where the events stored/occurred. In
        order to get list of available devices/components run command netwitness-im-get-components'
      name: deviceId
      required: true
    - description: '[number] Id of the event'
      name: eventId
      required: true
    description: Returns two entries. One is event details json and the second is
    name: netwitness-im-get-event-details
    outputs:
    - contextPath: Netwitness.Event.EventId
      description: Netwitness Event ID
    - contextPath: Netwitness.Event.DeviceId
      description: Netwitness Event Device Id
    - contextPath: Netwitness.Event.ReconstructedContentType
      description: Netwitness Event Reconstructed Content
    - contextPath: Netwitness.Event.PacketsTotal
      description: Total Packets Netwitness Event
    - contextPath: Netwitness.Event.PacketsProcessed
      description: Packets Processed in Current Event
  - arguments:
    - default: true
      description: '[number] ID of incident. Example: "INC-12"'
      name: incidentId
      required: true
    description: Returns incident json by id
    name: netwitness-im-get-incident-details
    outputs:
    - contextPath: Netwitness.Incident.Id
      description: Netwitness Incident ID
    - contextPath: Netwitness.Incident.Name
      description: Netwitness Incident Name
    - contextPath: Netwitness.Incident.Priority
      description: Netwitness Incident Priority
    - contextPath: Netwitness.Incident.CreatedBy
      description: User who created Netwitness Incident
    - contextPath: Netwitness.Incident.Summary
      description: Netwitness Incident Summary
    - contextPath: Netwitness.Incident.Assignee
      description: User Assigned To Incident
    - contextPath: Netwitness.Incident.Created
      description: Time of Incident Creation
    - contextPath: Netwitness.Incident.FirstAlertTime
      description: Time of Incident Creation
    - contextPath: Netwitness.Incident.LastUpdatedByUserName
      description: User who was last to update Incident
    - contextPath: Netwitness.Incident.RiskScore
      description: Netwitness Incident Risk Score
    - contextPath: Netwitness.Incident.AverageAlertRiskScore
      description: Netwitness Incident Average Risk Score
    - contextPath: Netwitness.Incident.Categories
      description: Netwitness Incident Category
    - contextPath: Netwitness.Incident.AlertCount
      description: Netwitness Incident Alerts Counts
  - arguments:
    - default: true
      description: Id of the alert
      name: alertId
      required: true
    description: Returns the original events which this alert contains
    name: netwitness-im-get-alert-original
  isfetch: true
  script: "var url = params.url;\nif (url.indexOf(\"https://\") < 0) {\n    url =\
    \ 'https://' + url;\n}\nvar username = params.username;\nvar password = params.password;\n\
    var proxy = params.proxy || false;\nvar COOKIE_PREFIX = 'RSA_SA_LICENSE=true;\
    \ JSESSIONID=';\n\nfunction FailedRequestError(message, url, query, reqBody, resBody)\
    \ {\n    return {\n        message: message,\n        url: url,\n        query:\
    \ query,\n        reqBody: reqBody,\n        resBody: resBody,\n        toString:\
    \ function() {\n            var error = [\n                message,\n        \
    \        'Request url: ' + url,\n            ];\n\n            if (query) {\n\
    \                error.push('Request query: ' + JSON.stringify(query));\n    \
    \        }\n            if (reqBody) {\n                error.push('Request body:'\
    \ + JSON.stringify(reqBody));\n            }\n\n            error.push('Response:\
    \ ' + resBody);\n\n            return error.join('\\n');\n        }\n    };\n\
    }\n\nfunction escapeRegExp(str) {\n    return str.replace(/([.*+?^=!:${}()|\\\
    [\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\nfunction replaceAll(str, find, replace) {\n\
    \    return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);\n}\n\n\
    function login(url, username, password) {\n    var fullUrl = url + '/j_spring_security_check';\n\
    \    var res = http(\n        fullUrl,\n        {\n            Method: 'POST',\n\
    \            Headers: {\n                'Origin': [url],\n                'Content-Type':\
    \ ['application/x-www-form-urlencoded'],\n                'Referer': [url + '/login']\n\
    \            },\n            Body: 'j_username=' + username + '&j_password=' +\
    \ password\n        },\n        true,\n        proxy,\n        true\n    );\n\n\
    \    if (res.StatusCode !== 302) {\n        throw 'Failed to login with status\
    \ [' + res.StatusCode + ']. Expected status 302. Check username or password. \\\
    nOriginal error: ' + res.Body;\n    }\n\n    var sessionId = null;\n    res.Cookies.forEach(function(cookie)\
    \ {\n        if (cookie.Name === 'JSESSIONID') {\n            sessionId = cookie.Value;\n\
    \        }\n    });\n\n    try {\n        getAvailableAssignees(sessionId);\n\
    \    } catch(err) {\n        throw 'Failed to login! Check username or password.\
    \ Error: ' + err;\n    }\n\n    return sessionId;\n}\n\nfunction logout(url, sessionId)\
    \ {\n    var fullUrl = url + '/j_spring_security_logout';\n\n    var res = http(\n\
    \        fullUrl,\n        {\n            Method: 'GET',\n            Headers:\
    \ {\n                'Origin': [url],\n                'Content-Type': ['application/x-www-form-urlencoded'],\n\
    \                'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n      \
    \  },\n        true,\n        proxy,\n        true\n    );\n\n    if (res.StatusCode\
    \ !== 302) {\n        throw 'Failed to logout with status [' + res.StatusCode\
    \ + ']. Expected status 302.\\nOriginal error: ' + res.Body;\n    }\n}\n\nfunction\
    \ createQuery(args, defaultQuery) {\n    args = args || {};\n    defaultQuery\
    \ = defaultQuery || {};\n    var query = {};\n\n    if (args.page || defaultQuery.page)\
    \ {\n        query.page = args.page || defaultQuery.page;\n    }\n\n    if (args.start\
    \ || defaultQuery.start) {\n        query.start = args.start || defaultQuery.start;\n\
    \    }\n\n    if (args.limit || defaultQuery.limit) {\n        query.limit = args.limit\
    \ || defaultQuery.limit;\n    }\n\n    if (args.sort || defaultQuery.sort) {\n\
    \        query.sort = args.sort || defaultQuery.sort;\n    }\n\n    if (args.filter\
    \ || defaultQuery.filter) {\n        query.filter = args.filter || defaultQuery.filter;\n\
    \    }\n\n    return query;\n}\n\nfunction createQueryFromString(q) {\n    if\
    \ (!q.match(/(.*=.*&)*(.*=.*)/)) {\n        throw 'invalid query. query must be\
    \ of structure: key1=value1&key2=value2&keyN=valueN';\n    }\n    var query =\
    \ replaceAll(q, '\\\"', '\"')\n        .split('&')\n        .reduce(function(qArgs,\
    \ nextArg) {\n            var na = nextArg.split('=');\n            var argKey\
    \ = na[0];\n            var argValue = na[1];\n            qArgs[argKey] = argValue;\n\
    \            return qArgs;\n        }, {});\n\n    return query;\n}\n\nvar defaultIncidentFilter\
    \ = {\n    page: 1,\n    start: 0,\n    limit: 50,\n    sort: JSON.stringify([\n\
    \        {\n            property:'created',\n            direction: 'DESC'\n \
    \       }\n    ]),\n    filter: JSON.stringify([\n        {\n            property:\
    \ 'created',\n            value: [\n                851171984031, // year 1996\n\
    \                new Date().getTime()\n            ]\n        }\n    ])\n};\n\n\
    function listIncidents(sessionId, args, incidentManagementId) {\n    var fullUrl\
    \ = url + '/ajax/incidents/' + incidentManagementId;\n    var query = {};\n  \
    \  if (args.query) {\n        query = createQueryFromString(args.query);\n   \
    \ } else {\n        query = createQuery(args, defaultIncidentFilter);\n    }\n\
    \n    fullUrl += encodeToURLQuery(query);\n\n    var res = http(\n        fullUrl,\n\
    \        {\n            Method: 'GET',\n            Headers: {\n             \
    \   'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n        },\n       \
    \ true,\n        proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        throw 'Failed to fetch incidents with status [' + res.StatusCode\
    \ + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try {\n        incidentsRes\
    \ = JSON.parse(res.Body);\n        if (incidentsRes.success) {\n            var\
    \ incidents = incidentsRes.data;\n            if (!args.loadAlerts) {\n      \
    \          return incidents;\n            }\n\n            // loading all the\
    \ alerts which related to incident\n            // we load the alerts and original\
    \ alerts which contains the original events which the alert created from\n   \
    \         // this has performance impact\n            for (var i = 0; i < incidents.length;\
    \ i++) {\n                var alerts = filterAlerts(sessionId, {\n           \
    \         filter: JSON.stringify([\n                        {\n              \
    \              property: 'incidentId',\n                            value: incidents[i].id\n\
    \                        }\n                    ])\n                })\n     \
    \           incidents[i].alerts = [];\n                alerts.forEach(function(alert)\
    \ {\n                    var originalAlert = getOriginalAlertById(sessionId, {\
    \ alertId: alert.id });\n                    incidents[i].alerts.push({\n    \
    \                    alert: alert,\n                        orignalAlert: originalAlert\n\
    \                    });\n                });\n            }\n\n            return\
    \ incidents;\n        } else {\n            throw FailedRequestError('Fetch incidents\
    \ failed.', fullUrl, query, null, incidentsRes).toString();\n        }\n    }\
    \ catch (err) {\n        throw FailedRequestError('Unexpected error while fetching\
    \ incidents. \\nOriginal error: ' + err, fullUrl, query, null, res.Body).toString();\n\
    \    }\n}\n\nfunction fetchIncidents(sessionId, args, incidentManagementId) {\n\
    \    var now = new Date().getTime();\n    var lastRun = getLastRun().lastRun ||\
    \ now - 1*60*1000; // last minute\n    var lastRunNext = lastRun;\n\n    var tillNow\
    \ = now;\n    var query = {\n        loadAlerts: true,\n        page: 1,\n   \
    \     start: 0,\n        limit: 50,\n        filter: JSON.stringify([{\n     \
    \       property: 'created',\n            value: [\n                lastRun,\n\
    \                tillNow\n            ]\n        }])\n    };\n\n    // TODO handle\
    \ paging. If number of incidents are more than 50, then we need to\n    // fetch\
    \ the next pages too.\n    var lastIncidents = listIncidents(sessionId, query,\
    \ incidentManagementId);\n    var convertedIncidents = [];\n    for (var i = 0;\
    \ i < lastIncidents.length; i++) {\n        var inc = lastIncidents[i];\n    \
    \    if (inc.created > lastRunNext) {\n            // we get the last incident\
    \ which created\n            lastRunNext = inc.created + 1;\n        }\n\n   \
    \     convertedIncidents.push({\n            name: inc.id,\n            occurred:\
    \ new Date(inc.firstAlertTime),\n            owner: inc.assignee ? inc.assignee.login\
    \ : '',\n            reason: inc.name,\n            rawJSON: JSON.stringify(inc)\n\
    \        });\n    }\n\n    setLastRun({ lastRun: lastRunNext });\n    return JSON.stringify(convertedIncidents);\n\
    }\n\nfunction getIncidentById(sessionId, args, incidentManagementId) {\n    var\
    \ fullUrl = [\n        url,\n        'ajax/incident',\n        incidentManagementId,\n\
    \        args.incidentId\n    ].join('/');\n\n    var res = http(\n        fullUrl,\n\
    \        {\n            Method: 'GET',\n            Headers: {\n             \
    \   'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n        },\n       \
    \ true,\n        proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        throw 'Failed to get incident by id with status [' + res.StatusCode\
    \ + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try {\n        incident\
    \ = JSON.parse(res.Body);\n        if (incident.success) {\n            return\
    \ incident.data;\n        } else {\n            throw FailedRequestError('Fetch\
    \ incident by id failed.', fullUrl, null, null, incident).toString();\n      \
    \  }\n    } catch (err) {\n        throw FailedRequestError('Unexpected error\
    \ while fetching incident by id. \\nOriginal error: ' + err, fullUrl, null, null,\
    \ res.Body).toString();\n    }\n}\n\nvar defaultComponentFilter = {\n    page:\
    \ 1,\n    start: 0,\n    limit: 1000,\n    sort: replaceAll(JSON.stringify([\n\
    \        {\n            property: 'displayName',\n            direction: 'ASC'\n\
    \        }\n    ]), '\\\"', '\"')\n};\n\nfunction getComponents(sessionId, argz,\
    \ types) {\n    var fullUrl = url + '/common/devices';\n    var query = {};\n\
    \    if (argz.query) {\n        query = createQueryFromString(argz.query);\n \
    \   } else {\n        query = createQuery(argz, defaultComponentFilter);\n   \
    \ }\n    fullUrl += types ? '/types/' + types.join('/') : '';\n    fullUrl +=\
    \ encodeToURLQuery(query);\n\n    var res = http(\n        fullUrl,\n        {\n\
    \            Method: 'GET',\n            Headers: {\n                'Cookie':\
    \ [COOKIE_PREFIX + sessionId]\n            }\n        },\n        true,\n    \
    \    proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n\
    \        throw 'Failed to fetch components with status [' + res.StatusCode + '].\
    \ \\nOriginal error: ' + res.Body;\n    }\n\n    try {\n        components = JSON.parse(res.Body);\n\
    \        if (components.success) {\n            return components.data;\n    \
    \    } else {\n            throw FailedRequestError('Fetch components failed.',\
    \ fullUrl, query, null, components).toString();\n        }\n    } catch (err)\
    \ {\n        throw FailedRequestError('Unexpected error when fetching components.\
    \ \\nOriginal error: ' + err, fullUrl, query, null, res.Body).toString();\n  \
    \  }\n}\n\nfunction getIncidentManagementId(sessionId) {\n    var incidentManagement\
    \ = getComponents(sessionId, {}, ['INCIDENT_MANAGEMENT']);\n\n    if (!incidentManagement\
    \ || incidentManagement.length === 0) {\n        throw 'Failed to find RSA NetWitness\
    \ INCIDENT_MANAGEMENT component/device: ' + JSON.stringify(incidentManagement);\n\
    \    }\n\n    return incidentManagement[0].id;\n}\n\nfunction createEventsQuery(args,\
    \ predicateIds) {\n    args = args || {};\n    var query = {};\n\n    query.deviceId\
    \ = args.deviceId;\n    query.collectionName = args.collectionName || '';\n  \
    \  query.predicateIds = predicateIds ? predicateIds.join(',') : '';\n    query.timeRangeType\
    \ = args.timeRangeType;\n    query.startDate = args.startDate || '';\n    query.endDate\
    \ = args.endDate || '';\n    query.lastCollectionTime = args.lastCollectionTime\
    \ || '';\n    query.mid1 = args.mid1 || 0;\n    query.mid2 = args.mid2 || 0;\n\
    \    query.investigationToken = args.investigationToken || '';\n    query.page\
    \ = args.page || 1;\n    query.start = args.start || 0;\n    query.limit = args.limit\
    \ || 25;\n    query.sort = args.sort\n        ? replaceAll(args.sort, '\\\"',\
    \ '\"')\n        : JSON.stringify([\n            {\n                property:\
    \ 'id',\n                direction: 'ASC'\n            }\n        ]);\n\n    return\
    \ query;\n}\nfunction getEvents(sessionId, args) {\n    var predicateIds = [];\n\
    \    if (args.filter) {\n        var eventsViewHTML = getEventsViewHtml(sessionId);\n\
    \        var csrfToken = extractCsrfTokenFromHTML(eventsViewHTML);\n        var\
    \ filters = args.filter.split(',');\n        for (var i = 0; i < filters.length;\
    \ i++) {\n            var predicate = postEventsTransient(sessionId, filters[i],\
    \ csrfToken);\n            predicateIds.push(predicate);\n        }\n    }\n \
    \   var query = createEventsQuery(args, predicateIds);\n    var fullUrl = url\
    \ + '/ajax/investigation/events' + encodeToURLQuery(query);\n\n    var res = http(\n\
    \        fullUrl,\n        {\n            Method: 'GET',\n            Headers:\
    \ {\n                'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n  \
    \      },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode < 200\
    \ || res.StatusCode >= 300) {\n        throw 'Failed to fetch events with status\
    \ [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try\
    \ {\n        events = JSON.parse(res.Body);\n        if (events.success) {\n \
    \           return events.data;\n        } else {\n            throw FailedRequestError('Fetch\
    \ events failed.', fullUrl, query, null, events).toString();\n        }\n    }\
    \ catch (err) {\n        throw FailedRequestError('Unexpected while fetching events.\
    \ \\nOriginal error: ' + err, fullUrl, query, null, res.Body).toString();\n  \
    \  }\n}\nfunction postEventsTransient(sessionId, query, ctoken) {\n    var fullUrl\
    \ = url + '/predicates/transient';\n    var body = {\n        name: query,\n \
    \       query: query,\n        ctoken: ctoken\n    };\n    var res = http(\n \
    \       fullUrl,\n        {\n            Method: 'POST',\n            Headers:\
    \ {\n                'Cookie': [COOKIE_PREFIX + sessionId],\n                'Content-Type':\
    \ ['application/x-www-form-urlencoded']\n            },\n            Body: encodeToURLQuery(body).replace(/^\\\
    ?/, '')\n        },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Failed to fetch events with\
    \ status [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n    }\n\n\
    \    try {\n        transient = JSON.parse(res.Body);\n        if (transient.success)\
    \ {\n            return transient.object;\n        } else {\n            throw\
    \ FailedRequestError('Posting transient for events failed.', fullUrl, null, body,\
    \ transient).toString();\n        }\n    } catch (err) {\n        throw FailedRequestError('Unexpected\
    \ while posting transient for events. \\nOriginal error: ' + err, fullUrl, null,\
    \ body, res.Body).toString();\n    }\n}\n\nfunction getEventDetails(sessionId,\
    \ args) {\n    var fullUrl = url + '/investigation/reconstruct/event';\n    var\
    \ eventsViewHTML = getEventsViewHtml(sessionId);\n    var csrfToken = extractCsrfTokenFromHTML(eventsViewHTML);\n\
    \n    var body = {\n        deviceId: args.deviceId,\n        collectionName:\
    \ args.collectionName || '',\n        eventId: args.eventId,\n        contentType:\
    \ 'AUTO',\n        contentSide: 'REQUEST_AND_RESPONSE',\n        contentLayout:\
    \ 'TOP_TO_BOTTOM',\n        packetOverride: -1,\n        ctoken: csrfToken\n \
    \   };\n    var res = http(\n        fullUrl,\n        {\n            Method:\
    \ 'POST',\n            Headers: {\n                'Cookie': [COOKIE_PREFIX +\
    \ sessionId],\n                'Content-Type': ['application/x-www-form-urlencoded']\n\
    \            },\n            Body: encodeToURLQuery(body).replace(/^\\?/, '')\n\
    \        },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode <\
    \ 200 || res.StatusCode >= 300) {\n        throw 'Failed to fetch event with status\
    \ [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try\
    \ {\n        event = JSON.parse(res.Body);\n        if (event.success) {\n   \
    \         var content = getEventContent(sessionId, event.data.uri);\n        \
    \    return {data: event.data, content: content};\n        } else {\n        \
    \    throw FailedRequestError('Fetching event details', fullUrl, null, body, event).toString();\n\
    \        }\n    } catch (err) {\n        throw FailedRequestError('Unexpected\
    \ while fetching event details. \\nOriginal error: ' + err, fullUrl, null, body,\
    \ res.Body).toString();\n    }\n}\n\n// Returns events/session data content.\n\
    function getEventContent(sessionId, urlSuffix) {\n    var fullUrl = url + urlSuffix;\n\
    \    var res = http(\n        fullUrl,\n        {\n            Method: 'GET',\n\
    \            Headers: {\n                'Cookie': [COOKIE_PREFIX + sessionId]\n\
    \            }\n        },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Failed to fetch event data\
    \ (recontruction) with status [' + res.StatusCode + ']. \\nOriginal error: ' +\
    \ res.Body;\n    }\n\n    try {\n        return res.Body;\n    } catch (err) {\n\
    \        throw FailedRequestError('Unexpected while fetching event data (recontruction).\
    \ \\nOriginal error: ' + err, fullUrl, query, null, res.Body).toString();\n  \
    \  }\n}\n\nvar defaultAlertQuery = {\n    page: 1,\n    start: 0,\n    limit:\
    \ 100,\n    sort: JSON.stringify([\n        {\n            property:'alert.timestamp',\n\
    \            direction: 'DESC'\n        }\n    ]),\n    filter: JSON.stringify([\n\
    \        {\n            property: 'alert.timestamp',\n            value: [\n \
    \               851171984031, // year 1996\n                new Date().getTime()\n\
    \            ]\n        }\n    ])\n};\nfunction filterAlerts(sessionId, args)\
    \ {\n    var query = createQuery(args, defaultAlertQuery);\n    var fullUrl =\
    \ [\n        url,\n        '/ajax/alerts/',\n        incidentManagementId,\n \
    \       encodeToURLQuery(query)\n    ].join('');\n\n    var res = http(\n    \
    \    fullUrl,\n        {\n            Method: 'GET',\n            Headers: {\n\
    \                'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n      \
    \  },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode < 200 ||\
    \ res.StatusCode >= 300) {\n        throw 'Failed to fetch alerts with status\
    \ [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try\
    \ {\n        alerts = JSON.parse(res.Body);\n        if (alerts.success) {\n \
    \           return alerts.data;\n        } else {\n            throw FailedRequestError('Fetch\
    \ alerts failed.', fullUrl, query, null, alerts).toString();\n        }\n    }\
    \ catch (err) {\n        throw FailedRequestError('Unexpected while fetching alerts.\
    \ Original error:' + err, fullUrl, query, null, res.Body).toString();\n    }\n\
    }\n\nfunction getAlertById(sessionId, args) {\n    var fullUrl = [\n        url,\n\
    \        'ajax/alerts',\n        incidentManagementId,\n        args.alertId\n\
    \    ].join('/');\n\n    var res = http(\n        fullUrl,\n        {\n      \
    \      Method: 'GET',\n            Headers: {\n                'Cookie': [COOKIE_PREFIX\
    \ + sessionId]\n            }\n        },\n        true,\n        proxy\n    );\n\
    \n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw 'Failed\
    \ to get events of alert with status [' + res.StatusCode + ']. \\nOriginal error:\
    \ ' + res.Body;\n    }\n\n    try {\n        alert = JSON.parse(res.Body);\n \
    \       if (alert.success) {\n            return alert.data;\n        } else {\n\
    \            throw FailedRequestError('Fetch alert details failed.', fullUrl,\
    \ query, null, alert).toString();\n        }\n    } catch (err) {\n        throw\
    \ FailedRequestError('Unexpected while fetching alert details. \\nOriginal error:\
    \ ' + err, fullUrl, null, null, res.Body).toString();\n    }\n}\n\nfunction getOriginalAlertById(sessionId,\
    \ args) {\n    var fullUrl = [\n        url,\n        'ajax/alerts/originalalert',\n\
    \        incidentManagementId,\n        args.alertId\n    ].join('/');\n\n   \
    \ var res = http(\n        fullUrl,\n        {\n            Method: 'GET',\n \
    \           Headers: {\n                'Cookie': [COOKIE_PREFIX + sessionId]\n\
    \            }\n        },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Failed to get events of alert\
    \ with status [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n   \
    \ }\n\n    try {\n        alert = JSON.parse(res.Body);\n        if (alert.success)\
    \ {\n            return alert.data;\n        } else {\n            throw FailedRequestError('Fetch\
    \ alert details failed.', fullUrl, query, null, alert).toString();\n        }\n\
    \    } catch (err) {\n        throw FailedRequestError('Unexpected while fetching\
    \ alert details. \\nOriginal error: ' + err, fullUrl, null, null, res.Body).toString();\n\
    \    }\n}\n\nfunction getAvailableAssignees(sessionId) {\n    var fullUrl = url\
    \ + '/ajax/incident/user/availableAssignees';\n\n    var res = http(\n       \
    \ fullUrl,\n        {\n            Method: 'GET',\n            Headers: {\n  \
    \              'Cookie': ['RSA_SA_LICENSE=true; SaneID=10.64.49.14-1456516139492605;\
    \ s_pers=%20s_fid%3D0D47AAAFD2A1592B-3436DC4A7A7EB300%7C1531522908438%3B%20gpv_pn%3DMYTOOLSSTATIC%252FTOOLS%252FTHE%2520SQUARE%7C1468452708438%3B%20s_lv%3D1468450908454%7C1563058908454%3B%20s_lv_s%3DLess%2520than%25201%2520day%7C1468452708454%3B;\
    \ s_vi=[CS]v1|2B6795DE050118E9-40001608C00050FA[CE]; s_fid=3D8DF632622AC544-1283F8DF4BA4E8DC;\
    \ JSESSIONID=' + sessionId]\n            }\n        },\n        true,\n      \
    \  proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n\
    \        throw 'Failed to fetch availabe assignees with status [' + res.StatusCode\
    \ + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try {\n        availableAssignees\
    \ = JSON.parse(res.Body);\n        if (availableAssignees.success) {\n       \
    \     return availableAssignees.data;\n        } else {\n            throw FailedRequestError('Fetch\
    \ available assignees failed.', fullUrl, null, null, availableAssignees).toString();\n\
    \        }\n    } catch (err) {\n        throw FailedRequestError('Unexpected\
    \ error while fetching available assignees. \\nOriginal error: ' + err, fullUrl,\
    \ null, null, res.Body).toString();\n    }\n}\n\nfunction getEventsViewHtml(sessionId)\
    \ {\n    var fullUrl = url + '/investigation/events';\n\n    var res = http(\n\
    \        fullUrl,\n        {\n            Method: 'GET',\n            Headers:\
    \ {\n                'Cookie': [COOKIE_PREFIX + sessionId]\n            }\n  \
    \      },\n        true,\n        proxy\n    );\n\n    if (res.StatusCode < 200\
    \ || res.StatusCode >= 300) {\n        throw 'Failed to fetch CSRF token with\
    \ status [' + res.StatusCode + ']. \\nOriginal error: ' + res.Body;\n    }\n\n\
    \    return res.Body;\n}\n\nfunction extractCsrfTokenFromHTML(html) {\n    var\
    \ matched = html.match(/<meta name=\"csrf-token\" content=\".*\"/);\n    if (!matched)\
    \ {\n        throw 'CSRF token not found! Internal error in NetWitness. Response\
    \  body: \\n' + html;\n    }\n\n    var csrfToken = replaceAll(matched[0].replace('<meta\
    \ name=\"csrf-token\" content=', ''), '\"', '');\n    return csrfToken;\n}\n\n\
    function extractLoggedUserFromHTML(html) {\n    var matchedLoggedUser = html.match(/name:\
    \ Ext\\.htmlDecode\\(.*\\)/);\n    if (!matchedLoggedUser) {\n        throw 'Failed\
    \ to determine logged in user. Html: ' + html;\n    }\n\n    var name = matchedLoggedUser[0].replace('name:\
    \ Ext.htmlDecode(\\'', '').replace('\\')', '');\n    var user = {\n        name:\
    \ name\n    };\n\n    return user;\n}\n\nvar DEFAULT_SEVERITY = \"50\";\nfunction\
    \ createAlert(sessionId, args, incidentManagementId, createdUser, csrfToken) {\n\
    \    var eventListString = replaceAll(args.eventList, ' ', '');\n    var fullUrl\
    \ = [\n        url,\n        'ajax/alert/create',\n        args.deviceId,\n  \
    \      eventListString,\n        incidentManagementId + '',\n        '?ctoken='\
    \ + csrfToken\n    ].join('/');\n\n    var body = {\n        alertSummary: args.alertSummary,\n\
    \        event_id_list: eventListString.split(','),\n        severity: args.severity\
    \ ? args.severity + '' : DEFAULT_SEVERITY,\n        create_by_user: createdUser.name\n\
    \    };\n\n    var res = http(\n        fullUrl,\n        {\n            Method:\
    \ 'POST',\n            Headers: {\n                'Cookie': [COOKIE_PREFIX +\
    \ sessionId],\n                'Content-Type': ['application/json']\n        \
    \    },\n            Body: JSON.stringify(body)\n        },\n        true,\n \
    \       proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode >= 300)\
    \ {\n        throw 'Failed to create new alert with status [' + res.StatusCode\
    \ + ']. \\nOriginal error: ' + res.Body;\n    }\n\n    try {\n        var alertRes\
    \ = JSON.parse(res.Body);\n        if (alertRes.success) {\n            return\
    \ alertRes.data;\n        } else {\n            throw FailedRequestError('Failed\
    \ to create alert.', fullUrl, null, body, alertRes).toString();\n        }\n \
    \   } catch (err) {\n        throw FailedRequestError('Unexpected error while\
    \ creating alert. \\nOriginal error: ' + err, fullUrl, null, body, res.Body).toString();\n\
    \    }\n}\n\nfunction createIncident(sessionId, args, incidentManagementId, availableAssignees)\
    \ {\n    var eventsViewHTML = getEventsViewHtml(sessionId);\n    var csrfToken\
    \ = extractCsrfTokenFromHTML(eventsViewHTML);\n    var loggedUser = extractLoggedUserFromHTML(eventsViewHTML);\n\
    \    // currently we extract only the name of the logged in user. But the all\
    \ the user object is exist in the html.\n    // it just will take more development\
    \ time.\n    // that is why we look for the user in availableAssigness\n    availableAssignees.forEach(function(user)\
    \ {\n        if (user.name === loggedUser.name) {\n            loggedUser = user;\n\
    \        }\n    });\n\n    var newAlert = createAlert(sessionId, args, incidentManagementId,\
    \ loggedUser, csrfToken);\n\n    var fullUrl = [\n        url,\n        'ajax/incident/create',\n\
    \        incidentManagementId + '',\n        '?ctoken=' + csrfToken\n    ].join('/');\n\
    \n    var newIncident = {\n        name: args.name,\n        summary: args.summary\
    \ || '',\n        priority: args.priority,\n        createdBy: loggedUser.name,\n\
    \        alert_id_list: [\n            newAlert.id\n        ]\n    };\n\n    var\
    \ res = http(\n        fullUrl,\n        {\n            Method: 'POST',\n    \
    \        Headers: {\n                'Cookie': [COOKIE_PREFIX + sessionId],\n\
    \                'Content-Type': ['application/json']\n            },\n      \
    \      Body: JSON.stringify(newIncident)\n        },\n        true,\n        proxy\n\
    \    );\n\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw\
    \ 'Failed to create incident with status [' + res.StatusCode + ']\\n.'\n     \
    \       + 'Request Body: ' + JSON.stringify(body) + '\\n. Response Body: ' + res.Body;\n\
    \    }\n\n    try {\n        var newIncidentRes = JSON.parse(res.Body);\n    \
    \    if (newIncidentRes.success) {\n            newIncident.id = newIncidentRes.data.id;\n\
    \            return newIncident;\n        } else {\n            throw FailedRequestError('Failed\
    \ to create incident.', fullUrl, null, body, newIncidentRes).toString();\n   \
    \     }\n    } catch (err) {\n        throw FailedRequestError('Unexpected error\
    \ while creating incident. \\nOriginal error: ' + err, fullUrl, null, body, res.Body).toString();\n\
    \    }\n}\n\nfunction addEventsToIncident(sessionId, args, incidentManagementId,\
    \ availableAssignees) {\n    var eventsViewHTML = getEventsViewHtml(sessionId);\n\
    \    var csrfToken = extractCsrfTokenFromHTML(eventsViewHTML);\n    var loggedUser\
    \ = extractLoggedUserFromHTML(eventsViewHTML);\n    // currently we extract only\
    \ the name of the logged in user. But the all the user object is exist in the\
    \ html.\n    // it just will take more development time.\n    // that is why we\
    \ look for the user in availableAssigness\n    availableAssignees.forEach(function(user)\
    \ {\n        if (user.name === loggedUser.name) {\n            loggedUser = user;\n\
    \        }\n    });\n\n    var newAlert = createAlert(sessionId, args, incidentManagementId,\
    \ loggedUser, csrfToken);\n\n    var fullUrl = [\n        url,\n        'ajax/incident/addToIncident',\n\
    \        incidentManagementId + '',\n        '?ctoken=' + csrfToken\n    ].join('/');\n\
    \n    var reqBody = {\n        alertIds: [\n            newAlert.id\n        ],\n\
    \        incidentId: args.incidentId\n    };\n\n    var res = http(\n        fullUrl,\n\
    \        {\n            Method: 'POST',\n            Headers: {\n            \
    \    'Cookie': [COOKIE_PREFIX + sessionId],\n                'Content-Type': ['application/json']\n\
    \            },\n            Body: JSON.stringify(reqBody)\n        },\n     \
    \   true,\n        proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        throw 'Failed to add events to incident with status [' +\
    \ res.StatusCode + ']\\n.'\n            + 'Request Body: ' + JSON.stringify(body)\
    \ + '\\n. Response Body: ' + res.Body;\n    }\n\n    try {\n        var resObject\
    \ = JSON.parse(res.Body);\n        if (resObject.success) {\n            return\
    \ true;\n        } else {\n            throw FailedRequestError('Failed to add\
    \ events to incident.', fullUrl, null, body, newIncidentRes).toString();\n   \
    \     }\n    } catch (err) {\n        throw FailedRequestError('Unexpected error\
    \ while adding new events to incident. \\nOriginal error: ' + err, fullUrl, null,\
    \ body, res.Body).toString();\n    }\n}\n\nfunction updateIncident(sessionId,\
    \ args, incidentManagementId, availableAssignees) {\n    var eventsViewHTML =\
    \ getEventsViewHtml(sessionId);\n    var csrfToken = extractCsrfTokenFromHTML(eventsViewHTML);\n\
    \    var loggedUser = extractLoggedUserFromHTML(eventsViewHTML);\n    // currently\
    \ we extract only the name of the logged in user. But the all the user object\
    \ is exist in the html.\n    // it just will take more development time.\n   \
    \ // that is why we look for the user in availableAssigness\n    availableAssignees.forEach(function(user)\
    \ {\n        if (user.name === loggedUser.name) {\n            loggedUser = user;\n\
    \        }\n    });\n\n    var fullUrl = [\n        url,\n        'ajax/incidents/update',\n\
    \        incidentManagementId + '',\n        '?ctoken=' + csrfToken\n    ].join('/');\n\
    \n    var updatedIncident = {\n        id_list: replaceAll(args.idList, ' ', '').split(','),\n\
    \        attribute_map: {\n            lastUpdatedByUser: loggedUser\n       \
    \ },\n        benign_domain_list: []\n    };\n    if (args.name) {\n        updatedIncident.attribute_map.name\
    \ = args.name;\n    }\n    if (args.priority) {\n        updatedIncident.attribute_map.priority\
    \ = args.priority;\n    }\n    if (args.status) {\n        updatedIncident.attribute_map.status\
    \ = args.status;\n    }\n    if (args.summary) {\n        updatedIncident.attribute_map.summary\
    \ = args.summary;\n    }\n    if (args.comment) {\n        updatedIncident.attribute_map.comment\
    \ = args.comment;\n    }\n    if (args.assignee) {\n        var assigneeUser =\
    \ null;\n        availableAssignees.forEach(function(user) {\n            if (user.login\
    \ === args.assignee) {\n                assigneeUser = user;\n            }\n\
    \        });\n        if (!assigneeUser) {\n            throw 'assignee argument\
    \ is invalid. No such [' + args.assignee + '] available assignee user exist';\n\
    \        }\n        updatedIncident.attribute_map.assignee = assigneeUser;\n \
    \   }\n    if (args.categories) {\n        updatedIncident.attribute_map.categories\
    \ = args.categories;\n    }\n\n    var res = http(\n        fullUrl,\n       \
    \ {\n            Method: 'POST',\n            Headers: {\n                'Cookie':\
    \ [COOKIE_PREFIX + sessionId],\n                'Content-Type': ['application/json']\n\
    \            },\n            Body: JSON.stringify(updatedIncident)\n        },\n\
    \        true,\n        proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        throw 'Failed to create incident with status [' + res.StatusCode\
    \ + ']\\n.'\n            + 'Request Body: ' + JSON.stringify(updatedIncident)\
    \ + '\\n. Response Body: ' + res.Body;\n    }\n\n    try {\n        var updateRes\
    \ = JSON.parse(res.Body);\n        if (updateRes.success) {\n            return\
    \ updateRes;\n        } else {\n            throw FailedRequestError('Failed to\
    \ update incident.', fullUrl, null, updatedIncident, updateRes).toString();\n\
    \        }\n    } catch (err) {\n        throw FailedRequestError('Failed to update\
    \ incident.', fullUrl, null, updatedIncident, res.Body).toString();\n    }\n}\n\
    \nfunction makeUpperCase (o) {\n    for (var key in o ) {\n        if(o.hasOwnProperty(key))\
    \ {\n            var newKey = key.charAt(0).toUpperCase() + key.slice(1);\n  \
    \          o[newKey] = o[key];\n            delete o[key];\n        }\n    }\n\
    \    return o;\n}\n\nfunction getIncidentObject(e) {\n    return {\n        \"\
    Id\": e.id,\n        \"Name\": e.name,\n        \"Status\": e.status,\n      \
    \  \"Priority\": e.priority,\n        \"Summary\": e.summary,\n        \"Assignee\"\
    : e.assignee ? e.assignee.name : \"\",\n        \"CreatedBy\": e.createdBy,\n\
    \        \"Created\": convertTimestampToString(e.created),\n        \"FirstAlertTime\"\
    : convertTimestampToString(e.firstAlertTime),\n        \"LastUpdatedByUserName\"\
    : e.lastUpdatedByUserName,\n        \"RiskScore\": e.riskScore,\n        \"AverageAlertRiskScore\"\
    : e.averageAlertRiskScore,\n        \"Categories\": e.categories,\n        \"\
    AlertCount\": e.alertCount\n    };\n}\n\nfunction getAlert (alert) {\n    return\
    \ {\n        \"Id\": alert.id,\n        \"Name\": alert.name,\n        \"IncidentId\"\
    : alert.incidentId,\n        \"Timestamp\": convertTimestampToString(alert.timestamp),\n\
    \        \"HostSummary\": alert.host_summary,\n        \"SignatureId\": alert.signature_id,\n\
    \        \"Source\": alert.source,\n        \"Type\": alert.type,\n        \"\
    RiskScore\": alert.risk_score,\n        \"SourceCountry\": alert.groupby_source_country,\n\
    \        \"DestinationCountry\": alert.groupby_destination_country,\n        \"\
    NumEvents\": alert.numEvents,\n        \"SourceIp\": alert.groupby_source_ip,\n\
    \        \"DestonationIp\": alert.groupby_destination_ip,\n        \"DestonationPort\"\
    : alert.groupby_destination_port\n    };\n}\nfunction buildRetValListIncidents\
    \ (incidets) {\n    var md = [];\n    var ctx = {\"Netwitness.Incident\":[]}\n\
    \    if (!Array.isArray(incidets)) {\n        incidets = [incidets]\n    }\n \
    \   incidets.forEach(function (e) {\n        var toPush = getIncidentObject(e);\n\
    \        md.push(toPush);\n        ctx[\"Netwitness.Incident\"].push(toPush);\n\
    \    })\n    return {Type: entryTypes.note, Contents: incidets, ContentsFormat:\
    \ formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown, EntryContext: ctx};\n}\n\nfunction buildRetValGetIncidentDetails\
    \ (incident) {\n    var md = [];\n    var ctx = {\"Netwitness.Incident\":[]}\n\
    \    var toPush = getIncidentObject(incident);\n    md.push(toPush);\n    ctx[\"\
    Netwitness.Incident\"].push(toPush);\n    return {Type: entryTypes.note, Contents:\
    \ incident, ContentsFormat: formats.json, HumanReadable: tableToMarkdown(command,\
    \ md), ReadableContentsFormat: formats.markdown, EntryContext: ctx};\n}\n\nfunction\
    \ buildRetValGetComponents (components) {\n    var md = [];\n    var ctx = {\"\
    Netwitness.Component\":[]}\n    if (!Array.isArray(components)) {\n        components\
    \ = [components]\n    }\n    components.forEach(function (e) {\n        var toPush\
    \ = {\n            \"Id\": e.id,\n            \"DisplayName\": e.displayName,\n\
    \            \"DeviceVersion\": e.deviceVersion,\n            \"DisplayType\"\
    : e.deviceType,\n            \"Host\": e.host,\n            \"Port\": e.port,\n\
    \            \"Validated\": e.validated,\n            \"Licensed\": e.licensed,\n\
    \            \"Username\": e.username,\n            \"EnableSSL\": e.enableSSL\n\
    \        };\n        md.push(toPush)\n        ctx[\"Netwitness.Component\"].push(toPush);\n\
    \    })\n    return {Type: entryTypes.note, Contents: components, ContentsFormat:\
    \ formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown, EntryContext:  ctx};\n}\n\nfunction buildRetValGetEvents (events)\
    \ {\n    var md = [];\n    var ctx = {\"Netwitness.Event\":[]}\n    if (!Array.isArray(events))\
    \ {\n        events = [events]\n    }\n    events.forEach(function (event) {\n\
    \        var toPush = {\n            \"Id\": event.id,\n            \"Medium\"\
    : event.medium,\n            \"Service\": event.service,\n            \"Size\"\
    : event.size\n        }\n        event[\"meta\"].forEach(function (meta) {\n \
    \           toPush[\"meta.\" + meta.name] = meta.value\n        });\n        md.push(toPush);\n\
    \    });\n    return {Type: entryTypes.note, Contents: events, ContentsFormat:\
    \ formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown};\n}\n\nfunction buildRetValGetEventDetails (event) {\n   \
    \ var md = [];\n    var ctx = {\"Netwitness.Event\":[]};\n    var data = event.data;\n\
    \    var content = event.content;\n    var toPush = {\n        \"EventId\": data.eventId,\n\
    \        \"DeviceId\": data.deviceId,\n        \"ReconstructedContentType\": data.reconstructedContentType,\n\
    \        \"PacketsTotal\": data.stats ? data.stats.packetsTotal : \"\",\n    \
    \    \"PacketsProcessed\": data.stats ? data.stats.packetsProcessed : \"\"\n \
    \   };\n    data.summaryAttributes.forEach(function (e) {\n        toPush[e.name]\
    \ = e.value\n    });\n    md.push(toPush);\n    ctx[\"Netwitness.Event\"].push(toPush);\n\
    \    return {Type: entryTypes.note, Contents: event, ContentsFormat: formats.json,\
    \ HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat: formats.markdown,\
    \ EntryContext:  ctx};\n}\n\nfunction buildRetValGetAlerts (alerts) {\n    var\
    \ md = [];\n    var ctx = {\"Netwitness.Alert\":[]}\n    if (!Array.isArray(alerts))\
    \ {\n        alerts = [alerts]\n    }\n    alerts.forEach(function (e) {\n   \
    \     var toPush = getAlert(e);\n        md.push(toPush);\n        ctx[\"Netwitness.Alert\"\
    ].push(toPush);\n    })\n    return {Type: entryTypes.note, Contents: alerts,\
    \ ContentsFormat: formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown, EntryContext: ctx};\n}\n\nfunction buildRetValGetAlert (alert)\
    \ {\n    var ctx = {\"Netwitness.Alert\":[]}\n    var alertValue = getAlert(alert);\n\
    \    var eventValue = [];\n    alert.events.forEach(function (evnt) {\n      \
    \  eventValue.push(treeToFlattenObject(evnt));\n    });\n    var relatedLinksValue\
    \ = alert.related_links;\n    var hr = tableToMarkdown('Alerts',alertValue)  +\
    \ tableToMarkdown('Events', eventValue)  + tableToMarkdown('Related Links', relatedLinksValue);\n\
    \    ctx[\"Netwitness.Alert\"].push(alertValue);\n    return {Type: entryTypes.note,\
    \ Contents: alert, ContentsFormat: formats.json, HumanReadable: hr, ReadableContentsFormat:\
    \ formats.markdown, EntryContext: ctx};\n}\n\nfunction buildRetValGetAlertOrig\
    \ (alertOrig) {\n    var md = [];\n    var ctx = {\"Netwitness.Event\": []}\n\
    \    if(!alertOrig.events) {\n        return {\"ContentsFormat\": formats[\"markdown\"\
    ], \"Type\": entryTypes[\"error\"], \"Contents\": \"Received an error from NetWitness\
    \ Please ensure that the referred alert Id exist in NetWitness\"};\n    }\n  \
    \  alertOrig.events.forEach(function (evnt) {\n        for (var key in evnt) {\n\
    \            if (key === 'time') {\n                evnt[key] = convertTimestampToString(evnt[key]);\n\
    \            }\n        }\n    });\n    md = alertOrig.events;\n    ctx[\"Netwitness.Event\"\
    ] = alertOrig.events;\n    return {Type: entryTypes.note, Contents: alertOrig,\
    \ ContentsFormat: formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown, EntryContext: ctx};\n}\n\nfunction buildRetValAvailableAssignees(availableAssignees)\
    \ {\n    var md = [];\n    var ctx = {\"Netwitness.Account\":[]}\n    if (!Array.isArray(availableAssignees))\
    \ {\n        availableAssignees = [availableAssignees]\n    }\n    availableAssignees.forEach(function\
    \ (e) {\n        var toPush ={\n            \"Id\": e.id,\n            \"Name\"\
    : e.name,\n            \"Login\": e.login,\n            \"EmailAddress\": e.emailAddress\n\
    \        };\n        md.push(toPush);\n        ctx[\"Netwitness.Account\"].push(toPush);\n\
    \    })\n    return {Type: entryTypes.note, Contents: availableAssignees, ContentsFormat:\
    \ formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown, EntryContext:  ctx};\n}\n\nfunction buildRetValCreateIncident\
    \ (newIncident) {\n    var md = [];\n    var ctx = {\"Netwitness.Incident\":[]}\n\
    \    var toPush = {\n        \"Id\": newIncident.id,\n        \"Name\": newIncident.name,\n\
    \        \"Priority\": newIncident.priority,\n        \"CreatedBy\": newIncident.createdBy,\n\
    \        \"AlertIDList\": newIncident.alertIdList\n    };\n    md.push(toPush);\n\
    \    ctx[\"Netwitness.Incident\"].push(toPush)\n    results = {Type: entryTypes.note,\
    \ Contents: newIncident, ContentsFormat: formats.json, HumanReadable: tableToMarkdown(command,\
    \ md), ReadableContentsFormat: formats.markdown, EntryContext:  ctx};\n}\n\n\n\
    // The command input arg holds the command sent from the user.\nvar sessionId\
    \ = login(url, username, password);\nvar incidentManagementId = args.incidentManagementId\
    \ || getIncidentManagementId(sessionId);\nvar results = false;\nswitch (command)\
    \ {\n    case 'fetch-incidents':\n        results = fetchIncidents(sessionId,\
    \ args, incidentManagementId);\n        break;\n    case 'test-module':\n    \
    \    results = 'ok';\n        break;\n    case 'nw-login':\n        results =\
    \ sessionId;\n        break;\n    case 'netwitness-im-list-incidents':\n     \
    \   var incidents = listIncidents(sessionId, args, incidentManagementId);\n  \
    \      results = buildRetValListIncidents(incidents);\n        break;\n    case\
    \ 'netwitness-im-get-incident-details':\n        var incident = getIncidentById(sessionId,\
    \ args, incidentManagementId);\n        results = buildRetValGetIncidentDetails(incident);\n\
    \        break;\n    case 'netwitness-im-get-components':\n        var components\
    \ = getComponents(sessionId, args);\n        results = buildRetValGetComponents(components);\n\
    \        break;\n    case 'netwitness-im-get-events':\n        var events = getEvents(sessionId,\
    \ args);\n        results = buildRetValGetEvents(events);\n        break;\n  \
    \  case 'netwitness-im-get-event-details':\n        event = getEventDetails(sessionId,\
    \ args);\n        results = buildRetValGetEventDetails(event);\n        break;\n\
    \    case 'netwitness-im-get-alerts':\n        var alerts = filterAlerts(sessionId,\
    \ args);\n        results = buildRetValGetAlerts(alerts);\n        break;\n  \
    \  case 'netwitness-im-get-alert-details':\n        var alert = getAlertById(sessionId,\
    \ args);\n        results = buildRetValGetAlert(alert);\n        break;\n    case\
    \ 'netwitness-im-get-alert-original':\n        var alert = getOriginalAlertById(sessionId,\
    \ args);\n        results = buildRetValGetAlertOrig(alert);\n        break;\n\
    \    case 'netwitness-im-get-available-assignees':\n        var availableAssignees\
    \ = getAvailableAssignees(sessionId);\n        results = buildRetValAvailableAssignees(availableAssignees);\n\
    \        break;\n    case 'netwitness-im-create-incident':\n        var availableAssignees\
    \ = getAvailableAssignees(sessionId);\n        var newIncident = createIncident(sessionId,\
    \ args, incidentManagementId, availableAssignees);\n        results = buildRetValCreateIncident(newIncident);\n\
    \        break;\n    case 'netwitness-im-add-events-to-incident':\n        var\
    \ md = [];\n        var availableAssignees = getAvailableAssignees(sessionId,\
    \ args);\n        var isSuccess = addEventsToIncident(sessionId, args, incidentManagementId,\
    \ availableAssignees);\n        md.push({ success: isSuccess })\n        results\
    \ = {Type: entryTypes.note, Contents: { success: isSuccess }, ContentsFormat:\
    \ formats.json, HumanReadable: tableToMarkdown(command, md), ReadableContentsFormat:\
    \ formats.markdown};\n        break;\n    case 'netwitness-im-update-incident':\n\
    \        var availableAssignees = getAvailableAssignees(sessionId, args);\n  \
    \      var update_incident = updateIncident(sessionId, args, incidentManagementId,\
    \ availableAssignees);\n        if( update_incident.success != true) {\n     \
    \       results = {\"ContentsFormat\": formats[\"markdown\"], \"Type\": entryTypes[\"\
    error\"], \"Contents\": \"Didn't succed to update incident.\\n\" + tableToMarkdown(\"\
    Data returned:\", update_incident)};\n        }\n        else if (update_incident.success\
    \ == true && update_incident.data < 1) {\n            results = {\"ContentsFormat\"\
    : formats[\"markdown\"], \"Type\": entryTypes[\"error\"], \"Contents\": \"Received\
    \ an error from NetWitness Please ensure that the referred incidents exist in\
    \ NetWitness.  Incidents count = \" + update_incident.data};\n        }\n    \
    \    else {\n            results = {\n                \"ContentsFormat\": formats[\"\
    text\"],\n                \"Type\": entryTypes[\"note\"],\n                \"\
    Contents\": \"Incident updated successfully.\"\n            };\n        }\n  \
    \      break;\n    default:\n        // You can use args[argName] or args.argName\
    \ to get a specific arg. args are strings.\n        // You can use params[paramName]\
    \ or params.paramName to get a specific params.\n        // Params are of the\
    \ type given in the integration page creation.\n}\n\nlogout(url, sessionId);\n\
    return results;"
  type: javascript
system: true
tests:
- no test
toversion: 4.1.9
