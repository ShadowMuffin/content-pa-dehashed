comment: Calculates average score for each indicator from context
commonfields:
  id: DBotAverageScore
  version: -1
enabled: true
name: DBotAverageScore
outputs:
- contextPath: DBotAvgScore.Indicator
  description: The indicator we calculate average score for
- contextPath: DBotAvgScore.Score
  description: The average score per indicator
script: "var scores = dq(invContext, 'DBotScore(val.Indicator && val.Score)');\nvar\
  \ s = {};\nfor (i=0; i<scores.length; i++) {\n    if (!s[scores[i].Indicator]) {\n\
  \        s[scores[i].Indicator] = [];\n    }\n    s[scores[i].Indicator].push(scores[i].Score);\n\
  }\nvar avg = Object.keys(s).map(function(ind) {\n    var sum = 0;\n    s[ind].forEach(function(i)\
  \ {sum += i;});\n    return {Indicator: ind, Score: sum / s[ind].length};\n});\n\
  return {Type: entryTypes.note, Contents: avg, ContentsFormat: formats.json, HumanReadable:\
  \ 'Scores average calculated', EntryContext: {DBotAvgScore: avg}};\n"
scripttarget: 0
tags:
- Utility
toversion: 4.1.9
type: javascript
