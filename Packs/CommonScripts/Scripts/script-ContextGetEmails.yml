args:
- description: Email addresses to exclude (separated by commas)
  isArray: true
  name: excludedEmails
comment: Gets all email addresses in context, excluding ones given.
commonfields:
  id: ContextGetEmails
  version: -1
enabled: true
name: ContextGetEmails
script: "var excludedEmails;\nif (args.excludedEmails) {\n    excludedEmails = args.excludedEmails.split(',');\n\
  }\nvar flat = {};\nvar res = [];\nvar currentValue;\nflattenFields(invContext,undefined,flat);\n\
  keysArr = Object.keys(flat);\nfor (var i = 0; i < keysArr.length; i++) {\n    currentValue=flat[keysArr[i]];\n\
  \    if (emailRegex.test(currentValue) && res.indexOf(currentValue) === -1) {\n\
  \        if (excludedEmails) {\n            if (excludedEmails.indexOf(currentValue)\
  \ === -1) {\n                res.push(currentValue);\n            }\n        } else\
  \ {\n            res.push(currentValue);\n        }\n    }\n}\n\nvar md = '### Email\
  \ addresses in context\\n';\nfor (var i = 0; i<res.length; i++) {\n    md += '-\
  \ ' + res[i] + '\\n';\n}\nreturn {\n        Type: entryTypes.note,\n        Contents:\
  \ res,\n        ContentsFormat: formats.json,\n        HumanReadable: md\n     \
  \   };\n\n"
scripttarget: 0
tags: []
toversion: 4.1.9
type: javascript
