args:
- description: Name of system on which to run the command
  name: system
  required: true
- description: Command to run
  name: cmd
  required: true
comment: Execute a command on a remote machine (without installing a D2 agent)
commonfields:
  id: RemoteExec
  version: -1
dependson:
  must:
  - ssh
name: RemoteExec
script: "//Execute a command on a remote machine\nvar output = [];\nvar localSystem\
  \ = false;\nfor (var s = 0; investigation.systems && s < investigation.systems.length;\
  \ s++) {\n    if (investigation.systems[s].name === args.system) {\n        localSystem\
  \ = true;\n        break;\n    }\n}\nvar params = localSystem ? {system: args.system,\
  \ cmd: args.cmd} : {using: args.system, cmd: args.cmd};\nvar entries = executeCommand(\"\
  ssh\", params);\nvar ret = entries[0];\nif (ret === null) {\n    output.push({ContentsFormat:\
  \ formats.text, Type: entryTypes.error, Contents: \"Failed to execute remote command.\"\
  });\n} else {\n    result = ret.Contents;\n    if (!result.success) {\n        output.push({ContentsFormat:\
  \ formats.text, Type: entryTypes.error, Contents: result.error});\n    } else {\n\
  \        output.push({ContentsFormat: formats.text, Type: entryTypes.note, Contents:\
  \ result.output});\n    }\n}\nreturn output;"
scripttarget: 0
system: true
tags:
- endpoint
timeout: 0s
toversion: 4.1.9
type: javascript
