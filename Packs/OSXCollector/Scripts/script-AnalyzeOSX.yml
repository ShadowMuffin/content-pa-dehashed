args:
- default: true
  description: Ask OSXCollector for a specific section
  name: section
- description: Timeout to be passed to OSXCollector script
  name: timeout
- description: Maximum amount of files/urls to verify
  name: maxchecks
- description: OSX System to be used
  name: system
comment: "Get file and url reputation for osxcollector result.\n will use VirusTotal\
  \ for Url checks, and IBM XForce for MD5 checks.\n maxchecks : for \n system  :\
  \ system name to run agent on.\n section : the type check that OSXCollector should\
  \ run."
commonfields:
  id: AnalyzeOSX
  version: -1
dependson:
  must:
  - file
  - url
name: AnalyzeOSX
script: "var osx_report = executeCommand('Osxcollector', {section: args.section, system:\
  \ args.system, timeout: args.timeout});\nvar res = [];\nvar maxchecks = 10;\nif\
  \ (args.maxchecks) {\n  maxchecks = args.maxchecks;\n}\nfor (var i=0; i<osx_report.length;\
  \ i++) {\n  if (osx_report[i].ContentsFormat == formats.json) {\n    var content\
  \ = osx_report[i].Contents;\n    if (content.osxcollector_result){\n      for (var\
  \ j=0; j<content.osxcollector_result.length && j < maxchecks; j++) {\n        if\
  \ (content.osxcollector_result[j].md5) {\n          var rep = executeCommand('file',\
  \ {file: content.osxcollector_result[j].md5});\n          if (rep && Array.isArray(rep))\
  \ {\n            for (var r = 0; r < rep.length; r++) {\n              if (positiveFile(rep[r]))\
  \ {\n                res.push(shortFile(rep[r]));\n              }\n           \
  \ }\n          }\n        }\n        var u = content.osxcollector_result[j].url;\n\
  \        if (u && u.indexOf(\"http\") === 0) {\n          var rep = executeCommand('url',\
  \ {url: u});\n          if (rep && Array.isArray(rep)) {\n            for (var r\
  \ = 0; r < rep.length; r++) {\n              if (positiveUrl(rep[r])) {\n      \
  \          res.push(shortUrl(rep[r]));\n              }\n            }\n       \
  \   }\n        }\n      }\n    }\n  }\n}\nif (res.length > 0) {\n  return res;\n\
  }\nreturn 'No infected files or malicious urls detected on OSX machine: '+args.system;"
scripttarget: 0
system: true
tags:
- osx
tests:
- No test - need to revisit
timeout: 0s
toversion: 4.1.9
type: javascript
