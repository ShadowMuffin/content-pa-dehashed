args:
- default: true
  description: Ask OSXCollector for a specific section
  name: section
- description: Timeout for the OSXCollector execution to complete. If omitted, defaults
    to 10 minutes.
  name: timeout
comment: Execute osxcollector on machine, can run ONLY on OSX
commonfields:
  id: Osxcollector
  version: -1
dependson: {}
name: Osxcollector
script: "var res = http('https://raw.githubusercontent.com/Yelp/osxcollector/master/osxcollector/osxcollector.py',\
  \ {SaveToFile: true});\nexecute('chmod +x '+res.Path);\nvar cmd = res.Path ;\nif\
  \ (args.section) {\n    cmd = cmd + \" -s \" + args.section ;\n}\nvar timeout =\
  \ 600 ;\nif (args.timeout) {\n    timeout = args.timeout ;\n}\npack(cmd);\nvar output\
  \ = execute(cmd,timeout);\npack(output);\nvar result = output.Stderr;\nvar fileNameStartIndex\
  \ = result.lastIndexOf(\"osxcollect\");\nvar fileName = result.substring(fileNameStartIndex,\
  \ result.length-1);\npack_file(String(fileName));\nfileNameWithoutExtension = fileName.substring(0,\
  \ fileName.length-7);\nexecute('tar -zxvf '+fileName+' ./'+fileNameWithoutExtension+'/'+fileNameWithoutExtension+'.json');\n\
  var jsonResultStr = read_file(fileNameWithoutExtension+'/'+fileNameWithoutExtension+'.json');\n\
  var arr = jsonResultStr.split('\\n');\nstr = arr.join(',');\nvar result = '{\"osxcollector_result\"\
  :['+str.substring(0, str.length-1)+']}';\npack(JSON.parse(result));"
scripttarget: 1
system: true
tags:
- osx
- agent
timeout: 0s
toversion: 4.1.9
type: javascript
