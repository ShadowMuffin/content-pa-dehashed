args:
- description: Comma separated escalation policy IDs from which choose the oncall
    user.
  name: escalation_policy_ids
- description: Comma separated schedule IDs from which to choose the oncall.
  name: schedule_ids
comment: By default assigns the first on-call user to an investigation (all incidents
  in the investigation will be owned by the on call user)
commonfields:
  id: PagerDutyAssignOnCallUser
  version: -1
dependson:
  must:
  - PagerDuty-get-users-on-call-now
enabled: true
name: PagerDutyAssignOnCallUser
runas: DBotWeakRole
runonce: false
script: "var res = executeCommand('PagerDuty-get-users-on-call-now',\n    {\n    \
  \    escalation_policy_ids: args.escalation_policy_ids,\n        schedule_ids: args.schedule_ids\n\
  \    });\n\nif (res[0].Type == entryTypes.error) {\n    return res[0]\n}\n\nvar\
  \ usersOnCall = res[0].Contents.oncalls;\nvar selectedUser = usersOnCall[0].user;\n\
  \nif (selectedUser === null) {\n    return 'error : could not find user from PagerDuty\
  \ OnCall now!';\n}\n\nres = executeCommand('getUserByEmail', {userEmail: selectedUser.email});\n\
  \nif (res[0].Type == entryTypes.error) {\n    return res[0];\n}\n\nvar userId =\
  \ res[0].Contents.id;\nsetOwner(userId);\n\nreturn 'User ' + userId + ' was set\
  \ as owner to incidents of this investigation';"
scripttarget: 0
tags:
- pagerduty
- communication
tests:
- No tests
toversion: 4.1.9
type: javascript
