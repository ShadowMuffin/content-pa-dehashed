args:
- description: Email address by which to search
  name: email
  required: true
- description: Include these AD attributes of the resulting objects in addition to
    the default ones
  name: attributes
comment: Use Active Directory to retrieve the user associated with the specified email
  address.
commonfields:
  id: ADGetUsersByEmail
  version: -1
dependson:
  must:
  - ad-search
deprecated: true
name: ADGetUsersByEmail
script: "# Optional arguments and default values\nattrs = 'name,displayname,mail'\n\
  if demisto.get(demisto.args(), 'attributes'):\n    attrs += \",\" + demisto.args()['attributes']\n\
  email = demisto.args()['email']\nfilterstr = r\"(&(objectClass=user)(mail=\" + email\
  \ + \"))\"\nresp = demisto.executeCommand( 'AdSearch', { 'filter' : filterstr, 'attributes'\
  \ : attrs } )\nif not isError(resp[0]) and not 'No results' == resp[0]['Contents']:\n\
  \    if isinstance(resp[0]['Contents'], list) and resp[0]['Contents']:\n       \
  \ person = resp[0]['Contents'][0]\n        dispname = demisto.get(person, 'displayname')\n\
  \        if dispname:\n            demisto.setContext('ADDisplayName', dispname)\n\
  \        name = demisto.get(person, 'name')\n        if name:\n            demisto.setContext('ADPersonName',\
  \ name)\n        dn = demisto.get(person, 'dn')\n        if dn:\n            demisto.setContext('ADDistinguishedName',\
  \ dn)\ndemisto.results(resp)"
scripttarget: 0
subtype: python2
system: true
tags:
- active directory
timeout: 0s
toversion: 4.1.9
type: python
