args:
- default: true
  description: If provided, checks only files whose names are in the list. The names
    should be comma-separated.
  name: fileNames
comment: Deprecated, use "WildFire - Detonate File" playbook instead
commonfields:
  id: CheckFilesWildfirePy
  version: -1
dependson:
  must:
  - wildfire-upload
  - wildfire-report
deprecated: true
name: CheckFilesWildfirePy
script: "import time\nfileNames = []\nif 'fileNames' in demisto.args():\n    fileNames\
  \ = demisto.args()['fileNames'].split(',')\nres = []\nuploaded = []\nviewed = {}\n\
  entries = demisto.executeCommand('getEntries', {})\nfor entry in entries:\n    if\
  \ entry['File'] and demisto.get(entry, 'FileMetadata.md5') and (len(fileNames) ==\
  \ 0 or entry['File'] in fileNames):\n        md5 = demisto.get(entry, 'FileMetadata.md5')\n\
  \        if viewed.get(md5):\n          continue\n        demisto.log('[*] Checking\
  \ - ' + demisto.get(entry, 'FileMetadata.md5'))\n        viewed[md5] = True\n  \
  \      rep = demisto.executeCommand('wildfire-report', {'md5': md5})\n        for\
  \ r in rep:\n            if positiveFile(r):\n                res.append(shortFile(r))\n\
  \            elif r['Type'] == entryTypes['error'] and '404' in r['Contents']:\n\
  \                upReply = demisto.executeCommand('wildfire-upload', {'upload':\
  \ entry['ID']})\n                if upReply[0]['Type'] != entryTypes['error']:\n\
  \                    uploaded.append(demisto.get(entry, 'FileMetadata.md5'))\n#\
  \ Wait for the uploaded files to be processed - 15 min\nif len(uploaded) > 0:\n\
  \    time.sleep(15 * 60)\nfor u in uploaded:\n    rep = demisto.executeCommand('wildfire-report',\
  \ {'md5': u})\n    notFound = False\n    for r in rep:\n        if positiveFile(r):\n\
  \            res.append(shortFile(r))\nif len(res) > 0:\n    res.append('yes')\n\
  else:\n    res.extend(['No suspicious files found', 'no'])\ndemisto.results(res)"
scripttarget: 0
subtype: python2
system: true
tags:
- hash
- server
- threat-intel
- wildfire
tests:
- No tests
timeout: 0s
toversion: 4.1.9
type: python
