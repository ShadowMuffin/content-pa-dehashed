args:
- default: true
  description: Input for the WHOIS query
  name: query
  required: true
comment: A simple script that outputs a shorter summary of the !whois command output
commonfields:
  id: WhoisSummary
  version: -1
dependson:
  must:
  - whois
deprecated: true
name: WhoisSummary
script: "// A simple example script for parsing WHOIS data\n// Regexp for matching\
  \ \"<key>: <value>\" pattern\nvar re = /^([a-zA-Z\\s]+):\\s(.+)$/;\nfunction stringStartsWith\
  \ (string, prefix) {\n    return string.slice(0, prefix.length) == prefix;\n}\n\
  var res = executeCommand('whois', {'using-brand': 'whois', 'query':args.query});\n\
  var lines = res[0].Contents.split('\\n');\nvar out = '';\nfor (var i=0; i < lines.length;\
  \ ++i) {\n    var str = lines[i];\n    str.trim();\n    if (str.length === 0) {\n\
  \        continue;\n    }\n    // Skip '%' lines\n    if (stringStartsWith(str,\
  \ '%')) {\n        continue;\n    }\n    // Stop when reaching the \"last update\"\
  \ line\n    if (stringStartsWith(str, '>>> Last update')) {\n        break;\n  \
  \  }\n    // See if the line matches the regex\n    if (re.test(str)) {\n      \
  \  out += str + '\\n';\n    }\n}\nreturn out;"
scripttarget: 0
system: true
tags:
- threat-intel
- whois
- server
timeout: 0s
toversion: 4.1.9
type: javascript
