args: []
comment: Delete Mails with ID's under the context key "ExchangeItemIDs"
commonfields:
  id: ExchangeDeleteIDsFromContext
  version: -1
dependson:
  must:
  - ews-delete-items
deprecated: true
name: ExchangeDeleteIDsFromContext
script: "import json\nresultText = ''\nresultErr = []\nres = []\nfound = demisto.get(demisto.context(),\
  \ 'ExchangeItemIDs')\nif found and not found == '{}':\n    mbIds = json.loads(found)\n\
  \n    for mb in mbIds.keys():\n        resultText += '**Deleting from {0}:**\\n'.format(str(mb))\n\
  \        itemids = ','.join(mbIds[mb])\n\n        delres = demisto.executeCommand('ews-delete-items',\
  \ {'target-mailbox': mb, 'item-ids' :itemids })\n        if isError(delres[0]):\n\
  \            resultErr += delres\n        else:\n            delres = delres[0]\n\
  \            if delres['Type'] != 4 and delres['ContentsFormat'] == 'json':\n  \
  \              delresp = demisto.get(delres, 'Contents.Envelope.Body.DeleteItemResponse.ResponseMessages.DeleteItemResponseMessage')\n\
  \                if delresp:\n                    delresp = delresp if isinstance(delresp,\
  \ list) else [delresp]\n                    if delresp[0]['-ResponseClass'] == 'Success':\n\
  \                        resultText += 'Delete successful.\\n'\n               \
  \     else:\n                        resultText += \"Delete failed: \" + delresp['MessageText']\
  \ + \"\\nResponse Code:\" + delresp['-ResponseCode']+'\\n'\n                else:\n\
  \                    resultText += \"Delete failed with missing response\\n\"\n\
  \            else:\n                resultErr += [delres]\n\n    res += [ { 'Type'\
  \ : entryTypes['note'], 'ContentsFormat' : formats['markdown'], 'Contents': resultText\
  \ } ]\n    res += resultErr\n    demisto.setContext('ExchangeItemIDs', '')\n   \
  \ demisto.results(res)\nelse:\n    demisto.results( { 'Type' : entryTypes['error'],\
  \ 'ContentsFormat' : formats['text'], 'Contents' : 'No mail ids were found in context.\
  \ Cannot continue.' } )"
scripttarget: 0
subtype: python2
system: true
tags:
- ews
- exchange
timeout: 0s
toversion: 4.1.9
type: python
