args:
- default: true
  description: Splunk query to execute
  name: query
  required: true
- description: Return up to X first rows. If omitted, defaults to 30.
  name: rows
comment: Run a query through Splunk and format the results as a markdown with raw
  data parsed as JSON
commonfields:
  id: SplunkSearchJsonPy
  version: -1
dependson:
  must:
  - splunk|||search
deprecated: true
name: SplunkSearchJsonPy
script: "import json\nrows = 30\nif 'rows' in demisto.args():\n    rows = demisto.args()['rows']\n\
  query = demisto.args()['query']\nquery = query + ' | head ' + str(rows)\nres = demisto.executeCommand('search',\
  \ {'query': query, 'using-brand': 'splunk'})\nif isError(res[0]):\n    demisto.results(res)\n\
  else:\n    data = demisto.get(res[0],'Contents')\n    if data:\n        data = data\
  \ if isinstance(data, list) else [data]\n        new_data  = []\n        for r in\
  \ data:\n            new_r = {}\n            raw = demisto.get(r, 'result._raw')\n\
  \            if raw:\n                new_r[\"Time\"] = demisto.get(r, 'result._time')\n\
  \                new_r[\"Host\"] = demisto.get(r, 'result.host')\n             \
  \   new_r[\"Source\"] = demisto.get(r, 'result.source')\n                raw = json.loads(raw)\n\
  \                for key in raw.keys():\n                    new_r[key] = raw[key]\n\
  \            else:\n                if not demisto.get(demisto.args(), 'showPreviews')\
  \ and demisto.get(r, 'preview'):\n                    continue\n               \
  \ new_r = demisto.get(r, 'result')\n            new_data.append(new_r)\n       \
  \ data = new_data\n        data = [{k: formatCell(row[k]).replace(\"\\n\",\"<br>\"\
  ) for k in row} for row in data]\n        data = tblToMd('Splunk search result',data)\n\
  \        demisto.results({\"ContentsFormat\": formats[\"markdown\"], \"Type\": entryTypes[\"\
  note\"], \"Contents\": data} )\n    else:\n        demisto.results(\"No results.\"\
  )\n"
scripttarget: 0
subtype: python2
system: true
tags:
- enhancement
timeout: 0s
toversion: 4.1.9
type: python
