category: Data Enrichment & Threat Intelligence
commonfields:
  id: Lastline
  version: -1
configuration:
- defaultvalue: https://analysis.lastline.com
  display: Server URL (e.g. https://analysis.lastline.com)
  name: url
  required: true
  type: 0
- defaultvalue: ''
  display: API Key for accessing Lastline APIs
  name: api_key
  required: true
  type: 0
- defaultvalue: ''
  display: API Token for accessing Lastline APIs
  name: api_token
  required: true
  type: 4
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: '70'
  display: Threshold
  name: threshold
  required: false
  type: 0
deprecated: true
description: Provides threat analysts and incident response teams with the advanced
  malware isolation and inspection environment, needed to safely execute advanced
  malware samples and understand their behavior.
display: Lastline
fromversion: 4.1.0
image: data:image/png;base64,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
name: Lastline
script:
  commands:
  - arguments:
    - description: The task UUID of the submitted Lastline analysis.
      name: uuid
      required: true
    - defaultValue: '0'
      description: The timeout (in seconds) to wait for an analysis to complete.
      name: timeout
    - defaultValue: '10'
      description: The interval (in seconds) to poll for the analysis status.
      name: interval
    - defaultValue: '50'
      description: The score threshold to identify a file as malicious.
      name: threshold
    deprecated: true
    description: This command is deprecated. Use the lastline-get-report command.
    name: lastline-get
    outputs:
    - contextPath: URL.Data
      description: A list of malicious URLs identified by the Lastline analysis.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason that the vendor made the decision.
      type: string
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor.
      type: number
    - contextPath: File.MD5
      description: Bad MD5 hash.
      type: string
    - contextPath: File.SHA1
      description: Bad SHA1 hash.
      type: string
    - contextPath: File.SHA256
      description: Bad SHA256 hash.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason that the vendor made the decision.
      type: string
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor.
      type: number
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor reporting the URL as malicious.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
  - arguments:
    - description: URL to analyze.
      name: url
      required: true
    - defaultValue: '0'
      description: Timeout (in seconds) to wait for an analysis to complete.
      name: timeout
    - defaultValue: '10'
      description: Interval (in seconds) to poll for the analysis status.
      name: interval
    - defaultValue: '70'
      description: The score threshold that determines if the file is malicious. Lastline
        default is 70.
      name: threshold
    - auto: PREDEFINED
      description: Whether to add the request to the Lastline portal.
      name: pushToPortal
      predefined:
      - 'true'
      - 'false'
    deprecated: true
    description: This command is deprecated. Use the lastline-upload-url command.
    name: url
    outputs:
    - contextPath: lastlineTasks
      description: A list of the submitted Lastline analysis tasks.
    - contextPath: URL.Data
      description: A list of malicious URLs identified by the Lastline analysis.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason that the vendor to made the decision.
      type: string
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor.
      type: number
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The type of indicator.
      type: string
    - contextPath: DBotScore.Vendor
      description: The Vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: Lastline.Submission.URL
      description: The URL to upload.
      type: string
    - contextPath: Lastline.Submission.UUID
      description: ID of the submission
      type: string
  - arguments:
    - default: true
      description: File hash to check (MD5, SHA-1 or SHA-256).
      name: file
      required: true
    - defaultValue: '70'
      description: Score threshold that determines if the file is malicious.
      name: threshold
    description: Checks the file reputation of the specified hash.
    name: file
    outputs:
    - contextPath: File.MD5
      description: Bad MD5 hash.
      type: string
    - contextPath: File.SHA1
      description: Bad SHA1 hash.
      type: string
    - contextPath: File.SHA256
      description: Bad SHA256 hash.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason that the vendor made the decision.
      type: string
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor.
      type: number
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: File.Type
      description: The file type.
      type: string
  - arguments:
    - description: The ID of the file ID to upload.
      name: file_id
      required: true
    - defaultValue: '70'
      description: The score threshold that determines if the file is malicious.
      name: threshold
    - defaultValue: '0'
      description: The timeout (in seconds) to wait for the analysis to complete.
      name: timeout
    - defaultValue: '10'
      description: The interval (in seconds) to poll for the analysis status.
      name: interval
    - auto: PREDEFINED
      description: Whether to add the request to the Lastline portal.
      name: pushToPortal
      predefined:
      - 'true'
      - 'false'
    deprecated: true
    description: This command is deprecated. Use the lastline-upload-file command.
    name: lastline-upload
    outputs:
    - contextPath: lastlineTasks.file_id
      description: The ID of the file submitted to the Lastline analysis tasks.
      type: string
    - contextPath: lastlineTasks.uuid
      description: The task UUID of the submitted Lastline analysis.
      type: string
  - arguments:
    - description: The URL to analyze. For example, https://www.demisto.com
      name: url
      required: true
    - defaultValue: '70'
      description: The score threshold that determines if the file is malicious. Lastline
        default is 70.
      name: threshold
    description: Submit URL for analysis.
    name: lastline-upload-url
    outputs:
    - contextPath: Lastline.Submission.URL
      description: The URL to upload.
      type: string
    - contextPath: Lastline.Submission.UUID
      description: The ID of the submission.
      type: string
    - contextPath: Lastline.Submission.Status
      description: The status of the submission.
      type: string
  - arguments:
    - description: The entry ID of the file to upload.
      name: EntryID
      required: true
    - defaultValue: '70'
      description: The score threshold that determines if the file is malicious. Lastline
        default is 70.
      name: threshold
    description: Submits a URL for analysis.
    name: lastline-upload-file
    outputs:
    - contextPath: Lastline.Submission.Filename
      description: The file name of the submitted sample.
      type: string
    - contextPath: Lastline.Submission.UUID
      description: The task UUID of the submitted sample.
      type: string
    - contextPath: Lastline.Submission.Status
      description: The status of the submission.
      type: string
  - arguments:
    - description: The task UUID of the submitted Lastline analysis.
      name: uuid
      required: true
    - description: The score threshold that determines if the file is malicious. Lastline
        default is 70.
      name: threshold
    description: Returns an analysis report.
    name: lastline-get-report
    outputs:
    - contextPath: URL.Data
      description: A list of malicious URLs identified by the lastline analysis.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision.
      type: string
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason that the vendor made the decision.
      type: string
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor.
      type: number
    - contextPath: File.MD5
      description: Bad MD5 hash.
      type: string
    - contextPath: File.SHA1
      description: Bad SHA1 hash.
      type: string
    - contextPath: File.SHA256
      description: Bad SHA256 hash.
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision.
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason that the vendor made the decision.
      type: string
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor.
      type: number
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The type of indicator.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: Lastline.Submission.Status
      description: Status of the submission.
      type: string
    - contextPath: Lastline.Submission.YaraSignatures.name
      description: Yara signatures name.
      type: string
    - contextPath: Lastline.Submission.YaraSignatures.score
      description: The score according to the yara signatures (0 to 100).
      type: number
    - contextPath: Lastline.Submission.YaraSignatures.internal
      description: Whether the signature is for internal usage only.
      type: boolean
    - contextPath: Lastline.Submission.DNSqueries
      description: List of DNS queries executed by the analysis subject.
      type: string
    - contextPath: Lastline.Submission.NetworkConnections
      description: A list of network connections executed by the analysis subject.
      type: string
    - contextPath: Lastline.Submission.DownloadedFiles
      description: A list of files that were downloaded using the Microsoft Windows
        file-download API functions. Each element is a tuple of file-origin URL and
        a File element.
      type: string
    - contextPath: Lastline.Submission.Process
      description: Information on a Windows process.
    - contextPath: Lastline.Submission.Process.arguments
      description: The argument of the process.
      type: string
    - contextPath: Lastline.Submission.Process.executable
      description: The executable of the process.
    - contextPath: Lastline.Submission.Process.executable.abs_path
      description: The absolute path of the executable of the process.
      type: string
    - contextPath: Lastline.Submission.Process.executable.filename
      description: The filename of the executable.
      type: string
    - contextPath: Lastline.Submission.Process.executable.yara_signature_hits
      description: The Yara signature of the executable of the process.
      type: string
    - contextPath: Lastline.Submission.Process.executable.ext_info
      description: The Executable information of the process.
      type: unknown
    - contextPath: Lastline.Submission.Process.process_id
      description: The process ID.
      type: string
    - contextPath: File.Type
      description: File type
      type: string
  - arguments:
    - description: Tasks before in UTC format %Y-%m-%d %H:%M:%S. For example, 2018-07-08
        12:00:00.
      name: before
    - description: Tasks after in UTC format %Y-%m-%d %H:%M:%S. For example, 2018-07-10
        12:00:00.
      name: after
      required: true
    description: Returns a list of tasks.
    name: lastline-get-task-list
  - arguments:
    - description: The task UUID of the submitted Lastline analysis.
      isArray: true
      name: uuid
      required: true
    description: Checks the status of a submission.
    name: lastline-check-status
    outputs:
    - contextPath: Lastline.Submission.UUID
      description: The task UUID of submitted sample.
      type: string
    - contextPath: Lastline.Submission.Status
      description: The status of the submission.
      type: string
  runonce: false
  script: "//GLOBALS//\nvar LAST_LINE_DEFAULTS = {\n    interval:10,\n    timeout:0,\n\
    \    pushToPortal:true\n};\n\nLAST_LINE_DEFAULTS.threshold = params.threshold\
    \ ? params.threshold : 70; // 70 is Lastline default\n\nvar SERVER_URL = params.url;\n\
    if (SERVER_URL[SERVER_URL.length - 1] !== '/') {\n    SERVER_URL += '/';\n}\n\
    var MD5_REGEX = /\\b[a-fA-F\\d]{32}\\b/m;\nvar SHA1_REGEX = /\\b[a-fA-F\\d]{40}\\\
    b/m;\nvar SHA256_REGEX = /\\b[a-fA-F\\d]{64}\\b/m;\n\n//HELPERS//\nfunction dataToMd(data,\
    \ threshold, filename) {\n    // print data report as markdown\n    var key;\n\
    \    var name;\n    if ('url' in data.analysis_subject) {\n        key='URL';\n\
    \        name = data.analysis_subject.url;\n    } else {\n        key='file';\n\
    \        if (filename) { //1st priority is user's choice\n            name = filename;\n\
    \        } else {\n            var filenameDq = dq(invContext, 'Lastline.Submission(val.UUID\
    \ === \"'+ data.task_uuid +'\").Filename'); //2nd priority is the filename from\
    \ the context\n            if (filenameDq && filenameDq[0]) {\n              \
    \  name = filenameDq;\n            } else {\n                name = 'MD5:' + data.analysis_subject.md5;\n\
    \            }\n        }\n    }\n    var md = '';\n    if (data.score >= threshold)\
    \ { //default is 70\n        name = name + ' :red_circle:';\n    }\n    md +=\
    \ '### Lastline analysis for ' + key + ': **' + name +'**\\n';\n    md += '####\
    \ Score: ' + data.score  + \"\\n\";\n    md += 'Task UUID: ' + data.task_uuid\
    \ + \"\\n\";\n    md += 'Submission Time: ' + data.submission + \"\\n\";\n   \
    \ if (Array.isArray(data.malicious_activity) && data.malicious_activity.length>0)\
    \ {\n        md += '### Suspicious Activity: ' + \"\\n\";\n        for (var i=0;\
    \ i <= data.malicious_activity.length; i++) {\n            if (data.malicious_activity[i])\
    \ {\n                md += '#### ' + data.malicious_activity[i] + \"\\n\";\n \
    \           }\n        }\n    }\n    if (key == 'file') {\n        md += objToMd(data.analysis_subject);\n\
    \    }\n    md += \"\\n\";\n    return md;\n}\n\nfunction doReq(method, path,\
    \ parameters) {\n    // send http post request\n    if (!parameters) {\n     \
    \   parameters = {};\n    }\n    parameters.key = params.api_key;\n    parameters.api_token\
    \ = params.api_token;\n    var result = http(\n        SERVER_URL + path + encodeToURLQuery(parameters),\n\
    \        {\n            Headers: {'Content-Type': ['application/json']},\n   \
    \         Method: method\n        },\n        params.insecure,\n        params.proxy\n\
    \    );\n    if (result.StatusCode < 200 && result.StatusCode > 299) {\n     \
    \   throw  'Failed to perform request ' + path + ', request status code: ' + result.StatusCode;\n\
    \    }\n    var obj;\n    try {\n        obj = JSON.parse(result.Body);\n    }\
    \ catch (ex) {\n        throw 'Error parsing reply - ' + result.Body + ' - ' +\
    \ ex;\n    }\n    if (obj.error_code) {\n        switch (obj.error_code) {\n \
    \           case 101:\n                // file hash does not exist\n         \
    \       throw \"File hash does not exist.\";\n            case 106:\n        \
    \        // analysis report not ready\n                throw \"Analysis report\
    \ is not ready yet.\";\n            case 115:\n                // reached api\
    \ quota\n                throw \"You've reached your API call quota. Contact your\
    \ Lastline representative.\";\n            default:\n                throw 'Error\
    \ from Lastline. Error code: ' + obj.error_code + '. Error: ' + obj.error;\n \
    \       }\n    }\n    if (obj.success === 0) {\n        throw 'Error from Lastline:\
    \ ' + obj.error;\n    }\n    return {body: result.Body, obj: obj};\n}\n\nfunction\
    \ doFile(entry_id,parameters) {\n    // send http multipart request (post file)\n\
    \    if (!parameters) {\n        parameters = {};\n    }\n    parameters.key =\
    \ params.api_key;\n    parameters.api_token=params.api_token;\n    var path =\
    \ 'analysis/submit/file';\n    var result = httpMultipart(\n        SERVER_URL\
    \ + path + encodeToURLQuery(parameters),\n        entry_id,\n        {\n     \
    \       Method: 'POST',\n            Headers: {'Content-Type': ['application/json']}\n\
    \        },\n        params.insecure,\n        params.proxy\n    );\n    if (result.StatusCode\
    \ < 200 && result.StatusCode > 299) {\n        throw 'Failed to perform request\
    \ ' + path + ', request status code: ' + result.StatusCode;\n    }\n    var obj;\n\
    \    try {\n        obj = JSON.parse(result.Body);\n    } catch (ex) {\n     \
    \   throw 'Error parsing reply - ' + result.Body + ' - ' + ex;\n    }\n    if\
    \ (obj.error_code) {\n        switch (obj.error_code) {\n            case 101:\n\
    \                // file hash does not exist\n                throw \"File hash\
    \ does not exist.\";\n            case 106:\n                // analysis report\
    \ not ready\n                throw \"Analysis report is not ready yet.\";\n  \
    \          case 115:\n                // reached api quota\n                throw\
    \ \"You've reached your API call quota. Contact your Lastline representative.\"\
    ;\n            default:\n                throw 'Error from Lastline. Error code:\
    \ ' + obj.error_code + '. Error: ' + obj.error;\n        }\n    }\n    return\
    \ {body: result.Body, obj: obj};\n}\n\nfunction analysisPoll(uuid, threshold,\
    \ timeout, interval) {\n    // poll for analysis report\n    if (!timeout) {\n\
    \        timeout = LAST_LINE_DEFAULTS.timeout;\n    }\n    if (!interval) {\n\
    \        interval = LAST_LINE_DEFAULTS.interval;\n    }\n    if (!threshold) {\n\
    \        threshold = LAST_LINE_DEFAULTS.threshold;\n    }\n    var result = doReq('POST',\
    \ '/analysis/get', {uuid: uuid, full_report_score:threshold});\n    var waited=0;\n\
    \    while (!analysisReady(result.obj.data) && parseInt(timeout)>waited) {\n \
    \       wait(parseInt(interval));\n        waited+=interval;\n        result =\
    \ doReq('POST', 'analysis/get', {uuid: uuid, full_report_score:threshold});\n\
    \    }\n    return result;\n}\n\nfunction analysisReady(data) {\n    // check\
    \ if report is ready based on data content (score field is set)\n    return (data\
    \ && 'score' in data);\n}\n\n//COMMANDS//\nfunction FileUpload(file_id,threshold,timeout,interval,pushToPortal)\
    \ {\n    // submit file for analysis\n    // optional - wait for analysis to copmplete\
    \ and print results\n    // if not waiting - add uuid to context\n    if (!timeout)\
    \ {\n        timeout = LAST_LINE_DEFAULTS.timeout;\n    }\n    if (!interval)\
    \ {\n        interval = LAST_LINE_DEFAULTS.interval;\n    }\n    if (!threshold)\
    \ {\n        threshold = LAST_LINE_DEFAULTS.threshold;\n    }\n    if (!pushToPortal)\
    \ {\n        pushToPortal = LAST_LINE_DEFAULTS.pushToPortal;\n    }\n    var result\
    \ = doFile(file_id, {\n        full_report_score: threshold,\n        push_to_portal:\
    \ pushToPortal\n    });\n    var uuid = result.obj.data.task_uuid;\n    var ec\
    \ = {};\n    ec.lastlineTasks = [{'file_id': file_id, 'uuid': uuid}]; //backward\
    \ compatabillity\n\n    var filenameToUpload;\n    var filenameDq = dq(invContext,\
    \ 'File(val.EntryID === \"'+file_id +'\").Name'); //1st priority is the filename\
    \ from the context\n    if (filenameDq && filenameDq[0]) {\n        filenameToUpload\
    \ = filenameDq;\n    } else {\n        filenameToUpload = file_id; //2nd priority\
    \ for the file name is demisto's entryID\n    }\n\n    ec.Lastline = {};\n   \
    \ ec.Lastline.Submission = {'Filename': filenameToUpload, 'UUID': uuid, 'Status':\
    \ 'Analyzing'};\n    var md = '';\n    if (!analysisReady(result.obj.data) &&\
    \ timeout > 0) {\n        result = analysisPoll(uuid, timeout, interval);\n  \
    \  }\n    if (analysisReady(result.obj.data)) {\n        ec.Lastline.Submission.Status\
    \ = 'Completed';\n        md = dataToMd(result.obj.data, threshold, filenameToUpload);\n\
    \        var DBotScore = {\n            Indicator: result.obj.data.analysis_subject.md5,\n\
    \            Type: 'hash',\n            Vendor: 'Lastline',\n            Score:\
    \ 0 //score will never be 0\n        };\n        if (result.obj.data.score > threshold)\
    \ { //default is 70\n            var analysis = result.obj.data.analysis_subject;\n\
    \            addMalicious(ec, outputPaths.file, {\n                MD5: analysis.md5,\n\
    \                SHA1: analysis.sha1,\n                SHA256: analysis.sha256,\n\
    \                Malicious: {\n                    Vendor: 'Lastline',\n     \
    \               Description: 'Score above ' + threshold,\n                   \
    \ Score: result.obj.data.score\n                }\n            });\n         \
    \   DBotScore.Score = 3;\n        } else if (result.obj.data.score > 30) { //hard-coded\
    \ due to lastline doc, won't reach if score > threshold\n            DBotScore.Score\
    \ = 2;\n        } else {\n            DBotScore.Score = 1;\n        }\n      \
    \  ec.DBotScore = DBotScore;\n    } else {\n        md += '### Lastline analysis\
    \ for file: **' + filenameToUpload +'**\\n';\n        md += 'File submitted for\
    \ analysis.\\n';\n        md += 'Task UUID: ' + uuid + '\\n';\n    }\n    return\
    \ {\n        Type: entryTypes.note,\n        Contents: result.obj,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext: {\n       \
    \     \"Lastline.Submission(val.UUID==obj.UUID)\": ec.Lastline.Submission,\n \
    \           \"lastlineTasks(val.uuid==obj.uuid)\": ec.lastlineTasks //backward\
    \ compatabillity\n        }\n    };\n}\nfunction UrlUpload(url,threshold,timeout,interval,\
    \ pushToPortal) {\n    // submit URL for analysis and get its report\n    // if\
    \ analysis exists - return it immediately.\n    // if analysis does not exist\
    \ - submit it and either wait or put task id into context\n    if (!timeout) {\n\
    \        timeout = LAST_LINE_DEFAULTS.timeout;\n    }\n    if (!interval) {\n\
    \        interval = LAST_LINE_DEFAULTS.interval;\n    }\n    if (!threshold) {\n\
    \        threshold = LAST_LINE_DEFAULTS.threshold;\n    }\n    if (!pushToPortal)\
    \ {\n        pushToPortal = LAST_LINE_DEFAULTS.pushToPortal;\n    }\n    var result\
    \ = doReq('POST', 'analysis/submit/url', {url: url, full_report_score:threshold,\
    \ push_to_portal:pushToPortal});\n    var uuid = result.obj.data.task_uuid;\n\
    \    var ec = {};\n    ec.lastlineTasks = [{'url': url, 'uuid': uuid}]; //backward\
    \ compatabillity\n    ec.Lastline = {};\n    ec.Lastline.Submission = [{'URL':\
    \ url, 'UUID': uuid, 'Status': 'Analyzing'}];\n    var md = '';\n    if (!analysisReady(result.obj.data)\
    \ && timeout > 0) {\n        result = analysisPoll(uuid,threshold,timeout,interval);\n\
    \    }\n    if (analysisReady(result.obj.data)) {\n        ec.Lastline.Submission.Status\
    \ = 'Completed';\n        var DBotScore = {\n            Indicator: url,\n   \
    \         Type: 'url',\n            Vendor: 'Lastline',\n            Score:0 //score\
    \ will never be 0\n        };\n        md=dataToMd(result.obj.data,threshold);\n\
    \        if (result.obj.data.score > threshold) { //default is 70\n          \
    \  addMalicious(ec, outputPaths.url, {\n                Data: url,\n         \
    \       Malicious: {\n                    Vendor: 'Lastline',\n              \
    \      Description: 'Score above ' + threshold,\n                    Score: result.obj.data.score\n\
    \                }\n            });\n            DBotScore.Score = 3;\n      \
    \  } else if (result.obj.data.score > 30) { //hard-coded due to lastline doc,\
    \ won't reach if score > threshold\n            DBotScore.Score = 2;\n       \
    \ } else {\n            DBotScore.Score = 1;\n        }\n        ec.DBotScore\
    \ = DBotScore;\n    } else {\n        md += '### Lastline analysis for url: **'\
    \ + url +'**\\n';\n        md += 'URL submitted for analysis.\\n';\n        md\
    \ += 'Task UUID: ' + uuid + '\\n';\n    }\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: result.obj,\n        ContentsFormat: formats.json,\n      \
    \  HumanReadable: md,\n        EntryContext: {\n            \"Lastline.Submission(val.UUID==obj.UUID)\"\
    : ec.Lastline.Submission,\n            \"lastlineTasks(val.uuid==obj.uuid)\":\
    \ ec.lastlineTasks //backward compatabillity\n        }\n    };\n}\n\nfunction\
    \ HashGet(hash, threshold) {\n    // get file hash analysis.\n    // If hash is\
    \ not known - return error\n    if (!threshold) {\n        threshold = LAST_LINE_DEFAULTS.threshold;\n\
    \    }\n    var fileParams={full_report_score:threshold};\n    if (MD5_REGEX.test(hash))\
    \ {\n        fileParams.md5=hash;\n    }\n    else if (SHA1_REGEX.test(hash))\
    \ {\n        fileParams.sha1=hash;\n    }\n    else if (SHA256_REGEX.test(hash))\
    \ {\n        fileParams.sha256=hash;\n    }\n    else {\n        throw 'Hash must\
    \ be of the following: MD5, SHA1, SHA256.';\n    }\n    var md='';\n    var ec={};\n\
    \    // check if file hash exists\n    var result = doReq('POST','analysis/submit/file',\
    \ fileParams);\n    if (result.obj.error_code == 101) {\n        throw 'File hash\
    \ not found in Lastline';\n    }\n    var data = result.obj.data;\n    md += dataToMd(data,threshold);\n\
    \    var DBotScore = {\n        Indicator: hash,\n        Type: 'hash',\n    \
    \    Vendor: 'Lastline',\n        Score: 0 //score will never be 0\n    };\n \
    \   if (result.obj.data.score > threshold) { //default is 70\n        var analysis\
    \ = result.obj.data.analysis_subject;\n        addMalicious(ec, outputPaths.file,\
    \ {\n            MD5: analysis.md5,\n            SHA1: analysis.sha1,\n      \
    \      SHA256: analysis.sha256,\n            Type: analysis.mime_type,\n     \
    \       Malicious: {\n                Vendor: 'Lastline',\n                Description:\
    \ 'Score above ' + threshold,\n                Score: result.obj.data.score\n\
    \            }\n        });\n        DBotScore.Score= 3;\n    } else if (result.obj.data.score\
    \ > 30) { //hard-coded due to lastline doc, won't reach if score > threshold\n\
    \        DBotScore.Score= 2;\n    } else {\n        DBotScore.Score= 1;\n    }\n\
    \    ec.DBotScore = DBotScore;\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: result.obj,\n        ContentsFormat: formats.json,\n      \
    \  HumanReadable: md,\n        EntryContext: ec\n    };\n}\n\nfunction GetReport(uuid,threshold,timeout,interval)\
    \ {\n    // get analysis report based on uuid\n    // if report not ready - either\
    \ wait or return waiting message\n    if (!timeout) {\n        timeout = LAST_LINE_DEFAULTS.timeout;\n\
    \    }\n    if (!interval) {\n        interval = LAST_LINE_DEFAULTS.interval;\n\
    \    }\n    if (!threshold) {\n        threshold = LAST_LINE_DEFAULTS.threshold;\n\
    \    }\n    if (!uuid || uuid === '') {\n        throw 'No task UUID provided';\n\
    \    }\n\n    var ec = {};\n    var md = '';\n\n    var result = analysisPoll(uuid,threshold,timeout,interval);\n\
    \    var DBotScore = {Vendor: 'Lastline', Score: 0};\n    if (analysisReady(result.obj.data))\
    \ {\n\n        ec[\"Lastline.Submission(val.UUID===obj.UUID)\"] = {\n        \
    \    'UUID': uuid,\n            'Status': 'Completed',\n        };\n        var\
    \ analysis = result.obj.data;\n\n        if('report' in result.obj.data) {\n \
    \           if ('analysis_subjects' in result.obj.data.report) {\n           \
    \     //mainly in file samples\n                if ('yara_signatures' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].YaraSignatures\
    \ = result.obj.data.report.analysis_subjects[0].yara_signatures;\n           \
    \     }\n                if ('dns_queries' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].DNSqueries\
    \ = result.obj.data.report.analysis_subjects[0].dns_queries;\n               \
    \ }\n                if ('network_connections' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].NetworkConnections\
    \ = result.obj.data.report.analysis_subjects[0].network_connections;\n       \
    \         }\n                if ('downloaded_files' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].DownloadedFiles\
    \ = result.obj.data.report.analysis_subjects[0].downloaded_files;\n          \
    \      }\n                if ('process' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].Process\
    \ = result.obj.data.report.analysis_subjects[0].process;\n                }\n\
    \                //mainly in pcap samples\n                if ('domain_detections'\
    \ in result.obj.data.report.analysis_subjects[0]) {\n                    ec[\"\
    Lastline.Submission(val.UUID===obj.UUID)\"].DomainDetections = result.obj.data.report.analysis_subjects[0].domain_detections;\n\
    \                }\n                if ('ip_detections' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].IPdetections\
    \ = result.obj.data.report.analysis_subjects[0].ip_detections;\n             \
    \   }\n                if ('url_detections' in result.obj.data.report.analysis_subjects[0])\
    \ {\n                    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"].URLdetections\
    \ = result.obj.data.report.analysis_subjects[0].url_detections;\n            \
    \    }\n            }\n        }\n        if ('url' in analysis) {\n         \
    \   DBotScore.Type = 'url';\n            DBotScore.Indicator = analysis.url;\n\
    \            if (result.obj.data.score > threshold) { //default is 70\n      \
    \          addMalicious(ec, outputPaths.url, {\n                    Data: url,\n\
    \                    Malicious: {\n                        Vendor: 'Lastline',\n\
    \                        Description: 'Score above ' + threshold,\n          \
    \              Score: result.obj.data.score\n                    }\n         \
    \       });\n                DBotScore.Score = 3;\n            } else if (result.obj.data.score\
    \ > 30) { //hard-coded due to lastline doc, won't reach if score > threshold\n\
    \                DBotScore.Score = 2;\n            } else {\n                DBotScore.Score\
    \ = 1;\n            }\n        } else {\n            DBotScore.Type = 'hash';\n\
    \            DBotScore.Indicator = analysis.md5;\n            if (result.obj.data.score\
    \ > threshold) { //default is 70\n                addMalicious(ec, outputPaths.file,\
    \ {\n                    MD5: analysis.md5,\n                    SHA1: analysis.sha1,\n\
    \                    SHA256: analysis.sha256,\n                    Type: analysis.mime_type,\n\
    \                    Malicious: {\n                        Vendor: 'Lastline',\n\
    \                        Description: 'Score above ' + threshold,\n          \
    \              Score: result.obj.data.score\n                    }\n         \
    \       });\n            DBotScore.Score = 3;\n            } else if (result.obj.data.score\
    \ > 30) { //hard-coded due to lastline doc, won't reach if score > threshold\n\
    \                DBotScore.Score = 2;\n            } else {\n                DBotScore.Score\
    \ = 1;\n            }\n        }\n        md += dataToMd(result.obj.data,threshold);\n\
    \n    } else {\n        md += '#### Report not ready.\\n';\n        md += 'Task\
    \ UUID: ' + uuid + '\\n';\n    }\n    ec.DBotScore = DBotScore;\n\n    return\
    \ {\n        Type: entryTypes.note,\n        Contents: result.obj,\n        ContentsFormat:\
    \ formats.json,\n        HumanReadable: md,\n        EntryContext: ec\n    };\n\
    }\n\n\nfunction CheckStatus(uuid) {\n    var result;\n    try {\n        result\
    \ = doReq('POST', '/analysis/get', {uuid: uuid});\n    } catch (err) {\n     \
    \   if (err == 'Analysis report is not ready yet.') {\n            return 'Report\
    \ for Task UUID: ' + uuid + ' is not ready';\n        } else {\n            throw\
    \ err;\n        }\n    }\n    var md = '#### Report ready for Task UUID: ' + uuid\
    \ + '.\\n';\n    var ec = {};\n    ec[\"Lastline.Submission(val.UUID===obj.UUID)\"\
    ] = {\n            'UUID': uuid,\n            'Status': 'Completed',\n       \
    \ };\n    return {\n        Type: entryTypes.note,\n        Contents: result,\n\
    \        ContentsFormat: formats.json,\n        HumanReadable: md,\n        EntryContext:\
    \ ec\n    };\n}\n\n\nfunction GetTaskList(before, after) {\n    var headers =\
    \ {};\n    headers.after = after; //mandatory field for lastline\n    if(before)\
    \ { //optional\n        headers.before = before;\n    }\n    var result = doReq('POST',\
    \ '/analysis/get_completed', headers);\n    var jbody = JSON.parse(result.body);\n\
    \    var md = '';\n    if (String(jbody.data.tasks).length > 0) {\n        md\
    \ += '### Lastline completed tasks list:' + \"\\n\";\n        md += objToMd(jbody.data.tasks);\n\
    \    } else {\n        md += 'No tasks were completed during the specified time\
    \ range.';\n    }\n    return {\n        Type: entryTypes.note,\n        Contents:\
    \ result.body,\n        ContentsFormat: formats.json,\n        HumanReadable:\
    \ md,\n    };\n}\n\n// The command input arg holds the command sent from the user.\n\
    try {\n    switch (command) {\n        // This is the call made when pressing\
    \ the integration test button.\n        case 'test-module':\n            UrlUpload('https://google.com');\n\
    \            return 'ok';\n\n        case 'file':\n            return HashGet(args.file,\
    \ args.threshold);\n\n        case 'url': //deprecated\n            return UrlUpload(args.url,\
    \ args.threshold, args.timeout, args.interval);\n        case 'lastline-upload-url':\n\
    \            return UrlUpload(args.url, args.threshold, 0, 0);\n\n        case\
    \ 'lastline-upload': //deprecated\n            return FileUpload(args.file_id,\
    \ args.threshold, args.timeout, args.interval);\n        case 'lastline-upload-file':\n\
    \            return FileUpload(args.EntryID, args.threshold, 0, 0, args.pushToPortal);\n\
    \n        case 'lastline-get': //deprecated\n            if (!args.threshold)\
    \ {\n                args.threshold = LAST_LINE_DEFAULTS.threshold;\n        \
    \    }\n            return GetReport(args.uuid, args.threshold, args.timeout,\
    \ args.interval);\n        case 'lastline-get-report':\n            if (!args.threshold)\
    \ {\n                args.threshold = LAST_LINE_DEFAULTS.threshold;\n        \
    \    }\n            var uuids = argToList(args.uuid);\n            var entries\
    \ = [];\n            for (var i=0; i < uuids.length; i++) {\n                var\
    \ reportResponse = GetReport(uuids[i], args.threshold, 0, 0);\n              \
    \  if (reportResponse.error){\n                    return reportResponse.error;\n\
    \                }\n                entries.push(reportResponse);\n          \
    \  }\n            return entries;\n\n        case 'lastline-check-status':\n \
    \           var uuids = argToList(args.uuid);\n            var entries = [];\n\
    \            for (var i=0; i < uuids.length; i++) {\n                var reportResponse\
    \ = CheckStatus(uuids[i]);\n                entries.push(reportResponse);\n  \
    \          }\n            return entries;\n\n        case 'lastline-get-task-list':\n\
    \            return GetTaskList(args.before, args.after);\n\n        default:\n\
    \            throw 'Unknown command - ' + command;\n    }\n} catch (err) {\n \
    \ return {\n    'Type': entryTypes['error'],\n    'ContentsFormat': formats['text'],\n\
    \    'Contents': err\n  }\n}"
  type: javascript
tests:
- No tests - deprecated
toversion: 4.1.9
