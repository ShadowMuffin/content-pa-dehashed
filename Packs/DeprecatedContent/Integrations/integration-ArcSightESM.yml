category: Analytics & SIEM
commonfields:
  id: ArcSight ESM
  version: -1
configuration:
- defaultvalue: ''
  display: Server URL (e.g. https://192.168.0.1)
  name: server
  required: true
  type: 0
- defaultvalue: '8443'
  display: Port
  name: port
  required: true
  type: 0
- defaultvalue: ''
  display: Credentials
  name: credentials
  required: true
  type: 9
- defaultvalue: ''
  display: Fetch Events as incidents via Query Viewer ID. Mandatory fields for query
    are Start Time and Event ID.
  name: viewerId
  required: false
  type: 0
- defaultvalue: ''
  display: Fetch Cases as incidents via Query Viewer ID. Mandatory fields for query
    are Create Time and ID.
  name: casesQueryViewerId
  required: false
  type: 0
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
deprecated: true
description: ArcSight ESM SIEM by Micro Focus (Formerly HPE Software).
display: ArcSight ESM (deprecated)
fromversion: 4.1.0
hidden: false
image: data:image/png;base64,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
name: ArcSight ESM
script:
  commands:
  - arguments: []
    deprecated: true
    description: commands.server.arcsight.getallcases.description
    name: as-get-all-cases
    outputs:
    - contextPath: ArcSightESM.AllCaseIDs
      description: All cases ids
  - arguments:
    - default: true
      description: commands.server.arcsight.arguments.caseid.description
      name: resourceId
      required: true
    deprecated: true
    description: commands.server.arcsight.getspecificcase.description
    name: as-get-case
    outputs:
    - contextPath: ArcSightESM.Cases.resourceid
      description: The id of the case
    - contextPath: ArcSightESM.Cases.name
      description: Name of the case
    - contextPath: ArcSightESM.Cases.eventIDs
      description: Related base event ids
    - contextPath: ArcSightESM.Cases.createdTimestamp
      description: The time case created
  - arguments:
    - default: true
      description: commands.server.arcsight.arguments.queryid.description
      name: id
      required: true
    - auto: PREDEFINED
      defaultValue: 'true'
      description: If true will return only the columns of the query. If false will
        return the column headers and all query results.
      name: onlyColumns
      predefined:
      - 'true'
      - 'false'
    deprecated: true
    description: commands.server.arcsight.query.description
    name: as-get-matrix-data
  - arguments:
    - description: resource id of the Active list
      name: resourceId
      required: true
    - description: 'Entries in JSON format. JSON must be array of entries. Each entry
        must contain the same columns like in the Active list. Example: [{ "UserName":
        "john", "IP":"19.12.13.11"},{ "UserName": "bob", "IP":"22.22.22.22"}]'
      isArray: true
      name: entries
      required: true
    deprecated: true
    description: Add new entries to Active List
    execution: true
    name: as-add-entries
  - arguments:
    - description: Resource id of specific Active List
      name: resourceId
      required: true
    deprecated: true
    description: Clean all entries in the Active List
    execution: true
    name: as-clear-entries
  - arguments:
    - description: Resource id of specific Active List
      name: resourceId
      required: true
    - description: 'Filters the entries. Example: entryFilter="moo:moo1"'
      name: entryFilter
    deprecated: true
    description: Get all entries from Active List
    name: as-get-entries
    outputs:
    - contextPath: ArcSightESM.ActiveList
      description: Active List is a map of active list resource id => active list
        entries
  - arguments:
    - description: 'Start time filter. Example: 2017-05-22T10:00:00'
      name: startDate
    - description: 'End time filter. Example: 2017-05-22T10:00:00'
      name: endDate
    - description: 'ID or multiple ids separated by comma of security events. Event
        ID is ArcSight is always a number. Example: 13906590'
      name: ids
      required: true
    deprecated: true
    description: Returns the security event details
    name: as-get-security-events
    outputs:
    - contextPath: ArcSightESM.SecurityEvents
      description: List of security events
    - contextPath: ArcSightESM.SecurityEvents.name
      description: The name of the event
    - contextPath: ArcSightESM.SecurityEvents.eventId
      description: Event id
    - contextPath: ArcSightESM.SecurityEvents.type
      description: Type of the event
    - contextPath: ArcSightESM.SecurityEvents.baseEventIds
      description: Base event ids
    - contextPath: ArcSightESM.SecurityEvents.startTime
      description: Start time in milliseconds
  - arguments:
    - description: 'Case ID. Example: 7e6LEbF8BABCfA-dlp1rl1A=='
      name: caseId
      required: true
    deprecated: true
    description: Returns all case event IDs
    name: as-get-case-event-ids
    outputs:
    - contextPath: ArcSightESM.CaseEvents
      description: Map of caseId => related event ids
    - contextPath: ArcSightESM.CaseEvents.LatestResult
      description: Event ids of the last execution of this command
  - arguments:
    - description: The ID of the case
      name: caseId
      required: true
    - auto: PREDEFINED
      description: The stage of case
      name: stage
      predefined:
      - CLOSED
      - QUEUED
      - FINAL
      - FOLLOW_UP
      - INITIAL
    deprecated: true
    description: Updates a case
    name: as-update-case
    outputs:
    - contextPath: ArcSightESM.Cases
      description: List of cases
  - arguments: []
    deprecated: true
    description: Returns all the query viewer ids
    name: as-get-all-query-viewers
    outputs:
    - contextPath: ArcSightESM.AllQueryViewers
      description: List of all query viewer ids
  - arguments:
    - description: The resource id of the case
      name: caseId
      required: true
    deprecated: true
    description: Deletes a case
    execution: true
    name: as-case-delete
  isfetch: true
  script: "var server = params.server.replace(/[\\/]+$/, '') + ':' + params.port +\
    \ '/';\n\n// Arcsight field names\nvar eventIdField = 'Event ID';\nvar caseIdField\
    \ = 'ID';\nvar eventsTimeField = 'Start Time';\nvar casesTimeField = 'Create Time';\n\
    \nvar pathDictionary = {\n    login: 'www/core-service/rest/LoginService/login',\n\
    \    logout: 'www/core-service/rest/LoginService/logout',\n    'as-get-matrix-data':\
    \ 'www/manager-service/rest/QueryViewerService/getMatrixData',\n    'as-get-all-cases':\
    \ 'www/manager-service/rest/CaseService/findAllIds',\n    'as-get-case': 'www/manager-service/rest/CaseService/getResourceById',\n\
    \    'as-get-all-query-viewers': 'www/manager-service/rest/QueryViewerService/findAllIds',\n\
    \    'as-get-case-event-ids': 'www/manager-service/rest/CaseService/getCaseEventIDs',\n\
    \    ActiveListService: 'www/manager-service/services/ActiveListService/'\n};\n\
    \nfunction getToken() {\n    var res = JSON.parse(sendRequest(\n        pathDictionary.login,\
    \ {\n            login: params.credentials.identifier,\n            password:\
    \ params.credentials.password\n        },\n        true));\n\n    if (res && res['log.loginResponse']\
    \ && res['log.loginResponse']['log.return']) {\n        return res['log.loginResponse']['log.return'];\n\
    \    }\n\n    throw 'Failed to login. Check username/password. Original login\
    \ response: ' + res;\n}\n\nfunction logout() {\n    sendRequest(pathDictionary.logout,\
    \ {\n        authToken: args.authToken\n    });\n}\n\nfunction sendRequest(url,\
    \ args, login) {\n    var newArgs = args || {};\n    newArgs.alt = 'json';\n\n\
    \    var fullUrl = server + url + encodeToURLQuery(newArgs);\n    var res = http(\n\
    \        fullUrl, {\n            Method: 'GET',\n            Headers: {\n    \
    \            'Content-Type': ['application/x-www-form-urlencoded'],\n        \
    \        'Accept': ['application/json']\n            }\n        },\n        params.insecure,\n\
    \        params.proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        if (!login) {\n            sendRequest(pathDictionary.logout,\
    \ {\n                authToken: args.authToken\n            });\n        }\n \
    \       throw 'Request to ArcSight ' + (login ? (server + url) : fullUrl) + '\
    \ failed, request status code: ' + res.StatusCode + ' and Body: ' + res.Body +\
    \ '.';\n    }\n\n    return res.Body;\n}\n\nfunction sendAndParse(command, url,\
    \ args) {\n    var json = parseSOAPResponse(sendRequest(url, args));\n    if (!json)\
    \ {\n        return null;\n    }\n\n    var result = json;\n    return result;\n\
    }\n\nfunction postRestRequest(queryPath, param, body) {\n    var stringBody =\
    \ body;\n    if (body && typeof body !== 'string') {\n        stringBody = JSON.stringify(body)\n\
    \    }\n\n    var newArgs = param || {};\n    newArgs.alt = 'json';\n\n    //\
    \ prepare the request url (make sure to encode the query parameter value)\n  \
    \  var requestUrl = server + queryPath;\n    if (newArgs) {\n        requestUrl\
    \ += encodeToURLQuery(newArgs);\n    }\n\n    var res = http(\n        requestUrl,\
    \ {\n            Method: 'POST',\n            Headers: {\n                'Content-Type':\
    \ ['application/json'],\n                'Accept': ['application/json']\n    \
    \        },\n            Body: stringBody\n        },\n        params.insecure,\n\
    \        params.proxy\n    );\n\n    if (res.StatusCode < 200 || res.StatusCode\
    \ >= 300) {\n        throw 'Request Body: ' + stringBody + '\\n' + 'Request Failed\
    \ to ' + requestUrl + '.\\nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res)\
    \ + '.';\n    }\n    return res;\n}\n\nfunction sendSOAPRequest(queryPath, param,\
    \ body) {\n    // prepare the request url (make sure to encode the query parameter\
    \ value)\n    var requestUrl = server + queryPath;\n    if (param) {\n       \
    \ requestUrl += encodeToURLQuery(param);\n    }\n\n    var res = http(\n     \
    \   requestUrl, {\n            Method: 'POST',\n            Body: body\n     \
    \   },\n        params.insecure,\n        params.proxy\n    );\n\n    if (res.StatusCode\
    \ < 200 || res.StatusCode >= 300) {\n        throw 'Request Failed to ' + requestUrl\
    \ + '.\\nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res)\
    \ + '.';\n    }\n\n    return res;\n}\n\nfunction parseSOAPResponse(resBody) {\n\
    \    var matches = resBody.match(/<ns\\d{1,3}:return>(.|[\\r\\n])*<\\/ns\\d{1,3}:return>/);\n\
    \    if (!matches || !matches[0]) {\n        return null;\n    }\n\n    var match\
    \ = matches[0].replace(/:return><ns/gi, ':return>##==##==#<ns').split('##==##==#');\n\
    \    if (match.length === 1) {\n        match = match[0];\n        var json =\
    \ JSON.parse(x2j(match));\n        return json;\n    } else {\n        var arr\
    \ = [];\n        for (var i = 0; i < match.length; i++) {\n            arr.push(JSON.parse(x2j(match[i])).return);\n\
    \        }\n\n        return arr;\n    }\n}\n\nfunction convertByMap(arrSrc, translationMap)\
    \ {\n    var arrDest = [];\n\n    if (!arrSrc) {\n        throw 'arrSrc can\\\
    't be undefined or null';\n    }\n\n    if (!Array.isArray(arrSrc)) {\n      \
    \  arrSrc = [arrSrc];\n    }\n\n    if (!translationMap) {\n        throw 'translationMap\
    \ must contain map';\n    }\n\n    /*\n    [\n        {\n            \"name\"\
    : \"Anar\",\n            \"age\": 19\n        }\n    ]\n\n    ==> { \"NAME\":\
    \ \"name\" }\n    [\n        {\n            \"NAME\": \"Anar\"\n        }\n  \
    \  ]\n\n    */\n    arrSrc.forEach(function(objSrc) {\n        var objDest = {};\n\
    \        Object.keys(translationMap).forEach(function(destKey) {\n           \
    \ var srcKey = translationMap[destKey];\n            objDest[destKey] = dq(objSrc,\
    \ srcKey);\n        });\n        arrDest.push(objDest);\n    });\n\n    return\
    \ arrDest;\n}\n\nfunction getCasesIncidents(lastRun) {\n    var timeField = 'Create\
    \ Time'; // Query must contain Start Time field\n    var newIncidents = [];\n\n\
    \    var response;\n    try {\n        response = getQueryViewerResultsRequest(args.authToken,\
    \ params.casesQueryViewerId, false);\n    } catch (ex) {\n        throw 'Cases\
    \ response to query is not in the correct format. Error: ' + ex;\n    }\n    if\
    \ (!response) {\n        throw 'Cases response to query is empty';\n    }\n  \
    \  var fieldNames = response.columnHeaders;\n    if (fieldNames.indexOf(timeField)\
    \ === -1) {\n        throw 'Cases Query must contain ' + timeField + ' fields';\n\
    \    }\n    var data = response.data;\n\n    var lastEventTime = (lastRun && lastRun.caseLastEventTime)\
    \ ? lastRun.caseLastEventTime : 0;\n    var maxEventTime = lastEventTime;\n  \
    \  for (var i = 0; i < data.length; i++) {\n        var eventTimeInMillis = Number(data[i][timeField]);\n\
    \        if (lastEventTime < eventTimeInMillis) {\n            if (maxEventTime\
    \ < eventTimeInMillis) {\n                maxEventTime = eventTimeInMillis;\n\
    \            }\n            var keys = Object.keys(data[i]);\n            var\
    \ labels = [];\n            for (var j = 0; j < keys.length; j++) {\n        \
    \        if (keys[j] !== 'Name') {\n                    labels.push({\n      \
    \                  type: keys[j],\n                        value: String(data[i][keys[j]])\n\
    \                    });\n                }\n            }\n            newIncidents.push({\n\
    \                name: data[i].Name || ('New case from arcsight at ' + Date.now()),\n\
    \                labels: labels,\n                rawJSON: JSON.stringify(data[i])\n\
    \            });\n        }\n    }\n\n    lastRun.caseLastEventTime = maxEventTime;\n\
    \    return newIncidents;\n}\n\nfunction getEventsIncidents(lastRun) {\n    var\
    \ timeField = 'Start Time'; // Query must contain Start Time field\n    var newIncidents\
    \ = [];\n\n    var response;\n    try {\n        response = getQueryViewerResultsRequest(args.authToken,\
    \ params.viewerId, false);\n    } catch (ex) {\n        throw 'Events response\
    \ to query is not in the correct format. Error: ' + ex;\n    }\n    if (!response)\
    \ {\n        throw 'Events response to query is empty';\n    }\n    var fieldNames\
    \ = response.columnHeaders;\n    if (fieldNames.indexOf(timeField) === -1) {\n\
    \        throw 'Events Query must contain ' + timeField + ' fields';\n    }\n\
    \    var data = response.data;\n    var lastEventTime = lastRun && lastRun.lastEventTime\
    \ ? lastRun.lastEventTime : 0;\n    var maxEventTime = lastEventTime;\n    for\
    \ (var i = 0; i < data.length; i++) {\n        var eventTimeInMillis = Number(data[i][timeField]);\n\
    \        if (lastEventTime < eventTimeInMillis) {\n            if (maxEventTime\
    \ < eventTimeInMillis) {\n                maxEventTime = eventTimeInMillis;\n\
    \            }\n\n            var keys = Object.keys(data[i]);\n            var\
    \ labels = [];\n            for (var j = 0; j < keys.length; j++) {\n        \
    \        if (keys[j] !== 'Name') {\n                    labels.push({\n      \
    \                  type: keys[j],\n                        value: String(data[i][keys[j]])\n\
    \                    });\n                }\n            }\n            newIncidents.push({\n\
    \                name: data[i].Name || ('New event from arcsight at ' + Date.now()),\n\
    \                labels: labels,\n                rawJSON: JSON.stringify(data[i])\n\
    \            });\n        }\n    }\n\n    lastRun.lastEventTime = maxEventTime;\n\
    \    return newIncidents;\n}\n\nfunction convertRowsToStruct(fields, rows) {\n\
    \    var data = [];\n    for (var i = 0; i < rows.length; i++) {\n        var\
    \ newData = {};\n        for (var j = 0; j < fields.length; j++) {\n         \
    \   if (rows[i].value[j]['#text']) {\n                newData[fields[j]] = rows[i].value[j]['#text'];\n\
    \            }\n        }\n        data.push(newData);\n    }\n    return data;\n\
    }\n\nfunction getCase() {\n    var ccase = getCaseRequest(args.authToken, args.resourceId);\n\
    \n    return {\n        Type: entryTypes.note,\n        ContentsFormat: formats.json,\n\
    \        Contents: ccase,\n        ReadableContensFormat: formats.markdown,\n\
    \        HumanReadable: tableToMarkdown('Case ' + args.resourceId, convertByMap(ccase,\
    \ {\n            'Name': 'name',\n            'EventIDs': 'eventIDs',\n      \
    \      'Action': 'action',\n            'Stage': 'stage',\n            'CaseID':\
    \ 'resourceid',\n            'CreatedTime': 'createdTimestamp=Date(val)'\n   \
    \     })),\n        EntryContext: {\n          'ArcSightESM.Cases(val.resourceid===obj.resourceid)':\
    \ ccase\n        }\n    };\n}\n\nfunction getCaseRequest(authToken, resourceId)\
    \ {\n    var reqArgs = {\n        authToken: authToken,\n        resourceId: resourceId\n\
    \    };\n\n    var res = sendRequest(pathDictionary['as-get-case'], reqArgs);\n\
    \    var json = JSON.parse(res);\n    if (json && json['cas.getResourceByIdResponse']\
    \ && json['cas.getResourceByIdResponse']['cas.return']) {\n        return json['cas.getResourceByIdResponse']['cas.return'];\n\
    \    }\n\n    return null;\n}\n\nfunction dlog(obj) {\n    try {\n        log(JSON.stringify(obj,\
    \ null, 2));\n    } catch (err) {\n        log(obj);\n    }\n\n}\n\nfunction getMatrixData()\
    \ {\n    args.onlyColumns = args.onlyColumns === 'true' ? true : false;\n    var\
    \ results = getQueryViewerResultsRequest(args.authToken, args.id, args.onlyColumns);\n\
    \n    var entries = [{\n        Type: entryTypes.note,\n        ContentsFormat:\
    \ formats.json,\n        Contents: results.columnHeaders,\n        ReadableContensFormat:\
    \ formats.markdown,\n        HumanReadable: arrayToMarkdownTable(results.columnHeaders,\
    \ 'Column Headers') // will print only query viewer column headers\n    }];\n\n\
    \    if (!args.onlyColumns) {\n        entries.push({\n            Type: entryTypes.note,\n\
    \            ContentsFormat: formats.json,\n            Contents: results.data,\n\
    \            ReadableContensFormat: formats.markdown,\n            HumanReadable:\
    \ tableToMarkdown('Query Viewer Results: ' + args.id, results.data) // will print\
    \ all the results table\n        });\n    }\n\n    return entries;\n}\n\nfunction\
    \ getQueryViewerResultsRequest(authToken, queryViewerId, includeOnlyHeaders) {\n\
    \    var reqArgs = {\n        authToken: authToken,\n        id: queryViewerId\n\
    \    };\n    var resBody = sendRequest(pathDictionary['as-get-matrix-data'], reqArgs);\n\
    \    var json;\n    try {\n        json = JSON.parse(resBody);\n    } catch(err)\
    \ {\n        throw 'Failed to parse results for query viewer ' + queryViewerId\
    \ + '.\\nRaw response body: ' + resBody;\n    }\n\n\n    var returnObject;\n \
    \   if (json && json['qvs.getMatrixDataResponse'] && json['qvs.getMatrixDataResponse']['qvs.return'])\
    \ {\n        // ArcSight ESM version 6.7 & 6.9 rest API supports qvs.getMatrixDataResponse\n\
    \        returnObject = json['qvs.getMatrixDataResponse']['qvs.return'];\n   \
    \ } else if (json && json['que.getMatrixDataResponse'] && json['que.getMatrixDataResponse']['que.return'])\
    \ {\n        // ArcSight ESM version 6.1 rest API supports que.getMatrixDataResponse\n\
    \        returnObject = json['que.getMatrixDataResponse']['que.return'];\n   \
    \ } else {\n        throw 'Failed to get results for query viewer ' + queryViewerId\
    \ + '.\\nRaw response body: ' + JSON.stringify(json);\n    }\n\n    var columnHeaders\
    \ = dq(returnObject, 'columnHeaders');\n    if (columnHeaders && !Array.isArray(columnHeaders))\
    \ {\n        columnHeaders = [columnHeaders];\n    }\n    if (includeOnlyHeaders)\
    \ {\n        return {\n            columnHeaders: columnHeaders\n        };\n\
    \    }\n\n    if (!returnObject.rows || !Array.isArray(returnObject.rows) || returnObject.rows.length\
    \ === 0) {\n        // there are no results\n        return {\n            columnHeaders:\
    \ columnHeaders,\n            data: []\n        };\n    }\n\n    if (!columnHeaders\
    \ || !columnHeaders.length || columnHeaders.length === 0) {\n        // no columns\
    \ exists\n        return {\n            columnHeaders: [],\n            data:\
    \ []\n        };\n    }\n\n    // we should parse the raws by column headers and\
    \ create result objects from them\n    var queryResults = [];\n    for (var i\
    \ = 0; i < returnObject.rows.length; i++) {\n        var row = returnObject.rows[i].value;\n\
    \        var qResult = {};\n        for (var columnIdx = 0; columnIdx < columnHeaders.length;\
    \ columnIdx++) {\n            column = columnHeaders[columnIdx];\n           \
    \ qResult[column] = row[columnIdx]['$'];\n        }\n        queryResults.push(qResult);\n\
    \    }\n\n    return {\n        columnHeaders: columnHeaders,\n        data: queryResults\n\
    \    };\n}\n\nfunction getAllCases() {\n    var allCases = getAllCasesRequest(args.authToken);\n\
    \n    return {\n        Type: entryTypes.note,\n        ContentsFormat: formats.json,\n\
    \        Contents: allCases,\n        ReadableContensFormat: formats.markdown,\n\
    \        HumanReadable: arrayToMarkdownTable(allCases, 'Case ID'),\n        EntryContext:\
    \ {\n          'ArcSightESM.AllCaseIDs': allCases\n        }\n    };\n}\n\nfunction\
    \ getAllCasesRequest(authToken) {\n    var reqArgs = {\n        authToken: authToken\n\
    \    };\n\n    var json = JSON.parse(sendRequest(pathDictionary['as-get-all-cases'],\
    \ reqArgs));\n    if (json && json['cas.findAllIdsResponse'] && json['cas.findAllIdsResponse']['cas.return'])\
    \ {\n        return json['cas.findAllIdsResponse']['cas.return'];\n    }\n\n \
    \   return null;\n}\n\nfunction getAllQueryViewers() {\n    var json = JSON.parse(sendRequest(pathDictionary['as-get-all-query-viewers'],\
    \ args));\n    if (!json || !json['qvs.findAllIdsResponse'] || !json['qvs.findAllIdsResponse']['qvs.return'])\
    \ {\n        return null;\n    }\n\n    var queryList = json['qvs.findAllIdsResponse']['qvs.return'];\n\
    \    return {\n        Type: entryTypes.note,\n        ContentsFormat: formats.json,\n\
    \        Contents: queryList,\n        ReadableContensFormat: formats.markdown,\n\
    \        HumanReadable: arrayToMarkdownTable(queryList, 'Query Viewers'),\n  \
    \      EntryContext: {\n            'ArcSightESM.AllQueryViewers': queryList\n\
    \        }\n    };\n}\n\n// convertCsvToEntryListObject converts entries which\
    \ is array of entry objects into entryList object according to the SOAP request\n\
    // entryList object contains separately the columns and the entries\nfunction\
    \ convertCsvToEntryListObject(entries) {\n    var entryList = [];\n    var columns\
    \ = [];\n    var column;\n\n    if (!entries || !Array.isArray(entries) || entries.length\
    \ === 0) {\n        return {\n            columns: [],\n            entryList:\
    \ []\n        };\n    }\n\n    // extract the columns\n    for (column in entries[0])\
    \ {\n        if (entries[0].hasOwnProperty(column)) {\n            columns.push(column);\n\
    \        }\n    }\n\n    // get the entries\n    for (var i = 0; i < entries.length;\
    \ i++) {\n        entryRow = [];\n        for (var j = 0; j < columns.length;\
    \ j++) {\n            column = columns[j];\n            var innerEntryValue =\
    \ entries[i][column];\n            entryRow.push(innerEntryValue);\n        }\n\
    \        entryList.push(entryRow);\n    }\n\n\n    return {\n        columns:\
    \ columns,\n        entryList: entryList\n    };\n}\n\nfunction convertFromEntryListToJSON(entryList)\
    \ {\n    var columns = entryList.return.columns;\n    var entries = entryList.return.entryList;\n\
    \n    if (!entries) {\n        return [];\n    }\n\n    // if there is only single\
    \ column in columns then columns will be parsed as string instead of array\n \
    \   // the algorithm requires columns to be array\n    if (columns && !Array.isArray(columns))\
    \ {\n        columns = [columns];\n        for (var k = 0; k < entries.length;\
    \ k++) {\n            entries[k].entry = [entries[k].entry];\n        }\n    }\n\
    \n    var entriesArray = [];\n    for (var i = 0; i < entries.length; i++) {\n\
    \        var newEntry = {};\n        for (var columnIdx = 0; columnIdx < columns.length;\
    \ columnIdx++) {\n            var column = columns[columnIdx];\n\n           \
    \ var innerEntry = entries[i].entry[columnIdx];\n            newEntry[column]\
    \ = innerEntry;\n        }\n\n        entriesArray.push(newEntry);\n    }\n\n\
    \    return entriesArray;\n}\n\n\nvar addEntriesTemplate = '<?xml version=\"1.0\"\
    \ encoding=\"UTF-8\"?><soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:act=\"http://ws.v1.service.resource.manager.product.arcsight.com/activeListService/\"\
    \ xmlns:xsd=\"http://activelist.model.v1.service.resource.manager.product.arcsight.com/xsd\"\
    ><soapenv:Header /><soapenv:Body><act:addEntries><act:authToken>%authToken%</act:authToken><act:resourceId>%resourceId%</act:resourceId><act:entryList>%entryList%</act:entryList></act:addEntries></soapenv:Body></soapenv:Envelope>';\n\
    \nfunction addEntries() {\n    var entries = args.entries;\n    if (typeof args.entries\
    \ === 'string') {\n        try {\n            entries = JSON.parse(args.entries);\n\
    \        } catch (err) {\n            throw 'entries must be in JSON format. Must\
    \ be array of objects.'\n        }\n    }\n    var entryList = convertCsvToEntryListObject(entries)\n\
    \    var stringBuilder = [];\n    entryList.columns.forEach(function(column) {\n\
    \        stringBuilder.push(replaceInTemplates('<columns>%column%</columns>',\
    \ {\n            column: column\n        }));\n    });\n\n    entryList.entryList.forEach(function(entryRow)\
    \ {\n        stringBuilder.push('<entryList>');\n        entryRow.forEach(function(entry)\
    \ {\n            stringBuilder.push(replaceInTemplates('<entry>%entry%</entry>',\
    \ {\n                entry: entry\n            }));\n        })\n        stringBuilder.push('</entryList>');\n\
    \    });\n\n    var entryListXml = stringBuilder.join('');\n    var soapReq =\
    \ replaceInTemplates(addEntriesTemplate, {\n        authToken: args.authToken,\n\
    \        resourceId: args.resourceId,\n        entryList: entryListXml\n    });\n\
    \    sendSOAPRequest('www/manager-service/services/ActiveListService/', null,\
    \ soapReq);\n    return 'Success';\n}\n\nvar clearEntriesTemplate = '<soapenv:Envelope\
    \ xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:act=\"http://ws.v1.service.resource.manager.product.arcsight.com/activeListService/\"\
    ><soapenv:Header/><soapenv:Body><act:clearEntries><act:authToken>%authToken%</act:authToken><act:resourceId>%resourceId%</act:resourceId></act:clearEntries></soapenv:Body></soapenv:Envelope>';\n\
    \nfunction clearEntries() {\n    var soapReq = replaceInTemplates(clearEntriesTemplate,\
    \ {\n        authToken: args.authToken,\n        resourceId: args.resourceId\n\
    \    });\n    var res = sendSOAPRequest('www/manager-service/services/ActiveListService/',\
    \ null, soapReq);\n    return 'Success';\n}\n\nvar getEntriesTemplate = '<soapenv:Envelope\
    \ xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:act=\"http://ws.v1.service.resource.manager.product.arcsight.com/activeListService/\"\
    >\\\n<soapenv:Header/>\\\n<soapenv:Body>\\\n<act:getEntries>\\\n<act:authToken>%authToken%</act:authToken>\\\
    \n<act:resourceId>%resourceId%</act:resourceId>\\\n</act:getEntries>\\\n</soapenv:Body>\\\
    \n</soapenv:Envelope>';\n\nfunction getEntries() {\n    var soapReq = replaceInTemplates(getEntriesTemplate,\
    \ {\n        authToken: args.authToken,\n        resourceId: args.resourceId\n\
    \    });\n    var res = sendSOAPRequest('www/manager-service/services/ActiveListService/',\
    \ null, soapReq);\n\n    var parsedResponse = parseSOAPResponse(res.Body);\n \
    \   var entryArray = convertFromEntryListToJSON(parsedResponse);\n\n    // get\
    \ the column headers which exists in Active List\n    var columns = dq(parsedResponse,\
    \ 'return.columns');\n    if (columns && !Array.isArray(columns)) {\n      columns\
    \ = [columns];\n    }\n\n    if (args.entryFilter) {\n        var filteredEntries\
    \ = [];\n        var conditions = args.entryFilter.split(':');\n        var conditionKey\
    \ = conditions[0]; // moo\n        var conditionValue = conditions[1]; // moo1\n\
    \n        for (var i = 0; i < entryArray.length; i++) {\n            var entry\
    \ = entryArray[i];\n\n            if (entry[conditionKey] === conditionValue)\
    \ {\n                filteredEntries.push(entry);\n            }\n        }\n\
    \        entryArray = filteredEntries;\n    }\n\n    var entryContext = {};\n\
    \    entryContext['ArcSightESM.ActiveList.' + args.resourceId] = entryArray;\n\
    \    return [\n      {\n          Type: entryTypes.note,\n          ContentsFormat:\
    \ formats.json,\n          Contents: {\n              columns: columns\n     \
    \     },\n          ReadableContentsFormat: formats.markdown,\n          HumanReadable:\
    \ columns ? arrayToMarkdownTable(columns, 'Columns') : 'Active list has no columns'\n\
    \      },\n      {\n          Type: entryTypes.note,\n          ContentsFormat:\
    \ formats.json,\n          Contents: {\n              result: entryArray\n   \
    \       },\n          ReadableContentsFormat: formats.markdown,\n          HumanReadable:\
    \ (!entryArray || entryArray.length) ? tableToMarkdown('Active List Entries: '\
    \ + args.resourceId, entryArray) : 'Active List has no entries',\n          EntryContext:\
    \ entryContext\n      }\n    ];\n}\n\n\nfunction getCaseEventIDs() {\n    var\
    \ json = JSON.parse(sendRequest(pathDictionary['as-get-case-event-ids'], args));\n\
    \    if (!json || !json['cas.getCaseEventIDsResponse'] || !json['cas.getCaseEventIDsResponse']['cas.return'])\
    \ {\n        return null;\n    }\n\n    var eventIds = json['cas.getCaseEventIDsResponse']['cas.return'];\n\
    \    if (!eventIds) {\n        // case has no events\n        return null;\n \
    \   }\n\n    if (!Array.isArray(eventIds)) {\n        eventIds = [eventIds];\n\
    \    }\n    var entryContext = {};\n    entryContext['ArcSightESM.CaseEvents']\
    \ = eventIds;\n    return {\n        Type: entryTypes.note,\n        ContentsFormat:\
    \ formats.json,\n        Contents: json,\n        ReadableContentsFormat: formats.markdown,\n\
    \        HumanReadable: arrayToMarkdownTable(eventIds, 'Case ' + args.caseId +\
    \ ' Event IDs'),\n        EntryContext: entryContext\n    };\n}\n\nfunction updateCase()\
    \ {\n    var currentCase = getCaseRequest(args.authToken, args.caseId);\n    if\
    \ (!currentCase) {\n        throw 'There is no such case: ' + args.caseId;\n \
    \   }\n\n    var updatedCase = currentCase;\n    updatedCase.stage = args.stage;\n\
    \    var soapReq = {\n        'cas.update': {\n            'cas.authToken': args.authToken,\n\
    \            'cas.resource': updatedCase\n        }\n    };\n    try {\n     \
    \   var res = postRestRequest('www/manager-service/rest/CaseService/update', null,\
    \ soapReq);\n    } catch (err) {\n        throw 'soapReq: ' + soapReq + '\\n'\
    \ + err;\n    }\n\n    // creating human readable table\n    var response = JSON.parse(res.Body)\n\
    \n    if (!response || !response['cas.updateResponse'] || !response['cas.updateResponse']['cas.return'])\
    \ {\n        return null;\n    }\n\n    var responseUpdatedCase = response['cas.updateResponse']['cas.return'];\n\
    \    var entryContext = {};\n    entryContext['ArcSightESM.Cases(val.resourceid===obj.resourceid)']\
    \ = responseUpdatedCase;\n    return {\n        Type: entryTypes.note,\n     \
    \   ContentsFormat: formats.json,\n        Contents: responseUpdatedCase,\n  \
    \      ReadableContensFormat: formats.markdown,\n        HumanReadable: tableToMarkdown('Case\
    \ ' + args.caseId, convertByMap(responseUpdatedCase, {\n            'Name': 'name',\n\
    \            'EventIDs': 'eventIDs',\n            'Action': 'action',\n      \
    \      'Stage': 'stage',\n            'CaseID': 'resourceid',\n            'CreatedTime':\
    \ 'createdTimestamp=Date(val)'\n        })),\n        EntryContext: entryContext\n\
    \    };\n}\n\nfunction deleteCase() {\n    deleteCaseRequest(args.authToken, args.caseId);\n\
    \n    return {\n        Type: entryTypes.note,\n        ContentsFormat: formats.text,\n\
    \        Contents: 'Case ' + args.caseId + ' successfully deleted'\n    };\n}\n\
    function deleteCaseRequest(authToken, caseId) {\n    var reqBody = {\n       \
    \ 'cas.deleteByUUID': {\n            'cas.authToken': authToken,\n           \
    \ 'cas.id': caseId\n        }\n    };\n    var res = postRestRequest('www/manager-service/rest/CaseService/deleteByUUID',\
    \ null, reqBody);\n    return res;\n}\n\nvar intToIpDT = ';function intToIP(int){\\\
    \n    var part1 = int & 255;\\\n    var part2 = ((int >> 8) & 255);\\\n    var\
    \ part3 = ((int >> 16) & 255);\\\n    var part4 = ((int >> 24) & 255);\\\n   \
    \ return part4 + \".\" + part3 + \".\" + part2 + \".\" + part1;\\\n};';\n\n//\
    \ table from JSON to human readable table\nvar eventTranslateMap = {\n    'Event\
    \ ID': 'eventId',\n    'Time': 'endTime=new Date(Number(val)).toLocaleString()',\n\
    \    'Source Address': 'source.address=intToIP(val)' + intToIpDT,\n    'Destination\
    \ Address': 'destination.address=intToIP(val)' + intToIpDT,\n    'Name': 'name',\n\
    \    'Source Port': 'source.port',\n    'Base Event IDs': 'baseEventIds'\n};\n\
    \nfunction getSecurityEvents() {\n    var events = getSecurityEventsRequest(args.authToken,\
    \ args.ids, args.startDate, args.endDate);\n    var hr = 'No events found';\n\
    \    if (events) {\n        hr = tableToMarkdown('Security Event: ' + args.ids,\
    \ convertByMap(events, eventTranslateMap))\n    }\n\n    var entryContext = {};\n\
    \    entryContext['ArcSightESM.SecurityEvents(val.eventId===obj.eventId)'] = events;\n\
    \    return {\n        Type: entryTypes.note,\n        ContentsFormat: formats.json,\n\
    \        Contents: { events: events },\n        ReadableContentsFormat: formats.markdown,\n\
    \        HumanReadable: hr,\n        EntryContext: entryContext\n    };\n}\n\n\
    function getSecurityEventsRequest(authToken, ids, startDate, endDate) {\n    var\
    \ startMillis = -1;\n    if (startDate) {\n        if (isNaN(Date.parse(startDate)))\
    \ {\n            throw 'startDate must be of format yyyy-mm-ddTHH:MM:SS. Example:\
    \ 2015-09-22T10:00:00';\n        }\n        startMillis = new Date(startDate).getTime();\n\
    \    }\n    var endMillis = -1;\n    if (endDate) {\n        if (isNaN(Date.parse(endDate)))\
    \ {\n            throw 'endDate must be of format yyyy-mm-ddTHH:MM:SS. Example:\
    \ 2015-09-22T10:00:00';\n        }\n        endMillis = new Date(endDate).getTime();\n\
    \    }\n\n    var arrIDs = [];\n    if (typeof ids === 'string') {\n      var\
    \ split = ids.split(',');\n      for (var i = 0; i < split.length; i++) {\n  \
    \        var id = split[i];\n          if (isNaN(id)) {\n              throw 'id\
    \ ' + id + ' must be numeric';\n          }\n          arrIDs.push(parseInt(id));\n\
    \      }\n    } else if (typeof ids === 'number') {\n      // ids passed as number\n\
    \      // so there only single id\n      arrIDs.push(ids);\n    }\n\n    var soapReq\
    \ = {\n        'sev.getSecurityEvents': {\n            'sev.authToken': authToken,\n\
    \            'sev.ids': arrIDs,\n            'sev.startMillis': startMillis,\n\
    \            'sev.endMillis': endMillis\n        }\n    };\n    var res = postRestRequest('www/manager-service/rest/SecurityEventService/getSecurityEvents',\
    \ null, soapReq);\n\n    // creating human readable table\n    var json = JSON.parse(res.Body);\n\
    \    if (!json || !json['sev.getSecurityEventsResponse'] || !json['sev.getSecurityEventsResponse']['sev.return'])\
    \ {\n        return null;\n    }\n\n    var events = json['sev.getSecurityEventsResponse']['sev.return'];\n\
    \n    if (!Array.isArray(events)) {\n        events = [events];\n    }\n\n   \
    \ return events;\n}\n\n\nvar dashboardDataTemplateWithEnv = '<soapenv:Envelope\
    \ xmlns:soapenv=\\'http://schemas.xmlsoap.org/soap/envelope/\\'  xmlns:ns2=\\\
    'http://ws.v1.service.resource.manager.product.arcsight.com/dashboardService/\\\
    '  xmlns:ns5=\\'http://model.v1.service.resource.manager.product.arcsight.com/xsd\\\
    '>\\\n                                    <soapenv:Header/>\\\n              \
    \                      <soapenv:Body>\\\n                                    \
    \  <ns2:getDashboardIfNewer>\\\n                                        <ns2:authToken>%authToken%</ns2:authToken>\\\
    \n                                        <ns2:id>%monitorID%</ns2:id>\\\n   \
    \                                     <ns2:currentSignature>\\\n             \
    \                               <ns5:id>%monitorID%</ns5:id>\\\n             \
    \                               <ns5:modificationCount>%modificationCount%</ns5:modificationCount>\\\
    \n                                        </ns2:currentSignature>\\\n        \
    \                              </ns2:getDashboardIfNewer>\\\n                \
    \                    </soapenv:Body>\\\n                                  </soapenv:Envelope>';\n\
    \n// currently this function is not works\nfunction getDashboardData(authToken,\
    \ modCount, monitorID) {\n    var soapReq = replaceInTemplates(dashboardDataTemplateWithEnv,\
    \ {\n        authToken: authToken,\n        modificationCount: modCount,\n   \
    \     monitorID: monitorID\n    });\n    //return soapReq;\n    var res = postRestRequest('www/manager-service/services/DashboardService/',\
    \ null, soapReq);\n    return res.Body;\n}\n\n\nvar monitorDataTemplateWithEnv\
    \ = '<soapenv:Envelope xmlns:soapenv=\\'http://schemas.xmlsoap.org/soap/envelope/\\\
    '  xmlns:ns2=\\'http://ws.v1.service.resource.manager.product.arcsight.com/dataMonitorService/\\\
    '  xmlns:ns5=\\'http://model.v1.service.resource.manager.product.arcsight.com/xsd\\\
    '>\\\n                                  <soapenv:Header/>\\\n                \
    \                  <soapenv:Body>\\\n                                    <ns2:getDataMonitorIfNewer>\\\
    \n                                      <ns2:authToken>%authToken%</ns2:authToken>\\\
    \n                                      <ns2:id>%monitorID%</ns2:id>\\\n     \
    \                                 <ns2:currentSignature>\\\n                 \
    \                       <ns5:id>%monitorID%</ns5:id>\\\n                     \
    \                   <ns5:modificationCount>%modificationCount%</ns5:modificationCount>\\\
    \n                                      </ns2:currentSignature>\\\n          \
    \                          </ns2:getDataMonitorIfNewer>\\\n                  \
    \                </soapenv:Body>\\\n                                </soapenv:Envelope>';\n\
    \nfunction getDataMonitor(authToken, modCount, monitorID) {\n    var soapReq =\
    \ replaceInTemplates(monitorDataTemplateWithEnv, {\n        authToken: authToken,\n\
    \        modificationCount: modCount,\n        monitorID: monitorID\n    });\n\
    \    var res = postRestRequest('www/manager-service/services/DataMonitorService/',\
    \ null, soapReq);\n    return res.Body;\n}\n\nfunction test() {\n    var isFetch\
    \ = params.isFetch;\n    if (isFetch && !params.viewerId && !params.casesQueryViewerId)\
    \ {\n        throw 'If Fetch incidents is on, then Events Query Viewer ID or Case\
    \ Query Viewer ID must be passed';\n    }\n\n    var results;\n    var columnHeaders\n\
    \    if (isFetch && params.viewerId) {\n        try {\n            results = getQueryViewerResultsRequest(args.authToken,\
    \ params.viewerId, true);\n        } catch(ex) {\n            throw 'Make sure\
    \ Events query viewer id is valid.\\nOriginal Error: ' + ex;\n        }\n    \
    \    columnHeaders = results.columnHeaders;\n        if (columnHeaders.indexOf(eventsTimeField)\
    \ === -1) {\n            throw 'Event Query in ArcSight must select \"' + eventsTimeField\
    \ + '\" field';\n        }\n        if (columnHeaders.indexOf(eventIdField) ===\
    \ -1) {\n            throw 'Event Query in ArcSight  must select \"' + eventIdField\
    \ + '\" field';\n        }\n    }\n\n    if (isFetch && params.casesQueryViewerId)\
    \ {\n        try {\n            results = getQueryViewerResultsRequest(args.authToken,\
    \ params.casesQueryViewerId, true);\n        } catch(ex) {\n            throw\
    \ 'Make sure Cases query viewer id is valid.\\nOriginal Error: ' + ex;\n     \
    \   }\n        columnHeaders = results.columnHeaders;\n        if (columnHeaders.indexOf(casesTimeField)\
    \ === -1) {\n            throw 'Case Query in ArcSight must select \"' + casesTimeField\
    \ + '\" field';\n        }\n        if (columnHeaders.indexOf(caseIdField) ===\
    \ -1) {\n            throw 'Case Query in ArcSight must select \"' + caseIdField\
    \ + '\" field';\n        }\n    }\n}\n\nvar result;\nargs.authToken = getToken();\n\
    switch (command) {\n    case 'test-module':\n        test();\n        result =\
    \ 'ok';\n        break;\n    case 'fetch-incidents':\n        var lastRun = getLastRun();\n\
    \        lastRun = lastRun && lastRun.value ? JSON.parse(lastRun.value) : {};\n\
    \        var casesIncidents = [];\n        var eventsIncidents = [];\n       \
    \ if (params.casesQueryViewerId) {\n            casesIncidents = getCasesIncidents(lastRun);\n\
    \        }\n        if (params.viewerId) {\n            eventsIncidents = getEventsIncidents(lastRun);\n\
    \        }\n\n        setLastRun({\n            value: JSON.stringify(lastRun)\n\
    \        });\n        result = JSON.stringify(casesIncidents.concat(eventsIncidents));\n\
    \        break;\n    case 'as-get-matrix-data':\n        result = getMatrixData();\n\
    \        break;\n    case 'as-get-all-cases':\n        result = getAllCases();\n\
    \        break;\n    case 'as-get-all-query-viewers':\n        result = getAllQueryViewers();\n\
    \        break;\n    case 'as-get-case':\n        result = getCase();\n      \
    \  break;\n    case 'as-add-entries':\n        result = addEntries();\n      \
    \  break;\n    case 'as-clear-entries':\n        result = clearEntries();\n  \
    \      break;\n    case 'as-get-entries':\n        result = getEntries();\n  \
    \      break;\n    case 'as-get-security-events':\n        result = getSecurityEvents();\n\
    \        break;\n    case 'as-get-case-event-ids':\n        result = getCaseEventIDs();\n\
    \        break;\n    case 'as-update-case':\n        result = updateCase();\n\
    \        break;\n    case 'as-case-delete':\n        result = deleteCase();\n\
    \        break;\n    default:\n        result = sendAndParse(command, pathDictionary[command],\
    \ args);\n}\ntry {\n    logout();\n} catch (err) {\n    demisto.error('Failed\
    \ to logout ArcSight ESM session. Error: ' + err);\n}\n\nreturn result;"
  type: javascript
tests:
- No test
toversion: 4.1.9
