category: Forensics & Malware Analysis
commonfields:
  id: Intezer
  version: -1
configuration:
- defaultvalue: ''
  display: API Key
  name: APIKey
  required: true
  type: 4
- defaultvalue: 'true'
  display: Use system proxy settings
  name: useproxy
  required: false
  type: 8
deprecated: true
description: Malware detection and analysis based on code reuse.
detaileddescription: "Intezer\u2019s cloud-based malware detection and analysis provides\
  \ a fast, in-depth understanding of any file by mapping its code DNA.\nSee [https://analyze.intezer.com](https://analyze.intezer.com)\
  \ for creating API key and more details.\n"
display: Intezer
image: data:image/png;base64,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
name: Intezer
script:
  commands:
  - arguments:
    - default: true
      description: Hash of the file to query. Supports SHA256
      isArray: true
      name: file
    - description: SHA256 hash of the file to query
      isArray: true
      name: sha256
    - auto: PREDEFINED
      defaultValue: file
      description: Item type - File (file), Memory Module (memory_module) or Memory
        Fileless Code (fileless_code)
      name: codeItemType
      predefined:
      - file
      - memory_module
      - fileless_code
    - defaultValue: '60'
      description: Number of retries for polling the analysis report
      name: maxRetries
    - defaultValue: '5'
      description: Delay in seconds between polling of analysis results
      name: delay
    description: Checks file reputation of the given hash, supports SHA256
    name: file
    outputs:
    - contextPath: File.SHA256
      description: Hash SHA256
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    - contextPath: File.ExistsInIntezer
      description: 'File exists in Intezer genome database (in case file does not
        exist, consider upload the file) '
      type: boolean
    - contextPath: File.Metadata
      description: Metadata returned from Intezer analysis (analysis id, analysis
        url, family, family type, sha256, verdict, sub_verdict). Metedata will be
        retuned only for supported files.
      type: unknown
  - arguments:
    - default: true
      description: The file entry id to upload
      name: fileEntryId
      required: true
    - auto: PREDEFINED
      defaultValue: file
      description: Item type - File (file), Memory Module (memory_module) or Memory
        Fileless Code (fileless_code)
      name: codeItemType
      predefined:
      - file
      - memory_module
      - fileless_code
    - defaultValue: '60'
      description: Number of retries for polling the analysis report
      name: maxRetries
    - defaultValue: '5'
      description: Delay in seconds between polling of analysis results
      name: delay
    description: Checks file reputation for uploaded file (up to 20MB)
    name: intezer-upload
    outputs:
    - contextPath: File.SHA256
      description: Hash SHA256
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    - contextPath: File.Metadata
      description: Metadata returned from Intezer analysis (analysis id, analysis
        url, family, family type, sha256, verdict, sub_verdict). Metedata will be
        retuned only for supported files.
  runonce: false
  script: "var SERVER_API = 'https://analyze.intezer.com/api/';\nvar IS_AVAILABLE_URL\
    \ = 'is-available';\nvar HASH_URL = 'v1-2/analyze-by-sha256';\nvar FILE_UPLOAD_URL\
    \ = 'v1-2/analyze';\nvar ANALYSIS_RESULT_URL = 'v1-2/analyses/';\nvar SHA_256_REGEXP\
    \ = new RegExp('[A-Fa-f0-9]{64}');\nvar SHA_1_REGEXP = new RegExp('[A-Fa-f0-9]{40}');\n\
    var MD_5_REGEXP = new RegExp('[A-Fa-f0-9]{32}');\nvar SUCCESS_STATUS = 'succeeded';\n\
    var ERROR_PREFIX = 'Error from Intezer: ';\n\nvar sendRequest = function(method,\
    \ url, body, acceptedCodes) {\n    // handle '/' at the end of the url\n    if\
    \ (url[url.length - 1] === '/') {\n        url = url.substring(0, url.length -\
    \ 1);\n    }\n    if (!body) {\n        body = {};\n    }\n    body.api_key =\
    \ params.APIKey;\n    // no need to handle url query encoding in GET (as no such\
    \ api in Intezer)\n    var result = http(\n        SERVER_API + url,\n       \
    \ {\n            Headers: {'Content-Type': ['application/json'], 'Accept': ['application/json']},\n\
    \            Method: method,\n            Body: method == 'POST' ? JSON.stringify(body)\
    \ : ''\n        },\n        false,\n        params.useproxy\n    );\n    return\
    \ handleResponse(result, url, acceptedCodes);\n};\n\nvar sendMultipartRequest\
    \ = function(url, file, body) {\n    // handle '/' at the end of the url\n   \
    \ if (url[url.length - 1] === '/') {\n        url = url.substring(0, url.length\
    \ - 1);\n    }\n    if (!body) {\n        body = {};\n    }\n    body.api_key\
    \ = params.APIKey;\n    var result = httpMultipart(\n      SERVER_API + url,\n\
    \      file,\n      {\n        Method: 'POST',\n        Headers: {'Content-Type':\
    \ ['multipart/form-data']},\n      },\n      body\n    );\n    return handleResponse(result,\
    \ url);\n};\n\nvar handleResponse = function(result, url, acceptedCodes) {\n \
    \   var ignoreStatusCode = acceptedCodes && (acceptedCodes.indexOf(result.StatusCode)\
    \ !== -1);\n    // validate response\n    if (!ignoreStatusCode && (result.StatusCode\
    \ < 200 || result.StatusCode > 299)) {\n        switch (result.StatusCode) {\n\
    \            case 400:\n                throw ERROR_PREFIX + '400 Bad Request\
    \ - Wrong or invalid parameters\\n';\n            case 401:\n                throw\
    \ ERROR_PREFIX + '401 Unauthorized - Wrong or invalid api key\\n';\n         \
    \   case 403:\n                throw ERROR_PREFIX + '403 Forbidden - The API key\
    \ is not valid\\n';\n            case 404:\n                throw ERROR_PREFIX\
    \ + '404 Not Found - Access to expired analysis URL or sha256 not found for analysis\
    \ by sha256\\n';\n            case 410:\n                throw ERROR_PREFIX +\
    \ '410 Gone - Analysis no longer exists in the service\\n';\n            case\
    \ 413:\n                throw ERROR_PREFIX + '413 Payload Too Large - Large request\\\
    n';\n            case 415:\n                throw ERROR_PREFIX + '415 Unsupported\
    \ Media Type - Wrong or missing content type\\n';\n            case 500:\n   \
    \             throw ERROR_PREFIX + '500 Internal Server Error - Internal error\\\
    n';\n            case 503:\n                throw ERROR_PREFIX + '503 Service\
    \ Unavailable\\n';\n            default:\n                throw ERROR_PREFIX +\
    \ 'Failed to perform request ' + SERVER_API + url + ', request status code: '\
    \ + result.StatusCode + '\\n';\n        }\n    }\n    if (result.Body === '' &&\
    \ result.StatusCode === 204) {\n        return { statusCode: result.StatusCode\
    \ };\n    }\n    if (result.Body === '') {\n        throw ERROR_PREFIX + 'No content\
    \ received' + '\\n';\n    }\n    var obj;\n    try {\n        obj = JSON.parse(result.Body);\n\
    \    } catch (ex) {\n        throw ERROR_PREFIX + 'Error parsing reply - ' + result.Body\
    \ + ' - ' + ex;\n    }\n    return { body: result.Body, obj: obj, statusCode:\
    \ result.StatusCode };\n};\n\nvar getAnalysis = function(analysisId) {\n    var\
    \ analysisRes = sendRequest('POST', ANALYSIS_RESULT_URL + analysisId);\n    return\
    \ analysisRes.obj;\n};\n\nvar analyzeSHA256 = function(hash, codeItemType, maxRetries,\
    \ delay) {\n    // validate file is indeed sha256\n    if (!SHA_256_REGEXP.test(hash))\
    \ {\n        var warning = 'Intezer file hash reputation supports only SHA256.\\\
    n';\n        return {\n          Type: 11, // warning type\n          Contents:\
    \ warning,\n          ContentsFormat: formats.markdown\n        };\n    }\n  \
    \  // create file analysis request\n    var res = sendRequest('POST', HASH_URL,\
    \ {\n        sha256: hash,\n        code_item_type: codeItemType\n    }, [404]);\n\
    \    var analysisId;\n    if (res.statusCode === 404) {\n        var dBotScore\
    \ = [{Indicator: hash, Type: 'hash', Vendor: 'Intezer', Score: 0}];\n        var\
    \ file = {\n            SHA256: hash,\n            ExistsInIntezer: false\n  \
    \      };\n        var ec = { };\n        ec[outputPaths.file] = file;\n     \
    \   ec.DBotScore = dBotScore;\n\n        return {\n            Type: entryTypes.note,\n\
    \            Contents: '',\n            ContentsFormat: formats.json,\n      \
    \      HumanReadable: 'Hash ' + hash + ' does not exist on Intezer genome database',\n\
    \            ReadableContentsFormat: formats.markdown,\n            EntryContext:\
    \ ec\n          };\n    } else if (res.statusCode === 201) {\n        analysisId\
    \ = res.obj.analysis_id;\n    } else {\n        throw ERROR_PREFIX + 'Failed to\
    \ create sha256 analysis for ' + hash + ', request status code: ' + res.statusCode\
    \ + '\\n';\n    }\n    return waitForResponse(analysisId, maxRetries, delay);\n\
    };\n\nvar analyzeUploadedFile = function(fileEntryId, codeItemType, maxRetries,\
    \ delay) {\n    var res = sendMultipartRequest(FILE_UPLOAD_URL, fileEntryId, {code_item_type:\
    \ codeItemType});\n    var analysisId;\n    if (res.statusCode === 201) {\n  \
    \      analysisId = res.obj.analysis_id;\n    } else {\n        throw ERROR_PREFIX\
    \ + 'Failed to create analysis, request status code: ' + res.statusCode + '\\\
    n';\n    }\n    return waitForResponse(analysisId, maxRetries, delay);\n};\n\n\
    var waitForResponse = function(analysisId, maxRetries, delay) {\n    var entry;\n\
    \    // perform wait loop\n    res = getAnalysis(analysisId);\n    var tries =\
    \ 0;\n    while (res.status !== SUCCESS_STATUS && tries < maxRetries) {\n    \
    \    // this means that status is 'in_progress' or 'queued'\n        tries++;\n\
    \        wait(delay); // wait {delay} seconds\n        res = getAnalysis(analysisId);\n\
    \    }\n    // if polling did not retrieve response after {delay * maxRetries}\
    \ seconds, return an error message\n    if (res.status !== SUCCESS_STATUS) {\n\
    \        throw ERROR_PREFIX + 'Failed to analyze, Try to change maxRetries or\
    \ delay arguments\\n';\n    } else {\n        // Create new indicator of sha256\
    \ according to verdict\n        var verdict = res.result.verdict;\n        var\
    \ hash = res.result.sha256;\n        var dbotScore = 0;\n        var ec = {};\n\
    \        ec.DBotScore = [];\n        ec[outputPaths.file] = [];\n\n        if\
    \ (verdict === 'malicious') {\n            dbotScore = 3;\n            var malFile\
    \ = {};\n            addMalicious(malFile, outputPaths.file, {\n             \
    \   SHA256: hash,\n                ExistsInIntezer: true,\n                Metadata:\
    \ res.result,\n                Malicious: {Vendor: 'Intezer'}\n            });\n\
    \            ec[outputPaths.file].push(malFile[outputPaths.file]);\n        }\
    \ else {\n            ec[outputPaths.file].push({\n                SHA256: hash,\n\
    \                ExistsInIntezer: true,\n                Metadata: res.result\n\
    \            });\n            if (verdict === 'suspicious') {\n              \
    \  dbotScore = 2;\n            } else if (verdict === 'trusted' || verdict ===\
    \ 'neutral') {\n                dbotScore = 1;\n            }\n        }\n\n \
    \       // Set DBot score\n        ec.DBotScore.push({Indicator: hash, Type: 'hash',\
    \ Vendor: 'Intezer', Score: dbotScore});\n\n        var data = res.result;\n \
    \       var md = '## Intezer analysis result\\n';\n        md += 'SHA256: ' +\
    \ hash + '\\n';\n        if (data.family) {\n            var familyType = data.family_type\
    \ ? ' (' + data.family_type + ')' : '';\n            md += 'Family: **' + data.family\
    \ + '**' + familyType + '\\n';\n        }\n        md += 'Verdict: **' + data.verdict\
    \ + '** (' + data.sub_verdict + ')\\n';\n        md += '[' + 'Analysis Link' +\
    \ '](' + data.analysis_url + ')\\n';\n        // set return entry with context\n\
    \        entry = {\n          Type: entryTypes.note,\n          Contents: res.body,\n\
    \          ContentsFormat: formats.json,\n          HumanReadable: md,\n     \
    \     ReadableContentsFormat: formats.markdown,\n          EntryContext: ec\n\
    \        };\n    }\n    return entry;\n};\n\nswitch (command) {\n    case 'test-module':\n\
    \        // send is available\n        return sendRequest('GET', IS_AVAILABLE_URL).obj.is_available;\n\
    \n    case 'file':\n        if ((args.sha256 && args.file) || (!args.sha256 &&\
    \ !args.file)) {\n            var error = 'Specify only 1 of the arguments: file,\
    \ sha256';\n            return {\n                Type: entryTypes.error,\n  \
    \              HumanReadable: error,\n                ReadableContentsFormat:\
    \ formats.text\n            };\n        }\n        var inputs = args.sha256? argToList(args.sha256)\
    \ : argToList(args.file);\n        var entries = [];\n        for (i=0; i < inputs.length;\
    \ i++) {\n            var entry = analyzeSHA256(inputs[i], args.codeItuemType,\
    \ args.maxRetries, args.delay);\n            entries.push(entry);\n        }\n\
    \        return entries;\n\n    case 'intezer-upload':\n        return analyzeUploadedFile(args.fileEntryId,\
    \ args.codeItemType, args.maxRetries, args.delay);\n    default:\n}"
  type: javascript
tests:
- No test - integration was deprecated, and doesn't need to be tested
toversion: 4.1.9
