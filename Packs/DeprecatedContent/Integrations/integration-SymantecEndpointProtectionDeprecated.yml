category: Endpoint
commonfields:
  id: Symantec Endpoint Protection
  version: -1
configuration:
- defaultvalue: ''
  display: Server (e.g. https://1.2.3.4:8446)
  name: server
  required: true
  type: 0
- defaultvalue: ''
  display: Authentication
  name: authentication
  required: true
  type: 9
- defaultvalue: ''
  display: SEPM domain for the user
  name: domain
  required: false
  type: 0
- defaultvalue: 'false'
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
deprecated: true
description: Query the Symantec Endpoint Protection Manager using the official REST
  API- DEPRECATED. Please use Symantec Endpoint Protection V2 integration instead.
detaileddescription: Integration with Symantec Endpoint Protection Manager using the
  sepm REST API - DEPRECATED. Please use Symantec Endpoint Protection V2 integration
  instead.
display: Symantec Endpoint Protection 14 (Deprecated)
hidden: false
image: data:image/png;base64,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
name: Symantec Endpoint Protection
script:
  commands:
  - arguments:
    - description: The columns to show.
      name: columns
    - description: The host name of computer. Wild card is supported as '*'.
      name: computerName
    - description: Indicates when a computer last updated its status. The default
        value of 0 gets all the results.
      name: lastUpdate
    - auto: PREDEFINED
      description: The list of OS to filter.
      name: os
      predefined:
      - CentOs
      - Debian
      - Fedora
      - MacOSX
      - Oracle
      - OSX
      - RedHat
      - SUSE
      - Ubuntu
      - Win10
      - Win2K
      - Win7
      - Win8
      - WinEmb7
      - WinEmb8
      - WinEmb81
      - WinFundamental
      - WinNT
      - Win2K3
      - Win2K8
      - Win2K8R2
      - WinVista
      - WinXP
      - WinXPEmb
      - WinXPProf64
    - description: The number of results to include on each page. The default is 20.
      name: pageSize
    deprecated: true
    description: Get information about endpoints.
    name: sep-endpoints-info
    outputs:
    - contextPath: SEPM.Endpoint.Hostname
      description: The endpoint's hostname.
    - contextPath: SEPM.Endpoint.Domain
      description: The endpoint's domain.
    - contextPath: SEPM.Endpoint.IPAddresses
      description: The endpoint's IP addresses.
    - contextPath: SEPM.Endpoint.OS
      description: The endpoint's OS information.
    - contextPath: SEPM.Endpoint.Description
      description: The endpoint's description.
    - contextPath: SEPM.Endpoint.MACAddresses
      description: The endpoint's MAC address.
    - contextPath: SEPM.Endpoint.BIOSVersion
      description: The endpoint's BIOS version.
    - contextPath: SEPM.Endpoint.DHCPServer
      description: The endpoint's DHCP server address.
  - arguments:
    - description: The IP of the endpoint.
      name: ip
    - description: The hostname of the endpoint.
      name: hostname
    - description: The timeout of the command.
      name: timeout
    - description: The polling interval of the command.
      name: interval
    deprecated: true
    description: Updates the content of the given client.
    name: sep-update-content
    outputs:
    - contextPath: SEPM.LastCommand.CommandDetails
      description: The details of the command.
    - contextPath: SEPM.LastCommand.CommandId
      description: The ID of the command.
  - arguments:
    - description: The IP of the endpoint.
      name: ip
    - auto: PREDEFINED
      description: Type of scan.
      name: scanType
      predefined:
      - ScanNow_Quick
      - ScanNow_Full
      - ScanNow_Custom
      required: true
    - description: The hostname of the endpoint.
      name: hostname
    - description: The timeout of the command.
      name: timeout
    - description: The polling interval of the command.
      name: interval
    deprecated: true
    description: Scans an endpoint.
    name: sep-scan
    outputs:
    - contextPath: SEPM.LastCommand.CommandDetails
      description: The details of the command.
    - contextPath: SEPM.LastCommand.CommandId
      description: The ID of the command.
  - arguments:
    - description: The columns to show.
      name: columns
    deprecated: true
    description: Get information about groups.
    name: sep-groups-info
    outputs:
    - contextPath: SEPM.Groups
      description: The list of groups.
  - arguments: []
    deprecated: true
    description: Get the system information (version, AV definition).
    name: sep-system-info
    outputs:
    - contextPath: SEPM.ServerAVDefVersion
      description: The serverAV definition version.
  - arguments:
    - description: The command ID.
      name: commandId
      required: true
    deprecated: true
    description: Retrieves the status of a command.
    name: sep-command-status
    outputs:
    - contextPath: SEPM.LastCommand.CommandDetails
      description: The details of the command.
    - contextPath: SEPM.LastCommand.CommandId
      description: The ID of the command.
  - arguments:
    - description: The IP address of the endpoint.
      name: ip
    - description: The hostname of the endpoint.
      name: hostname
    - description: The timeout of the command.
      name: timeout
    - description: The polling interval of the command.
      name: interval
    - auto: PREDEFINED
      description: The action type.
      name: actionType
      predefined:
      - Quarantine
      - Undo
      required: true
    deprecated: true
    description: Quarantines the endpoint according to its policy.
    name: sep-quarantine
    outputs:
    - contextPath: SEPM.LastCommand.CommandDetails
      description: The details of the command.
    - contextPath: SEPM.LastCommand.CommandId
      description: The ID of the command.
  - arguments: []
    deprecated: true
    description: Retrieves the client content.
    name: sep-client-content
    outputs:
    - contextPath: SEPM.ClientContentVersions
      description: The versions of the clients.
    - contextPath: SEPM.LastUpdated
      description: The last-updated date.
  script: "// Default timeout and interval parameters for polling the response\nCLIENT_COMMAND_PARAMETERS\
    \ = {\n    'sep-update-content'    : {'timeout': 120, 'interval': 10},\n    'sep-quarantine'\
    \        : {'timeout': 120, 'interval': 10},\n    // Don't poll for scan response\
    \ because it takes too long. The automation will do that\n    'sep-scan'     \
    \         : {'timeout': 1, 'interval': 1}\n}\n\nENDPOINTS_INFO_DEFAULT_COLUMNS\
    \ = [\n    'computerName',\n    'ipAddresses',\n    'operatingSystem',\n    'osBitness',\n\
    \    'cidsDefsetVersion',\n    'lastScanTime',\n    'description',\n    'quarantineDesc',\n\
    \    'domainOrWorkgroup',\n    'macAddresses',\n    'group',\n    'dhcpServer',\n\
    \    'biosVersion',\n    'virtualizationPlatform',\n    'computerTimeStamp',\n\
    \    'creationTime',\n    'agentTimestamp'\n]\n\nGROUPS_INFO_DEFAULT_COLUMNS =\
    \ [\n    'fullPathName',\n    'numberOfPhysicalComputers',\n    'numberOfRegisteredUsers',\n\
    \    'policySerialNumber',\n    'policyDate',\n    'description',\n    'created'\n\
    ]\n\nvar fixUrl = function(base) {\n    return ((base[base.length - 1] != '/')\
    \ ? (base + '/') : base);\n}\n\nvar buildArgs = function(args) {\n    sArgs =\
    \ Object.keys(args).map(function(key) {\n        return [key, args[key]].map(encodeURIComponent).join(\"\
    =\");\n    }).join(\"&\");\n    if (sArgs) {\n        return '?' + sArgs;\n  \
    \  } else {\n        return '';\n    }\n}\n\nvar buildClientXml = function(data)\
    \ {\n    return '<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    \ xmlns:cli=\"http://client.webservice.sepm.symantec.com/\"> \\\n            <soapenv:Header/><soapenv:Body>{0}</soapenv:Body></soapenv:Envelope>'.format(data);\n\
    }\n\nvar buildCommandXml = function(data) {\n    return '<soapenv:Envelope xmlns:soapenv=\"\
    http://schemas.xmlsoap.org/soap/envelope/\" xmlns:com=\"http://command.client.webservice.sepm.symantec.com/\"\
    > \\\n            <soapenv:Header/><soapenv:Body>{0}</soapenv:Body></soapenv:Envelope>'.format(data);\n\
    }\n\nvar parseResponse = function(resp) {\n    if (resp.StatusCode === 200) {\n\
    \        try {\n            return JSON.parse(resp.Body);\n        } catch (e)\
    \ {\n            return resp.Body;\n        }\n    } else {\n        err = resp.Status;\n\
    \        if (resp.Body) {\n            err += '\\n' + resp.Body;\n        }\n\
    \        throw err;\n    }\n}\n\nvar doAuth = function() {\n    url = fixUrl(params.server)\
    \ + 'sepm/api/v1/identity/authenticate';\n    body = {\n        username: (params.authentication\
    \ ? params.authentication.identifier : ''),\n        password: (params.authentication\
    \ ? params.authentication.password : ''),\n        domain: (params.domain ? params.domain\
    \ : '')\n    };\n    res = http(\n        url,\n        {\n            Method:\
    \ 'POST',\n            Headers: {\"Content-Type\": [\"application/json\"]},\n\
    \            Body: JSON.stringify(body),\n\n        },\n        params.insecure,\n\
    \        params.proxy\n    );\n\n    return res;\n};\n\nvar doGet = function(token,\
    \ raw, suffix) {\n    url = fixUrl(params.server) + suffix + buildArgs(args);\n\
    \    res = http(\n        url,\n        {\n            Method: 'GET',\n      \
    \      Headers: {'Authorization': ['Bearer ' + token]}\n        },\n        params.insecure,\n\
    \        params.proxy\n    );\n\n    if (raw) {\n        return res;\n    } else\
    \ {\n        return parseResponse(res);\n    }\n}\n\nvar doPost = function(token,\
    \ is_xml, suffix, body) {\n    url = fixUrl(params.server) + suffix;\n    res\
    \ = http(\n        url,\n        {\n            Method: 'POST',\n            Headers:\
    \ {'Authorization': ['Bearer ' + token]},\n            Body: body\n\n        },\n\
    \        params.insecure,\n        params.proxy\n    );\n\n    res = parseResponse(res);\n\
    \    if (is_xml) {\n        res = JSON.parse(x2j(res));\n    }\n\n    return res;\n\
    }\n\nvar systemInfo = function(token) {\n    versionJson = doGet(token, false,\
    \ 'sepm/api/v1/version');\n    avdefJson = doGet(token, false, 'sepm/api/v1/content/avdef/latest');\n\
    \n    var systemInfoJson = {\n        'version': versionJson,\n        'avdef':\
    \ avdefJson\n    };\n\n    var md = '## System Information\\n';\n    md += '###\
    \ Version\\n';\n    md += objToMd(versionJson);\n    md += '### AV Definitions\\\
    n';\n    md += objToMd(avdefJson);\n\n    return {\n        Type: entryTypes.note,\
    \ Contents: systemInfoJson, ContentsFormat: formats.json, HumanReadable: md,\n\
    \        EntryContext: {'SEPM.ServerAVDefVersion': systemInfoJson.avdef.publishedBySymantec}\n\
    \    };\n}\n\nvar clientContent = function(token) {\n    clientContentJson = doGet(token,\
    \ false, 'sepm/api/v1/stats/client/content');\n\n    var lastUpdatedDate = (new\
    \ Date(parseInt(clientContentJson.lastUpdated))).toString();\n    var md = '##\
    \ Client Content, last updated on {0}\\n'.format(lastUpdatedDate);\n    md +=\
    \ tblToMd('Client Content Versions', clientContentJson.clientDefStatusList);\n\
    \n    return {\n        Type: entryTypes.note, Contents: clientContentJson, ContentsFormat:\
    \ formats.json, HumanReadable: md,\n        EntryContext: {'SEPM.ClientContentVersions':\
    \ clientContentJson.clientDefStatusList, 'SEPM.LastUpdated': lastUpdatedDate}\n\
    \    };\n}\n\nvar endpointsInfo = function(token) {\n    var jsonRes = doGet(token,\
    \ false, 'sepm/api/v1/computers');\n\n    // Set the war room result\n    var\
    \ md = '## Endpoints Information';\n\n    if (args.computerName) {\n        md\
    \ += ', filtered for hostname: ' + args.computerName;\n    }\n    if(args.lastUpdate)\
    \ {\n        md += ', filtered for last updated status: ' + args.lastUpdate;\n\
    \    }\n    if(args.os){\n        md += ', filtered for os: ' + args.os;\n   \
    \ }\n    if(args.pageSize){\n        md += ', page size: ' + args.pageSize;\n\
    \    }\n\n    md += '\\n';\n\n    var entryContext = [];\n\n    var filteredJsonRes\
    \ = [];\n    jsonRes.content.forEach(function(content) {\n        filteredJsonRes.push(content);\n\
    \        // Set the entry context\n\n        entryContext.push({\n           \
    \ Hostname: content.computerName,\n            Domain: content.domainOrWorkgroup,\n\
    \            IPAddresses: content.ipAddresses,\n            OS: content.operatingSystem\
    \ + ' | ' + content.osBitness,\n            Description: content.description,\n\
    \            MACAddresses: content.macAddresses,\n            BIOSVersion: content.biosVersion,\n\
    \            DHCPServer: content.dhcpServer\n        });\n    });\n\n    if (args.columns)\
    \ {\n        if (args.columns == 'all' || args.columns == '*') {\n           \
    \ var columnsList = [];\n        } else {\n            columnsList = argToList(args.columns);\n\
    \        }\n    } else {\n        columnsList = ENDPOINTS_INFO_DEFAULT_COLUMNS;\n\
    \        columnsList.sort();\n    }\n\n    md += tblToMd('Endpoints', filteredJsonRes,\
    \ columnsList);\n    return {\n        Type: entryTypes.note,\n        Contents:\
    \ filteredJsonRes,\n        ContentsFormat: formats.json,\n        HumanReadable:\
    \ md,\n        EntryContext: {\n            'SEPM.Endpoint(val.computerName ==\
    \ obj.computerName)': entryContext\n        }\n    };\n}\n\nvar groupsInfo = function(token)\
    \ {\n    jsonRes = doGet(token, false, 'sepm/api/v1/groups');\n\n    // Set the\
    \ entry context\n    entryContext = {}\n    entryContext['SEPM.Groups'] = [];\n\
    \    jsonRes.content.forEach(function(entry) {\n        var group = {}\n     \
    \   GROUPS_INFO_DEFAULT_COLUMNS.forEach(function(h) {\n            group[h] =\
    \ entry[h];\n        });\n        entryContext['SEPM.Groups'].push(group);\n \
    \   });\n\n    // Set the war room result\n    if (args.columns) {\n        if\
    \ (args.columns == 'all' || args.columns == '*') {\n            columnsList =\
    \ [];\n        } else {\n            columnsList = argToList(args.columns);\n\
    \        }\n    } else {\n        columnsList = GROUPS_INFO_DEFAULT_COLUMNS;\n\
    \        columnsList.sort();\n    }\n\n    md = tblToMd('Groups Information',\
    \ jsonRes.content, columnsList);\n    return {Type: entryTypes.note, Contents:\
    \ jsonRes, ContentsFormat: formats.json, HumanReadable: md, EntryContext: entryContext};\n\
    }\n\nvar getComputerIdByIp = function(token, ip) {\n    xml = buildClientXml('<cli:getComputersByIP><ipAddresses>{0}</ipAddresses></cli:getComputersByIP>'.format(ip));\n\
    \    resJson = doPost(token, true, 'sepm/ws/v1/ClientService', xml);\n\n    return\
    \ resJson.Envelope.Body.getComputersByIPResponse.ComputerResult.computers.computerId;\n\
    }\n\nvar getComputerIdByHostname = function(token, hostname) {\n    xml = buildClientXml('<cli:getComputersByHostName><computerHostNames>{0}</computerHostNames></cli:getComputersByHostName>'.format(hostname));\n\
    \    resJson = doPost(token, true, 'sepm/ws/v1/ClientService', xml);\n\n    return\
    \ resJson.Envelope.Body.getComputersByHostNameResponse.ComputerResult.computers.computerId;\n\
    }\n\nvar getComputerId = function(token) {\n    if (args.ip) {\n        try {\n\
    \            computerId = getComputerIdByIp(token, args.ip);\n        } catch\
    \ (err) {\n            throw 'Failed to locate the endpoint by its IP address.';\n\
    \        }\n    } else if (args.hostname) {\n        try {\n            computerId\
    \ = getComputerIdByHostname(token, args.hostname);\n        } catch (err) {\n\
    \            throw 'Failed to locat the endpoint by its hostname.';\n        }\n\
    \    } else {\n        throw 'Please provide the IP address or the hostname of\
    \ endpoint.';\n    }\n\n    return computerId;\n}\n\nvar getCommandStatusDetails\
    \ = function(token, commandId) {\n    xml = buildCommandXml('<com:getCommandStatusDetails><commandID>{0}</commandID></com:getCommandStatusDetails>'.format(commandId));\n\
    \    resJson = doPost(token, true, 'sepm/ws/v1/CommandService', xml);\n\n    return\
    \ resJson;\n}\n\nvar pollResponse = function(token, commandId, timeout, interval)\
    \ {\n    retries = timeout / interval;\n    isDone = false;\n    for (var i =\
    \ 0; i < retries; i++) {\n        commandStatusJson = getCommandStatusDetails(token,\
    \ commandId);\n        cmdStatusDetail = commandStatusJson.Envelope.Body.getCommandStatusDetailsResponse.CommandStatusDetailResult.cmdStatusDetail;\n\
    \        stateId = cmdStatusDetail.stateId;\n        if (stateId == '2' || stateId\
    \ == '3') {\n            isDone = true;\n            break;\n        }\n\n   \
    \     wait(interval);\n    }\n\n    return {\n        'cmdStatusDetail': cmdStatusDetail,\n\
    \        'isDone': isDone\n    }\n}\n\nvar buildCommandResponseOutput = function(title,\
    \ commandId, message) {\n    cmdStatusDetail = response.cmdStatusDetail;\n   \
    \ delete cmdStatusDetail.hardwareKey;\n\n    md = '### ' + title + '\\n';\n  \
    \  md += objToMd(cmdStatusDetail) + '\\n';\n    md += '### Command ID: {0}\\n'.format(commandId);\n\
    \    md += '### ' + message;\n\n    return {Type: entryTypes.note, Contents: {'cmdStatusDetail':\
    \ cmdStatusDetail, 'commandId': commandId}, ContentsFormat: formats.json, HumanReadable:\
    \ md,\n            EntryContext: {'SEPM.LastCommand': {'CommandDetails': cmdStatusDetail,\
    \ 'CommandId': commandId}}};\n}\n\nvar runClientCommand = function(token, command)\
    \ {\n    try {\n        computerId = getComputerId(token);\n    }\n    catch (err)\
    \ {\n        return {Type: entryTypes.error, Contents: err, ContentsFormat: formats.json,\
    \ HumanReadable: err, EntryContext: {}};\n    }\n\n    timeout = args.timeout\
    \ ? parseInt(args.timeout) : CLIENT_COMMAND_PARAMETERS[command]['timeout'];\n\
    \    interval = args.interval ? parseInt(args.interval) : CLIENT_COMMAND_PARAMETERS[command]['interval'];\n\
    \n    switch (command) {\n        case 'sep-update-content':\n            commandId\
    \ = updateContent(token, computerId);\n            break;\n        case 'sep-scan':\n\
    \            commandId = scan(token, computerId);\n            break;\n      \
    \  case 'sep-quarantine':\n            commandId = quarantine(token, computerId);\n\
    \            break;\n        default:\n            throw 'Invalid command.';\n\
    \    }\n\n    response = pollResponse(token, commandId, timeout, interval);\n\
    \    endpoint = args.hostname ? args.hostname : args.ip;\n    title = 'Launched\
    \ {0} command for endpoint {1}, here is the output.\\n'.format(command, endpoint);\n\
    \n    if (response.isDone) {\n        message = 'Command is done.';\n    } else\
    \ if (command == 'sep-scan') {\n        message = 'Command is in progress.';\n\
    \    } else {\n        message = 'Command timed out after {0} second(s). Run !sep-command-status\
    \ to check again.'.format(timeout);\n    }\n\n    return buildCommandResponseOutput(title,\
    \ commandId, message);\n}\n\nvar commandStatus = function(token) {\n    // Poll\
    \ once for a response (timeout=1, interval=1)\n    response = pollResponse(token,\
    \ args.commandId, 1, 1);\n    message = response.isDone ? 'Command is done.' :\
    \ 'Command is in progress. Run !sep-command-status to check again.';\n\n    return\
    \ buildCommandResponseOutput('Command status:', args.commandId, message);\n}\n\
    \nvar updateContent = function(token, computerId) {\n    xml = buildCommandXml('<com:runClientCommandUpdateContent><computerGUIDList>{0}</computerGUIDList></com:runClientCommandUpdateContent>'.format(computerId));\n\
    \    resJson = doPost(token, true, 'sepm/ws/v1/CommandService', xml);\n    commandId\
    \ = resJson.Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.commandId;\n\
    \n    if(!commandId) {\n        errorCode = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorCode');\n\
    \        errorMessage = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorMessage');\n\
    \        if(errorCode || errorMessage){\n          throw 'An error response has\
    \ returned from server: ' + errorMessage + ' with code: ' + errorCode;\n     \
    \   } else {\n          throw 'Could not retrieve command ID, no error was returned\
    \ from server';\n        }\n    }\n\n    return commandId;\n}\n\nvar scan = function(token,\
    \ computerId) {\n    xml = buildCommandXml('<com:runClientCommandScan><computerGUIDList>{0}</computerGUIDList><scanType>{1}</scanType></com:runClientCommandScan>'.format(computerId,\
    \ args.scanType));\n    resJson = doPost(token, true, 'sepm/ws/v1/CommandService',\
    \ xml);\n    commandId = resJson.Envelope.Body.runClientCommandScanResponse.CommandClientResult.commandId;\n\
    \n    if(!commandId) {\n        errorCode = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorCode');\n\
    \        errorMessage = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorMessage');\n\
    \        if(errorCode || errorMessage){\n          throw 'An error response has\
    \ returned from server: ' + errorMessage + ' with code: ' + errorCode;\n     \
    \   } else {\n          throw 'Could not retrieve command ID, no error was returned\
    \ from server';\n        }\n    }\n\n    return commandId;\n}\n\nvar quarantine\
    \ = function(token, computerId) {\n    xml = buildCommandXml('<com:runClientCommandQuarantine><command><commandType>{0}</commandType><targetObjectIds>{1}</targetObjectIds><targetObjectType>COMPUTER</targetObjectType></command></com:runClientCommandQuarantine>'.format(args.actionType,\
    \ computerId));\n    resJson = doPost(token, true, 'sepm/ws/v1/CommandService',\
    \ xml);\n    commandId = resJson.Envelope.Body.runClientCommandQuarantineResponse.CommandClientResult.commandId;\n\
    \n    if(!commandId) {\n        errorCode = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorCode');\n\
    \        errorMessage = dq(resJson, 'Envelope.Body.runClientCommandUpdateContentResponse.CommandClientResult.inputErrors.errorMessage');\n\
    \        if(errorCode || errorMessage){\n          throw 'An error response has\
    \ returned from server: ' + errorMessage + ' with code: ' + errorCode;\n     \
    \   } else {\n          throw 'Could not retrieve command ID, no error was returned\
    \ from server';\n        }\n    }\n\n    return commandId;\n}\n\nvar resp = doAuth(params);\n\
    var token;\nif (resp.StatusCode === 200) {\n    token = JSON.parse(resp.Body).token;\n\
    } else {\n    return resp;\n}\n\nswitch (command) {\n    case 'test-module':\n\
    \        if (resp.StatusCode === 200) {\n            return 'ok';\n        } else\
    \ if (resp.Status) {\n            return resp.Status;\n        } else {\n    \
    \        return resp;\n        }\n        break;\n    case 'sep-system-info':\n\
    \        return systemInfo(token);\n    case 'sep-client-content':\n        return\
    \ clientContent(token);\n    case 'sep-endpoints-info':\n        return endpointsInfo(token);\n\
    \    case 'sep-groups-info':\n        return groupsInfo(token);\n    case 'sep-command-status':\n\
    \        return commandStatus(token);\n    case 'sep-update-content':\n    case\
    \ 'sep-scan':\n    case 'sep-quarantine':\n        return runClientCommand(token,\
    \ command);\n    default:\n}"
  type: javascript
tests:
- No test - deprecated integration
toversion: 4.1.9
