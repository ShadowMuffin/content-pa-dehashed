category: Data Enrichment & Threat Intelligence
commonfields:
  id: ThreatExchange
  version: -1
configuration:
- defaultvalue: https://graph.facebook.com
  display: Server URL (e.g. https://192.168.0.1)
  name: Server
  required: true
  type: 0
- defaultvalue: ''
  display: App ID
  name: appID
  required: true
  type: 0
- defaultvalue: ''
  display: App Secret
  name: appSecret
  required: true
  type: 4
- defaultvalue: 'true'
  display: Use system proxy settings
  name: useproxy
  required: false
  type: 8
- defaultvalue: 'false'
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: v2.8
  display: Api version
  name: apiVersion
  required: true
  type: 0
description: Receive threat intelligence about applications, IP addresses, URLs and
  hashes, a service by Facebook
detaileddescription: 'For more info look at : https://developers.facebook.com/products/threat-exchange'
display: ThreatExchange
fromversion: 2.5.0
hidden: false
image: data:image/png;base64,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
name: ThreatExchange
script:
  commands:
  - arguments:
    - default: true
      description: Hash of the file to query. Supports MD5, SHA1 and SHA256 hashes.
      name: file
      required: true
    - defaultValue: '20'
      description: The maximum number of results per page. The maximum is 1000. Default
        is 20.
      name: limit
    - description: 'A comma-separated list of headers to display in human-readable
        format. For example: header1,header2,header3'
      name: headers
    - description: 'The start timestamp for collecting malware, format: 1391813489'
      name: since
    - description: 'The end timestamp for collecting malware, format: 1391813489'
      name: until
    description: Checks the file reputation of the given hash.
    name: file
    outputs:
    - contextPath: File.MD5
      description: Bad MD5 hash found.
    - contextPath: File.SHA1
      description: Bad SHA1 hash found.
    - contextPath: File.SHA256
      description: Bad SHA256 hash found.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason that the vendor made the decision.
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor.
  - arguments:
    - default: true
      description: IP address to check.
      name: ip
      required: true
    - description: 'A comma-separated list of headers to display in human-readable
        format. For example: header1,header2,header3.'
      name: headers
    description: Checks the reputation of the given IP address.
    name: ip
    outputs:
    - contextPath: IP.Address
      description: Bad IP address found.
    - contextPath: IP.Malicious.Vendor
      description: For malicious IPs addresse, the vendor that made the decision.
    - contextPath: IP.Malicious.Description
      description: For malicious IP addresses, the reason that the vendor made the
        decision.
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: IP.Malicious.Score
      description: For malicious IP addresses, the score from the vendor.
  - arguments:
    - description: URL to be checked
      name: url
      required: true
    - defaultValue: '20'
      description: The maximum number of results per page. The maximum is 1000. Default
        is 20.
      name: limit
    - description: 'Headers to display in Human readable format, comma separated format,
        for example: header1,header2,header3'
      name: headers
    - description: 'The start timestamp for collecting malware, format: 1391813489'
      name: since
    - description: 'The end timestamp for collecting malware, format: 1391813489'
      name: until
    description: Check URL Reputation
    name: url
    outputs:
    - contextPath: URL.Data
      description: Bad URLs found
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason for the vendor to make the decision
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor
  - arguments:
    - default: true
      description: Domain name to check reputation
      name: domain
      required: true
    - defaultValue: '20'
      description: The maximum number of results per page. The maximum is 1000. Default
        is 20.
      name: limit
    - description: 'Headers to display in Human readable format, comma separated format,
        for example: header1,header2,header3'
      name: headers
    - description: 'The start timestamp for collecting malware, format: 1391813489'
      name: since
    - description: 'The end timestamp for collecting malware, format: 1391813489'
      name: until
    description: Check domain reputation
    name: domain
    outputs:
    - contextPath: Domain.Name
      description: Bad domain found
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
    - contextPath: DBotScore.Type
      description: The indicator type.
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
    - contextPath: DBotScore.Score
      description: The actual score.
    - contextPath: Domain.Malicious.Vendor
      description: For malicious domains, the vendor that made the decision
    - contextPath: Domain.Malicious.Description
      description: For malicious domains, the reason that the vendor made the decision.
  - arguments:
    - default: true
      description: Free-form text field with a value to search for. This can be a
        file hash or a string found in other fields of the objects.
      name: text
    - description: 'The type of descriptor to search for. For more information see:
        https://developers.facebook.com/docs/threat-exchange/reference/apis/indicator-type/v2.9'
      name: type
    - defaultValue: '20'
      description: The maximum number of results per page. The maximum is 1000. Default
        is 20.
      name: limit
    - description: 'Headers to display in Human readable format, comma separated format,
        for example: header1,header2,header3'
      name: headers
    - description: 'The start timestamp for collecting malware, format: 1391813489'
      name: since
    - description: 'The end timestamp for collecting malware, format: 1391813489'
      name: until
    description: ' Searches for subjective opinions on indicators of compromise stored
      in ThreatExchange'
    name: threatexchange-query
  - arguments: []
    description: Returns a list of current members of the ThreatExchange, alphabetized
      by application name. Each application may also include an optional contact email
      address. You can set this address, if desired, under the settings panel for
      your application
    name: threatexchange-members
  script: "var serverUrl = params.Server;\nif (serverUrl[serverUrl.length - 1] !==\
    \ '/') {\n    serverUrl += '/';\n}\n\nvar defaultLimit = 20;\n\nvar doReq = function(method,\
    \ path, parameters) {\n    if (!parameters) {\n        parameters = {};\n    }\n\
    \    parameters.access_token = params.appID + '|' + params.appSecret;\n    var\
    \ result = http(\n        serverUrl + '/' + params.apiVersion + '/'+ path + (method\
    \ === 'GET' ? encodeToURLQuery(parameters) : ''),\n        {\n            Headers:\
    \ {'Content-Type': ['application/x-www-form-urlencoded'], 'Accept': ['application/json']},\n\
    \            Method: method,\n            Body: method == 'POST' ? encodeToURLQuery(parameters).substring(1)\
    \ : ''\n        },\n        params.insecure,\n        params.useproxy\n    );\n\
    \    if (result.StatusCode < 200 || result.StatusCode > 299) {\n        throw\
    \ 'Failed to perform request ' + path + ', request status code: ' + result.StatusCode\
    \ + ' with Body: '+ result.Body;\n    }\n    if (result.Body === '') {\n     \
    \   throw 'No content recieved for ThreatExchange path: '+path;\n    }\n    var\
    \ obj;\n    try {\n        obj = JSON.parse(result.Body);\n    } catch (ex) {\n\
    \        throw 'Error parsing reply - ' + result.Body + ' - ' + ex;\n    }\n \
    \   return {body: result.Body, obj: obj, statusCode: result.StatusCode};\n};\n\
    \nvar doFile = function(hash) {\n    var limit = defaultLimit;\n    if (args.limit)\
    \ {\n        limit = args.limit;\n    }\n    var argsForCall = {text: hash, limit:\
    \ limit, strict_text: true};\n    if (args.since) {\n        argsForCall.since\
    \ = args.since;\n    }\n    if (args.until) {\n        argsForCall.until = args.until;\n\
    \    }\n    var res = doReq('GET', 'malware_analyses', argsForCall);\n    var\
    \ data = res.obj.data;\n    var ec = {};\n    ec.DBotScore = [];\n    if (data.length\
    \ === 0) {\n        ec.DBotScore.push({\n            Indicator: hash,\n      \
    \      Type: 'hash',\n            Vendor: 'ThreatExchange',\n            Score:\
    \ 0\n        });\n        ec.DBotScore.push({\n            Indicator: hash,\n\
    \            Type: 'file',\n            Vendor: 'ThreatExchange',\n          \
    \  Score: 0\n        })\n\n        return {Type: entryTypes.note, Contents: res.body,\
    \ ContentsFormat: formats.json,\n            HumanReadable: 'ThreatExchange does\
    \ not have details about ' + hash + '\\n',\n            EntryContext: ec\n   \
    \     };\n    }\n    ec[outputPaths.file] = [];\n    var md = tblToMd('ThreatExchange\
    \ Hash Reputation', data, argToList(args.headers));\n    for (var i=0; i<data.length;\
    \ i++) {\n        var dbotScore = 0;\n        if (data[i].status == 'MALICIOUS')\
    \ {\n            dbotScore = 3;\n            var malFile = {};\n            addMalicious(malFile,outputPaths.file,{MD5:\
    \ data[i].md5, SHA1: data[i].sha1, SHA256: data[i].sha256, Malicious: {Vendor:\
    \ 'ThreatExchange', Description: data[i].description}});\n            ec[outputPaths.file].push(malFile[outputPaths.file]);\n\
    \        } else if (data[i].status == 'SUSPICIOUS') {\n            dbotScore =\
    \ 2;\n        } else if (data[i].status == 'NON_MALICIOUS'){\n            dbotScore\
    \ = 1;\n        }\n        ec.DBotScore.push({\n            Indicator: hash,\n\
    \            Type: 'hash',\n            Vendor: 'ThreatExchange',\n          \
    \  Score: dbotScore\n        });\n        ec.DBotScore.push({\n            Indicator:\
    \ hash,\n            Type: 'file',\n            Vendor: 'ThreatExchange',\n  \
    \          Score: dbotScore\n        })\n    }\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: res.body,\n        ContentsFormat: formats.json,\n        HumanReadable:\
    \ md,\n        EntryContext: ec\n    };\n};\n\nvar dbotTypeHashList = function(hash,\
    \ score)\n{\n    return [{\n            Indicator: hash,\n            Type: 'hash',\n\
    \            Vendor: 'ThreatExchange',\n            Score: score\n        },\n\
    \        {\n            Indicator: hash,\n            Type: 'file',\n        \
    \    Vendor: 'ThreatExchange',\n            Score: score\n        }\n        ]\n\
    }\n\nvar doIP = function(ip) {\n    if (!isValidIP(ip)) {\n        return {Type:\
    \ entryTypes.error, Contents: 'IP - ' + ip + ' is not valid IP', ContentsFormat:\
    \ formats.text};\n    }\n    var limit = defaultLimit;\n    if (args.limit) {\n\
    \        limit = args.limit;\n    }\n    var argsForCall = {text: ip, limit: limit,\
    \ strict_text: true, type: 'IP_ADDRESS'};\n    if (args.since) {\n        argsForCall.since\
    \ = args.since;\n    }\n    if (args.until) {\n        argsForCall.until = args.until;\n\
    \    }\n    var res = doReq('GET', 'threat_descriptors', argsForCall);\n    var\
    \ data = res.obj.data;\n    var ec = {};\n    ec.DBotScore = [];\n    if (data.length\
    \ === 0) {\n        ec.DBotScore.push({\n            Indicator: ip,\n        \
    \    Type: 'ip',\n            Vendor: 'ThreatExchange',\n            Score: 0\n\
    \        });\n        return {\n            Type: entryTypes.note,\n         \
    \   Contents: res.body,\n            ContentsFormat: formats.json,\n         \
    \   HumanReadable: 'ThreatExchange does not have details about ' + ip + '\\n',\n\
    \            EntryContext: ec\n        };\n    }\n    ec[outputPaths.ip] = [];\n\
    \    var md = tblToMd('ThreatExchange IP Reputation', data, argToList(args.headers));\n\
    \    for (var i=0; i<data.length; i++) {\n        var dbotScore = 0;\n       \
    \ if (data[i].status == 'MALICIOUS') {\n            dbotScore = 3;\n         \
    \   // not really an array, so I can override\n            addMalicious(ec, outputPaths.ip,\
    \ {\n                Address: ip,\n                Malicious: {\n            \
    \        Vendor: 'ThreatExchange',\n                    Description: data[i].description\n\
    \                }\n            });\n        } else if (data[i].status == 'SUSPICIOUS')\
    \ {\n            dbotScore = 2;\n        } else if (data[i].status == 'NON_MALICIOUS'){\n\
    \            dbotScore = 1;\n        }\n        ec.DBotScore.push({\n        \
    \    Indicator: ip,\n            Type: 'ip',\n            Vendor: 'ThreatExchange',\n\
    \            Score: dbotScore\n        });\n    }\n    return {\n        Type:\
    \ entryTypes.note,\n        Contents: res.body,\n        ContentsFormat: formats.json,\n\
    \        HumanReadable: md,\n        EntryContext: ec\n    };\n};\n\nvar doURL\
    \ = function(url) {\n    var limit = defaultLimit;\n    if (args.limit) {\n  \
    \      limit = args.limit;\n    }\n    var argsForCall = {text: url, limit: limit,\
    \ strict_text: true, type: 'URI'};\n    if (args.since) {\n        argsForCall.since\
    \ = args.since;\n    }\n    if (args.until) {\n        argsForCall.until = args.until;\n\
    \    }\n    var res = doReq('GET', 'threat_descriptors', argsForCall);\n    var\
    \ data = res.obj.data;\n    var ec = {};\n    ec.DBotScore = [];\n    if (data.length\
    \ === 0) {\n        ec.DBotScore.push({\n            Indicator: url,\n       \
    \     Type: 'url',\n            Vendor: 'ThreatExchange',\n            Score:\
    \ 0\n        });\n        return {\n            Type: entryTypes.note,\n     \
    \       Contents: res.body,\n            ContentsFormat: formats.json,\n     \
    \       HumanReadable: 'ThreatExchange does not have details about ' + url + '\\\
    n',\n            EntryContext: ec\n        };\n    }\n    ec[outputPaths.url]\
    \ = [];\n    var md = tblToMd('ThreatExchange URL Reputation', data, argToList(args.headers));\n\
    \    for (var i=0; i<data.length; i++) {\n        var dbotScore = 0;\n       \
    \ if (data[i].status == 'MALICIOUS') {\n            dbotScore = 3;\n         \
    \   // not really an array, so I can override\n            addMalicious(ec, outputPaths.url,\
    \ {\n                Data: url,\n                Malicious: {\n              \
    \      Vendor: 'ThreatExchange',\n                    Description: data[i].description\n\
    \                }\n            });\n        } else if (data[i].status == 'SUSPICIOUS'){\n\
    \            dbotScore = 2;\n        } else if (data[i].status == 'NON_MALICIOUS'){\n\
    \            dbotScore = 1;\n        }\n        ec.DBotScore.push({\n        \
    \    Indicator: url,\n            Type: 'url',\n            Vendor: 'ThreatExchange',\n\
    \            Score: dbotScore\n        });\n    }\n    return {\n        Type:\
    \ entryTypes.note,\n        Contents: res.body,\n        ContentsFormat: formats.json,\n\
    \        HumanReadable: md,\n        EntryContext: ec\n    };\n};\n\nvar doDomain\
    \ = function(domain) {\n    var limit = defaultLimit;\n    if (args.limit) {\n\
    \        limit = args.limit;\n    }\n    var argsForCall = {\n        text: domain,\n\
    \        limit: limit,\n        strict_text: true,\n        type: 'DOMAIN'\n \
    \   };\n\n    if (args.since) {\n        argsForCall.since = args.since;\n   \
    \ }\n    if (args.until) {\n        argsForCall.until = args.until;\n    }\n \
    \   var res = doReq('GET', 'threat_descriptors', argsForCall);\n    var data =\
    \ res.obj.data;\n    var ec = {};\n    ec.DBotScore = [];\n    if (data.length\
    \ === 0) {\n        ec.DBotScore.push({\n            Indicator: domain,\n    \
    \        Type: 'domain',\n            Vendor: 'ThreatExchange',\n            Score:\
    \ 0\n        });\n        return {\n            Type: entryTypes.note,\n     \
    \       Contents: res.body,\n            ContentsFormat: formats.json,\n     \
    \       HumanReadable: 'ThreatExchange does not have details about ' + domain\
    \ + '\\n',\n            EntryContext: ec\n        };\n    }\n    ec[outputPaths.domain]\
    \ = [];\n    var md = tblToMd('ThreatExchange Domain Reputation', data, argToList(args.headers));\n\
    \    for (var i=0; i<data.length; i++) {\n        var dbotScore = 0;\n       \
    \ if (data[i].status == 'MALICIOUS') {\n            dbotScore = 3;\n         \
    \   addMalicious(ec, outputPaths.domain, {\n                Name: domain,\n  \
    \              Malicious: {\n                    Vendor: 'ThreatExchange',\n \
    \                   Description: data[i].description\n                }\n    \
    \        });\n        } else if (data[i].status == 'SUSPICIOUS') {\n         \
    \   dbotScore = 2;\n        } else if (data[i].status == 'NON_MALICIOUS'){\n \
    \           dbotScore = 1;\n        }\n        ec.DBotScore.push({\n         \
    \   Indicator: domain,\n            Type: 'domain',\n            Vendor: 'ThreatExchange',\n\
    \            Score: dbotScore\n        });\n    }\n    return {\n        Type:\
    \ entryTypes.note,\n        Contents: res.body,\n        ContentsFormat: formats.json,\n\
    \        HumanReadable: md,\n        EntryContext: ec\n    };\n};\n\nvar doQuery\
    \ = function(text) {\n    var limit = defaultLimit;\n    if (args.limit) {\n \
    \       limit = args.limit;\n    }\n    var argsForCall = {\n        limit: limit,\n\
    \        strict_text: false\n    };\n    if (args.type) {\n        argsForCall.type\
    \ = args.type;\n    }\n    if (args.text) {\n        argsForCall.text = args.text;\n\
    \    }\n    if (args.since) {\n        argsForCall.since = args.since;\n    }\n\
    \    if (args.until) {\n        argsForCall.until = args.until;\n    }\n    var\
    \ res = doReq('GET', 'threat_descriptors', argsForCall);\n    var data = res.obj.data;\n\
    \    if (data.length === 0) {\n        return {\n            Type: entryTypes.note,\n\
    \            Contents: res.body,\n            ContentsFormat: formats.json,\n\
    \            HumanReadable: 'ThreatExchange does not have details about ' + text\
    \ + '\\n'\n        };\n    }\n    var ec = {};\n    ec.queryResult = data;\n \
    \   var md = tblToMd('ThreatExchange Query Result', data, argToList(args.headers));\n\
    \    return {\n        Type: entryTypes.note,\n        Contents: res.body,\n \
    \       ContentsFormat: formats.json,\n        HumanReadable: md,\n        EntryContext:\
    \ ec\n    };\n};\n\nvar doMembers = function() {\n    var res = doReq('GET', 'threat_exchange_members',\
    \ {});\n    var data = res.obj.data;\n    var md = tblToMd('ThreatExchange Members',\
    \ data, argToList(args.headers));\n    return {\n        Type: entryTypes.note,\n\
    \        Contents: res.body,\n        ContentsFormat: formats.json,\n        HumanReadable:\
    \ md\n    };\n};\n\nswitch (command) {\n    case 'test-module':\n        doFile('d2b4a84e2b69856ba8e234f55b1fbc4b');\
    \ // Check File Hash d2b4a84e2b69856ba8e234f55b1fbc4b - it will throw an error\
    \ if not successful\n        return true;\n    case 'file':\n        return doFile(args.file);\n\
    \    case 'ip':\n        return doIP(args.ip);\n    case 'url':\n        return\
    \ doURL(args.url);\n    case 'domain':\n        return doDomain(args.domain);\n\
    \    case 'threatexchange-query':\n        return doQuery(args.text);\n    case\
    \ 'threatexchange-members':\n        return doMembers();\n    default:\n     \
    \   throw 'Unknown command - ' + command;\n}"
  type: javascript
tests:
- ThreatExchange-test
toversion: 4.1.9
